var __extends=this&&this.__extends||function(b,a){function c(){this.constructor=b}for(var d in a)a.hasOwnProperty(d)&&(b[d]=a[d]);b.prototype=null===a?Object.create(a):(c.prototype=a.prototype,new c)};
(function(){function b(c,a,b){var b=b(),g,h;switch(typeof b){case "string":case "number":h=b;g=c.toLowerCase();break;case "object":h="function"==typeof b.value?b.value():b.value,g=b.type+c}h&&$(a)[g](h)}function a(c){var c=$("span[formulaData]",c),a=c.length;c.each(function(c,a){var d=$(a),b=$("<span></span>"),e=d.attr("id"),k=d.attr("class"),l=d.attr("formulaType"),d=d.attr("formulaData");b.attr("id",e);if(k){e=k.split(" ");for(k=0;k<e.length;k++)if("bold"==e[k]||"italic"==e[k])e[k]="formula"+e[k];
b.attr("class",e.join(" "))}"Latex"==l?b.html("\\("+d+"\\)"):"AsciiMath"==l?b.html("`"+d+"`"):"MathML"==l&&(b.html(d),$(b).children().attr("display","inline"));$(a).after($(b))});c.remove();return a}function c(c){$(".tooltip__icon",c).each(function(c,a){var d=$(a),b=d.prev();b.hasClass("tooltip__text")&&(d.appendTo(b),d.html(d.attr("data-tooltip")))})}ko.bindingHandlers.visibility={init:function(c,a){$(c).css("visibility",a()?"visible":"hidden")},update:function(c,a){$(c).css("visibility",a()?"visible":
"hidden")}};ko.bindingHandlers.id={init:function(c,a){$(c).attr("id",a())},update:function(c,a){$(c).attr("id",a())}};ko.bindingHandlers.outerTemplate={init:function(){return{controlsDescendantBindings:!0}},update:function(c,a,b,g,h){var i;try{i=ko.unwrap(a()).data}catch(j){i=null}i?ko.applyBindingsToNode(c,{attr:{id:i.slideId,"class":i.exerciseClass},template:{name:"OuterTemplate",afterRender:function(){applicationViewModel.sliderViewModel.isRendered(!0)}}},h.createChildContext(i)):ko.applyBindingsToNode(c,
{template:"LoadingTemplate"},h);return{controlsDescendantBindings:!0}}};ko.bindingHandlers.exerciseTemplate={init:function(){return{controlsDescendantBindings:!0}},update:function(c,a,b,g,h){var i;try{i=ko.unwrap(a()).data}catch(j){i=null}i&&i.contentViewModel()&&ko.applyBindingsToNode(c,{template:{name:i.contentViewModel().layoutTemplate(),afterRender:function(){i.isRendered(!0);applicationViewModel.eventManager.triggerExercisePreloadEvent(i)}}},h.createChildContext(i.contentViewModel()));return{controlsDescendantBindings:!0}}};
ko.bindingHandlers.height={init:function(c,a){b("Height",c,a)},update:function(c,a){b("Height",c,a)}};ko.bindingHandlers.width={init:function(c,a){b("Width",c,a)},update:function(c,a){b("Width",c,a)}};ko.bindingHandlers.backgroundImage={init:function(c,a){$(c).css("background-image","url("+a()+")")},update:function(c,a){$(c).css("background-image","url("+a()+")")}};ko.bindingHandlers.top={init:function(c,a){$(c).css("top",a())},update:function(c,a){$(c).css("top",a())}};ko.bindingHandlers.richtext=
{init:function(d,b,f,g,h){f=ko.utils.unwrapObservable(b());(b=$($.parseHTML(f)))&&b.length&&b.hasClass("richText")?(f=a(b),c(b),$("li",b).each(function(c,a){var d=$(a).children()[0];null!=d&&d.className.match("emphasize")&&1==$(a).children().length&&$(a).attr("class",d.className+"-color")}),ko.applyBindingsToNode(d,{html:b[0].outerHTML},h),0<f&&MathJax.Hub.Queue(["Typeset",MathJax.Hub,d])):ko.applyBindingsToNode(d,{html:f},h)},update:function(d,b,f,g,h){f=ko.utils.unwrapObservable(b());(b=$($.parseHTML(f)))&&
b.length&&b.hasClass("richText")?(f=a(b),c(b),$("li",b).each(function(c,a){$(a);var d=$(a).children()[0];null!=d&&d.className.match("emphasize")&&1==$(a).children().length&&$(a).attr("class",d.className+"-color")}),ko.applyBindingsToNode(d,{html:b[0].outerHTML},h),0<f&&MathJax.Hub.Queue(["Typeset",MathJax.Hub,d])):ko.applyBindingsToNode(d,{html:f},h)}}})();
var PlatformFeatures=function(){function b(){var a=this;this.innerHeight=ko.observable(0);this.innerWidth=ko.observable(0);this.getIsPhoneLandscape=this.getIsPhonePortrait=null;this.forceDevice="";this.autoPlayEnabled=!0;this.androidVersion=function(){var c=c||navigator.userAgent;return(c=c.match(/Android\s([0-9\.]*)/))?c[1]:!1}();this.iosVersion=(""+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",
"");this.windowsPhoneVersion=function(){var c=c||navigator.userAgent;return(c=c.match(/Windows Phone\s([0-9\.]*)/))?c[1]:!1}();this.isPhone=this.isWebKit=!1;this.transitionSupported=Transition.none;this.feedbackDelay=500;this.autoTransition=this.nativeScrollbar=this.isJqueryTransitionSupported=!1;this.css="";this.navigationMode=NavigationMode.jquery;this.showFriezeButtons=this.autoHideNavigationButton=!0;this.allowManualSwipe=this.showOverlayAtStartup=!1;this.autoHideFrieze=!0;this.HDqualityCookieTimeOut=
1;this.useNativePlayerControls=!1;this.divContentCssClassName="";this.preloadAfter=this.preloadBefore=1;this.requiresDelayedVideoFeedback=!1;this.sliderName="ckslider";this.log("debug","constructor","Device : "+navigator.userAgent);this.forceDevice=AjaxLoader.getUrlParameterValue("device");this.isIE=-1!=navigator.userAgent.indexOf("MSIE")||-1!=navigator.userAgent.indexOf("Trident")||-1!=navigator.userAgent.indexOf("Edge");this.isIE6=-1!=navigator.userAgent.indexOf("MSIE 6");this.isIE7=-1!=navigator.userAgent.indexOf("MSIE 7");
this.isIE8=-1!=navigator.userAgent.indexOf("MSIE 8");this.isIE9=-1!=navigator.userAgent.indexOf("MSIE 9");this.isIE10=-1!=navigator.userAgent.indexOf("MSIE 10");this.isIE11=-1!=navigator.userAgent.indexOf("Trident/7.0");this.isEdge=-1!=navigator.userAgent.indexOf("Edge");this.isAndroid=-1!=navigator.userAgent.indexOf("Android");this.isHudl=-1!=navigator.userAgent.indexOf("Hudl");this.isWin8Touch=-1!=navigator.userAgent.indexOf("MSIE 10")&&-1!=navigator.userAgent.indexOf("Touch");this.isWin10=-1!=
navigator.userAgent.indexOf("Windows NT 10.0");this.isWebKit=-1!=navigator.userAgent.indexOf("WebKit");this.isIPhone=-1!=navigator.userAgent.indexOf("iPhone")||-1!=navigator.userAgent.indexOf("iPod");if(this.isIPad=-1!=navigator.userAgent.indexOf("iPad")||-1!=navigator.platform.indexOf("Mac")&&1<navigator.maxTouchPoints)this.isIPad1=-1!=navigator.userAgent.indexOf("OS 5");if(this.isWindowsPhone=-1!=navigator.userAgent.indexOf("Windows Phone"))this.isIPhone=this.isAndroid=!1;this.isFirefox=-1<navigator.userAgent.indexOf("Firefox/");
this.isChrome=-1<navigator.userAgent.indexOf("Chrome/")&&!this.isEdge;this.isQQbrowser=-1<navigator.userAgent.toLowerCase().indexOf("qqbrowser");this.css=this.getIsDesktopMode()?"css/core-desktop.css":"css/core-tablet.css";this.getIsDeviceForced=ko.computed(function(){return"phone"===this.forceDevice||"tablet"===this.forceDevice},this);this.setNavigationMode(function(){var c=NavigationMode.jquery;a.getIsAndroid()&&0<=a.compareVersion(a.androidVersion,b.MINIMUM_ANDROID_VERSION_SWIPE)?(c=NavigationMode.swipe,
a.setAllowManualSwipe(!0)):a.getIsiOS()&&0<=a.compareVersion(a.iosVersion,b.MINIMUM_IOS_VERSION_SWIPE)||!a.getIsIPad1()&&a.getIsIPad()?(c=NavigationMode.swipe,a.setAllowManualSwipe(!0)):a.getIsWindowsPhone()&&0<=a.compareVersion(a.windowsPhoneVersion,b.MINIMUM_WINDOWSPHONE_VERSION_SWIPE)?(c=NavigationMode.swipe,a.setAllowManualSwipe(!0)):"phone"===a.forceDevice||"tablet"===a.forceDevice?(c=NavigationMode.swipe,a.setAllowManualSwipe(!0)):a.setAllowManualSwipe(!1);return c}());this.getIsDesktopMode()?
(this.setAutoHideNavigationButton(!0),this.setShowFriezeButtons(!0),this.setShowOverlayAtStartup(!1),this.setAutoHideFrieze(!0),this.setNativeScrollbar(!1),this.setAutoTransition(!0),this.setFeedbackDelay(this.getIsIE8()||this.getIsIE9()?500:100),this.preloadAfter=this.preloadBefore=1,this.isNodeWebkitApplication()&&(this.fixNodeWebkitExternalLink(),this.addNodeWebkitMacMenu())):(this.setAutoHideNavigationButton(!0),this.setShowFriezeButtons(!1),this.setShowOverlayAtStartup(ajaxLoader.getRuntimeMode()==
EnumRuntimeMode.LEARNER_LOCAL||ajaxLoader.getRuntimeMode()==EnumRuntimeMode.LEARNER),this.setAutoHideFrieze(!1),"phone"===this.forceDevice||"tablet"===this.forceDevice?this.setNativeScrollbar(!1):this.setNativeScrollbar(!0),this.setAutoTransition(!1),this.setFeedbackDelay(100),this.preloadAfter=this.preloadBefore=1,this.getIsPhone()?this.setHDqualityCookieTimeOut(0.02):this.setHDqualityCookieTimeOut(9999));this.requiresDelayedVideoFeedback=this.isWebKit?!1:!0;this.getIsIE8()||this.getIsIE9()||this.getIsIE10()?
this.setTransitionSupported(Transition.jquery):this.setTransitionSupported(Transition.css);var c=768<Math.max(screen.width,screen.height);this.setIsPhone(this.getIsIPhone()||this.getIsAndroid()&&!c||this.getIsWindowsPhone());this.getIsPhone()?this.setHDqualityCookieTimeOut(0.02):this.setHDqualityCookieTimeOut(9999);this.getIsPhone()&&this.setUseNativePlayerControls(!0);this.flashEnabled=8<swfobject.getFlashPlayerVersion().major&&this.getIsDesktopMode();this.getIsPhonePortrait=ko.computed(function(){return a.isPhone&&
a.innerHeight()>a.innerWidth()});this.getIsPhoneLandscape=ko.computed(function(){return a.isPhone&&a.innerHeight()<a.innerWidth()});this.sliderName=this.getIsIE8()||this.getIsIE9()?"slickjs":"ckslider"}b.prototype.addNodeWebkitMacMenu=function(){var a=require("nw.gui"),c=new a.Menu({type:"menubar"});"function"==typeof c.createMacBuiltin&&(c.createMacBuiltin("Mohive Module"),a.Window.get().menu=c)};b.prototype.disableAutoPlay=function(){this.autoPlayEnabled=!1};b.prototype.isAutoPlayEnabled=function(){return this.autoPlayEnabled};
b.prototype.fixNodeWebkitExternalLink=function(){var a=require("nw.gui");document.body.addEventListener("click",function(c){function d(f){if("a"===f.nodeName.toLowerCase()){if((b=f.getAttribute("href"))&&-1!=b.search("http"))a.Shell.openExternal(b),c.preventDefault()}else f.parentElement&&d(f.parentElement)}var b;d(c.target)},!1)};b.prototype.isThisAndroidSupportedByRuntime=function(){return this.androidVersion?this.getIsAndroid()&&0<=this.compareVersion(this.androidVersion,b.MINIMUM_ANDROID_VERSION):
null};b.prototype.isThisIOSSupportedByRuntime=function(){return this.iosVersion?0<=this.compareVersion(this.iosVersion,b.MINIMUM_IOS_VERSION):!0};b.prototype.isThisWindowsPhoneSupportedByRuntime=function(){return this.windowsPhoneVersion?0<=this.compareVersion(this.windowsPhoneVersion,b.MINIMUM_WINDOWSPHONE_VERSION):null};b.prototype.isPlatformSupported=function(){return this.getIsDesktopMode()||this.isThisAndroidSupportedByRuntime()||this.isThisIOSSupportedByRuntime()||this.isThisWindowsPhoneSupportedByRuntime()};
b.prototype.isFlashEnabled=function(){return this.flashEnabled};b.prototype.compareVersion=function(a,c){if("stringstring"!=typeof a+typeof c)return-2;for(var d=a.split("."),b=c.split("."),f=0,g=Math.max(d.length,b.length);f<g;f++){if(d[f]&&!b[f]&&0<parseInt(d[f])||parseInt(d[f])>parseInt(b[f]))return 1;if(b[f]&&!d[f]&&0<parseInt(b[f])||parseInt(d[f])<parseInt(b[f]))return-1}return 0};b.prototype.getIsSwipeEnabled=function(){return this.getNavigationMode()==NavigationMode.swipe};b.prototype.getSlideAnimationDuration=
function(){return this.getIsPhone()?400:800};b.prototype.getIsFirefox=function(){return this.isFirefox};b.prototype.getIsIE=function(){return this.isIE};b.prototype.getIsIPhone=function(){return this.isIPhone};b.prototype.getIsIE6=function(){return this.isIE6};b.prototype.getIsIE7=function(){return this.isIE7};b.prototype.getIsIE8=function(){return this.isIE8};b.prototype.getIsIE9=function(){return this.isIE9};b.prototype.getIsIE678=function(){return this.isIE6||this.isIE7||this.isIE8};b.prototype.getIsIE89=
function(){return this.isIE8||this.isIE9};b.prototype.getIsIE10=function(){return this.isIE10};b.prototype.getIsIE11=function(){return this.isIE11};b.prototype.getIsEdge=function(){return this.isEdge};b.prototype.getIsIPad=function(){return this.isIPad};b.prototype.getIsIPad1=function(){return this.isIPad1};b.prototype.getIsHudl=function(){return this.isHudl};b.prototype.getIsAndroid=function(){return this.isAndroid||"tablet"===this.forceDevice};b.prototype.getIsiOS=function(){return this.isIPad||
this.isIPhone};b.prototype.getIsChrome=function(){return this.isChrome};b.prototype.getIsQQBrowser=function(){return this.isQQbrowser};b.prototype.getIsWindowsPhone=function(){return this.isWindowsPhone};b.prototype.getIsWin8Touch=function(){return this.isWin8Touch};b.prototype.getIsWin10=function(){return this.isWin10};b.prototype.getIsWebkit=function(){return this.isWebKit};b.prototype.getIsLowPerformance=function(){return this.getIsIE89()||this.getIsHudl()};b.prototype.getIsPhone=function(){return this.isPhone||
"phone"===this.forceDevice};b.prototype.setIsPhone=function(a){this.isPhone=a};b.prototype.getFontSize=function(a,c){if(this.getIsPhone()){var d=14;this.getIsWindowsPhone()&&(d=12);return d}d=21/(1.5+Math.pow(Math.E,-0.0014*a+2))+8.5;2<=a/c&&(d-=5*Math.log(a/c-1));return Math.round(d)};b.prototype.getTransitionSupported=function(){return this.transitionSupported};b.prototype.setTransitionSupported=function(a){this.transitionSupported=a};b.prototype.getFeedbackDelay=function(){return this.feedbackDelay};
b.prototype.setFeedbackDelay=function(a){this.feedbackDelay=a};b.prototype.getIsJqueryTransitionSupported=function(){return this.isJqueryTransitionSupported};b.prototype.setIsJqueryTransitionSupported=function(a){this.isJqueryTransitionSupported=a};b.prototype.getNativeScrollbar=function(){return this.nativeScrollbar};b.prototype.setNativeScrollbar=function(a){this.nativeScrollbar=a};b.prototype.getAutoTransition=function(){return this.autoTransition};b.prototype.setAutoTransition=function(a){this.autoTransition=
a};b.prototype.getCss=function(){return this.css};b.prototype.getIsDesktopMode=function(){return this.isIPad||this.isIPhone||this.isAndroid||this.isWindowsPhone||"phone"===this.forceDevice||"tablet"===this.forceDevice?!1:!0};b.prototype.getIsMobileDevice=function(){return!this.getIsDesktopMode()};b.prototype.getNavigationMode=function(){return this.navigationMode};b.prototype.setNavigationMode=function(a){this.navigationMode=a;a=$body;this.setDivContentCssClassName("exercise-swipe-slide");a.addClass("swipe-sliding")};
b.prototype.getAutoHideNavigationButton=function(){return this.autoHideNavigationButton};b.prototype.setAutoHideNavigationButton=function(a){this.autoHideNavigationButton=a};b.prototype.getShowFriezeButtons=function(){return this.showFriezeButtons};b.prototype.setShowFriezeButtons=function(a){this.showFriezeButtons=a};b.prototype.getShowOverlayAtStartup=function(){return this.showOverlayAtStartup};b.prototype.setShowOverlayAtStartup=function(a){this.showOverlayAtStartup=a};b.prototype.getAllowManualSwipe=
function(){return this.allowManualSwipe};b.prototype.setAllowManualSwipe=function(a){this.allowManualSwipe=a};b.prototype.getAutoHideFrieze=function(){return this.autoHideFrieze};b.prototype.setAutoHideFrieze=function(a){this.autoHideFrieze=a};b.prototype.getHDqualityCookieTimeOut=function(){return this.HDqualityCookieTimeOut};b.prototype.setHDqualityCookieTimeOut=function(a){this.HDqualityCookieTimeOut=a};b.prototype.getUseNativePlayerControls=function(){return this.useNativePlayerControls};b.prototype.setUseNativePlayerControls=
function(a){this.useNativePlayerControls=a};b.prototype.getDivContentCssClassName=function(){return this.divContentCssClassName};b.prototype.setDivContentCssClassName=function(a){this.divContentCssClassName=a};b.prototype.getPreloadBefore=function(){return this.preloadBefore};b.prototype.getPreloadAfter=function(){return this.preloadAfter};b.prototype.isNodeWebkitApplication=function(){return"object"==typeof nwDispatcher};b.prototype.getRequiresDelayedVideoFeedback=function(){return this.requiresDelayedVideoFeedback};
b.prototype.log=function(a,c,d){logger[a]("[PlatformFeatures] "+c+" "+(d?d:""))};b.prototype.getSliderName=function(){return this.sliderName};b.MINIMUM_IOS_VERSION="7";b.MINIMUM_WINDOWSPHONE_VERSION="8";b.MINIMUM_ANDROID_VERSION="4";b.MINIMUM_IOS_VERSION_SWIPE="7";b.MINIMUM_ANDROID_VERSION_SWIPE="4.2";b.MINIMUM_WINDOWSPHONE_VERSION_SWIPE="10";return b}(),NavigationMode;(function(b){b[b.swipe=0]="swipe";b[b.jquery=1]="jquery"})(NavigationMode||(NavigationMode={}));var Transition;
(function(b){b[b.css=0]="css";b[b.jquery=1]="jquery";b[b.none=2]="none"})(Transition||(Transition={}));
var Logger=function(){function b(){this.errorsArray=[];this.popup=null;this.logLevel=LoggerLevel.Error}b.prototype.setLogLevel=function(a){this.logLevel=null!=a?parseInt(a):LoggerLevel.Error};b.prototype.debug=function(){for(var a=[],c=0;c<arguments.length;c++)a[c-0]=arguments[c];a.unshift(LoggerLevel.Debug);this.log.apply(this,a)};b.prototype.info=function(){for(var a=[],c=0;c<arguments.length;c++)a[c-0]=arguments[c];a.unshift(LoggerLevel.Info);this.log.apply(this,a)};b.prototype.warning=function(){for(var a=
[],c=0;c<arguments.length;c++)a[c-0]=arguments[c];a.unshift(LoggerLevel.Warning);this.log.apply(this,a)};b.prototype.error=function(a,c){this.log(LoggerLevel.Error,a+"\n"+c)};b.prototype.errors=function(a,c){this.log(LoggerLevel.Error,a+"\n"+c)};b.prototype.log=function(a){for(var c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];var b;"undefined"!=typeof console&&(a==LoggerLevel.Debug&&a>=this.logLevel&&"undefined"!=typeof console.log?b="debug":a==LoggerLevel.Info&&a>=this.logLevel&&"undefined"!=
typeof console.info?b="info":a==LoggerLevel.Warning&&a>=this.logLevel&&"undefined"!=typeof console.warn?b="warn":a==LoggerLevel.Error&&a>=this.logLevel&&"undefined"!=typeof console.error&&(b="error",this.errorsArray.push(c)));if(b&&"function"==typeof console.log){c=[];c.push(b);for(var d=1,f=arguments.length;d<f;d++)c.push(arguments[d]);"debug"==b&&platformFeatures.getIsIE()?console.info.apply(console,c):console[b].apply(console,c)}else b&&"object"==typeof console.log&&Function.prototype.call.call(console.log,
console,Array.prototype.slice.call(arguments))};return b}(),LoggerLevel={Debug:0,Info:1,Warning:2,Error:3};(function(){var b=function(){var a,c=document.createElement("fakeelement"),d={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(a in d)if(void 0!==c.style[a])return d[a]}();$.fn.cssPromise=function(){var a=$.Deferred();this.first().one(b,function(){logger.log("received transition end for ",this);a.resolve()});return a.promise()}})();
var EnumAspectRatio;(function(b){b[b.AR_16_9=0]="AR_16_9";b[b.AR_4_3=1]="AR_4_3"})(EnumAspectRatio||(EnumAspectRatio={}));
var EnumAspectRatioHelper=function(){function b(){}b.parseEnumAspectRatio=function(a){var c=null;0==a.localeCompare("AR_16_9")&&(c=EnumAspectRatio.AR_16_9);0==a.localeCompare("AR_4_3")&&(c=EnumAspectRatio.AR_4_3);return c};return b}(),LocalizedText=function(){function b(){this.CallToAction_RestartAndReset=ko.observable("");this.CallToAction_Confirm=ko.observable("");this.CallToAction_Cancel=ko.observable("");this.CallToAction_Print=ko.observable("");this.Overlay_StartOverText=ko.observable("");this.Overlay_ResumeText=
ko.observable("");this.scrollToContinueText=ko.observable("");this.clickToContinueText=ko.observable("");this.Accessibility_NewSlideLoaded=ko.observable("");this.Accessibility_LastSlideLoaded=ko.observable("");this.Accessibility_NextSlide=ko.observable("");this.Accessibility_SlideLocked=ko.observable("");this.Accessibility_PreviousSlide=ko.observable("");this.Accessibility_OpeningSoundToggle=ko.observable("");this.Accessibility_Timeline=ko.observable("");this.Accessibility_DisableAccessibility=ko.observable("");
this.Accessibility_DisabledAccessibilityAlert=ko.observable("");this.Accessibility_DisableTranscript=ko.observable("");this.Accessibility_DisabledTranscriptAlert=ko.observable("");this.Accessibility_EnableAccessibility=ko.observable("");this.Accessibility_EnabledAccessibilityAlert=ko.observable("");this.Accessibility_EnableTranscript=ko.observable("");this.Accessibility_EnabledTranscriptAlert=ko.observable("");this.Accessibility_AudioToggle=ko.observable("");this.Accessibility_IexploreZone=ko.observable("");
this.Accessibility_CloseFeedback=ko.observable("");this.Accessibility_CorrectAnswer=ko.observable("");this.Accessibility_WrongAnswer=ko.observable("");this.Accessibility_TextToFind=ko.observable("");this.Accessibility_DisplayCorrectAnswer=ko.observable("");this.Accessibility_PreviousSequence=ko.observable("");this.Accessibility_DropZone=ko.observable("");this.Accessibility_SelectDestination=ko.observable("");this.Accessibility_RestartAndResetTheScore=ko.observable("");this.Accessibility_SoundPlayerPlay=
ko.observable("");this.Accessibility_SoundPlayerPause=ko.observable("");this.Accessibility_SoundPlayerReplay=ko.observable("");this.Accessibility_VideoPlayerPlay=ko.observable("");this.Accessibility_VideoPlayerPause=ko.observable("");this.Accessibility_SwitchToHd=ko.observable("");this.Accessibility_SwitchedToHdAlert=ko.observable("");this.Accessibility_SwitchToLd=ko.observable("");this.Accessibility_SwitchedToLdAlert=ko.observable("");this.Accessibility_GlossaryBegin=ko.observable("");this.Accessibility_GlossaryEnd=
ko.observable("");this.Accessibility_ZoomOnclick=ko.observable("");this.Assessment_Submit=ko.observable("");this.Assessment_Retry=ko.observable("");this.Assessment_AttemptsLeft=ko.observable("");this.Assessment_AttemptLeft=ko.observable("");this.Assessment_ShowSolution=ko.observable("");this.Accessibility_Selected=ko.observable("");this.Accessibility_Unselected=ko.observable("");this.ScormError_CantResetLessonStatus=ko.observable("");this.Tooltip_MediaImage_ZoomOnclick=ko.observable("");this.Certificate_Date=
ko.observable("");this.Certificate_Signature=ko.observable("")}b.prototype.initialize=function(a){this.Overlay_StartOverText(a.Overlay_StartOverText);this.Overlay_ResumeText(a.Overlay_ResumeText);this.Accessibility_NewSlideLoaded(a.Accessibility_NewSlideLoaded);this.Accessibility_LastSlideLoaded(a.Accessibility_LastSlideLoaded);this.Accessibility_NextSlide(a.Accessibility_NextSlide);this.Accessibility_PreviousSlide(a.Accessibility_PreviousSlide);this.Accessibility_SlideLocked(a.Accessibility_SlideLocked);
this.Accessibility_OpeningSoundToggle(a.Accessibility_OpeningSoundToggle);this.Accessibility_Timeline(a.Accessibility_Timeline);this.Accessibility_DisableAccessibility(a.Accessibility_DisableAccessibility);this.Accessibility_DisabledAccessibilityAlert(a.Accessibility_DisabledAccessibilityAlert);this.Accessibility_DisableTranscript(a.Accessibility_DisableTranscript);this.Accessibility_DisabledTranscriptAlert(a.Accessibility_DisabledTranscriptAlert);this.Accessibility_EnableAccessibility(a.Accessibility_EnableAccessibility);
this.Accessibility_EnabledAccessibilityAlert(a.Accessibility_EnabledAccessibilityAlert);this.Accessibility_EnableTranscript(a.Accessibility_EnableTranscript);this.Accessibility_EnabledTranscriptAlert(a.Accessibility_EnabledTranscriptAlert);this.Accessibility_AudioToggle(a.Accessibility_AudioToggle);this.Accessibility_IexploreZone(a.Accessibility_IexploreZone);this.Accessibility_CloseFeedback(a.Accessibility_CloseFeedback);this.Accessibility_CorrectAnswer(a.Accessibility_CorrectAnswer);this.Accessibility_WrongAnswer(a.Accessibility_WrongAnswer);
this.Accessibility_TextToFind(a.Accessibility_TextToFind);this.Accessibility_DisplayCorrectAnswer(a.Accessibility_DisplayCorrectAnswer);this.Accessibility_PreviousSequence(a.Accessibility_PreviousSequence);this.Accessibility_DropZone(a.Accessibility_DropZone);this.Accessibility_SelectDestination(a.Accessibility_SelectDestination);this.Accessibility_SoundPlayerPlay(a.Accessibility_SoundPlayerPlay);this.Accessibility_SoundPlayerPause(a.Accessibility_SoundPlayerPause);this.Accessibility_SoundPlayerReplay(a.Accessibility_SoundPlayerReplay);
this.Accessibility_VideoPlayerPlay(a.Accessibility_VideoPlayerPlay);this.Accessibility_VideoPlayerPause(a.Accessibility_VideoPlayerPause);this.Accessibility_SwitchToHd(a.Accessibility_SwitchToHd);this.Accessibility_SwitchedToHdAlert(a.Accessibility_SwitchedToHdAlert);this.Accessibility_SwitchToLd(a.Accessibility_SwitchToLd);this.Accessibility_SwitchedToLdAlert(a.Accessibility_SwitchedToLdAlert);this.Accessibility_GlossaryBegin=ko.observable(a.Accessibility_GlossaryBegin);this.Accessibility_GlossaryEnd=
ko.observable(a.Accessibility_GlossaryEnd);this.Accessibility_ZoomOnclick=ko.observable(a.Accessibility_ZoomOnclick);this.ScormError_CantResetLessonStatus(a.ScormError_CantResetLessonStatus);this.Assessment_Submit(a.Assessment_Submit);this.Assessment_Retry(a.Assessment_Retry);this.Assessment_ShowSolution(a.Assessment_ShowSolution);this.Assessment_AttemptsLeft(a.Assessment_AttemptsLeft);this.Assessment_AttemptLeft(a.Assessment_AttemptLeft);this.Accessibility_Selected(a.Accessibility_Selected);this.Accessibility_Unselected(a.Accessibility_Unselected);
this.Tooltip_MediaImage_ZoomOnclick=ko.observable(a.Tooltip_MediaImage_ZoomOnclick);this.CallToAction_RestartAndReset(a.CallToAction_RestartAndReset);this.CallToAction_Confirm(a.CallToAction_Confirm);this.Accessibility_RestartAndResetTheScore(a.Accessibility_RestartAndResetTheScore);this.CallToAction_Cancel(a.CallToAction_Cancel);this.CallToAction_Print(a.CallToAction_Print);this.Certificate_Date(a.Certificate_Date);this.Certificate_Signature(a.Certificate_Signature)};return b}(),Sequence=function(){function b(a,
c){this.chapter=a;this.id=c.id;this.name=c.name;this.exercises=[];for(var d=0;d<c.exercises.length;d++)this.exercises.push(new Exercise(this,c.exercises[d]))}b.prototype.getExerciseById=function(a){for(var c=0;c<this.exercises.length;c++)if(this.exercises[c].id==a)return this.exercises[c];return null};b.prototype.getChapter=function(){return this.chapter};return b}(),Exercise=function(){function b(a,c){this.isLocked=ko.observable(!0);this.isWatched=ko.observable(!1);this.isCompleted=ko.observable(!1);
this.sequence=a;this.id=c.id;this.title=c.title;this.transitionType=c.transitionType;this.type=c.type;this.thumbnail=c.thumbnail;this.metadatas=c.metadatas}b.prototype.getChapter=function(){return this.sequence.getChapter()};b.prototype.hasCallToAction=function(){if(null!=this.metadatas)for(var a=0;a<this.metadatas.length;a++)if("assessmentResult"!==this.type&&"calltoaction"===this.metadatas[a].key.toLowerCase())return!StringHelper.isNullOrEmpty(this.metadatas[a].value);return!1};return b}(),EnumModuleType;
(function(b){b[b.TwoLevelModule=0]="TwoLevelModule";b[b.ThreeLevelModule=1]="ThreeLevelModule"})(EnumModuleType||(EnumModuleType={}));
var EnumModuleTypeHelper=function(){function b(){}b.parseEnumModuleType=function(a){var c=null;if(null==a)return null;0==a.localeCompare("TwoLevelModule")&&(c=EnumModuleType.TwoLevelModule);0==a.localeCompare("ThreeLevelModule")&&(c=EnumModuleType.ThreeLevelModule);return c};b.toString=function(a){var c="";if(null==a)return null;switch(a){case EnumModuleType.ThreeLevelModule:c="ThreeLevelModule";break;case EnumModuleType.TwoLevelModule:c="TwoLevelModule"}return c};return b}(),EnumModuleCatergory;
(function(b){b[b.AssessmentHtml5=0]="AssessmentHtml5"})(EnumModuleCatergory||(EnumModuleCatergory={}));var EnumModuleCategoryHelper=function(){function b(){}b.parseEnumModuleCategory=function(a){var c=null;if(null==a)return null;0===a.localeCompare("assessmentHtml5")&&(c=EnumModuleCatergory.AssessmentHtml5);return c};b.toString=function(a){var c="";if(null==a)return null;switch(a){case EnumModuleCatergory.AssessmentHtml5:c="assessmentHtml5"}return c};return b}(),EnumBranchingLinkType;
(function(b){b[b.Alternative=0]="Alternative";b[b.CallToAction=1]="CallToAction";b[b.NextButton=2]="NextButton"})(EnumBranchingLinkType||(EnumBranchingLinkType={}));
var EnumBranchingLinkTypeHelper=function(){function b(){}b.parseEnumBranchingLinkType=function(a){var c=null;if(a&&(0==a.toLowerCase().localeCompare("alternative")&&(c=EnumBranchingLinkType.Alternative),0==a.toLowerCase().localeCompare("calltoaction")&&(c=EnumBranchingLinkType.CallToAction),0==a.toLowerCase().localeCompare("nextbutton")))c=EnumBranchingLinkType.NextButton;return c};return b}(),BranchingLink=function(){return function(b){this.destinationType=EnumBranchingDestinationTypeHelper.parseEnumBranchingDestinationType(b.destinationType);
this.destinationId=null===b.destinationId?-1:b.destinationId;this.linkType=EnumBranchingLinkTypeHelper.parseEnumBranchingLinkType(b.linkType);this.linkId=b.linkId;this.exerciseId=b.exerciseId}}(),Course=function(){function b(a){this.sendScoreToLMS=this.timelineVisible=!0;this.name=a.coursename;this.description=a.coursedescription;this.code=a.coursecode;this.culture=a.culture;this.moduleType=EnumModuleTypeHelper.parseEnumModuleType(a.moduleType);this.numberOfAttempts=a.numberOfAttempts;this.postCompletionIfSuccess=
a.postCompletionIfSuccess;this.sendScoreToLMS=a.sendScoreToLMS;this.chapters=[];for(var c=0;c<a.chapters.length;c++)this.chapters.push(new Chapter(this,a.chapters[c]));this.branchingLinks=[];for(c=0;c<a.branchingLinks.length;c++)this.branchingLinks.push(new BranchingLink(a.branchingLinks[c]))}b.prototype.isAssessment=function(){if(0<this.chapters.length)for(var a=0;a<this.chapters.length;a++)if(this.chapters[a].isAssessment)return!0;return!1};b.prototype.getSendScoreToLMS=function(){return this.sendScoreToLMS};
b.prototype.getChapterById=function(a){for(var c=0;c<this.chapters.length;c++)if(this.chapters[c].id==a)return this.chapters[c];return null};b.prototype.getChapterByExerciseId=function(a){for(var c=0;c<this.chapters.length;c++)if(null!=this.chapters[c].getExerciseById(a))return this.chapters[c];return null};b.prototype.getExerciseById=function(a){for(var c=0;c<this.chapters.length;c++){var d=this.chapters[c].getExerciseById(a);if(null!=d)return d}return null};b.prototype.getAssessmentExercises=function(){for(var a=
[],c=0;c<this.chapters.length;c++)this.chapters[c].isAssessment&&(a=a.concat(this.chapters[c].getExercises()));return a};b.prototype.getExercises=function(){for(var a=[],c=0;c<this.chapters.length;c++)a=a.concat(this.chapters[c].getExercises());return a};return b}(),Chapter=function(){function b(a,c){this.course=a;this.id=c.id;this.name=c.name;this.isAssessment=void 0!==c.isAssessment?c.isAssessment:!1;this.disableForwardBrowsing=void 0!==c.disableForwardBrowsing?c.disableForwardBrowsing:!1;this.shuffledExercisesMaximumCount=
(this.shuffleExercises=void 0!==c.shuffleExercises?c.shuffleExercises:!1)?c.shuffledExercisesMaximumCount:0;this.sequences=[];for(var d=0;d<c.sequences.length;d++)this.sequences.push(new Sequence(this,c.sequences[d]))}b.prototype.getExercises=function(){for(var a=[],c=0;c<this.sequences.length;c++)a=a.concat(this.sequences[c].exercises);return a};b.prototype.getShuffledExercises=function(){for(var a=this.getExercises(),c=a.length,d,b;0!==c;)b=Math.floor(Math.random()*c),c-=1,d=a[c],a[c]=a[b],a[b]=
d;return a};b.prototype.getExerciseById=function(a){for(var c=0;c<this.sequences.length;c++){var d=this.sequences[c].getExerciseById(a);if(null!=d)return d}return null};b.prototype.getCourse=function(){return this.course};b.prototype.setExercicesWithBehavioursApplied=function(a){this.exercisesWithBehavioursApplied=a};return b}(),ChapterShuffled=function(){function b(){this.chaptersMap={}}b.prototype.loadData=function(a){StringHelper.isNullOrEmpty(a)||(this.chaptersMap=JSON.parse(a))};b.prototype.addChapter=
function(a,c){this.chaptersMap[a.id.toString()]=[];for(var d=0,b=c.length;d<b;d++)this.chaptersMap[a.id.toString()].push(c[d].id)};b.prototype.removeChapter=function(a){delete this.chaptersMap[a.id.toString()]};b.prototype.serializeData=function(){return JSON.stringify(this.chaptersMap)};b.prototype.containsChapter=function(a){return null!=this.chaptersMap[a.toString()]};b.prototype.getExercisesIds=function(a){return this.chaptersMap[a.toString()]};return b}(),GuidHelper=function(){function b(){}
b.newGuid=function(){b.index++;return"id_"+b.index};b.index=0;return b}();String.prototype.trim||function(){String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}();
var StringHelper=function(){function b(){}b.isNullOrEmpty=function(a){return null==a||void 0==a||""==a?!0:!1};b.transformStringForAriaLabel=function(a){if(b.isNullOrEmpty(a))return"";var c=document.createElement("div");c.innerHTML=a.replace(RegExp("(</p>)","gi"),"\n</p>");a=c.innerText;$(c).remove();return a};b.getBoolean=function(a){return b.isNullOrEmpty(a)?!1:"true"==a.toLowerCase()||"yes"==a.toLowerCase()||"1"==a.toLowerCase()?!0:!1};b.getHtmlFormat=function(a){return a?a.replace(/\n/g,"<br/>"):
""};b.htmlTrim=function(a){if(void 0==a||null==a)return"";a=this.htmlLTrim(a);return a=this.htmlRTrim(a)};b.htmlLTrim=function(a){for(;b.startsWith(a," ")||b.startsWith(a,"&nbsp;")||b.startsWith(a,"\t");)b.startsWith(a," ")&&(a=a.substr(1)),b.startsWith(a,"\t")&&(a=a.substr(1)),b.startsWith(a,"&nbsp;")&&(a=a.substr(6));return a};b.htmlRTrim=function(a){for(;b.endsWith(a," ")||b.endsWith(a,"&nbsp;")||b.endsWith(a,"\t");)b.endsWith(a," ")&&(a=a.substr(0,a.length-1)),b.endsWith(a,"\t")&&(a=a.substr(0,
a.length-1)),b.endsWith(a,"&nbsp;")&&(a=a.substr(0,a.length-6));return a};b.startsWith=function(a,c){return 0==a.indexOf(c)?!0:!1};b.endsWith=function(a,c){return-1!=a.indexOf(c,a.length-c.length)?!0:!1};b.getHtmlTextLength=function(a){return $("<span>"+a+"</span>").text().length};b.compareHtmlText=function(a,c,d){a=b.replace(a,"&nbsp;"," ").trim().replace(/ +(?= )/g,"");c=b.replace(c,"&nbsp;"," ").trim().replace(/ +(?= )/g,"");if(null==d||d)a=a.toLowerCase(),c=c.toLowerCase();a=$("<span>"+a+"</span>").text();
c=$("<span>"+c+"</span>").text();if(a.length!=c.length)return!1;for(var d=0,e=a.length;d<e;d++)if(a.charCodeAt(d)!=c.charCodeAt(d))return!1;return!0};b.replace=function(a,c,d){if(a)for(;-1!=a.indexOf(c);)a=a.replace(c,d);return a};b.GetURLParameter=function(a,c){var d=a,b=-1,b=a.indexOf("?");0<=b&&(d=d.substring(b+1));b=a.indexOf("#");0<=b&&(d=d.substring(0,b));d=d.split("&");for(b=0;b<d.length;b++){var f=d[b].split("=");if(f[0]==c)return f[1]}return null};return b}(),EventHandler=function(){function b(){this.handlers=
[];this.execute=function(){for(var a=[],c=0;c<arguments.length;c++)a[c-0]=arguments[c];for(var c=0,d=this.handlers.length;c<d;c++){var b=this.handlers[c];b.callback.apply(b.target,a)}}}b.prototype.subscribe=function(a,c){this.handlers.push(new EventHandlerItem(a,c))};b.prototype.unSubscribe=function(a,c){for(var d=[],b=0,f=this.handlers.length;b<f;b++){var g=this.handlers[b];(g.target!=a||g.callback!=c)&&d.push(g)}this.handlers=d};b.prototype.cleanup=function(){try{if(null!=this.handlers)for(var a=
0,c=this.handlers.length;a<c;a++)delete this.handlers[a];this.handlers=[]}catch(d){logger.error("EventHandler.cleanup error : "+d)}};return b}(),EventHandlerItem=function(){return function(b,a){this.target=b;this.callback=a}}(),MediaType;(function(b){b[b.sound=0]="sound";b[b.image=1]="image";b[b.video=2]="video";b[b.text=3]="text";b[b.flash=4]="flash";b[b.html=5]="html";b[b.undefined=6]="undefined"})(MediaType||(MediaType={}));
var MediaBase=function(){function b(a){void 0===a&&(a=!0);this.FORMATS_SEPARATOR=",";this.type=MediaType.undefined;this.url=ko.observable("");this.computedUrl="";this.isVisible=ko.observable(!0);this.y=this.x=this.zIndex=0;this.top=ko.observable(0);this.left=ko.observable(0);this.width=ko.observable(0);this.height=ko.observable(0);this.hidden=ko.observable(!1);this.id=GuidHelper.newGuid();this.mediaRatio=1;this.defaultFileName=this.cleanMediaId=this.mediaId="";this.template=ko.observable("EmptyMediaTemplate");
this.cssClassValues=ko.observable("");this.areaHeight=this.areaWidth=0;this.cssClasses=[];this.transcriptTitle=this.metadataTranscript=this.metadataDescription="";this.transcriptDisplayedAsList=!1;this.metadataScreenReaderDescription="";this.tabindex=ko.observable(-1);this.onLoaded=new EventHandler;this.fixMediaUrlCase=function(c){var a=c.indexOf(".");return c.substring(0,a).toUpperCase()+c.substring(a)};this.type=MediaType.undefined;this.preloadMedia=a}b.prototype.hide=function(){this.isVisible(!1);
this.hidden(!0);return this};b.prototype.show=function(){this.isVisible(!0);this.hidden(!1);return this};b.prototype.getDom=function(){return $("#"+this.id)};b.prototype.cleanup=function(){this.onLoaded.cleanup()};b.prototype.loadData=function(a){this.json=a;a["meta-data"]&&(this.metadataDescription=a["meta-data"].description||"",this.metadataTranscript=a["meta-data"].transcript||"",this.metadataScreenReaderDescription=a["meta-data"].screenReaderDescription||"");a["@originalwidth"]&&a["@originalheight"]&&
(this.mediaRatio=a["@originalwidth"]/a["@originalheight"]);this.loadUrl(a);this.loadPostionsAndDimensions(a)};b.prototype.setTranscriptDisplayedAsList=function(a){this.transcriptDisplayedAsList=a};b.prototype.setTranscriptTitle=function(a){this.transcriptTitle=a};b.prototype.appendTranscriptText=function(){var a=StringHelper.isNullOrEmpty(this.transcriptTitle)?null:this.transcriptTitle;applicationViewModel.transcriptViewModel.appendTranscriptText(this.metadataTranscript,a,null!=a?!0:this.transcriptDisplayedAsList)};
b.prototype.setTabindex=function(a){a&&(this.tabIndexValue=a);this.tabindex(a)};b.prototype.resetTabindex=function(){this.tabindex(-1)};b.prototype.displayMediaTexts=function(a,c,d,b){d&&d(void 0==a?"":a);b&&b(void 0==c?"":c)};b.prototype.loadUrl=function(a){a&&a["@url"]&&null!=a["@url"]&&""!=a["@url"]&&(this.json=a,this.assignDefaults(),this.computedUrl=this.getMediaBaseUrl()+this.fixMediaUrlCase(this.getJsonUrl()));this.url(this.computedUrl)};b.prototype.assignDefaults=function(){this.defaultFileName=
this.json["@url"];this.mediaId=this.defaultFileName.substr(0,this.defaultFileName.indexOf("."));this.cleanMediaId=this.mediaId.replace("{","").replace("}","")};b.prototype.getJsonUrl=function(){return this.defaultFileName};b.prototype.getMediaBaseUrl=function(){return applicationViewModel.ajaxLoader.getStandardMediaBaseUrl()};b.prototype.loadComputedUrl=function(){this.url(this.computedUrl)};b.prototype.unloadUrl=function(){this.url(null)};b.prototype.hasUrlData=function(){return this.url()&&""!=
this.url()};b.prototype.onClick=function(){};b.prototype.fitToContent=function(){};b.prototype.addCssClass=function(a){for(var c=!1,d=0,b=this.cssClasses.length;d<b;d++)this.cssClasses[d]==a&&(c=!0);c||(this.cssClasses.push(a),this.buildCssClasses())};b.prototype.removeCssClass=function(a){for(var c=[],d=!1,b=0,f=this.cssClasses.length;b<f;b++)this.cssClasses[b]!=a?c.push(this.cssClasses[b]):d=!0;d&&(this.cssClasses=c,this.buildCssClasses())};b.prototype.clearCssClass=function(){this.cssClasses=[];
this.buildCssClasses()};b.prototype.buildCssClasses=function(){this.cssClassValues(this.cssClasses.join(" "))};b.prototype.loadPostionsAndDimensions=function(a){a["@zPos"]&&!isNaN(a["@zPos"])&&(this.zIndex=parseInt(a["@zPos"]));a["@xPos"]&&!isNaN(a["@xPos"])&&(this.left(parseInt(a["@xPos"])),this.x=parseInt(a["@xPos"]));a["@yPos"]&&!isNaN(a["@yPos"])&&(this.top(parseInt(a["@yPos"])),this.y=parseInt(a["@yPos"]));a["@width"]&&!isNaN(a["@width"])&&this.width(parseInt(a["@width"]));a["@height"]&&!isNaN(a["@height"])&&
this.height(parseInt(a["@height"]));this.overloadPositionsAndDimensions(a)};b.prototype.overloadPositionsAndDimensions=function(){};b.prototype.getMediaGuid=function(){return this.mediaId.replace("{","").replace("}","")};b.prototype.play=function(){};b.prototype.stop=function(){};b.prototype.sizeChanged=function(){};b.prototype.log=function(a,c){for(var d=[],b=2;b<arguments.length;b++)d[b-2]=arguments[b];a=a.toLowerCase();b=[];b.push("[Media"+MediaType[this.type]+"]("+this.id+"): ["+c+"]");for(var f=
0,g=d.length;f<g;f++)b.push(d[f]);logger[a].apply(logger,b);return this};return b}(),ArrayHelper=function(){function b(){}b.getArrayFromJson=function(a){var c=[];null!=a&&void 0!=a&&(void 0!=a.length?c=a:c.push(a));return c};b.shuffle=function(a){var c=[],c=c.concat(a);if(uiManager.screenshotMode)return c;for(var a=0,d=c.length;a<d;a++){var b=Math.floor(Math.random()*c.length),f=c[a];c[a]=c[b];c[b]=f}return c};b.prepend=function(a,c){c.unshift(a);return c};b.append=function(a,c){c.push(a);return c};
return b}(),MediaQualityChooser=function(){function b(){}b.prototype.getExpectedFileQuality=function(a,c,d,e,f){var g=b.upscaleImageDesktopValue,a=this.defineSizeForQualitySelection(a,c,d,e),c=ImageQuality.Q1;f&&(g=b.upscaleImageMobileValue);for(var h in MediaQualityDimensions)if(f=parseInt(MediaQualityDimensions[h]),!isNaN(f))if(a<=f*g)c=ImageQuality[h];else break;return c};b.prototype.defineSizeForQualitySelection=function(a,c,d,b){if(0==c||0==a)c=0;else if(null!=d&&void 0!=d&&0<d){var f=d/a,g=
b/c;f>g?c=b/f:a=d/g;c=Math.max(a,c)}else c=Math.max(c,a);return c};b.upscaleImageDesktopValue=1;b.upscaleImageMobileValue=1;return b}(),MediaQualityDimensions;(function(b){b[b.Q1=1280]="Q1";b[b.Q2=900]="Q2";b[b.Q3=600]="Q3";b[b.Q4=300]="Q4";b[b.Q5=100]="Q5"})(MediaQualityDimensions||(MediaQualityDimensions={}));
var MediaSound=function(b){function a(){b.call(this,!1);this.onEnded=new EventHandler;this.isPlaying=ko.observable(!1);this.hasPlayed=!1;this.type=MediaType.sound}__extends(a,b);a.prototype.loadData=function(c){b.prototype.loadData.call(this,c);return this};a.prototype.toggle=function(){this.isPlaying()?this.stop():this.play()};a.prototype.playPause=function(){this.isPlaying()?(audioPlayer.pause(),this.isPlaying(!1)):(audioPlayer.play(),this.isPlaying(!0))};a.prototype.hasSource=function(){return""!=
this.url()};a.prototype.play=function(){var c=this;this.log("info","play","requesting playing");this.hasPlayed=!1;this.isPlaying(!1);audioPlayer&&(audioPlayer.onEnded(function(){c.onAudioPlayerEnded()}),this.hasSource()?(this.log("info","play","has url, marking as playing ("+this.url()+")"),audioPlayer.src(this.url()),audioPlayer.play(),this.appendTranscriptText(),this.isPlaying(!0)):this.log("debug","play","no url given"))};a.prototype.pause=function(){audioPlayer&&(this.log("debug","pausing",this.url()),
audioPlayer.pause(),this.isPlaying(!1))};a.prototype.stop=function(c){if(void 0!=audioPlayer.src&&""!=audioPlayer.src()&&this.isPlaying()&&(c==this.url()||null==c||""==c))try{this.log("debug","stopping",this.url()),this.isPlaying(!1),audioPlayer.stop()}catch(a){this.log("error","Error on audioPlayer stop",a)}};a.prototype.replay=function(){audioPlayer&&(this.isPlaying(!0),this.stop(),this.play())};a.prototype.loadUrl=function(c){if(c["@url"]&&null!=c["@url"]&&""!=c["@url"]){this.defaultFileName=c["@url"];
this.mediaId=this.defaultFileName.substr(0,this.defaultFileName.indexOf("."));this.computedUrl=applicationViewModel.ajaxLoader.getStandardMediaBaseUrl();var a=this.getExpectedFileQuality(),c=this.getQualityFileExtension(c);null!=c&&0!=c.length?(a=this.getQualityFileUrl(a,this.mediaId,c),this.computedUrl+=this.mediaId.replace("{","").replace("}","")+"/"):a=this.defaultFileName;this.computedUrl+=this.fixMediaUrlCase(a)}this.url(this.computedUrl);0==this.url().length&&this.addCssClass("no-source")};
a.prototype.getExpectedFileQuality=function(){return 1};a.prototype.getQualityFileExtension=function(c){var a="";void 0!=c["@formats"]&&""!=c["@formats"]&&(c=c["@formats"].split(this.FORMATS_SEPARATOR),0<c.length&&(a=c[0]));return a};a.prototype.getQualityFileUrl=function(c,a,b){return"Q"+c+"_"+a+"."+b};a.prototype.cleanup=function(){this.log("info","cleanup","cleaning up");try{this.isPlaying(!1),b.prototype.cleanup.call(this),this.onEnded.cleanup(),this.unloadUrl()}catch(c){this.log("error","cleanup",
"error: "+c)}};a.prototype.onAudioPlayerEnded=function(){this.log("info","onAudioPlayerEnded","executing");this.isPlaying(!1);this.hasPlayed=!0;this.onEnded.execute()};a.prototype.hasBeenPlayed=function(){var c=null;audioPlayer instanceof Html5AudioPlayer&&(c=audioPlayer.hasBeenPlayed());this.log("debug","hasBeenPlayed","value: "+c);return c&&this.hasPlayed};a.prototype.getCurrentTime=function(){return audioPlayer.getCurrentTime()};a.prototype.setCurrentTime=function(c){audioPlayer.setCurrentTime(c)};
a.prototype.getDuration=function(){return audioPlayer.getDuration()};a.prototype.initializePlayerSize=function(){};return a}(MediaBase),EnumScreenshotMode;(function(b){b[b.Theme=0]="Theme";b[b.Media=1]="Media";b[b.Exercise=2]="Exercise";b[b.Test=3]="Test"})(EnumScreenshotMode||(EnumScreenshotMode={}));
var EnumScreenshotModeHelper=function(){function b(){}b.parseEnumScreenshotMode=function(a){if(null==a)return null;var c=null;0===a.localeCompare("theme")?c=EnumScreenshotMode.Theme:0===a.localeCompare("media")?c=EnumScreenshotMode.Media:0===a.localeCompare("exercise")?c=EnumScreenshotMode.Exercise:0===a.localeCompare("test")&&(c=EnumScreenshotMode.Test);return c};return b}(),ScrollbarManager=function(){function b(a,c,d,b){var f=this;this.forceNativeScrollbar=!1;this.getViewport=function(){return f.container().find(".viewport")};
this.getOverview=function(){return f.container().find(".overview")};this.getScrollbar=function(){return f.container().find(".scrollbar")};this.getStickyFooter=function(){return f.container().find("#sticky__container")};this.hide=function(){return f.getScrollbar().hide().promise()};this.show=function(){return f.getScrollbar().show().promise()};this.options=d;this.platformFeatures=c;this.log=b;this.container=a}b.prototype.isCustom=function(){return!this.platformFeatures.getNativeScrollbar()&&uiManager.screenshotMode!==
EnumScreenshotMode.Exercise};b.prototype.isTinyScrollbarActivated=function(){return this.isCustom()&&platformFeatures.getIsIE89()};b.prototype.isPerfectScrollbarActivated=function(){return this.isCustom()&&!platformFeatures.getIsIE89()};b.prototype.initialize=function(a,c){void 0===c&&(c=!1);this.forceNativeScrollbar=c;this.isDomReady()&&!this.forceNativeScrollbar&&(this.isPerfectScrollbarActivated()?(this.getViewport().perfectScrollbar({wheelSpeed:1,wheelPropagation:!0,minScrollbarLength:20,suppressScrollX:!0}),
this.update(a)):this.isTinyScrollbarActivated()&&(this.container().tinyscrollbar(),this.instance=this.container().data("plugin_tinyscrollbar"),this.update(a)))};b.prototype.cleanup=function(){this.log("debug","ScrollbarManager.cleanup");clearTimeout(this.timerInit);this.isCustom()&&(this.isPerfectScrollbarActivated()?this.getViewport().perfectScrollbar("destroy"):null!=this.container().data("plugin_tinyscrollbar")&&(this.instance=null,this.container().data("plugin_tinyscrollbar",null)));this.platformFeatures=
this.options=this.container=null;this.forceNativeScrollbar=!1};b.prototype.update=function(a,c){a&&this.log("debug","ScrollbarManager.update",a);if(this.isTinyScrollbarActivated()&&null!=this.instance&&!this.forceNativeScrollbar)a?this.instance.update(a):this.instance.update(b.RELATIVE);else if(this.isPerfectScrollbarActivated()||this.platformFeatures.getNativeScrollbar()||this.forceNativeScrollbar)if(a&&this.getViewport().animate({scrollTop:a},c?c:750),this.isPerfectScrollbarActivated()){var d=this.getViewport();
0<d.length?d.perfectScrollbar("update"):this.log("debug","ScrollbarManager.update","Viewport not found, update failed !")}};b.prototype.updateTo=function(a){this.log("debug","ScrollbarManager.update",a);if(this.isTinyScrollbarActivated()&&!this.forceNativeScrollbar)switch(a){case b.TOP:this.instance.update();break;case b.BOTTOM:this.instance.update(this.getViewport()[0].scrollHeight);break;case b.RELATIVE:this.instance.update(b.RELATIVE)}else if(this.isPerfectScrollbarActivated()||this.platformFeatures.getNativeScrollbar()||
this.forceNativeScrollbar)switch(a){case b.TOP:this.update(0);break;case b.BOTTOM:this.update(this.getViewport()[0].scrollHeight);break;case b.RELATIVE:this.update()}};b.prototype.setViewportHeight=function(){if(this.isDomReady()&&this.options&&0<this.options.maxHeight){var a=Math.min(this.options.maxHeight,this.getOverview().outerHeight(!0));this.getViewport().height(a)}};b.prototype.isDomReady=function(){return 0<this.getOverview().length&&0<this.getViewport().length&&0<this.getScrollbar().length};
b.RELATIVE="relative";b.BOTTOM="bottom";b.TOP="top";return b}(),ScrollbarManagerOption=function(){return function(){this.maxHeight=0}}(),MediaText=function(b){function a(){b.call(this,!1);this.effect=TextEffect.text;this.text=ko.observable("");this.balloonPosition=TextBalloonPosition.top;this.type=MediaType.text;this.template(this.getTemplateName())}__extends(a,b);a.prototype.loadData=function(c,a){if(null==a)throw"exerciseId required";this.exerciseId=a;c&&(void 0!=c["#text"]?this.text(this.extractTooltips(StringHelper.htmlTrim(c["#text"]))):
void 0!=c.length&&this.text(this.extractTooltips(StringHelper.htmlTrim(c))));c&&void 0!=c["@effects"]&&""!=c["@effects"]&&(this.effect=c["@effects"]);this.template(this.getTemplateName());return this};a.prototype.transformStringForAriaLabel=function(){var c=document.createElement("div");c.innerHTML=this.text().replace(RegExp("(</p>)","gi"),"\n</p>");$(c).find(".tooltip__icon").remove();var a=c.innerText;$(c).remove();return a};a.prototype.setBalloonPosition=function(c){this.effect==TextEffect.balloon&&
(this.balloonPosition=c)};a.prototype.sizeChanged=function(c,a){this.log("info","sizeChanged","width:",c,"height:",a)};a.prototype.getTemplateName=function(){return this.fixEffectNameCase()+"Template"};a.prototype.fixEffectNameCase=function(){var c=this.effect;return c?c.substr(0,1).toUpperCase()+c.substr(1,c.length-1):"Text"};a.prototype.extractTooltips=function(c){var a=$.parseHTML(c),b=this;$(".tooltip__text",$(a)).each(function(){if($(this).attr("id")){var c=$(this).attr("id").replace("_text",
""),g=$(this).text(),h=$("#"+c,a).text(),c=c+"_"+b.exerciseId,g=new TooltipViewModel(c,b.exerciseId,g,h);$(this).attr("onclick",' uiManager.stopPropagation(event); applicationViewModel.tooltipManager.showTooltip("'+c+'");');applicationViewModel.tooltipManager.addTooltip(g)}});$(a).find(".tooltip__icon").remove();return $("<div></div>").append($(a)).html()};return a}(MediaBase),TextEffect={balloon:"balloon",note:"note",text:"text"},TextBalloonPosition={top:"top",bottom:"bottom",left:"left",right:"right"},
VideoJsPlayer=function(){function b(a,c){this.player=null;this.domId=a;logger.debug("[VideoJsPlayer "+this.domId+"] Init VideoJS");this.player=VideoJS(a,c).ready(function(){$("#"+a).css("visibility","visible");logger.debug("[VideoJsPlayer "+a+"] are ready ! Set visibility to visible")});c.muted?this.mute():this.unmute();return this}b.prototype.setHD=function(a){var c=this;logger.debug("[VideoJsPlayer "+this.domId+"] set HD("+a+")");this.player.ready(function(){c.player.setHD(a)})};b.prototype.isFullScreen=
function(){return this.player.isFullScreen};b.prototype.mute=function(){this.player&&this.player.muted(!0)};b.prototype.unmute=function(){this.player&&this.player.muted(!1)};b.prototype.play=function(){var a=this;logger.debug("[VideoJsPlayer "+this.domId+"].play() when ready");this.player.ready(function(){logger.debug("[VideoJsPlayer "+a.domId+"] ready! play");a.player.play();a.checkIfVideoPlayerIsLocked()})};b.prototype.playToggle=function(){logger.debug("[VideoJsPlayer "+this.domId+"].playToggle() ");
this.player.paused()?this.play():this.pause()};b.prototype.checkIfVideoPlayerIsLocked=function(){var a=this;platformFeatures.getIsDesktopMode()||(this.timerCheckControls=setTimeout(function(){a.player.paused()&&a.forceDisplayControlPaused()},2E3))};b.prototype.forceDisplayControlPaused=function(){this.player&&this.player.controlBar&&(this.player.loadingSpinner.hide(),this.player.posterImage.show(),this.player.controlBar.show(),this.player.controlBar.fadeIn(),this.player.controlBar.lockShowing(),$(this.player.controlBar.playToggle.el).addClass("vjs-paused"))};
b.prototype.pause=function(){logger.debug("[VideoJsPlayer "+this.domId+"] Pause");this.player.paused()||this.player.pause()};b.prototype.stop=function(){logger.debug("[VideoJsPlayer "+this.domId+"] Stop");this.currentTime(0);this.pause();this.player&&this.player.controlBar&&($(this.player.controlBar.el).hide(),this.player.controlBar.skipNextEvent())};b.prototype.src=function(a){var c=this;logger.debug("[VideoJsPlayer "+this.domId+"] src( "+a+" ) when ready");this.player.ready(function(){logger.debug("[VideoJsPlayer"+
c.domId+" ] ready ! src("+a+")");c.player.src({src:a,type:"video/mp4"});c.player.controlBar&&c.player.controlBar.skipNextEvent()})};b.prototype.currentTime=function(a){logger.debug("[VideoJsPlayer "+this.domId+"] currentTime( "+a+" )");return"html5"==this.player.techName?(this.player.currentTime(a),this.player.currentTime()):a};b.prototype.getDuration=function(){return this.player.duration()};b.prototype.getCurrentTime=function(){return this.player.currentTime()};b.prototype.setCurrentTime=function(a){return this.player.currentTime(a)};
b.prototype.setSubtitle=function(a){this.player.changeSubtitle(a)};b.prototype.onEnded=function(a){logger.debug("[VideoJsPlayer "+this.domId+"] addEvent onEnded");this.addEvent("ended",function(){a()})};b.prototype.onhdchange=function(a){logger.debug("[VideoJsPlayer "+this.domId+"] addEvent hdchange");this.addEvent("hdchange",a)};b.prototype.onsdchange=function(a){logger.debug("[VideoJsPlayer "+this.domId+"] addEvent sdchange");this.addEvent("sdchange",a)};b.prototype.onCanPlay=function(a){logger.debug("[VideoJsPlayer "+
this.domId+"] addEvent onCanPlay");this.addEvent("canplay",a)};b.prototype.onPlaying=function(a){logger.debug("[VideoJsPlayer "+this.domId+"] addEvent onPlaying");this.addEvent("playing",a)};b.prototype.addEvent=function(a,c){this.callback=c;this.player.addEvent(a,c,!1)};b.prototype.destroy=function(){try{logger.debug("[VideoJsPlayer "+this.domId+"] Destroy)"),clearTimeout(this.timerCheckControls),this.player.destroy()}catch(a){logger.error("[VideoJsPlayer].Destroy error : "+a)}};return b}(),VideoPlayerFactory=
function(){function b(){}b.createVideoPlayer=function(a,c,d,e,f){this.hasCustomControls=f;return null==b.instance?null!=document.getElementById(a)?(logger.debug("[VideoPlayerFactory] Initialisation du video player url:"+c+"  hd:"+d),new VideoJsPlayer(a,{controls:!0,nativeControls:platformFeatures.getUseNativePlayerControls(),poster:e,accessibility:applicationViewModel.accessibilityViewModel.accessibilityFeaturesActivated(),preload:"auto",autoplay:!1,loop:!1,hd:d,src:c,muted:b.isMuted,hasCustomControls:f})):
null:b.instance};b.mute=function(){$("video",$("#previousSlide, #currentSlide, #nextSlide")).each(function(){$(this)[0].muted=!0});b.isMuted=!0};b.unmute=function(){$("video",$("#previousSlide, #currentSlide, #nextSlide")).each(function(){$(this)[0].muted=!1});b.isMuted=!1};b.defaultVideoPlayer=function(a,c){var d={video:$("#"+a),overlay:null,showPlayer:!1,play:function(){this.video[0].play()},playToggle:function(){this.video[0].paused?this.video[0].play():this.video[0].pause()},pause:function(){this.video[0].pause()},
stop:function(){this.currentTime(0);this.pause()},setSubtitle:function(){},src:function(c){this.video[0].src=c},setHD:function(){},currentTime:function(c){this.video[0].currentTime!=c&&(this.video[0].currentTime=c);return c},getCurrentTime:function(){return this.video[0].currentTime()},setCurrentTime:function(c){this.video[0].currentTime(c)},getDuration:function(){return this.video[0].duration()},onEnded:function(c){this.addEvent("ended",c)},onhdchange:function(c){this.addEvent("hdchange",c)},onsdchange:function(c){this.addEvent("sdchange",
c)},onPlaying:function(c){this.addEvent("playing",c)},onCanPlay:function(){},addEvent:function(c,a){this.video[0].addEventListener(c,a,!1)},removeEvent:function(c,a){this.video[0].removeEventListener(c,a,!1)},destroy:function(){this.video[0].src="";this.video[0].load()},hideControls:function(){logger.debug("VideoPlayer.hideControls");this.overlay=d.video.parent().find("div");this.overlay[0]&&(this.overlay[0].style.display="block");this.video.removeAttr("controls");this.overlay.width(d.video.width());
this.overlay.height(d.video.height())},showControl:function(){var c=this;logger.debug("VideoPlayer.showControl");this.overlay=d.video.parent().find("div");this.overlay[0]&&(this.overlay[0].style.display="none");this.video[0].setAttribute("controls","");this.timer=setTimeout(function(){c.hideControls()},3E3)},click:function(){logger.debug("VideoPlayer.click");clearTimeout(this.timer);this.video.attr("controls")?this.hideControls():this.showControl()},isFullScreen:function(){return!1},mute:function(){},
unmute:function(){},init:function(){var a=this;this.overlay=d.video.parent().find("div");if(c&&c.controls&&(!0==c.controls||"true"==c.controls))this.showPlayer=!0,this.video[0].setAttribute("controls","");this.video.attr("controls")&&(this.overlay.click(function(){a.click()}),this.timer=setTimeout(function(){a.hideControls()},3E3))}};d.init();return d};b.instance=null;return b}(),MediaVideoQuality;(function(b){b[b.HD=1]="HD";b[b.SD=2]="SD"})(MediaVideoQuality||(MediaVideoQuality={}));
var MediaVideo=function(b){function a(c){void 0===c&&(c=!0);b.call(this,c);this.videoPlayer=null;this.onCanPlayReceived=!1;this.isPlaying=ko.observable(!1);this.metadataScreenReaderFullDescription=ko.observable("");this.onEnded=new EventHandler;this.onCanPlay=new EventHandler;this.onPlaying=new EventHandler;this.poster=ko.observable("");this.subtitle=ko.observable("");this.quality=MediaVideoQuality.HD;this.videoWidth=1024;this.videoHeight=768;this.heightLimitForSmallSkin=310;this.isSmallSkin=ko.observable(!1);
this.videoPoster=ko.observable(null);this.hasCustomControls=!1;this.sessionToken=StringHelper.GetURLParameter(window.location.href,"EasyquizzServerSID");this.type=MediaType.video;this.template("MediaVideoTemplate");this.metadataScreenReaderFullDescription(localizedText.Accessibility_VideoPlayerPlay())}__extends(a,b);a.prototype.loadData=function(c){b.prototype.loadData.call(this,c);var a=c["@maxx"];StringHelper.isNullOrEmpty(a)||(this.videoWidth=a);c=c["@maxy"];StringHelper.isNullOrEmpty(c)||(this.videoHeight=
c);return this};a.prototype.getHdLdButtonDom=function(){return $("#"+this.id).find(".vjs-quality-control").first()};a.prototype.getOriginalWidth=function(){return this.videoWidth};a.prototype.getOriginalHeight=function(){return this.videoHeight};a.prototype.updatePlayerWrapperAriaLabel=function(){this.isPlaying()?this.metadataScreenReaderFullDescription(localizedText.Accessibility_VideoPlayerPause()):this.metadataScreenReaderFullDescription(localizedText.Accessibility_VideoPlayerPlay()+" "+(this.metadataScreenReaderDescription||
""))};a.prototype.loadUrl=function(){if(this.json&&this.json["@url"]&&null!=this.json["@url"]&&""!=this.json["@url"]){this.defaultFileName=this.json["@url"];this.mediaId=this.defaultFileName.substr(0,this.defaultFileName.indexOf("."));var c=this.getMediaBaseUrl()+this.fixMediaUrlCase(this.defaultFileName.replace(/\.[^\.]+$/,"."+this.getExpectedFileContainer())),a=null,a=this.getQualityFileExtension(this.json);this.onCanPlayReceived=!1;this.quality=this.preloadMedia?this.getQualitySettingFromCookie()||
this.quality:this.loadQualitySetting(!1);null!=a&&0!=a.length?(a=this.getQualityFileUrl(this.quality,this.mediaId,a),a=this.getMediaBaseUrl()+this.getMediaGuid()+"/"+this.fixMediaUrlCase(a)):a=c;var b=this.getSubtitlesJsonUrl(this.mediaId);b&&applicationViewModel.ajaxLoader.loadSubtitles(this,b);this.loadPosterUrl(c);this.loadVideoUrl(a);applicationViewModel.accessibilityViewModel.accessibilityFeaturesActivated()&&(this.updateHdLdButtonAccessibilityState(),this.updatePlayerWrapperAriaLabel(),this.getHdLdButtonDom().attr("role",
"button"))}};a.prototype.updateHdLdButtonAccessibilityState=function(){var c=this.getHdLdButtonDom();c.attr("aria-hidden","false");this.quality===MediaVideoQuality.HD?c.attr("aria-label",localizedText.Accessibility_SwitchToLd()):c.attr("aria-label",localizedText.Accessibility_SwitchToHd())};a.prototype.playToggle=function(){this.isPlaying()?this.isPlaying(!1):this.isPlaying(!0);applicationViewModel.accessibilityViewModel.accessibilityFeaturesActivated()&&(this.isPlaying()&&this.appendTranscriptText(),
this.getVideoPlayer().playToggle(),this.updatePlayerWrapperAriaLabel())};a.prototype.playPause=function(){this.isPlaying?this.videoPlayer.pause():this.videoPlayer.play();this.isPlaying(!this.isPlaying());applicationViewModel.accessibilityViewModel.accessibilityFeaturesActivated()&&this.updatePlayerWrapperAriaLabel()};a.prototype.loadQualitySetting=function(c){void 0===c&&(c=!0);var a=this.getQualitySettingFromCookie();return!a?(this.startBandwidthAnalysis(c),MediaVideoQuality.HD):a};a.prototype.getQualitySettingFromCookie=
function(){var c=applicationViewModel.ajaxLoader.readCookie("hdQuality");return!c?null:"true"!=c?MediaVideoQuality.SD:MediaVideoQuality.HD};a.prototype.getQualityFileExtension=function(c){var a="",b=!1,f=!1;if(void 0!=c["@formats"]&&""!=c["@formats"]){for(var c=c["@formats"].split(this.FORMATS_SEPARATOR),g=0,h=c.length;g<h;g++)"mp4"==c[g]?b=!0:"hls"==c[g]&&(f=!0);platformFeatures.getIsDesktopMode()?b&&(a="mp4"):f?a="hls":b&&(a="mp4")}return a};a.prototype.getQualityFileUrl=function(c,a,b){return"Q"+
c+"_"+a+"."+b};a.prototype.changeToHD=function(){this.changeQuality(MediaVideoQuality.HD);applicationViewModel.accessibilityViewModel.setAlertContent(localizedText.Accessibility_SwitchedToHdAlert());applicationViewModel.accessibilityViewModel.accessibilityFeaturesActivated()&&this.updateHdLdButtonAccessibilityState()};a.prototype.changeToSD=function(){this.changeQuality(MediaVideoQuality.SD);applicationViewModel.accessibilityViewModel.setAlertContent(localizedText.Accessibility_SwitchedToLdAlert());
applicationViewModel.accessibilityViewModel.accessibilityFeaturesActivated()&&this.updateHdLdButtonAccessibilityState()};a.prototype.changeQuality=function(c){this.log("debug","switch to "+MediaVideoQuality[c]);this.quality=c;c=MediaVideoQuality.HD===c;applicationViewModel.ajaxLoader.createCookie("hdQuality",c,platformFeatures.getHDqualityCookieTimeOut());this.loadUrl();this.getVideoPlayer()&&(this.videoPlayer.setHD(c),this.play())};a.prototype.getCurrentTime=function(){return this.videoPlayer.getCurrentTime()};
a.prototype.setCurrentTime=function(c){return this.videoPlayer.setCurrentTime(c)};a.prototype.getDuration=function(){return this.videoPlayer.getDuration()};a.prototype.getExpectedFileContainer=function(){return VideoContainer.MP4};a.prototype.play=function(){this.log("debug","play");this.quality=this.loadQualitySetting();null!=this.getVideoPlayer()&&(null!=this.getVideoPlayer().player&&null!=this.getVideoPlayer().player.isHD&&this.getVideoPlayer().player.isHD!=(this.quality==MediaVideoQuality.HD)?
this.quality==MediaVideoQuality.HD?this.changeToHD():this.changeToSD():null==uiManager.screenshotMode&&platformFeatures.isAutoPlayEnabled()&&this.getVideoPlayer().play(),this.applySkin())};a.prototype.replay=function(){null!=this.getVideoPlayer()&&(this.stop(),this.play())};a.prototype.initializePlayerSize=function(){this.getVideoPlayer()};a.prototype.pause=function(){this.log("debug","pause");null!=this.getVideoPlayer()&&(this.getVideoPlayer().pause(),this.isPlaying(!1));applicationViewModel.accessibilityViewModel.accessibilityFeaturesActivated()&&
this.updatePlayerWrapperAriaLabel()};a.prototype.stop=function(){this.log("debug","stop");null!=this.videoPlayer&&(this.videoPlayer.stop(),this.isPlaying(!1));this.onCanPlayReceived=!1;applicationViewModel.accessibilityViewModel.accessibilityFeaturesActivated()&&this.updatePlayerWrapperAriaLabel()};a.prototype.cleanup=function(){this.log("debug","cleanup");b.prototype.cleanup.call(this);clearTimeout(this.checkBandwidthTimer);this.onEnded.cleanup();this.onCanPlay.cleanup();this.onPlaying.cleanup();
this.onCanPlayReceived=!1;if(null!=this.videoPlayer){try{this.isPlaying(!1),this.disposeVideoPlayer()}catch(c){this.log("error",c)}this.videoPlayer=null}};a.prototype.disposeVideoPlayer=function(){this.videoPlayer.destroy();this.videoPlayer=null};a.prototype.sizeChanged=function(){this.getDom().closest(".media-video-fit-to-container").length?this.fitToContainer():platformFeatures.getIsIE8()&&this.setObjectHeightForIE8();platformFeatures.getIsIE()&&this.updateVjsOptionsPosition();this.applySkin()};
a.prototype.fitToContainer=function(){var c=this.getDom(),a=$("video",c);a.css("display","none");var b=c.height()/this.videoHeight,f=c.width()/this.videoWidth;b<=f?(c=c.height(),a.css("width","auto"),a.css("height",c+"px")):(a.css("height","auto"),a.css("width","100%"));a.css("display","")};a.prototype.updateVjsOptionsPosition=function(){var c=this.getDom(),a=$(".vjs-controls",c),b=$(".vjs-poster",c),f=$(".vjs-loading-spinner",c);0!=a.length&&a.css({top:c.height()/2});0!=f.length&&f.css("top",c.height()/
2);0!=b.length&&b.css({top:c.height()/2});platformFeatures.getIsIE678()||b.css({transform:"translateY(-50%)"})};a.prototype.setObjectHeightForIE8=function(){var c=this.getDom(),a=$("#"+this.id+"_flash_api",c),b=this.videoWidth/this.videoHeight,c=c.width()/b;a.css("height",c+"px")};a.prototype.setTabindex=function(c){b.prototype.setTabindex.call(this,c);this.getHdLdButtonDom().attr("tabindex",c+1)};a.prototype.resetTabindex=function(){b.prototype.resetTabindex.call(this);this.getHdLdButtonDom().attr("tabindex",
"-1")};a.prototype.applySkin=function(){var c=this;setTimeout(function(){var a;a=platformFeatures.getIsIE8()?$("#"+c.id+"_flash_api",c.getDom()):$("video",c.getDom());c.isSmallSkin(a.height()<c.heightLimitForSmallSkin)},1E3)};a.prototype.loadPosterUrl=function(c){this.poster(c.replace("content/","preview/").replace(/\.[^\.]+$/,".jpg"));uiManager.screenshotMode&&this.videoPoster(this.poster())};a.prototype.loadVideoUrl=function(c){this.log("debug","loadVideoUrl","url:",c);applicationViewModel.ajaxLoader.getRuntimeMode()!=
EnumRuntimeMode.LEARNER&&(c=c.replace(applicationViewModel.ajaxLoader.getStandardMediaBaseUrl(),"../CoursePreview/GetMedia.ashx?platform=tablet&url="));if(null!=this.sessionToken)var a=0<=c.indexOf("?")?"&":"?",c=c+a+"EasyquizzServerSID="+this.sessionToken;this.url(c);null!=this.getVideoPlayer()&&this.getVideoPlayer().src(this.url())};a.prototype.getSubtitlesJsonUrl=function(c){return applicationViewModel.ajaxLoader.getSubtitleBaseUrl()+c+"/CONFIG.JS"};a.prototype.getSubtitleUrl=function(c){var a=
null;applicationViewModel.ajaxLoader.getRuntimeMode()!=EnumRuntimeMode.LEARNER&&(c="{"+c+"}");return a=applicationViewModel.ajaxLoader.getSubtitleBaseUrl()+this.mediaId+"/"+this.mediaId+"_"+c.toUpperCase()+".SRT"};a.prototype.loadSubtitleUrl=function(c){if(""!=c&&userCulture&&(c=c.split("/"),0<c.length)){var c=c[c.length-1],c=c.replace(".mp4",""),c=c.replace(".flv",""),a=userCulture;applicationViewModel.ajaxLoader.getRuntimeMode()!=EnumRuntimeMode.LEARNER&&(a="{"+a+"}");this.subtitle(applicationViewModel.ajaxLoader.getSubtitleBaseUrl()+
c+"/"+c+"_"+a+".srt");null!=this.getVideoPlayer()&&this.getVideoPlayer().setSubtitle(this.subtitle())}};a.prototype.toggleSubtitle=function(){var c=applicationViewModel.ajaxLoader.readCookie("subtitle");null==c&&applicationViewModel.ajaxLoader.createCookie("subtitle",!0,null);"true"==c?(applicationViewModel.ajaxLoader.createCookie("subtitle",!1,null),this.hideSubtitle()):(applicationViewModel.ajaxLoader.createCookie("subtitle",!0,null),this.showSubtitle())};a.prototype.showSubtitle=function(){$(".vjs-control-text",
".vjs-subtitles-button").text("t");$(".vjs-captions.vjs-text-track",".vjs-text-track-display").show()};a.prototype.hideSubtitle=function(){$(".vjs-control-text",".vjs-subtitles-button").text("z");$(".vjs-captions.vjs-text-track",".vjs-text-track-display").hide()};a.prototype.getVideoPlayer=function(){var c=this;this.log("debug","getVideoPlayer");null==this.videoPlayer&&(this.log("debug","getVideoPlayer","was null, creating player"),this.videoPlayer=VideoPlayerFactory.createVideoPlayer(this.id,this.url(),
this.quality==MediaVideoQuality.HD,this.poster(),this.hasCustomControls),null!=this.videoPlayer&&(this.log("debug","getVideoPlayer","created"),this.videoPlayer.onEnded(function(){c.onVideoEnded()}),this.videoPlayer.onCanPlay(function(){c.onVideoCanPlay()}),this.videoPlayer.onPlaying(function(){c.onVideoPlaying()}),this.videoPlayer.onhdchange(function(){c.changeToHD()}),this.videoPlayer.onsdchange(function(){c.changeToSD()}),setTimeout(function(){$(".vjs-subtitles-button  .vjs-control-text",$("#"+
c.id)).click(function(){c.toggleSubtitle()})},0)));return this.videoPlayer};a.prototype.onVideoEnded=function(){this.log("debug","onVideoEnded");this.onEnded.execute();this.isPlaying(!1);applicationViewModel.accessibilityViewModel.accessibilityFeaturesActivated()&&this.updatePlayerWrapperAriaLabel()};a.prototype.onVideoCanPlay=function(){this.log("debug","onVideoCanPlay");this.onCanPlay.execute();this.onCanPlayReceived=!0;this.applySkin()};a.prototype.onVideoPlaying=function(){this.log("debug","onVideoPlaying");
this.onPlaying.execute();this.onCanPlayReceived=!0;this.isPlaying(!0);this.appendTranscriptText();applicationViewModel.accessibilityViewModel.accessibilityFeaturesActivated()&&this.updatePlayerWrapperAriaLabel()};a.prototype.onLoadSubtitlesCompleted=function(c){var a=this;this.log("debug","onLoadSubtitlesCompleted");if(c){for(var c=ArrayHelper.getArrayFromJson(c.subtitles.subtitle),b=null,f=0,g=c.length;f<g;f++){var h=c[f]["@isocode"],i=c[f]["@default"];if(h==userCulture){b=h;break}i&&null==b&&(b=
h)}null!=b&&(c=this.getSubtitleUrl(b),this.log("info","url:",c),this.subtitle(c),null!=this.getVideoPlayer()&&""!=this.subtitle()?this.getVideoPlayer().setSubtitle(this.subtitle()):this.log("debug","onLoadSubtitlesCompleted","videoplayer not yet ready, will use subtitles when loading"),setTimeout(function(){if(applicationViewModel.accessibilityViewModel.accessibilityFeaturesActivated()){var c=applicationViewModel.ajaxLoader.readCookie("subtitle");c&&"false"==c?a.hideSubtitle():a.showSubtitle()}else a.showSubtitle()},
0))}};a.prototype.startBandwidthAnalysis=function(c){var a=this;void 0===c&&(c=!0);this.log("info","loadQualitySetting","launching timeout");clearTimeout(this.checkBandwidthTimer);this.checkBandwidthTimer=setTimeout(function(){!1==a.onCanPlayReceived?(a.log("debug","loadQualitySetting timeout","onCanPlay not received in time, switching to SD"),c?a.changeToSD():applicationViewModel.ajaxLoader.createCookie("hdQuality",!1,platformFeatures.getHDqualityCookieTimeOut())):(a.log("debug","loadQualitySetting timeout",
"onCanPlay received in time, stay with HD, set cookie"),applicationViewModel.ajaxLoader.createCookie("hdQuality",!0,platformFeatures.getHDqualityCookieTimeOut()))},5E3)};return a}(MediaBase),VideoContainer={MP4:"mp4",FLV:"flv",HLS:"m3u8",UNDEFINED:"undefined",getVideoContainerFromString:function(b){switch(b.toLowerCase()){case "mp4":return VideoContainer.MP4;case "flv":return VideoContainer.FLV;case "m3u8":return VideoContainer.HLS;default:return null}}},MediaFlash=function(b){function a(){b.call(this);
this.swfVersionStr="7.0.0";this.flashvars={};this.params={allowscriptaccess:"sameDomain",wmode:"opaque"};this.lastComputedHeight=this.lastComputedWidth=-1;this.flashElementVisible=ko.observable(!1);this.idswf=this.embedObjectHtml="";this.attributes={};this.idswf=this.id+"swf";this.attributes={id:this.idswf,name:this.id};this.type=MediaType.flash;this.template("MediaFlashTemplate")}__extends(a,b);a.prototype.getSwf=function(c){if(c=document[c]||window[c])this.player=1<c.length?c[c.length-1]:c};a.prototype.loadData=
function(c){b.prototype.loadData.call(this,c);var a=parseInt(c["@originalwidth"]);NaN!=a&&(this.originalWidth=a);c=parseInt(c["@originalheight"]);NaN!=c&&(this.originalHeight=c);return this};a.prototype.loadUrl=function(c){b.prototype.loadUrl.call(this,c)};a.prototype.play=function(){var c=this;logger.debug("MediaFlash.play");this.flashElementVisible(!0);swfobject.embedSWF(this.url(),this.idswf,this.originalWidth,this.originalHeight,this.swfVersionStr,"",this.flashvars,this.params,this.attributes,
function(a){a.success||$("#"+a.id).html("<div id='flashContent'><p>To view this page ensure that Adobe Flash Player version 9.0.0 or greater is installed.</p><a href='http://www.adobe.com/go/getflashplayer'><img src='http://www.adobe.com/macromedia/style_guide/images/160x41_Get_Flash_Player.jpg' alt='Get Adobe Flash player' /></a></div>");c.getSwf(c.id)});this.restoreComputedDimensions()};a.prototype.initialize=function(){this.play();this.stop()};a.prototype.pause=function(){swfobject.getObjectById(this.idswf).StopPlay()};
a.prototype.stop=function(){this.flashElementVisible(!1)};a.prototype.cleanup=function(){b.prototype.cleanup.call(this);swfobject.removeSWF(this.idswf)};a.prototype.sizeChanged=function(c,a){if(!(0>=this.originalWidth||0>=this.originalHeight||0>=a||0>=c)){var b=c,f=this.originalHeight*c/this.originalWidth,g=this.originalWidth*a/this.originalHeight,h=a;g>c?(c=Math.floor(b),a=Math.floor(f)):(c=Math.floor(g),a=Math.floor(h));this.player&&(this.player.width=c,this.player.height=a);this.storeLastComputedDimensions(c,
a)}};a.prototype.storeLastComputedDimensions=function(c,a){this.lastComputedWidth=c;this.lastComputedHeight=a};a.prototype.restoreComputedDimensions=function(){this.player&&0<this.lastComputedWidth&&0<this.lastComputedHeight&&(this.player.width=this.lastComputedWidth,this.player.height=this.lastComputedHeight)};return a}(MediaBase),MediaHtml=function(b){function a(){b.call(this);this.isLoading=ko.observable(!1);this.isLoaded=ko.observable(!1);this.iframeHeight=ko.observable(0);this.iframeWidth=ko.observable(0);
this.previewUrl=ko.observable("");this.previewImage=ko.observable(null);this.type=MediaType.html;this.template("MediaHtmlTemplate")}__extends(a,b);a.prototype.loadData=function(c){b.prototype.loadData.call(this,c);return this};a.prototype.loadUrl=function(c){c=c["@url"];c=c.replace("{","").replace("}","").replace("\\","/");this.computedUrl=c=this.getMediaBaseUrl()+c;this.isLoaded(!1);this.isLoading(!0);this.url("components/MediaHtmlSpinner.html");this.loadPreview(c)};a.prototype.loadPreview=function(c){this.previewUrl(c.replace("content/",
"preview/").replace(/preview\/([a-f0-9\-]+)\/.*/,"preview/{$1}.jpg"));uiManager.screenshotMode&&(this.previewImage(new MediaImage),this.previewImage().verticalAlignMiddle(!0),this.previewImage().setSourceForImageWithoutQuality(this.previewUrl()))};a.prototype.play=function(){this.url(this.computedUrl)};a.prototype.initialize=function(){};a.prototype.pause=function(){};a.prototype.stop=function(){this.url("components/MediaHtmlSpinner.html")};a.prototype.cleanup=function(){b.prototype.cleanup.call(this)};
a.prototype.sizeChanged=function(c,a){this.iframeHeight(a);this.iframeWidth(c);var b=$("iframe",this.getDom());null!=$("meta[name=author]",b.contents())&&"HTML5Point"==$("meta[name=author]",b.contents()).attr("content")&&setTimeout(function(){b[0].contentWindow.innerWidth=c;b[0].contentWindow.innerHeight=a;b[0].contentWindow.dispatchEvent(new Event("resize"))},0)};return a}(MediaBase),MediaFactory=function(){function b(){}b.createMedia=function(a,c){void 0===c&&(c=!0);var d,b;void 0!=a["@detailedtype"]&&
""!=a["@detailedtype"]?b=a["@detailedtype"]:void 0!=a["@type"]&&""!=a["@type"]&&(b=a["@type"]);switch(b){case "sound":d=new MediaSound;d.loadData(a);break;case "image":d=new MediaImage(c);d.loadData(a);break;case "video":d=new MediaVideo(c);d.loadData(a);break;case "text":d=new MediaText;d.loadData(a,0);break;case "html":d=new MediaHtml;d.loadData(a);break;case "animation":case "widget":case "movie":d=new MediaFlash,d.loadData(a)}return d};return b}(),MediaImage=function(b){function a(c,a){void 0===
c&&(c=!0);void 0===a&&(a=!1);b.call(this,c);this.idLow=GuidHelper.newGuid();this.effect=ko.observable(ImageEffect.none);this.hasServerSideEffect=!1;this.minCropX=0;this.maxCropX=1;this.minCropY=0;this.maxCropY=1;this.originalHeight=this.originalWidth=null;this.currentQuality=ImageQuality.Q5;this.useQuality=ko.observable(!0);this.urlLowQuality=ko.observable("");this.idIllustration=GuidHelper.newGuid();this.idH3=GuidHelper.newGuid();this.idImage=GuidHelper.newGuid();this.polaroidTitle=ko.observable("");
this.isPolaroid=ko.observable(!1);this.isShadow=ko.observable(!1);this.isRoundedBorder=ko.observable(!1);this.isBorder=ko.observable(!1);this.isZoomout=ko.observable(!1);this.isPlayingWithDelay=ko.observable(!1);this.isPlaying=ko.observable(!1);this.isCropped=!1;this.hasSourceUrl=ko.observable(!1);this.isFitted=ko.observable(!1);this.verticalAlignMiddle=ko.observable(!1);this.isHqLoaded=ko.observable(!1);this.isLqLoaded=ko.observable(!1);this.onHqLoaded=new EventHandler;this.verticalAlignMiddle(a);
this.type=MediaType.image;this.template("ImageTemplate");this.qualityChooser=new MediaQualityChooser}__extends(a,b);a.prototype.duplicateFrom=function(c){this.loadData(c.json)};a.prototype.getLowQualityImageDom=function(){return $("#"+this.idLow)};a.prototype.getHighQualityImageDom=function(){return this.getDom()};a.prototype.getInnerContainer=function(){return this.getDom().closest(".media-image-parent-landmark")};a.prototype.getFitContainer=function(){return this.getDom().closest(".media-image-fit-to-container")};
a.prototype.getIllustrationDom=function(){return this.getDom().closest(".media-image-wrapper")};a.prototype.getMediaImageDom=function(){return this.getDom().closest(".media-image__img")};a.prototype.cleanup=function(){b.prototype.cleanup.call(this);clearTimeout(this.switchImageQualityTimeout);b.prototype.cleanup.call(this);this.unloadUrl();this.template=ko.observable("EmptyMediaTemplate")};a.prototype.getMediaBaseUrl=function(){var c=applicationViewModel.ajaxLoader.getStandardMediaBaseUrl();this.hasServerSideEffect&&
(c+="effects/");return c};a.prototype.getQualityFileExtension=function(c){c||(c=this.json);var a="";void 0!=c["@formats"]&&""!=c["@formats"]&&(c=c["@formats"].split(this.FORMATS_SEPARATOR),0<c.length&&(a=c[0]));return a};a.prototype.getQualityFileUrl=function(c,a,b){return"Q"+c+"_"+a+"."+b};a.prototype.getFileEffectExtension=function(){var c="";this.isCropped&&(c=this.minCropX.toString().replace(".","x")+"_"+this.minCropY.toString().replace(".","x")+"_"+this.maxCropX.toString().replace(".","x")+"_"+
this.maxCropY.toString().replace(".","x"));return c};a.prototype.loadData=function(c){c&&c["@url"]&&(this.hasSourceUrl(!0),this.loadAnimations(c),this.loadCropImage(c),this.loadEffects(c),b.prototype.loadData.call(this,c),this.preloadFeedbackMedia());return this};a.prototype.setSourceForImageWithoutQuality=function(c,a){var b=this;void 0===a&&(a=!0);a?this.computeImageUrlFromTheme(JSON.parse('{"@url":"'+c+'"}')):(this.computedUrl=c,this.loadComputedUrl());this.useQuality(!1);this.hasSourceUrl(!0);
setTimeout(function(){b.resize()},100)};a.prototype.play=function(c){void 0===c&&(c=!0);this.log("debug","play image animation");!0==c?(this.isPlayingWithDelay(!0),this.isPlaying(!1)):(this.isPlayingWithDelay(!1),this.isPlaying(!0))};a.prototype.preloadFeedbackMedia=function(){this.preloadMedia&&(0<this.mediaRatio&&(this.currentQuality=this.getExpectedFileQualityAtFullscreen(),this.computedUrl=this.generateCompleteUrl(this.currentQuality),this.loadComputedUrl()),document.createElement("img").src=
this.url())};a.prototype.computeImageUrlFromTheme=function(c){this.json=c;this.computedUrl=applicationViewModel.ajaxLoader.getSkinMediaBaseUrl();this.computedUrl+=this.json["@url"];this.loadComputedUrl()};a.prototype.generateCompleteUrl=function(c){var a=applicationViewModel.ajaxLoader.getStandardMediaBaseUrl(),b=this.getQualityFileExtension(this.json);null!=b&&0!=b.length?(c=this.getQualityFileUrl(c,this.mediaId,b),a+=this.cleanMediaId+"/"):c=this.defaultFileName;this.hasServerSideEffect?(a+="effects/",
b=this.getFileEffectExtension(),c=c.split("."),a+=this.fixMediaUrlCase(c[0]+"-"+b+"."+c[1])):a+=this.fixMediaUrlCase(c);return a};a.prototype.loadUrl=function(c){c&&c["@url"]&&null!=c["@url"]&&""!=c["@url"]&&(this.json=c,this.assignDefaults(),this.computedUrl=this.getMediaBaseUrl()+this.fixMediaUrlCase(this.getJsonUrl()));this.json&&(this.currentQuality=this.getExpectedFileQuality(),this.computedUrl=this.generateCompleteUrl(this.currentQuality),ImageQuality.Q5==this.currentQuality?this.urlLowQuality(this.computedUrl):
this.urlLowQuality(this.generateCompleteUrl(ImageQuality.Q5)),this.initMediaRatio(),this.loadComputedUrl(),c["@zoomonclick"]&&"true"==c["@zoomonclick"]&&(c["@zoomonclick"]="false",c["@effects"]="none",this.imageZoomOnClick=MediaFactory.createMedia(c)))};a.prototype.startFeedback=function(){var c=this;this.imageZoomOnClick&&applicationViewModel.navigationManager.currentExercise().contentViewModel()&&setTimeout(function(){applicationViewModel.navigationManager.currentExercise().contentViewModel().feedback.setFeedback(c.imageZoomOnClick,
null,null);applicationViewModel.navigationManager.currentExercise().contentViewModel().showFeedback()},platformFeatures.getFeedbackDelay())};a.prototype.initMediaRatio=function(){var c=this,a=new Image;a.onload=function(){c.mediaRatio=a.width/a.height;c.preloadFeedbackMedia()};a.src=this.urlLowQuality()};a.prototype.loadComputedUrl=function(){5==this.currentQuality&&this.urlLowQuality(this.computedUrl);b.prototype.loadComputedUrl.call(this);0==this.computedUrl.length&&this.hasSourceUrl(!1)};a.prototype.loadEffects=
function(c){var a;void 0!=c["@effects"]&&""!=c["@effects"]&&this.effect(a=c["@effects"]);if(a!=ImageEffect.none)switch(a){case ImageEffect.polaroid:this.isPolaroid(!0);break;case ImageEffect.bordered:this.isBorder(!0);break;case ImageEffect.roundedborder:this.isRoundedBorder(!0);break;case ImageEffect.shadow:this.isShadow(!0)}};a.prototype.loadAnimations=function(c){if(void 0!=c["@animations"])for(var c=c["@animations"].split(";"),a=0,b=c.length;a<b;a++)ImageAnimation.zoomout==c[a]&&this.isZoomout(!0)};
a.prototype.hasUrl=function(){return!StringHelper.isNullOrEmpty(this.url())};a.prototype.loadCropImage=function(c){void 0!=c["@mincropx"]&&(this.minCropX=c["@mincropx"]);void 0!=c["@maxcropx"]&&(this.maxCropX=c["@maxcropx"]);void 0!=c["@mincropy"]&&(this.minCropY=c["@mincropy"]);void 0!=c["@maxcropy"]&&(this.maxCropY=c["@maxcropy"]);if(void 0!=c["@mincropx"]&&0!=c["@mincropx"]||void 0!=c["@maxcropx"]&&1!=c["@maxcropx"]||void 0!=c["@mincropy"]&&0!=c["@mincropy"]||void 0!=c["@maxcropy"]&&1!=c["@maxcropy"])this.isCropped=
this.hasServerSideEffect=!0;var a=parseInt(c["@originalwidth"]);isNaN(a)||(this.originalWidth=a);c=parseInt(c["@originalheight"]);isNaN(c)||(this.originalHeight=c);if(0!=this.minCropX||1!=this.maxCropX||0!=this.minCropY||1!=this.maxCropY)this.isCropped=this.hasServerSideEffect=!0};a.isCssEffect=function(c){return ImageEffect.isCssEffect(c)};a.prototype.hqLoaded=function(){var c=this;this.log("info","HQLoaded",this.url());this.onHqLoaded.execute();setTimeout(function(){c.resize()},0);this.isHqLoaded(!0)};
a.prototype.hqError=function(){this.isHqLoaded(!1);this.isLqLoaded()?this.getLowQualityImageDom().show():this.hasSourceUrl(!1)};a.prototype.lqLoaded=function(){var c=this;this.log("info","LQLoaded",this.url());setTimeout(function(){c.resize()},0);this.isLqLoaded(!0);this.onLoaded.execute()};a.prototype.lqError=function(){this.isLqLoaded(!1);this.isHqLoaded()?this.getHighQualityImageDom().show():this.hasSourceUrl(!1)};a.prototype.getExpectedFileQualityAtFullscreen=function(){var c=0,a=0;this.mediaRatio>
applicationViewModel.width()/applicationViewModel.height()?(a=applicationViewModel.height(),c=a*this.mediaRatio):(c=applicationViewModel.width(),a=c/this.mediaRatio);return this.qualityChooser.getExpectedFileQuality(applicationViewModel.width(),applicationViewModel.height(),c,a,platformFeatures.getIsMobileDevice())};a.prototype.getDimensions=function(){var c=this.getInnerContainer(),a=this.getHighQualityImageDom();return{container:{width:c.innerWidth(),height:c.innerHeight()},image:{width:a.innerWidth(),
height:a.innerHeight()}}};a.prototype.fitToContainer=function(){var c,a,b=this.getFitContainer(),f=this.getHighQualityImageDom(),g=this.getLowQualityImageDom();a=this.getIllustrationDom();var h=this.getInnerContainer();b.length&&(this.isFitted(!1),h.width(""),h.height(""),c=this.verticalAlignMiddle(),this.verticalAlignMiddle(!1),platformFeatures.getIsPhone()?(f.css("width","100%"),g.css("width","100%")):(f.width("100%"),g.width("100%")),f.height("auto"),g.height("auto"),a.outerHeight()>b.innerHeight()&&
(a=a.outerHeight()-h.innerHeight(),h.height(b.height()-a),f.width("auto"),g.width("auto"),platformFeatures.getIsPhone()?(f.css("height","100%"),g.css("height","100%")):(f.height("100%"),g.height("100%")),h.width(g.width()),this.isFitted(!0)),this.verticalAlignMiddle(c))};a.prototype.getExpectedFileQuality=function(){var c=this.getDimensions();return this.qualityChooser.getExpectedFileQuality(c.container.width,c.container.height,c.image.width,c.image.height,platformFeatures.getIsMobileDevice())};a.prototype.isUsingExpectedQuality=
function(){return this.useQuality()&&this.getExpectedFileQuality()>=this.currentQuality};a.prototype.switchImageQualityIfNecessary=function(){var c=this;if(!this.useQuality())return platformFeatures.getIsIE8()?(clearTimeout(this.switchImageQualityTimeout),this.switchImageQualityTimeout=setTimeout(function(){c.loadComputedUrl()},500)):this.loadComputedUrl(),this;if("undefined"==typeof this.json)return this;this.log("info","switchImageQuality",this.url());this.isUsingExpectedQuality()||(platformFeatures.getIsIE8()?
(clearTimeout(this.switchImageQualityTimeout),this.switchImageQualityTimeout=setTimeout(function(){c.loadUrl(c.json)},500)):this.loadUrl(this.json));return this};a.prototype.sizeChanged=function(){this.resize()};a.prototype.onClick=function(){this.onClickCallback&&this.onClickCallback()};a.prototype.resize=function(){this.log("info","resize");this.fitToContainer();this.switchImageQualityIfNecessary()};a.prototype.displayMediaTexts=function(c,a,e,f,g,h){this.isPolaroid()&&(this.polaroidTitle(c),e=
null);b.prototype.displayMediaTexts.call(this,c,a,e,f,g,h)};return a}(MediaBase),ImageAnimation={none:"",zoomout:"zoom_out"},ImageEffect={bordered:"bordered",roundedborder:"roundedborder",shadow:"shadow",polaroid:"polaroid",none:"none",lightenblur:"lightenblur",darkenblur:"darkenblur",isCssEffect:function(b){return"undefined"!=typeof this[b.toLocaleLowerCase()]}},ImageQuality;(function(b){b[b.Q1=1]="Q1";b[b.Q2=2]="Q2";b[b.Q3=3]="Q3";b[b.Q4=4]="Q4";b[b.Q5=5]="Q5"})(ImageQuality||(ImageQuality={}));
var TextStretcher=function(){function b(a){this.disabled=!1;this.timers=new Timers;this.TIMER_ID="applyStretch";this.afterStretchCallback=a;this.disabled=applicationViewModel.ajaxLoader.getUrlParameterValue("nostretch")}b.prototype.setTimeout=function(a,c,d){void 0===d&&(d=0);return this.timers.setTimeout(a,c,d)};b.prototype.getTimers=function(){return this.timers};b.prototype.clearTimeout=function(a){this.timers.clearTimeout(a)};b.prototype.stretch=function(a){logger.info("[MediaText] stretchText: starting",
a().selector);if(!this.disabled){var c=$.Deferred(),d=a,e=a().data(b.ATTR_CACHE);e||(e=GuidHelper.newGuid(),a().data(b.ATTR_CACHE,e),b.CONTAINERS[e]=$("[data-nb-word-wrap-allowed]",a));d=function(){return b.CONTAINERS[e]};this.reset(d());this.executeStretch(d(),c);return c.promise()}};b.prototype.executeStretch=function(a,c){this.apply(a);this.afterStretchCallback();this.setTimeout("stretching",function(){c.resolve()})};b.prototype.reset=function(a){for(var c=0,d=a.length;c<d;c++){var b=$(a[c]),f=
this.getSettingsForDom(b),g=f.parent;logger.info("[MediaText] reset parent width",b.selector);f.isTd&&(b.css("height","auto"),platformFeatures.isFirefox&&g.css({"min-width":""}));g.css("width",f.minWidth);logger.log("reset",f.minWidth)}};b.prototype.apply=function(a){for(var c=0,d=a.length;c<d;c++){var b=$(a[c]),f=this.getSettingsForDom(b);logger.log("STRETCH",b[0]);this.applyWithSingleParent(b,f)}};b.prototype.nodeMustBeStretched=function(a,c){var d=0,b,f,g;a.hasClass("richText")||0!=a.find(".richText").length?
g=a.find("p, li").filter(function(){return!this.className.match(/^vjs/)}):(g=a,d=-a.find("br").length);for(var h=0,i=g.length;h<i;h++){f=$(g[h]);b=f.css("line-height");if(-1<b.indexOf("px"))b=parseInt(b);else{b=parseFloat(b);var j=!1;isNaN(b)?(j=!0,f.css("line-height","1em"),b=parseInt(f.css("line-height"))):b*=parseInt(f.css("font-size"));j&&f.css("line-height","")}f=f.height();d+=Math.round(f/b)-1}return d>c};b.prototype.applyWithSingleParent=function(a,c){logger.info("[MediaText] stretch width",
a.selector,c.lines);c.sourceNodeSelector&&0<c.sourceNodeSelector.length&&(a=a.find(c.sourceNodeSelector));c.loopParentWidthInRun=c.parent.innerWidth();this.loopSingleParent(a,c);c.isTd&&a.css("height","");c.othersContext&&this.loopOverOtherContexts(a,c);0==c.loopsMadeInRun&&!c.isTd&&this.resetWidthIfChildsAreOverflowing(a,c)};b.prototype.getMaxWidthInPixels=function(a){var c=parseInt(a.maxWidth),d=isNaN(c);d&&(c=100);if(!platformFeatures.getIsIE8()&&!platformFeatures.getIsEdge()||d)c=Math.floor(a.grandParentWidth*
c/100);return c};b.prototype.loopSingleParent=function(a,c){for(var d=0,e=this.getMaxWidthInPixels(c);50>d&&(this.nodeMustBeStretched(a,c.lines)||0==d)&&c.loopParentWidthInRun<e;){logger.debug("[MediaText] stretchText: in while loop",a.selector);c.loopParentWidthInRun+=b.ENLARGE_STEP;var f=c.loopParentWidthInRun>e;f&&(c.loopParentWidthInRun=e);c.isTd&&platformFeatures.isFirefox?(c.parent.css({"min-width":c.loopParentWidthInRun}),c.loopParentWidthInRun=parseInt(c.parent.css("min-width"))):(c.parent.innerWidth(c.loopParentWidthInRun),
c.loopParentWidthInRun=c.parent.innerWidth());logger.log("PARENT WIDTH",c.loopParentWidthInRun);d++;if(f)break}c.loopsMadeInRun=d};b.prototype.loopOverOtherContexts=function(a,c){for(var d=c.loopParentWidthInRun,b=a.parents(c.othersContext).find(c.othersSelector),f=0,g=b.length;f<g;f++){var h=$(b[f]);h.data("nb-word-wrap-allowed")&&(h=h.width(),h>d&&(d=h))}b.innerWidth(d)};b.prototype.resetWidthIfChildsAreOverflowing=function(a,c){for(var d=Math.round(a.width()),b=null,f=a.children(),g=0,h=f.length;g<
h;g++){var i=$(f[g]).width();i>b&&(b=i)}b>d&&c.parent.width("auto")};b.prototype.cleanup=function(a){this.clearTimeout(this.TIMER_ID);var c=a.data(b.ATTR_CACHE);a.removeData(b.ATTR_CACHE);for(var a=0,d=b.CONTAINERS[c];a<d;a++){var e=b.CONTAINERS[c][a].attr("id");b.SETTINGS[e]&&(b.SETTINGS[e]=null)}b.CONTAINERS[c]=null};b.prototype.computeSettingsForDom=function(a){var c=new TextStretcherSettings;c.node=a;var d=a.data(b.STRETCH_PARENT),e=""==a.data(b.STRETCH_SELF),f=a.data(b.STRETCH_TD);c.othersContext=
a.data("stretch-others-context-selector");c.othersSelector=a.data("stretch-others-selector");c.sourceNodeSelector=a.data("stretch-source-node-selector");d?(c.parent=a.parents(d),1<c.parent.length&&(c.parents=c.parent,c.parent=c.parent.first())):c.parent=e?a:f?$("#"+f):a.parent();c.isTd=f?!0:!1;c.grandParent=f?c.parent.parents(".exercise__content"):c.parent.parent();c.lines=parseInt(a.data("nb-word-wrap-allowed"));return c};b.prototype.isStringOrNumber=function(a){return!("string"==typeof a||"number"==
typeof a)};b.prototype.validateSettings=function(a){if(this.isStringOrNumber(a.minWidth)||this.isStringOrNumber(a.maxWidth)||this.isStringOrNumber(a.lines))throw"Error in configuration for node:"+a.node;};b.prototype.getSettingsForDom=function(a){var c=a.attr("id");c||(c=GuidHelper.newGuid(),a.attr("id",c));b.SETTINGS[c]||(b.SETTINGS[c]=this.computeSettingsForDom(a));this.refreshValues(b.SETTINGS[c]);this.validateSettings(b.SETTINGS[c]);return b.SETTINGS[c]};b.prototype.refreshValues=function(a){a.grandParentWidth=
parseInt(a.grandParent.width());var c=(platformFeatures.getIsIE9()||platformFeatures.getIsIE10()||platformFeatures.getIsIE11())&&!platformFeatures.getIsWindowsPhone();a.minWidth=c?a.parent[0].currentStyle.minWidth:a.parent.css("min-width");a.maxWidth=c?a.parent[0].currentStyle.maxWidth:a.parent.css("max-width")};b.ATTR_CACHE="stretcher-cache-id";b.DATA_STRETCHER_SETTINGS="stretcher-settings";b.STRETCH_SELF="stretch-self";b.STRETCH_TD="stretch-td";b.STRETCH_PARENT="stretch-parent";b.ENLARGE_STEP=60;
b.SETTINGS=[];b.CONTAINERS=[];return b}(),TextStretcherSettings=function(){return function(){}}(),Timers=function(){function b(){this.timers={};this.rafs={};this.intervals={}}b.prototype.setTimeout=function(a,c,d){void 0===d&&(d=0);this.timers[a]&&(clearTimeout(this.timers[a]),delete this.timers[a],logger.debug("[Timers]Timeout '"+a+"' already exists and has been erased"));this.timers[a]=setTimeout(c,d);return this.timers[a]};b.prototype.clearTimeout=function(a){this.timers[a]&&clearTimeout(this.timers[a]);
return this};b.prototype.requestAnimationFrame=function(a,c){this.rafs[a]&&(cancelAnimationFrame(this.rafs[a]),delete this.rafs[a],logger.debug("[Timers]Request Animation frame '"+a+"' already exists and has been erased"));this.rafs[a]=requestAnimationFrame(c);return this.rafs[a]};b.prototype.cancelAnimationFrame=function(a){this.rafs[a]&&cancelAnimationFrame(this.rafs[a]);return this};b.prototype.setInterval=function(a,c,d){this.intervals[a]&&(clearInterval(this.intervals[a]),delete this.intervals[a],
logger.debug("[Timers]Interval '"+a+"' already exists and has been erased"));this.intervals[a]=setInterval(c,d);return this.intervals[a]};b.prototype.clearInterval=function(a){this.intervals[a]&&clearInterval(this.intervals[a]);return this};b.prototype.cleanup=function(){for(var a in this.timers)this.timers[a]&&clearTimeout(this.timers[a]);for(a in this.rafs)this.rafs[a]&&cancelAnimationFrame(this.rafs[a]);for(a in this.intervals)this.intervals[a]&&clearInterval(this.intervals[a]);this.timers={};
this.intervals={};this.rafs={}};return b}(),Interaction=function(){function b(){}b.prototype.setValues=function(a,c,d,b,f,g){this.exerciseId=a;this.correct=d;this.learnerResponse=b;this.type=c;this.result=f;this.weighting=g};return b}(),CountDown=function(){function b(a,c){this.timesUp=!1;this.countDownValue=ko.observable("");this.exerciseId=a;this.startDate=c}b.prototype.init=function(a,c){this.timesUpcallback=c;this.countDownInSeconds=a;this.countDownValue("")};b.prototype.executeJob=function(){var a=
new Date(this.startDate.getTime()+1E3*this.countDownInSeconds),a=Math.round((a.getTime()-(new Date).getTime())/1E3);this.countDownValue(this.formatToString(a));0>=a&&(this.timesUp=!0,clearInterval(this.timer),this.timesUpcallback())};b.prototype.start=function(){var a=this;null==this.startDate&&(this.startDate=new Date);this.executeJob();this.timesUp||(this.timer=setInterval(function(){a.executeJob()},1E3))};b.prototype.stop=function(){clearInterval(this.timer);this.countDownValue("")};b.prototype.getExerciseId=
function(){return this.exerciseId};b.prototype.getStartDate=function(){return this.startDate};b.prototype.formatToString=function(a){var c="0",c=Math.floor(a/3600),a=a%3600,d=Math.floor(a/60),a=a%60;return c=0<c?c.toString()+":"+("0"+d).slice(-2)+":"+("0"+a).slice(-2):0<d?("0"+d).slice(-2)+":"+("0"+a).slice(-2):"0:"+("0"+a).slice(-2)};return b}(),InteractionManager=function(){function b(a){this.trakingEnabled=!1;this.interactions=[];this.countDowns=[];this.successStatus="unknown";this.isAssessmentPassed=
!1;this.score=0;this.isAssessmentHtml5=!1;this.assessmentExercisesIds=[];if(this.scormApi=a)this.trakingEnabled=a.trackingEnabled}b.prototype.addInteraction=function(a){this.interactions.push(a);this.trakingEnabled&&this.scormApi.addInteraction(a.exerciseId,a.type,a.correct,a.learnerResponse,a.result,a.weighting)};b.prototype.addCountDown=function(a){this.countDowns.push(a);if(this.trakingEnabled){var a=[],c;for(c in this.countDowns){var d=this.countDowns[c];a.push(d.getExerciseId()+"|"+(null!=d.getStartDate()?
d.getStartDate().getTime():null))}this.scormApi.setCountDowns(a)}};b.prototype.deleteCountDown=function(a){var c=[],d;for(d in this.countDowns)this.countDowns[d].getExerciseId()!==a&&c.push(this.countDowns[d]);this.countDowns=c;if(this.trakingEnabled){a=[];for(d in this.countDowns)c=this.countDowns[d],a.push(c.getExerciseId()+"|"+(null!=c.getStartDate()?c.getStartDate().getTime():null));this.scormApi.setCountDowns(a)}};b.prototype.removeInteraction=function(a){var c=[],d;for(d in this.interactions)this.interactions[d].exerciseId!==
a?c.push(this.interactions[d]):this.trakingEnabled&&this.scormApi.removeInteraction(a);this.interactions=c};b.prototype.getInteractionCountForExercise=function(a){var c=0,d=null,b;for(b in this.interactions)d=this.interactions[b].result,this.interactions[b].exerciseId==a&&this.hasInteractionResult(d)&&c++;return c};b.prototype.getInteractionCount=function(){return this.interactions.length};b.prototype.getLastInteraction=function(a){var c=null,d=null,b;for(b in this.interactions)d=this.interactions[b].result,
this.interactions[b].exerciseId==a&&this.hasInteractionResult(d)&&(c=this.interactions[b]);return c};b.prototype.initialize=function(a){this.interactions=[];this.countDowns=[];this.successStatus="unknown";this.isAssessmentHtml5=a.isAssessment();this.assessmentExercisesIds=[];for(var a=a.getAssessmentExercises(),c=0;c<a.length;c++)this.assessmentExercisesIds.push(a[c].id);this.trakingEnabled&&(this.resumeModuleInteractions(),this.resumeModuleCountDowns())};b.prototype.getScore=function(){return this.score};
b.prototype.resetScore=function(){this.successStatus="unknown";this.score=0};b.prototype.computeScore=function(a){if(!this.isAssessmentHtml5)return this.score;var c=this.getNumberOfCorrectInteraction(),d=this.getNumberOfInteraction();this.score=0!==d?Math.round(100*c/d):0;this.successStatus=(this.isAssessmentPassed=this.score>=a)?"passed":"failed";this.scormApi&&this.trakingEnabled&&(this.isAssessmentHtml5&&applicationViewModel.course().getSendScoreToLMS()&&("1.2"!==LMS.SCORMversion||this.scormApi.getPostCompletionIfSuccess())&&
this.scormApi.setScore(0,d,c,this.score,this.successStatus),this.scormApi.getPostCompletionIfSuccess()&&this.isAssessmentPassed&&this.scormApi.courseCompleted());return this.score};b.prototype.getIsAssessmentPassed=function(){return this.isAssessmentPassed};b.prototype.getNumberOfInteraction=function(){var a=[],c;for(c in this.interactions){var d=this.interactions[c].exerciseId;-1===$.inArray(d,a)&&a.push(d)}d=[];for(c in a)-1!==$.inArray(a[c],this.assessmentExercisesIds)&&d.push(a[c]);a=0;for(c in d){var b=
this.getLastInteraction(d[c]);null!=b&&(b=parseInt(b.weighting),a+=b)}return a};b.prototype.getNumberOfCorrectInteraction=function(){var a=[],c;for(c in this.interactions){var d=this.interactions[c].exerciseId;-1===$.inArray(d,a)&&a.push(d)}d=[];for(c in a)-1!==$.inArray(a[c],this.assessmentExercisesIds)&&d.push(a[c]);a=0;for(c in d){var b=this.getLastInteraction(d[c]);if(null!=b){var f=parseInt(b.weighting);"correct"===b.result&&(a+=f)}}return a};b.prototype.isAssessment=function(){return this.isAssessmentHtml5};
b.prototype.getSuccessStatus=function(){return this.successStatus};b.prototype.resumeModuleInteractions=function(){this.interactions=this.scormApi.getInteractions();this.successStatus=this.scormApi.getSuccessStatus();this.score=this.scormApi.getScore()};b.prototype.resumeModuleCountDowns=function(){this.countDowns=this.scormApi.getCountDowns()};b.prototype.hasInteractionResult=function(a){return!isNaN(a)&&0==parseInt(a,10)?!1:!0};b.prototype.getFirstInteraction=function(){for(var a in this.interactions)if(0<
parseInt(this.interactions[a].weighting))return this.interactions[a];return null};b.prototype.getCountDown=function(a){for(var c in this.countDowns)if(this.countDowns[c].getExerciseId()==a)return this.countDowns[c];return null};b.prototype.getSerializedCountDowns=function(){var a=[],c;for(c in this.countDowns){var d=this.countDowns[c],b=null;null!=d.getStartDate()&&(b=d.getStartDate().getTime());a.push(d.getExerciseId()+"|"+b)}return a};return b}(),InteractionApi=function(){function b(){}b.prototype.init=
function(a,c){this.interactionManager=a;this.exerciseId=c};b.prototype.getLastInteraction=function(){return!this.interactionManager?null:this.interactionManager.getLastInteraction(this.exerciseId)};b.prototype.getCountDown=function(){return!this.interactionManager?null:this.interactionManager.getCountDown(this.exerciseId)};b.prototype.getInteractionCount=function(){return!this.interactionManager?0:this.interactionManager.getInteractionCountForExercise(this.exerciseId)};b.prototype.getTotalInteractionsCount=
function(){return!this.interactionManager?0:this.interactionManager.getInteractionCount()};b.prototype.addInteraction=function(a){this.interactionManager&&this.interactionManager.addInteraction(a)};b.prototype.addCountDown=function(a){this.interactionManager&&this.interactionManager.addCountDown(a)};return b}(),ScoreApi=function(){function b(){}b.prototype.init=function(a,c){this.interactionManager=a;this.exerciseId=c};b.prototype.computeScore=function(a){return this.interactionManager.computeScore(a)};
b.prototype.getNumberOfInteraction=function(){return this.interactionManager.getNumberOfInteraction()};b.prototype.getNumberOfCorrectInteraction=function(){return this.interactionManager.getNumberOfCorrectInteraction()};return b}(),TemplateSettings=function(){function b(a){this.templateSettings={};this.loadConfig(a)}b.prototype.loadConfig=function(a){for(var a=ArrayHelper.getArrayFromJson(a),c=0,d=a.length;c<d;c++){var b=a[c],f=b["@name"];if(null!=f){f=f.toLowerCase();this.templateSettings[f]={};
for(var b=ArrayHelper.getArrayFromJson(b.Setting),g=0,h=b.length;g<h;g++){var i=b[g],j=i["@key"];"undefined"!=typeof j&&(j=j.toLowerCase(),this.templateSettings[f][j]=i["@value"])}}}};b.prototype.getTemplateSetting=function(a,c,d){a=a.toLowerCase();c=c.toLowerCase();return this.templateHasSetting(a,c)?(a=this.templateSettings[a][c],0<a.length&&d&&(a=SkinManager.getInstance().getHtmlSkinPath(a)),a):this.getTemplateSettingDefault(a,c)};b.prototype.templateHasSetting=function(a,c){return this.templateHasSettings(a)&&
"undefined"!=typeof this.templateSettings[a.toLowerCase()][c.toLowerCase()]};b.prototype.getTemplateSettings=function(a){a=a.toLowerCase();return this.templateHasSettings(a)?this.templateSettings[a]:this.getTemplateSettingsDefaults(a)};b.prototype.templateHasSettings=function(a){a=a.toLowerCase();return"undefined"!=typeof this.templateSettings[a]};b.prototype.getTemplateSettingDefault=function(a,c){a=a.toLowerCase();return"undefined"==typeof b.defaults[a]||"undefined"==typeof b.defaults[a][c]?null:
b.defaults[a][c]};b.prototype.getTemplateSettingsDefaults=function(a){a=a.toLowerCase();return"undefined"==typeof b.defaults[a]?null:b.defaults[a]};return b}(),DefaultSettings=function(){function b(a){this.settings={};this.loadConfig(a)}b.prototype.loadConfig=function(a){if(a)for(var a=ArrayHelper.getArrayFromJson(a.Setting),c=0,d=a.length;c<d;c++){var b=a[c],f=b["@key"];"undefined"!=typeof f&&(f=f.toLowerCase(),this.settings[f]=b["@value"])}};b.prototype.getSetting=function(a){if(null==a)return null;
a=a.toLowerCase();return null!=this.settings?this.settings[a]:void 0};b.prototype.getUrlSetting=function(a){if(this.getSetting(a))return SkinManager.getInstance().getHtmlSkinPath(this.getSetting(a))};return b}(),SkinManager=function(){function b(){var a=this;this.defaultSettings=new DefaultSettings(null);this.skinIsLoaded=ko.observable(!1);this.isSkinLoaded=ko.computed({read:function(){return a.skinIsLoaded()},write:function(c){return c}})}b.prototype.init=function(a){var c=this,a=a||{},d=applicationViewModel.ajaxLoader.getUrlParameterValue("skin");
null!=d?applicationViewModel.ajaxLoader.loadManifestXml(d,function(a){c.initializeSettings(c.manifestXmlToJsonSettings(a))},function(){c.skinIsLoaded(!0)}):(a.settings=a.settings||{},this.initializeSettings(a))};b.prototype.initializeSettings=function(a){this.createTemplateSettings(a.settings.SkinSettings);this.createDefaultSettings(a.settings.SkinSettings);this.loadCSSFromSkinId(a.htmlSkinIdentifier)};b.prototype.loadCSSFromSkinId=function(a){this.skinIdentifier=a;null!=uiManager&&(this.skinIsLoaded(!0),
null!=this.skinIdentifier&&(a=this.getHtmlSkinPath()+"/runtime/style.css",$("head").append('<link rel="stylesheet" href="'+a+'" type="text/css" />')))};b.prototype.createTemplateSettings=function(a){var c=[];a&&a.TemplateSettings&&(c=a.TemplateSettings);this.templateSettings=new TemplateSettings(c)};b.prototype.createDefaultSettings=function(a){var c=[];a&&a.DefaultSettings&&(c=a.DefaultSettings);this.defaultSettings=new DefaultSettings(c)};b.setDefaultInstance=function(a){b.instance=a};b.getInstance=
function(){null==b.instance&&b.setDefaultInstance(new b);return b.instance};b.prototype.getHtmlSkinPath=function(a){"undefined"==typeof a&&(a=null);return applicationViewModel.ajaxLoader.getHtmlSkinBaseUrl()+this.skinIdentifier+(a?"/"+a:"")};b.prototype.getDefaultSettings=function(){logger.debug(this.defaultSettings);return this.defaultSettings};b.prototype.getTemplateSettings=function(a){logger.debug(this.templateSettings);return this.templateSettings.getTemplateSettings(a)};b.prototype.getTemplateSetting=
function(a,c,d){return!this.templateSettings?null:this.templateSettings.getTemplateSetting(a,c,d)};b.prototype.manifestXmlToJsonSettings=function(a){var c={settings:{}};c.settings.SkinSettings={};c.settings.SkinSettings.TemplateSettings=[];c.settings.SkinSettings.DefaultSettings=[];var d=[];c.htmlSkinIdentifier=applicationViewModel.ajaxLoader.getUrlParameterValue("skin");$(a).find("DefaultSettings").children().each(function(){d.push({"@key":$(this).attr("key"),"@value":$(this).attr("value")})});c.settings.SkinSettings.DefaultSettings.Setting=
d;$(a).find("TemplateSettings").each(function(){var a=$(this).attr("name"),d=[];$(this).find("Setting").each(function(){d.push({"@key":$(this).attr("key"),"@value":$(this).attr("value")})});c.settings.SkinSettings.TemplateSettings.push({"@name":a,Setting:d})});return c};return b}(),EnumTemplateCompatibility;(function(b){b[b.brandedintro=0]="brandedintro";b[b.brandedoutro=1]="brandedoutro";b[b.aboutwords=2]="aboutwords"})(EnumTemplateCompatibility||(EnumTemplateCompatibility={}));
var EnumTemplateCompatibilityHelper=function(){function b(){}b.parseEnumTemplateType=function(a){var c=null;if(null==a)return null;0==a.localeCompare("intro")&&"true"==SkinManager.getInstance().getTemplateSetting("intro","useBrandedIntro")&&(c=EnumTemplateCompatibility.brandedintro);0==a.localeCompare("ending")&&"true"==SkinManager.getInstance().getTemplateSetting("ending","useBrandedOutro")&&(c=EnumTemplateCompatibility.brandedoutro);return c};b.toString=function(a){var c="";if(null==a)return null;
switch(a){case EnumTemplateCompatibility.brandedintro:c="brandedIntro";break;case EnumTemplateCompatibility.brandedoutro:c="brandedOutro"}return c};return b}(),EnumTransitionType;(function(b){b[b.Manual=0]="Manual";b[b.Auto=1]="Auto"})(EnumTransitionType||(EnumTransitionType={}));
var EnumTransitionTypeHelper=function(){function b(){}b.parseEnumTransitionType=function(a){var c=null;if(null==a)return null;switch(a){case "0":c=EnumTransitionType.Manual;break;case "1":c=EnumTransitionType.Auto;break;default:c=EnumTransitionType.Manual}return c};b.toNumber=function(a){var c=0;if(null==a)return null;switch(a){case EnumTransitionType.Manual:c=0;break;case EnumTransitionType.Auto:c=1;break;default:c=0}return c};return b}(),ExerciseViewModel=function(){function b(a){var c=this;this.exerciseClass=
ko.observable("");this.slideId="0000";this.title=ko.observable("");this.isLoading=ko.observable(!1);this.isLoaded=ko.observable(!1);this.isActive=ko.observable(!1);this.isRendered=ko.observable(!1);this.animationNextArrowCancelled=this.animationNextArrowActivated=!1;this.computeIsCompleted={read:function(){return c.exercise.isCompleted()},write:function(a){c.exercise.isCompleted(a)},owner:this};this.outerTemplate=ko.computed(function(){return c.isLoaded()?"OuterTemplate":"LoadingTemplate"});this.template=
ko.observable("LoadingTemplate");this.contentViewModel=ko.observable(null);this.width=1200;this.height=800;this.cssClassValues="";this.readyForScreenshot=this.screenshotMode=this.isSwiping=!1;this.isVisible=ko.observable(!0);this.startRequested=!1;this.hasRestartButton=ko.observable(!1);this.timelineIndexLabel=ko.observable(0);this.thumbnail=ko.observable("");this.computeIsWatched={read:function(){return this.exercise.isWatched()},write:function(c){this.exercise.isWatched(c)},owner:this};this.isCurrent=
ko.observable(!1);this.computeIsLocked={read:function(){return this.exercise.isLocked()},write:function(c){this.exercise.isLocked(c)},owner:this};this.callToActionId=GuidHelper.newGuid();this.callToActionText=null;this.hasCallToAction=ko.observable(!1);this.showCallToAction=ko.observable(!1);this.showConfirmButtonRestart=ko.observable(!1);this.callToActionRotateAnimation=ko.observable(!1);this.callToActionBranchingLinkId=this.resetBranchingLinkId=null;this.callToActionReset=ko.observable(!1);this.skinVariation=
"0";this.sizeChangedExecuted=!1;this.onVisualAnimationEnded=null;this.timers=new Timers;this.setExerciseCompleted=function(){c.contentViewModel()&&c.contentViewModel().hideStickyFooter(!0);applicationViewModel.navigationManager.isLast()&&"unknown"===applicationViewModel.interactionManager.getSuccessStatus()&&applicationViewModel.interactionManager.computeScore(0);c.isCompleted(!0);if(c.hasCallToAction()||c.hasRestartButton())c.showCallToAction(!0),c.contentViewModel()&&c.contentViewModel().startAnimateMoreContentArrow(!0);
applicationViewModel.eventManager.triggerExerciseCompleteEvent(c)};this.getExerciseDom=function(){return $("#"+c.slideId)};this.showConfirmResetAndRestartButton=function(){c.showCallToAction(!1);c.showConfirmButtonRestart(!0)};this.resetAndRestartCourse=function(){c.stop();var a=null!=c.resetBranchingLinkId||c.callToActionReset();applicationViewModel.scorm.decrementNumberOfAttempts();if(a){for(var d=applicationViewModel.navigationManager.historyExercises(),b=null,b=c.callToActionReset()?applicationViewModel.navigationManager.getBranchingManager().getDestination(c.exerciseId,
EnumBranchingLinkType.CallToAction,c.callToActionBranchingLinkId).id:applicationViewModel.navigationManager.getBranchingManager().getDestination(c.exerciseId,EnumBranchingLinkType.Alternative,c.resetBranchingLinkId).id,a=-1,e=0;e<d.length;++e)if(d[e].exerciseId==b){a=e;break}var f=null;if(-1==a){f=applicationViewModel.interactionManager.getFirstInteraction().exerciseId;for(e=0;e<d.length;++e)if(d[e].exerciseId==f){a=e;break}}d=d.slice(0,a);applicationViewModel.navigationManager.historyExercises(d);
applicationViewModel.navigationManager.allExercises().forEach(function(c){for(var a=!1,e=0;e<d.length;++e)if(d[e].exerciseId==c.id){a=!0;break}a||(c.isCompleted(!1),c.isWatched(!1),!applicationViewModel.uiManager.isPreviewMode()&&c.id!==b&&(null==f||c.id!==f)&&c.isLocked(!0),applicationViewModel.interactionManager.removeInteraction(c.id),applicationViewModel.interactionManager.deleteCountDown(c.id),applicationViewModel.scorm.trackingEnabled&&applicationViewModel.scorm.completionState.deleteCompletionState(c.id),
(c=applicationViewModel.navigationManager.lifecycleManager.getExerciseViewModelFromId(c.id))&&c.cleanup())});applicationViewModel.navigationManager.reshuffleChapters();applicationViewModel.interactionManager.resetScore();applicationViewModel.scorm.trackingEnabled&&applicationViewModel.scorm.resetModuleStatusOnly();c.callToActionReset()?applicationViewModel.navigationManager.followCallToActionLink(c.exerciseId,c.callToActionBranchingLinkId):applicationViewModel.navigationManager.followAlternativeLink(c.exerciseId,
c.resetBranchingLinkId)}else a=applicationViewModel.navigationManager.historyExercises()[0],applicationViewModel.scorm.trackingEnabled&&applicationViewModel.scorm.resetModuleData(),uiManager.isPreviewMode()&&(window.location.hash="gotoExercise="+a.exerciseId),applicationViewModel.interactionManager.initialize(applicationViewModel.course()),applicationViewModel.eventManager.triggerCourseLoadEvent(applicationViewModel.course()),applicationViewModel.sliderViewModel.slideTo(applicationViewModel.navigationManager.currentExercise(),
JumpType.Past)};this.cancelResetAndRestartCourse=function(){c.showConfirmButtonRestart(!1);c.showCallToAction(!0)};this.exercise=a;this.exerciseId=a.id;this.exerciseType=this.resolveExerciseType(a);a.transitionType&&(this.exerciseTransitionType=EnumTransitionTypeHelper.parseEnumTransitionType(a.transitionType.toString()));if(null==this.exerciseId)throw Error("exerciseId can not be null");if(null==this.exerciseType)throw Error("exerciseType can not be null");this.slideId="slide-"+(65536*(1+Math.random())|
0).toString(16).substring(1);this.templateName=this.resolveTemplateName();if(void 0!=a.metadatas)for(var d=0,b=a.metadatas.length;d<b;d++){var f=a.metadatas[d];"assessmentResult"!==this.exerciseType&&"calltoaction"==f.key.toLowerCase()&&(this.callToActionText=StringHelper.htmlTrim(f.value),this.hasCallToAction(!StringHelper.isNullOrEmpty(this.callToActionText)));"htmlskinvariation"==f.key.toLowerCase()&&(this.skinVariation=StringHelper.htmlTrim(f.value))}this.cssClass="slide template-"+this.exerciseType;
this.exerciseType&&(d="",b=this.exerciseType.toLowerCase(),d=platformFeatures.getDivContentCssClassName()+" ",d=d+("exercise exercise--"+b)+(" skin_"+this.skinVariation),this.exerciseClass(d));this.exerciseGuid=GuidHelper.newGuid();this.viewModelName=this.resolveViewModelName();this.viewModelFileUrl="templates/"+this.exerciseType+"/"+this.exerciseType+".js";this.title(a.title);this.isCompleted=ko.pureComputed(this.computeIsCompleted);this.isLocked=ko.pureComputed(this.computeIsLocked);this.isWatched=
ko.pureComputed(this.computeIsWatched)}b.prototype.getChapter=function(){return this.exercise.getChapter()};b.prototype.initInteractionApi=function(a){a.init(applicationViewModel.interactionManager,this.exerciseId)};b.prototype.initScoreApi=function(a){a.init(applicationViewModel.interactionManager,this.exerciseId)};b.prototype.resolveExerciseType=function(a){var a=a.type,a=a.charAt(0).toLowerCase()+a.slice(1),c=EnumTemplateCompatibilityHelper.parseEnumTemplateType(a);c&&(a=EnumTemplateCompatibilityHelper.toString(c));
return a};b.prototype.resolveViewModelName=function(){var a=this.exerciseType.charAt(0).toUpperCase()+this.exerciseType.slice(1);if("Intro"==a&&"true"==SkinManager.getInstance().getTemplateSetting("intro","useBrandedIntro"))a="BrandedIntro";else if("Ending"==a&&"true"==SkinManager.getInstance().getTemplateSetting("ending","useBrandedOutro"))a="BrandedOutro";else if(-1!=a.indexOf("AssessmentLabeledImages")||-1!=a.indexOf("AssessmentMultiBoxes"))a="AssessmentMatchTo";return a.replace("-","")+"ViewModel"};
b.prototype.resolveTemplateName=function(){var a=this.exerciseType.charAt(0).toUpperCase()+this.exerciseType.slice(1);if("Intro"==a&&"true"==SkinManager.getInstance().getTemplateSetting("intro","useBrandedIntro"))a="BrandedIntro";else if("Ending"==a&&"true"==SkinManager.getInstance().getTemplateSetting("ending","useBrandedOutro"))a="BrandedOutro";else if(-1!=a.indexOf("AssessmentLabeledImages")||-1!=a.indexOf("AssessmentMultiboxes"))a="AssessmentMatchTo";return a};b.prototype.getData=function(){return this.exercise};
b.prototype.loadThumbnail=function(){this.thumbnail(applicationViewModel.ajaxLoader.getThumbnailBaseUrl(this.exercise.thumbnail))};b.prototype.applySize=function(a,c){0==a&&(a=applicationViewModel.width());0==c&&(c=applicationViewModel.height());a&&(this.width=a);c&&(this.height=c);this.getExerciseDom().find(".overview").first().height(this.height);return $.Deferred().resolve().promise()};b.prototype.offloader=function(a,c,d){var b=$.Deferred();this.setTimeout(a,function(){c().then(function(){b.resolve()})},
d?d:0);return b.promise()};b.prototype.sizeChanged=function(a,c){var d=this;0==a&&(a=applicationViewModel.width());0==c&&(c=applicationViewModel.height());var b=this.applySize(a,c);if(this.isLoaded()&&a&&c){var f=this.contentViewModel();b.then(function(){return d.offloader("sizeChanged_reset-size",function(){return f.resetSize()})}).then(function(){return d.offloader("sizeChanged_before-size-changed",function(){return f.beforeSizeChanged()})}).then(function(){return d.offloader("sizeChanged_stretch-texts",
function(){return d.stretchTexts()})}).then(function(){return d.offloader("sizeChanged_size-changed",function(){return f.sizeChanged(a,c)})}).then(function(){return d.offloader("sizeChanged_update-scrollbar",function(){return f.updateScrollbar()})}).then(function(){d.sizeChangedExecuted=!0;return $.Deferred().resolve().promise()})}return b};b.prototype.swipeStarted=function(){this.isLoaded()&&this.contentViewModel().swipeStarted()};b.prototype.swipeEnded=function(){this.isLoaded()&&this.contentViewModel().swipeEnded()};
b.prototype.swipeCancelled=function(){this.isLoaded()&&this.contentViewModel().swipeCancelled()};b.prototype.focusFirstTabIndexElement=function(){this.getExerciseDom().find("[tabindex]").first().focus()};b.prototype.load=function(){var a=this;if(null==this.loader&&!this.isLoaded()){this.log("info","load","executing");var c=$.Deferred();this.isLoading()?(this.log("info","load","already loaded"),c.resolve()):(this.log("info","load","loading"),this.isLoading(!0),this.isLoaded(!1),this.isActive(!1),this.getExerciseDom().attr("aria-hidden",
"true"),applicationViewModel.ajaxLoader.loadExerciseAsync(this).done($.proxy(this.onExerciseLoadedAsync,this,c)));c.fail(function(){a.log("error","ERROR LOADING EXERCISE FULLY",null)});this.loader=c}return this.loader};b.prototype.isOuterTemplateReady=function(){var a=1==this.getExerciseDom().find(".template-ready").length;this.log("info","isOuterTemplateReady",a);return a};b.prototype.setTimeout=function(a,c,d){void 0===d&&(d=0);return this.timers.setTimeout(a,c,d)};b.prototype.getTimers=function(){return this.timers};
b.prototype.onExerciseLoadedAsync=function(a,c,d,b){this.isLoading(!1);d.loadData(b).loadCompleted();this.textStretcher=new TextStretcher(d.onStretchTextEnded.bind(d));c.contentViewModel(d);c.template(c.getTemplateName());d.loadBackground();d.loadHeaderLogo();d.loadLogoPosition();d.onVisualAnimationEnded=this.onVisualAnimationEnded;this.isLoaded(!0);this.render(a)};b.prototype.render=function(a){var c=this.contentViewModel();c.initDom().render().createScrollbar();this.sizeChanged(applicationViewModel.width(),
applicationViewModel.height());c.updateScrollbar();this.setTimeout("renderer-resolver",function(){a.resolve()},50)};b.prototype.start=function(){var a=this;this.log("info","start","executing");if(this.startRequested)this.log("info","start","start already requested");else if(this.log("info","start","starting"),this.isLoaded()){if(uiManager&&(this.screenshotMode=null!=uiManager.screenshotMode),this.isActive(!0),this.getExerciseDom().attr("aria-hidden","false"),this.startContent(),this.isWatched(!0),
this.animationNextArrowCancelled=!1,1===applicationViewModel.navigationManager.historyExercises().length){var c=5E3,d=SkinManager.getInstance();if("BrandedIntro"==this.templateName||"BrandedOutro"==this.templateName)c+=parseInt(d.getTemplateSetting(this.templateName,"delay"))+2E3;setTimeout(function(){if(!a.animationNextArrowCancelled){$(".nav-button__next").addClass("nav-buttons--startAnimation");a.animationNextArrowActivated=true}},c)}}else this.startRequested=!0,this.log("info","start","start requested"),
this.load().then(function(){a.log("info","start","start request completion: starting");a.startRequested=!1;a.start()})};b.prototype.stop=function(){this.isActive(!1);this.getExerciseDom().attr("aria-hidden","true");this.animationNextArrowCancelled=!0;this.animationNextArrowActivated&&$(".nav-button__next").removeClass("nav-buttons--startAnimation");this.isLoaded()&&(this.contentViewModel().stop(),this.getExerciseDom().removeClass("exercise--started"))};b.prototype.getDomCallToAction=function(){return $("#"+
this.callToActionId)};b.prototype.startContent=function(){var a=this;if(!applicationViewModel.modalBoxViewModel.overlayVisible()){this.log("info","startContent","starting content for "+this.slideId);var c=this.contentViewModel();requestAnimationFrame(function(){c.getExerciseDom().removeClass("exercise--started").addClass("exercise--started")});this.screenshotMode?this.loader.then(function(){c.startThumbnail();var d="EmbeddedContentTemplate"==a.template()?5E3:1E3;a.setTimeout("call-phantom",function(){a.readyForScreenshot=
!0;window.callPhantom&&window.callPhantom()},d)}):this.isRendered()?c.start():this.loader.then(function(){a.startContent()})}};b.prototype.stretchTexts=function(){return this.textStretcher.stretch(this.getExerciseDom)};b.prototype.cleanup=function(){if(this.isLoaded()){this.timers.cleanup();var a=this.contentViewModel();if(null!=a)try{a.cleanup(),this.textStretcher.cleanup(this.getExerciseDom())}catch(c){this.log("error","cleanup","ExerciseViewModel.cleanup error : "+c)}this.isRendered(!1);this.startRequested=
!1;this.loader=null;this.sizeChangedExecuted=!1;this.template("LoadingTemplate");this.contentViewModel(null)}this.markNotLoaded()};b.prototype.markNotLoaded=function(){this.log("debug","markNotLoaded");this.template("LoadingTemplate");this.isLoading(!1);this.isLoaded(!1);this.loader=null};b.prototype.getExerciseTemplateUrl=function(){var a=this.exerciseType;"intro"==a&&"true"==SkinManager.getInstance().getTemplateSetting("intro","useBrandedIntro")?a="brandedIntro":"ending"==a&&"true"==SkinManager.getInstance().getTemplateSetting("ending",
"useBrandedOutro")&&(a="brandedOutro");return"templates/"+a+"/"+a+".html"};b.prototype.getTemplateName=function(){return this.templateName+"Template"};b.prototype.log=function(a,c){for(var d=[],b=2;b<arguments.length;b++)d[b-2]=arguments[b];b=["ExerciseVM."+c+"=> Id:"+this.exerciseId+" Type:"+this.exerciseType+" Slideid:"+this.slideId];b.concat(d);logger[a].apply(logger,b)};b.prototype.callToActionCancelClick=function(){this.showCallToAction(!1)};b.prototype.callToActionClick=function(){applicationViewModel.navigationManager.followCallToActionLink(this.exerciseId,
this.callToActionBranchingLinkId)};b.prototype.getSizeChangedExecuted=function(){return this.sizeChangedExecuted};return b}(),EXERCISE_LOADING_STATE;(function(b){b[b.NOT_LOADING=0]="NOT_LOADING";b[b.LOADING=1]="LOADING";b[b.LOADED=2]="LOADED"})(EXERCISE_LOADING_STATE||(EXERCISE_LOADING_STATE={}));
var BrowserHelper=function(){function b(){}b.refreshDom=function(){var a=document.createElement("div");a.innerHTML="x";a.style.visibility="hidden";a.style.height="0px";document.body.insertBefore(a,document.body.firstChild);window.setTimeout(function(){document.body.removeChild(a)},1)};return b}(),AssessmentFeedbackUI=function(){function b(a,c){var d=this;void 0===c&&(c=!1);this.assessmentFeedbackTextId="assessmentfeedbacktext_"+GuidHelper.newGuid();this.currentFeedbackMediaText=ko.observable(null);
this.toggleRetryButton=ko.observable(!0);this.toggleCallToAction=ko.observable(!1);this.exerciseCompleted=ko.observable(!1);this.allResponsesFound=ko.observable(!1);this.toggleAttemptLeft=ko.observable(!0);this.show=ko.observable(!1);this.iconfont=ko.observable("x");this.attemptsLeft=ko.observable(0);this.feedbackAriaLabel=ko.observable("");this.retryButtonText=localizedText.Assessment_Retry;this.showSolutionLocalizedText=localizedText.Assessment_ShowSolution;this.showSolution=ko.observable(!1);this.submitLocalizedText=
localizedText.Assessment_Submit;this.attemptsLeftText=ko.computed(function(){if(d.attemptsLeft()==Number.POSITIVE_INFINITY)return"";if(1<d.attemptsLeft()){if(localizedText.Assessment_AttemptsLeft())return localizedText.Assessment_AttemptsLeft().replace("{0}",d.attemptsLeft().toString())}else if(localizedText.Assessment_AttemptLeft())return localizedText.Assessment_AttemptLeft().replace("{0}",d.attemptsLeft().toString());return null});this.retryButtonAriaLabel=ko.computed(function(){return null!=d.countDown?
d.retryButtonText()+" "+d.attemptsLeftText()+"   "+d.countDown.countDownValue().toString():d.retryButtonText()+" "+d.attemptsLeftText()});this.displayed=ko.computed(function(){return d.show()});this.isActiveAndAccessibilityEnabled=ko.computed(function(){return a()});this.hasShowSolutionButton=ko.observable(c);this.toggleShowSolutionButton=ko.computed(function(){return!d.toggleRetryButton()&&d.showSolution()&&!d.allResponsesFound()&&d.hasShowSolutionButton()});this.tabIndexSubmit=ko.computed(function(){return!d.show()&&
d.isActiveAndAccessibilityEnabled()?120:-1});this.tabIndexCharmbar=ko.computed(function(){return d.show()&&d.isActiveAndAccessibilityEnabled()?120:-1});this.tabIndexShowMeTheAnswer=ko.computed(function(){return d.show()&&d.isActiveAndAccessibilityEnabled()?520:-1})}b.prototype.displayFeedback=function(a,c,d,b,f,g,h){this.currentFeedbackMediaText((new MediaText).loadData(c,a));this.feedbackAriaLabel(h);this.toggleRetryButton(!b);this.toggleCallToAction(b);this.toggleAttemptLeft(!b&&d!=Number.POSITIVE_INFINITY);
this.attemptsLeft(d);this.iconfont(f?"\u2713":"x");this.allResponsesFound(f);this.exerciseCompleted(b);this.showSolution(g);this.showFeedback()};b.prototype.showFeedback=function(){this.show(!0);if(this.isActiveAndAccessibilityEnabled()){var a=$("#"+this.assessmentFeedbackTextId);null!=a&&a.focus()}};b.prototype.hideFeedback=function(){this.show(!1);this.isActiveAndAccessibilityEnabled()&&$("[tabindex]").filter(function(){var a=parseInt(this.getAttribute("tabindex"),10);return 1<a&&1E3>a}).first().focus()};
b.prototype.setCountDown=function(a){this.countDown=a};return b}(),interactionLearnerResponseSeparator="$",AssessmentManager=function(){function b(a,c,d,b,f,g){var h=this;void 0===b&&(b=!1);void 0===f&&(f=!1);void 0===g&&(g=!0);this.allResponsesFound=ko.observable(!1);this.storeInteractions=!0;this.countDown=null;this.assessmentFeedbackUI=new AssessmentFeedbackUI(d,f);this.exerciseId=a;this.interactionApi=c;this.attemptsLeft=ko.observable(0);this.exerciseEnabled=ko.computed(function(){return!h.assessmentFeedbackUI.displayed()});
this.onlyRecordsUserAnswers=b;this.storeInteractions=g}b.prototype.showSolution=function(){return this._showSolution};b.prototype.initialize=function(a,c,d,b,f,g,h){void 0===g&&(g=function(){});void 0===h&&(h=function(){});if(null!=a){var i=a.attemptNumber;"unlimited"==a.attemptNumber&&(i=Number.POSITIVE_INFINITY);this.attemptsLeft(i);this._showSolution=StringHelper.getBoolean(a.showSolution);this.feedbackCorrectText=a.text[0];this.feedbackIncorrectText=a.text[1];this.feedbackIntermediateText=a.text[2];
null!=a.countdownTimer&&0<=parseInt(a.countdownTimer)&&(this.countDown=this.interactionApi.getCountDown(),null==this.countDown?(this.countDown=new CountDown(this.exerciseId),this.countDown.init(parseInt(a.countdownTimer),this.timesUpCallback.bind(this)),this.interactionApi.addCountDown(this.countDown)):this.countDown.init(parseInt(a.countdownTimer),this.timesUpCallback.bind(this)),this.assessmentFeedbackUI.setCountDown(this.countDown))}else this.attemptsLeft(Number.POSITIVE_INFINITY);this.validationCallback=
c;this.retryCallback=g;this.endingCallback=d;this.retrieveAnswers=b;this.resumeState=f;this.displayAnswers=h};b.prototype.startCountDown=function(){null!=this.countDown&&this.countDown.start()};b.prototype.stopCountDown=function(){null!=this.countDown&&this.countDown.stop()};b.prototype.timesUpCallback=function(){this.attemptsLeft(1);this.submitProcess()};b.prototype.storeInteraction=function(){var a=this.retrieveAnswers(),c=new Interaction;c.exerciseId=this.exerciseId;c.type=a.type;c.correct=a.correct;
c.learnerResponse=a.given;c.result=this.allResponsesFound()?"correct":"incorrect";c.weighting=null!=a.weighting?a.weighting:1;this.storeInteractions&&this.interactionApi.addInteraction(c)};b.prototype.resumeLearnerResponses=function(){var a=this.interactionApi.getInteractionCount(),c=this.interactionApi.getLastInteraction();this.attemptsLeft()!==Number.POSITIVE_INFINITY&&this.attemptsLeft(this.attemptsLeft()-a);c&&(this.resumeState(c.learnerResponse),this.allResponsesFound("correct"===c.result),this.onlyRecordsUserAnswers||
this.assessmentFeedbackUI.displayFeedback(this.exerciseId,this.getFeedbackText(),this.attemptsLeft(),this.getExerciseCompleted(),this.allResponsesFound(),this.showSolution(),StringHelper.transformStringForAriaLabel(this.getFeedbackText())));(0==this.attemptsLeft()||this.allResponsesFound())&&this.endingCallback()};b.prototype.retryProcess=function(){this.retryCallback();this.assessmentFeedbackUI.hideFeedback()};b.prototype.hideCharmBar=function(){this.getExerciseCompleted()&&this.assessmentFeedbackUI.hideFeedback()};
b.prototype.showCharmBar=function(){this.getExerciseCompleted()&&this.assessmentFeedbackUI.showFeedback()};b.prototype.submitProcess=function(){this.allResponsesFound(this.validationCallback());this.attemptsLeft()!=Number.POSITIVE_INFINITY&&this.attemptsLeft(this.attemptsLeft()-1);(this.interactionApi.interactionManager.isAssessment()||this.onlyRecordsUserAnswers)&&this.storeInteraction();var a=this.getExerciseCompleted();this.onlyRecordsUserAnswers||this.assessmentFeedbackUI.displayFeedback(this.exerciseId,
this.getFeedbackText(),this.attemptsLeft(),a,this.allResponsesFound(),this.showSolution(),StringHelper.transformStringForAriaLabel(this.getFeedbackText()));a&&this.endingCallback()};b.prototype.getAttemptsLeft=function(){return this.attemptsLeft()};b.prototype.getExerciseCompleted=function(){return this.allResponsesFound()||this.attemptsLeft()!=Number.POSITIVE_INFINITY&&0==this.attemptsLeft()?!0:!1};b.prototype.getFeedbackText=function(){return this.allResponsesFound()?this.feedbackCorrectText:0<
this.attemptsLeft()||this.attemptsLeft()==Number.POSITIVE_INFINITY?this.feedbackIntermediateText:0==this.attemptsLeft()?this.feedbackIncorrectText:""};return b}(),MediaImageBackground=function(b){function a(){b.apply(this,arguments);this.horizontalPosition=this.verticalPosition=this.backgroundPosition="";this.imageRatio=this.lastParentHeight=this.lastParentWidth=null;this.stretchRequested=this.bgLoadedEventSent=!1}__extends(a,b);a.prototype.setBackgroundPosition=function(c){this.backgroundPosition=
c;null!=this.backgroundPosition&&(c=this.backgroundPosition.split(" "),2==c.length&&(this.verticalPosition=c[0],this.horizontalPosition=c[1]))};a.prototype.getBackgroundImg=function(){return this.getDom().find(".exercise__background-img")};a.prototype.stretchCoverImage=function(){this.stretchRequested=!0;if(this.bgLoadedEventSent){var c=this.getDom()[0],a=this.getBackgroundImg()[0];this.imageRatio=a.width/a.height;var b=c.clientHeight,c=c.clientWidth;if(c!==this.lastParentWidth||b!==this.lastParentHeight)c/
b>=this.imageRatio?(a.width=c,a.height=a.width/this.imageRatio):(a.width=b*this.imageRatio,a.height=b),this.lastParentWidth=c,this.lastParentHeight=b,"left"==this.horizontalPosition?a.style.left="0":"center"==this.horizontalPosition?a.style.left=(c-a.width)/2+"px":"right"==this.horizontalPosition?a.style.left=c-a.width+"px":logger.info("no horizontal position  found for background "+this.id),"top"==this.verticalPosition?a.style.top="0":"center"==this.verticalPosition?a.style.top=(b-a.height)/2+"px":
"bottom"==this.verticalPosition?a.style.top=b-a.height+"px":logger.info("no vertical position  found for background "+this.id)}};a.prototype.getDimensions=function(){return{container:{width:this.getDom().innerWidth(),height:this.getDom().innerHeight()},image:{width:this.originalWidth,height:this.originalHeight}}};a.prototype.bgLoaded=function(){this.bgLoadedEventSent=!0;this.stretchRequested&&(this.stretchCoverImage(),this.switchImageQualityIfNecessary())};a.prototype.bgError=function(){logger.error("Error when loading background id="+
this.id)};return a}(MediaImage),BaseContentBackgroundViewModel=function(){function b(){this.background=new MediaImageBackground(!1);this.useImageTag=ko.observable(!1);this.timers=new Timers;this.exerciseBackgroundUrl=this.themeTemplateBackgroundUrl=this.themeDefaultBackgroundUrl=this.exerciseBackgroundPosition=this.themeTemplateBackgroundPosition=this.themeDefaultBackgroundPosition=null;this.backgroundPosition=ko.observable("center center");this.backgroundSize="cover";this.hasBackground=ko.computed(function(){return 0<
this.background.url().length},this);platformFeatures.getIsIE8()&&this.useImageTag(!0)}b.prototype.loadBackground=function(a,c){var d=SkinManager.getInstance();d.getDefaultSettings()&&(this.themeDefaultBackgroundUrl=d.getDefaultSettings().getUrlSetting("backgroundurl"),this.themeDefaultBackgroundPosition=this.getCSSBackgroundPositionForValue(d.getDefaultSettings().getSetting("backgroundImagePosition")));this.themeTemplateBackgroundUrl=d.getTemplateSetting(a,"backgroundurl",!0);this.themeTemplateBackgroundPosition=
this.getCSSBackgroundPositionForValue(d.getTemplateSetting(a,"backgroundImagePosition",!1));if(void 0!=c.metadatas)for(var d=0,b=c.metadatas.length;d<b;d++){var f=c.metadatas[d];"bgimage.media"==f.key.toLowerCase()&&(this.exerciseBackgroundUrl=f.value.media,this.exerciseBackgroundPosition=this.getCSSBackgroundPositionForValue("centered"));"bgimage.position"==f.key.toLowerCase()&&(this.exerciseBackgroundPosition=this.getCSSBackgroundPositionForValue(f.value))}if(this.exerciseBackgroundUrl||this.themeTemplateBackgroundUrl||
this.themeDefaultBackgroundUrl)d="",this.exerciseBackgroundUrl?(d=this.exerciseBackgroundPosition,this.background.loadData(this.exerciseBackgroundUrl)):StringHelper.isNullOrEmpty(this.themeTemplateBackgroundUrl)?StringHelper.isNullOrEmpty(this.themeDefaultBackgroundUrl)||(d=this.themeDefaultBackgroundPosition,this.background.setSourceForImageWithoutQuality(this.themeDefaultBackgroundUrl,!1)):(d=this.themeTemplateBackgroundPosition,this.background.setSourceForImageWithoutQuality(this.themeTemplateBackgroundUrl,
!1)),this.backgroundPosition(d),this.background.setBackgroundPosition(d)};b.prototype.resize=function(){this.hasBackground()&&(platformFeatures.getIsIE8()&&this.background.stretchCoverImage(),this.background.switchImageQualityIfNecessary())};b.prototype.getCSSBackgroundPositionForValue=function(a){switch(a){case "centered":return"center center";case "bottom-right":return"bottom right";case "bottom":return"bottom center";case "bottom-left":return"bottom left";case "left":return"center left";case "top-left":return"top left";
case "top":return"top center";case "top-right":return"top right";case "right":return"center right";default:return"center center"}};return b}(),TooltipViewModel=function(){return function(b,a,c,d){this.id=b;this.exerciseId=a;this.text=c;this.content=d}}(),BaseContentViewModel=function(){function b(a,c){var d=this;void 0===c&&(c=!1);this.parent=null;this.baseContentBackgroundViewModel=new BaseContentBackgroundViewModel;this.scrollbarManager=null;this.isHeaderBackgroundImageVisible=ko.observable(!1);
this.headerLogo=ko.observable("");this.logoPosition=ko.observable("");this.scrollbarWidth=-1;this.forceNativeScrollbar=!1;this.layout=ko.observable("");this.layoutTemplate=ko.observable("");this.template=ko.observable("");this.feedbackVisible=ko.observable(!1);this.layoutSizeGroupClassName=ko.observable("");this.getDom=function(){return d.parent.getExerciseDom()};this.getDomTitle=function(){return d.getDomTitleWrapper().find(".header")};this.getDomTitleH1=function(){return d.getDomTitle().find("h1").first()};
this.getDomTitleH2=function(){return d.getDomTitle().find("h2").first()};this.getDomScrollbar=function(){return d.parent.getExerciseDom().find(".scrollbar.exercise-scrollbar")};this.getDomOverview=function(){return d.parent.getExerciseDom().find(".overview")};this.getDomViewport=function(){return d.parent.getExerciseDom().find(".viewport")};this.getDomTitleWrapper=function(){return d.parent.getExerciseDom().find(".header-wrapper")};this.getDomContentWrapper=function(){return d.parent.getExerciseDom().find(".exercise__content-wrapper")};
this.getDomContent=function(){return d.getDomContentWrapper().find(".exercise__content")};this.onVisualAnimationEnded=function(){};this.getDomStickyFooterContainer=function(){return $("#sticky__container")};this.getDomStickyFooterContent=function(){return d.getDomStickyFooterContainer().children().first()};this.getDomExerciseStickyContainer=function(){return d.parent.getExerciseDom().find(".sticky__exercise-container")};this.getDomTooltipOverlay=function(){return $("#"+d.tooltipId)};this.getDomExerciseFooterContent=
function(){return d.getDomExerciseStickyContainer().children().first()};this.stickyHiddenBySwipe=ko.observable(!1);this.isScrollingNotSwiping=ko.observable(!1);this.title=ko.observable("");this.question=ko.observable("");this.instruction=ko.observable("");this.isActiveAndAccessibilityEnabled=null;this._tabindexTitleComponent=ko.observable(b.TITLE_COMPONENT_TABINDEX_ORDER_VALUE);this._tabindexCalltoAction=ko.observable(b.CALL_TO_ACTION_TABINDEX_ORDER_VALUE);this.openingSound=new MediaSound;this.isLayoutOpenup=
ko.observable(!1);this.viewportChanged=this.scrollHeightChanged=this.isDragDropTemplate=!1;this.previousViewportHeight=this.previousScrollheight=0;this.allMediasDom=null;this.tooltipViewModel=ko.observable(null);this.tooltipOverlayVisible=ko.observable(!1);this.tooltipOverlayFadeIn=ko.observable(!1);this.tooltipId="";this.timers=new Timers;this.onLoadedEvent=function(){d.updateScrollbar()};this.parent=a;this.forceNativeScrollbar=c;this.tooltipId="tooltip-overlay-"+this.parent.slideId;this.feedback=
new FeedbackViewModel;this.feedback.closeClick(function(){d.onFeedbackCloseClick()});this.isActiveAndAccessibilityEnabled=ko.computed(function(){return d.parent&&d.parent.isActive()&&applicationViewModel.accessibilityViewModel.accessibilityFeaturesActivated()});this.tabindexTitleComponent=this.generateTabIndexComputed("_tabindexTitleComponent",this);this.tabindexCalltoAction=this.generateTabIndexComputed("_tabindexCalltoAction",this)}b.prototype.transformStringForAriaLabel=function(a){if(!a||0>=a.length)return"";
var c=document.createElement("div");c.innerHTML=a.replace(RegExp("(</p>)","gi"),"\n</p>");$(c).find(".tooltip__icon").remove();a=c.innerText||c.textContent;$(c).remove();return a};b.prototype.initDom=function(){return this};b.prototype.render=function(){this.layoutSizeGroupClassName()||this.applySizeGroupForLayout(this.layout());0>this.parent.exerciseClass().indexOf(this.layout())&&this.parent.exerciseClass(this.parent.exerciseClass()+" "+this.layout());return this};b.prototype.hasOpeningSound=function(){return this.openingSound.hasSource()};
b.prototype.setAlertContent=function(a){applicationViewModel.accessibilityViewModel.setAlertContent(a)};b.prototype.generateTabIndexComputed=function(a,c){var d=this;return ko.computed({read:function(){return d.isActiveAndAccessibilityEnabled()?c[a]():-1},write:function(b){if(d.isActiveAndAccessibilityEnabled())c[a](b);else c[a](-1)}})};b.prototype.setTimeout=function(a,c,d){void 0===d&&(d=0);return this.timers.setTimeout(a,c,d)};b.prototype.getTimers=function(){return this.timers};b.prototype.clearTimeout=
function(a){this.timers.clearTimeout(a)};b.prototype.requestAnimationFrame=function(a,c){return this.timers.requestAnimationFrame(a,c)};b.prototype.cancelAnimationFrame=function(a){this.timers.cancelAnimationFrame(a)};b.prototype.setInterval=function(a,c,d){return this.timers.setInterval(a,c,d)};b.prototype.clearInterval=function(a){this.timers.clearInterval(a)};b.prototype.showScrollbar=function(){this.getDom().removeClass("scrollbar--hidden");return this};b.prototype.hideScrollbar=function(){this.getDom().addClass("scrollbar--hidden");
return this};b.prototype.hasAllImagesLoaded=function(){this.allMediasDom=this.allMediasDom||this.getExerciseDom().find(".media-image__img--lq");for(var a=!0,c=0;c<this.allMediasDom.length;c++){var d=this.allMediasDom[c];d.complete||(a=!1,$(d).off("load error",this.onLoadedEvent).on("load error",this.onLoadedEvent))}return a};b.prototype.resetAndSaveHeightValues=function(a,c){this.viewportChanged=this.scrollHeightChanged=!1;this.previousScrollheight=a;this.previousViewportHeight=c};b.prototype.updateScrollbar=
function(a,c){var d=this;if(!this.hasAllImagesLoaded())return $.Deferred().resolve().promise();var b=this.getDomViewport();if(0==b.length)return $.Deferred().resolve().promise();var f=this.getDomOverview().length?this.getDomOverview()[0].scrollHeight:0,g=b.height();if(this.getDomOverview().length&&f<=g)return this.previousScrollheight!=f&&(this.scrollHeightChanged=!0),this.previousViewportHeight!=g&&(this.viewportChanged=!0),b=this.scrollHeightChanged||this.viewportChanged,this.scrollbarManager&&
b&&(this.scrollbarManager.update(0,c),this.updateNavigationButtonPosition()),this.resetAndSaveHeightValues(f,g),$.Deferred().resolve().promise();if(platformFeatures.getIsIPad()||platformFeatures.getIsAndroid()||platformFeatures.getIsIPhone())return c?b.animate({scrollTop:a},c):b.scrollTop(a),this.resetAndSaveHeightValues(f,g),$.Deferred().resolve().promise();var h=$.Deferred();this.timers.requestAnimationFrame("frameUpdateScrollbar",function(){d.log("info","updateScrollbar","position:",a?a:"null");
d.scrollbarManager?d.scrollbarManager.update(a,c):d.createScrollbar();d.updateNavigationButtonPosition();h.resolve()});this.resetAndSaveHeightValues(f,g);return h.promise()};b.prototype.startAnimateMoreContentArrow=function(a){var c=this;void 0===a&&(a=!1);setTimeout(function(){c.getDomContent().outerHeight()+c.getDomTitleWrapper().outerHeight()>windowHeight&&(c.stopAnimateMoreContentArrow(),a?$(".moreContentArrow").addClass("moreContentArrow--visible"):setTimeout(function(){$(".moreContentArrow").addClass("moreContentArrow--visible")},
5E3),c.getDomViewport().on("touchmove",function(){c.stopAnimateMoreContentArrow()}),c.getDomViewport().scroll(function(){c.stopAnimateMoreContentArrow()}))})};b.prototype.stopAnimateMoreContentArrow=function(){$(".moreContentArrow").removeClass("moreContentArrow--visible")};b.prototype.computeNavigationButtonPosition=function(a){if(this.getScrollbar()&&!this.getScrollbar().isCustom()){if(null!=a)return a+"px";if(this.parent.isActive())return-1==this.scrollbarWidth&&(a=document.createElement("div"),
a.className="scrollbar-measure",document.body.appendChild(a),this.scrollbarWidth=a.offsetWidth-a.clientWidth,document.body.removeChild(a)),a=this.hasScrollbar()?this.scrollbarWidth+"px":"0px"}else return"0px"};b.prototype.updatePreviousButtonPosition=function(a){var c=document.getElementById("previous");null!=c&&(c.style.left=this.computeNavigationButtonPosition(a))};b.prototype.updateNextButtonPosition=function(a){var c=document.getElementById("next");null!=c&&(c.style.right=this.computeNavigationButtonPosition(a))};
b.prototype.updateNavigationButtonPosition=function(a){applicationViewModel.getIsRTLDirection()?this.updatePreviousButtonPosition(a):this.updateNextButtonPosition(a)};b.prototype.hasScrollbar=function(){return this.getDomViewport()[0].scrollHeight!=this.getDomViewport().height()};b.prototype.createScrollbar=function(){this.parent&&this.log("info","createScrollbar for "+this.parent.slideId);this.scrollbarManager=applicationViewModel.createScrollbarManager(this);this.scrollbarManager.initialize(null,
this.forceNativeScrollbar);return this};b.prototype.getScrollbar=function(){return this.scrollbarManager};b.prototype.scrollIfNecessary=function(a,c){var d=this;c||this.setTimeout("timerUpdateScrollbar"+this.parent.slideId,function(){var c;a&&(c=a.top,platformFeatures.getIsIPad()||platformFeatures.getIsAndroid()?d.updateScrollbar(c,500):d.updateScrollbar(c))})};b.prototype.showFeedback=function(){this.hideStickyFooter();this.feedbackVisible(!0)};b.prototype.feedbackIsVisual=function(){return this.feedback.isVisual()};
b.prototype.hideFeedback=function(){this.feedback.stop();this.feedbackVisible(!1);this.showStickyFooter()};b.prototype.onFeedbackCloseClick=function(){this.hideFeedback();this.updateStickyFooterHeight()};b.prototype.onStretchTextEnded=function(){};b.prototype.loadBackground=function(){this.baseContentBackgroundViewModel.loadBackground(this.parent.templateName,this.parent.getData())};b.prototype.loadHeaderLogo=function(){var a=SkinManager.getInstance();this.log("info","loadHeaderLogo");a.getDefaultSettings()&&
this.headerLogo(a.getDefaultSettings().getUrlSetting("headerlogourl"));return this};b.prototype.loadLogoPosition=function(){var a=SkinManager.getInstance();this.log("info","loadLogoPosition");a.getDefaultSettings()&&this.logoPosition(a.getDefaultSettings().getSetting("logoposition"));return this};b.prototype.showLogoOnBottomRight=function(){var a=[];a.push("Intro");a.push("Spacer");a.push("Ending");return this.isNotEmpty(this.headerLogo())&&"bottom-right"==this.logoPosition()&&-1==$.inArray(this.parent.templateName,
a)};b.prototype.loadData=function(){this.assessmentManager?(this.assessmentManager.resumeLearnerResponses(),this.parent.isCompleted(this.assessmentManager.getExerciseCompleted())):this.parent.isCompleted(!1);return this};b.prototype.beforeSizeChanged=function(){var a=this;this.setTimeout(this.parent.exerciseId+"_resizeBackground",function(){a.baseContentBackgroundViewModel.resize()});this.getDom().find(".tooltip__text--clicked .tooltip__popup").css({left:"50%",top:"50%"});this.parent.isActive()&&
this.hideStickyFooter();return $.Deferred().resolve().promise()};b.prototype.sizeChanged=function(a,c){var d=this;if(this.parent.isActive()){this.startAnimateMoreContentArrow();var b=$.Deferred();this.isDragDropTemplate&&!this.parent.isCompleted()?this.setTimeout("updateStickyFooter",function(){d.updateStickyFooterHeight();d.showStickyFooter();b.resolve()},200):b.resolve();return b.promise().then(function(){d.feedback.sizeChanged(a,c)})}return $.Deferred().resolve().promise()};b.prototype.resetSize=
function(){return $.Deferred().resolve().promise()};b.prototype.swipeStarted=function(){this.updateNavigationButtonPosition(0);return this};b.prototype.swipeCancelled=function(){return this};b.prototype.swipeEnded=function(){return this};b.prototype.start=function(){var a=this;this.updateNavigationButtonPosition();this.triggerAnimationEndedCallback();this.parent.isCompleted()||(this.moveInternalStickyToExternalStickyFooter(),this.setTimeout("sticky-footer-move-i-e",function(){a.updateStickyFooterHeight();
a.setTimeout("sticky-footer-show",function(){a.showStickyFooter()},250)}));this.isActiveAndAccessibilityEnabled()?1===applicationViewModel.navigationManager.historyExercises().length?this.focusAccessibilityButton():this.getDomTitleH1().length?this.getDomTitleH1().focus():this.getDomTitleH2().length?this.getDomTitleH2().focus():$("[tabindex]",this.getDom()).filter(function(){return parseInt(this.getAttribute("tabindex"),10)>10}).first().focus():this.hasOpeningSound()&&this.openingSound.play();this.startAnimateMoreContentArrow();
null!=this.assessmentManager&&this.assessmentManager.startCountDown();return this};b.prototype.focusAccessibilityButton=function(){applicationViewModel.accessibilityViewModel.getDomAccessibilityKeyboardNavButton().length&&applicationViewModel.accessibilityViewModel.getDomAccessibilityKeyboardNavButton().first().focus()};b.prototype.stop=function(){this.openingSound.stop();this.hideFeedback();this.isDragDropTemplate&&(this.cleanStickyFooterContainer(),this.hideStickyFooter());this.stopAnimateMoreContentArrow();
applicationViewModel.transcriptViewModel.transcriptActivated()&&applicationViewModel.transcriptViewModel.resetTranscriptText();null!=this.assessmentManager&&this.assessmentManager.stopCountDown();return this};b.prototype.reset=function(){return this};b.prototype.startThumbnail=function(){var a=this;this.moveInternalStickyToExternalStickyFooter();this.setTimeout("sticky-footer-move-i-e",function(){a.updateStickyFooterHeight();a.setTimeout("sticky-footer-show",function(){a.showStickyFooter()},250)});
return this};b.prototype.loadCompleted=function(){return this};b.prototype.cleanup=function(){this.timers.cleanup();this.scrollbarManager&&(this.scrollbarManager.cleanup(),this.scrollbarManager=null);this.feedback.cleanup();this.openingSound.cleanup();return this};b.prototype.focusInGlossary=function(){var a=$("#js-accessibility__glossary");a.hasClass("accessibility__glossary--visible")||a.addClass("accessibility__glossary--visible")};b.prototype.blurInGlossary=function(){var a=$("#js-accessibility__glossary");
setTimeout(function(){0<a.find(":focus").length||a.removeClass("accessibility__glossary--visible")},10)};b.prototype.stickyOnSwipeStarted=function(){this.hideStickyFooter();this.stickyHiddenBySwipe(!0)};b.prototype.stickyOnSwipeCancel=function(){this.stickyHiddenBySwipe()&&this.showStickyFooter();this.stickyHiddenBySwipe(!1)};b.prototype.moveInternalStickyToExternalStickyFooter=function(){!(this.getDom()&&0==this.getDom().length)&&this.getDomStickyFooterContainer()&&(this.getDomStickyFooterContainer().html(""),
0!=this.getDomExerciseFooterContent().length&&this.getDomExerciseFooterContent().appendTo(this.getDomStickyFooterContainer()),this.hideStickyFooter())};b.prototype.cleanStickyFooterContainer=function(){this.getDom()&&0==this.getDom().length||(this.isDragDropTemplate&&0<this.getDomStickyFooterContainer().children().length&&this.getDomStickyFooterContainer().children().first().appendTo(this.getDomExerciseStickyContainer()),this.hideStickyFooter())};b.prototype.showStickyFooter=function(){this.log("info",
"showStickyFooter","template : "+this.layout());this.getDom()&&0==this.getDom().length||!this.feedbackVisible()&&!this.parent.isCompleted()&&0!=this.getDomStickyFooterContent().children().length&&this.getDomStickyFooterContainer().children().first().removeClass("sticky--hide").addClass("sticky--show")};b.prototype.hideStickyFooter=function(a){var c=this;void 0===a&&(a=!1);this.log("info","hideStickyFooter","template : "+this.layout());this.getDom()&&0==this.getDom().length||!(this.getDomStickyFooterContainer()&&
0==this.getDomStickyFooterContainer().length)&&this.isDragDropTemplate&&this.requestAnimationFrame("hideStickyFooter",function(){c.getDomStickyFooterContainer().children().first().removeClass("sticky--show").addClass("sticky--hide");a&&(c.clearContentPadding(),c.updateScrollbar())})};b.prototype.removeStickyFooterContent=function(){this.getDomExerciseFooterContent().remove()};b.prototype.clearContentPadding=function(){this.getDomContent().css("padding-bottom","")};b.prototype.updateStickyFooterHeight=
function(){if(!this.parent||this.getDom()&&0==this.getDom().length||!this.getDomStickyFooterContainer()||0==this.getDomStickyFooterContainer().children().length)return this;this.getDomContent().css("padding-bottom","2em");this.getDomStickyFooterContainer().removeClass("sticky__container--fixed-bottom");var a=parseInt(this.getDomStickyFooterContainer().css("padding-top")),c=applicationViewModel.timelineViewModel.buttonMenu.outerHeight(!0),d=document.getElementById("progressbar").offsetHeight,b=this.getDomTitleWrapper().outerHeight(!0)+
this.getDomContentWrapper().outerHeight(!0);if(isNaN(b))throw"contentHeightWithOnlyPaddingTop NaN";a=Math.floor(windowHeight-b-a-c-d);a>this.getDomStickyFooterContent().outerHeight(!0)?(this.log("debug","updateStickyFooterHeight","stickyFooter inside content"),this.getDomStickyFooterContainer().innerHeight(a).css("max-height","none")):(this.log("debug","updateStickyFooterHeight","stickyFooter fixed to bottom"),platformFeatures.getIsEdge()?this.getDomStickyFooterContainer().addClass("sticky__container--fixed-bottom").height("auto").css("max-height",
0.5*windowHeight):(platformFeatures.getIsPhone()&&uiManager.getIsPhonePortrait(),this.getDomStickyFooterContainer().addClass("sticky__container--fixed-bottom").height("auto").css("max-height",0.4*windowHeight)),this.getDomContent().css("padding-bottom",Math.min(0.33*windowHeight,this.getDomStickyFooterContainer().outerHeight(!0)+(platformFeatures.getIsIPad()?20:0))+"px"),this.updateScrollbar());return this};b.prototype.applySizeGroupForLayout=function(a){a=a.toLowerCase();0<a.indexOf("little")||0<
a.indexOf("small")?this.applySmallSizeLayout():0<a.indexOf("medium")?this.applyMediumSizeLayout():0<a.indexOf("big")||0<a.indexOf("large")?this.applyLargeSizeLayout():0<a.indexOf("fullscreen")?this.applyFullScreenSizeLayout():this.layoutSizeGroupClassName("content--large-layout")};b.prototype.applySmallSizeLayout=function(){this.layoutSizeGroupClassName("content--small-layout")};b.prototype.applyLargeSizeLayout=function(){this.layoutSizeGroupClassName("content--large-layout")};b.prototype.applyMediumSizeLayout=
function(){this.layoutSizeGroupClassName("content--medium-layout")};b.prototype.applyFullScreenSizeLayout=function(){this.layoutSizeGroupClassName("content--fullscreen-layout")};b.prototype.isNotEmpty=function(a){return a&&0<a.length};b.prototype.isInstructionSeparate=function(){return"separated"===SkinManager.getInstance().getDefaultSettings().getSetting("instructionposition")};b.prototype.getHeaderBackgroundUrl=function(){return SkinManager.getInstance().getDefaultSettings().getUrlSetting("headerbackgroundurl")};
b.prototype.headerBackgroundImageLoaded=function(){this.isHeaderBackgroundImageVisible(!0)};b.prototype.getExerciseDom=function(){return this.getDom()};b.prototype.log=function(a,c){for(var d=[],b=2;b<arguments.length;b++)d[b-2]=arguments[b];b=[];this.parent?b.push("["+this.parent.templateName+"]("+this.parent.slideId+")["+c+"]: "):b.push("["+this.layout()+"] ["+c+"]: ");for(var f=0,g=d.length;f<g;f++)b.push(d[f]);logger[a].apply(logger,b);return this};b.prototype.triggerAnimationEndedCallback=function(){if(this.onVisualAnimationEnded)this.onVisualAnimationEnded(1E3)};
b.TITLE_COMPONENT_TABINDEX_ORDER_VALUE=10;b.CALL_TO_ACTION_TABINDEX_ORDER_VALUE=999;b.DISABLED_TABINDEX_ORDER_VALUE=-1;return b}(),FeedbackViewModel=function(){function b(){var a=this;this.SHOW_TEXT_DELAY=750;this.feedbackTextVisible=ko.observable(!1);this.feedbackText=ko.observable("");this.width=ko.observable(0);this.height=ko.observable(0);this.feedbackMedias=ko.observableArray([]);this.feedbackImage=ko.observable(null);this.feedbackVideo=ko.observable(null);this.feedbackHTMLAnimation=ko.observable(null);
this.feedbackSound=new MediaSound;this.feedbackBackground=ko.observable(null);this.needExpandText=ko.observable(!1);this.isHTMLAnimation=ko.observable(!1);this.isImage=ko.observable(!1);this.isVideo=ko.observable(!1);this.isVisual=ko.computed(function(){return a.feedbackImage()||a.feedbackVideo()||a.feedbackHTMLAnimation()});this.hasFeedbackSound=ko.observable(!1);this.timers=new Timers;this.currentExercise=ko.observable(null);this.tabindexCloseCross=ko.observable(-1);this.tabindex=ko.observable(-1);
this.ariaLabel=ko.observable("");this.feedbackMedias.push(this.feedbackImage);this.feedbackMedias.push(this.feedbackVideo);var c=this.feedbackImage();c&&c.addCssClass("mediafeedback")}b.prototype.setFeedback=function(a,c,d,b){var f=this;void 0===b&&(b=null);null!=b&&(this.closeClickCallbackForExercise=b);this.feedbackSound=c;this.feedbackTextVisible(!1);this.hasFeedbackSound(null!=c&&c.hasSource());d&&(this.feedbackText(d.text()),c=document.createElement("div"),c.innerHTML=d.text(),this.ariaLabel(c.innerText),
$(c).remove());var d=applicationViewModel.navigationManager.currentExercise(),g;d&&d.contentViewModel()&&(g=d.contentViewModel(),g.hideStickyFooter(),this.currentExercise(g));this.tabindexCloseCross(101);this.tabindex(100);var h=null,c=null;this.lockUi();d=MediaType.undefined;if(null!=a&&""!=a.url())d=a.type,this.feedbackBackground(null),d==MediaType.image?(a.verticalAlignMiddle(!0),c&&c.hide(),this.feedbackImage(a),h=a,h.addCssClass("mediafeedback"),h.show(),this.timers.setTimeout("resize",function(){h.resize();
h.play()}),this.isImage(!0),this.isVideo(!1),this.feedbackVideo(null),h.setTabindex(100),h.onClickCallback=function(){f.onCloseClick()}):d==MediaType.video?(this.feedbackVideo(new MediaVideo),this.isImage(!1),this.isVideo(!0),h&&h.hide(),c=this.feedbackVideo(),c.show(),c.loadData(a.json),c.onEnded.subscribe(this,this.onVideoEnded),c.sizeChanged(this.width(),this.height()),c.setTabindex(100),this.isActiveAndAccessibilityEnabled()?c.stop():c.play(),this.feedbackImage(null)):d==MediaType.html&&(this.isHTMLAnimation(!0),
this.feedbackHTMLAnimation(a),this.feedbackHTMLAnimation().setTabindex(100),this.feedbackHTMLAnimation().play());else{if(g)if(a=g.baseContentBackgroundViewModel.background){g=a.url();var i=new MediaImageBackground;i.setSourceForImageWithoutQuality(g);this.feedbackBackground(a);this.timers.setTimeout("stretch-image",function(){i.resize()})}else this.feedbackBackground(null);this.feedbackImage(null);this.feedbackVideo(null);this.isVideo(!1);this.isImage(!1)}this.imagesVisibleOnTheCurrentExercise=this.getVisibleImagesOnTheExercise();
this.hideImages();d==MediaType.image?this.timers.setTimeout("text-feedback-display",function(){f.displayFeedbackText()},this.SHOW_TEXT_DELAY):d==MediaType.undefined&&this.timers.setTimeout("text-feedback-display",function(){f.displayFeedbackText()},0);setTimeout(function(){var c=$('[tabindex="100"]',f.getExerciseDom());c.length>0?c.first().focus():$('[tabindex="101"]',f.getExerciseDom()).first().focus()},100)};b.prototype.lockUi=function(){applicationViewModel&&applicationViewModel.navigationManager&&
applicationViewModel.navigationManager.canLeaveCurrentExercise(!1)};b.prototype.unlockUi=function(){applicationViewModel&&applicationViewModel.navigationManager&&applicationViewModel.navigationManager.canLeaveCurrentExercise(!0)};b.prototype.getDom=function(){return this.feedbackImage().getDom().closest(".feedback__content")};b.prototype.sizeChanged=function(a,c){this.width(a);this.height(c);this.setVideoSize(a,c);this.needExpandText(!1);this.getFeedbackContentTextWrapper()&&(platformFeatures.getIsIE8()?
this.getFeedbackContentTextWrapper().css("height","auto"):(this.updateFeedbackContentTextWrapperHeight(),this.getFeedbackContentTextWrapper()[0].clientHeight<this.getFeedbackContentTextWrapper()[0].scrollHeight?this.needExpandText(!0):this.getFeedbackContentTextWrapper().find(".richText").outerHeight()<this.getFeedbackContentTextWrapper().height()&&this.getFeedbackContentTextWrapper().css("height","auto")));var d=this.feedbackImage();d&&d.resize()};b.prototype.stop=function(){this.timers.cleanup();
var a=this.feedbackVideo();a&&(a.stop(),a.cleanup());this.feedbackSound&&this.feedbackSound.stop();this.isHTMLAnimation()&&(this.feedbackHTMLAnimation().setTabindex(-1),this.feedbackHTMLAnimation().stop());this.showImages();this.feedbackTextVisible(!1);this.unlockUi();this.getFeedbackContentTextWrapper()&&this.getFeedbackExpandTextArrow()&&(this.getFeedbackContentTextWrapper().removeClass("feedback__content__text--expanded"),this.getFeedbackExpandTextArrow().removeClass("feedback__expandText__arrow--rotated"),
this.updateFeedbackContentTextWrapperHeight())};b.prototype.cleanup=function(){try{this.timers.cleanup();var a=this.feedbackVideo();a&&(a.stop(),a.cleanup());var c=this.feedbackImage();c&&c.cleanup();this.feedbackSound&&this.feedbackSound.cleanup();this.closeClickCallback=null}catch(d){logger.error("FeedbackViewModel.cleanup error : "+d)}};b.prototype.closeClick=function(a){this.closeClickCallback=a};b.prototype.isActiveAndAccessibilityEnabled=function(){return this.currentExercise()&&this.currentExercise().isActiveAndAccessibilityEnabled()};
b.prototype.displayFeedbackText=function(){logger.debug("[feedbackViewModel] displayFeedback");this.feedbackSound&&!this.isActiveAndAccessibilityEnabled()&&this.feedbackSound.play();StringHelper.isNullOrEmpty(this.feedbackText())||this.feedbackTextVisible(!0)};b.prototype.setVideoSize=function(a,c){null!=this.feedbackVideo()&&this.feedbackVideo().sizeChanged(a,c)};b.prototype.onVideoEnded=function(){logger.debug("[feedbackViewModel] onVideoEnded");if(StringHelper.isNullOrEmpty(this.feedbackText()))this.onCloseClick();
else this.displayFeedbackText()};b.prototype.onCloseClick=function(a,c){if(c){if(this.isVideo()&&this.feedbackVideo().getDom().find(c.target).length)return;if("A"==c.target.parentNode.nodeName||"a"==c.target.parentNode.localName){window.open(c.target.parentNode.href,"_blank");return}}logger.debug("[feedbackViewModel] onCloseClick");this.stop();this.isImage()?this.feedbackImage().resetTabindex():this.isVideo()&&this.feedbackVideo().resetTabindex();this.tabindexCloseCross(-1);this.tabindex(-1);this.currentExercise()&&
this.currentExercise().showStickyFooter();this.closeClickCallbackForExercise&&this.closeClickCallbackForExercise();this.closeClickCallback&&this.closeClickCallback()};b.prototype.toggleTextContainerHeight=function(){this.getFeedbackContentTextWrapper()&&this.getFeedbackExpandTextArrow()&&(this.getFeedbackContentTextWrapper().toggleClass("feedback__content__text--expanded"),this.getFeedbackExpandTextArrow().toggleClass("feedback__expandText__arrow--rotated"),this.updateFeedbackContentTextWrapperHeight())};
b.prototype.updateFeedbackContentTextWrapperHeight=function(){this.getFeedbackContentTextWrapper().hasClass("feedback__content__text--expanded")?this.getFeedbackContentTextWrapper().innerHeight(this.getFeedbackContent().innerHeight()):this.getFeedbackContentTextWrapper().css("height","")};b.prototype.showImages=function(){this.imagesVisibleOnTheCurrentExercise&&platformFeatures.getIsLowPerformance()&&(platformFeatures.getIsIE8()?this.imagesVisibleOnTheCurrentExercise.show():this.imagesVisibleOnTheCurrentExercise.css("visibility",
"visible"))};b.prototype.hideImages=function(){platformFeatures.getIsLowPerformance()&&this.imagesVisibleOnTheCurrentExercise&&this.isVisual()&&(platformFeatures.getIsIE8()?this.imagesVisibleOnTheCurrentExercise.hide():this.imagesVisibleOnTheCurrentExercise.css("visibility","hidden"))};b.prototype.getVisibleImagesOnTheExercise=function(){var a=null==this.getExerciseDom()?null:this.getExerciseDom().find(".viewport img");return null==a?null:a.filter(":visible")};b.prototype.getExerciseDom=function(){var a=
applicationViewModel.navigationManager.currentExercise();return null==a?null:$("#"+a.slideId)};b.prototype.getFeedbackContentTextWrapper=function(){return null==this.getExerciseDom()?null:this.getExerciseDom().find(".feedback__content__text-wrapper")};b.prototype.getFeedbackContent=function(){return null==this.getExerciseDom()?null:this.getExerciseDom().find(".feedback__content")};b.prototype.getFeedbackExpandTextArrow=function(){return null==this.getExerciseDom()?null:this.getExerciseDom().find(".feedback__expandText__arrow")};
return b}(),enumTemplate;(function(b){b[b.BulletPoint=0]="BulletPoint";b[b.ClassicMC=1]="ClassicMC";b[b.Combine=2]="Combine";b[b.Ending=3]="Ending";b[b.FillInBlanks=4]="FillInBlanks";b[b.IExplore=5]="IExplore";b[b.Intro=6]="Intro";b[b.LabeledImages=7]="LabeledImages";b[b.MoreAbout=8]="MoreAbout";b[b.ThreeBoxes=9]="ThreeBoxes";b[b.Video=10]="Video";b[b.WhatIf=11]="WhatIf"})(enumTemplate||(enumTemplate={}));
var ModalBoxViewModel=function(){function b(a){this.overlayVisible=ko.observable(!1);this.applicationViewModel=a}b.prototype.displayOverlay=function(a){this.applicationViewModel.sliderViewModel.contentDeactivated(a);this.overlayVisible(a)};b.prototype.restartModule=function(){this.displayOverlay(!1);this.applicationViewModel.navigationManager.gotoHistoryIndex(0)};b.prototype.resumeModule=function(){this.displayOverlay(!1);this.applicationViewModel.eventManager.triggerTransitionEndEvent(this.applicationViewModel.navigationManager.currentExercise())};
return b}(),TranscriptViewModel=function(){function b(a){this.transcriptActivated=ko.observable(!1);this.transcriptVisible=ko.observable(!1);this.transcriptText=ko.observable("");this.applicationViewModel=a}b.prototype.initTranscript=function(){logger.info("activate Transcript");$transcriptArea=$("#transcriptArea");$transcriptContent=$("#contentTranscript")};b.prototype.toggleTranscriptActivation=function(){this.transcriptActivated()?(this.transcriptActivated(!1),this.transcriptVisible()?this.minimizeTranscript():
this.maximizeTranscript(),this.applicationViewModel.setAlertContent(localizedText.Accessibility_DisabledTranscriptAlert())):(this.transcriptActivated(!0),this.transcriptVisible(!0),this.initTranscript(),this.applicationViewModel.ajaxLoader.createCookie("TranscriptActivated",this.transcriptActivated(),9999),this.applicationViewModel.setAlertContent(localizedText.Accessibility_EnabledTranscriptAlert()));this.applicationViewModel.accessibilityViewModel.setTranscriptFeatureState(this.transcriptActivated())};
b.prototype.checkTranscriptActivated=function(){if(this.applicationViewModel.accessibilityViewModel.accessibilityEnabled()){var a=this.applicationViewModel.ajaxLoader.readCookie("TranscriptActivated");a&&"true"==a?(this.transcriptActivated(!0),this.transcriptVisible(!0),this.resetTranscriptText(),this.initTranscript()):logger.info("Transcript is disabled")}this.applicationViewModel.accessibilityViewModel.setTranscriptFeatureState(this.transcriptActivated())};b.prototype.appendTranscriptText=function(a,
c,d){if(a){var c=this.transcriptText(),b=0;$transcriptContent[0]&&(b=$transcriptContent[0].scrollHeight);if(d){var f=c.lastIndexOf("</ul>");f===c.length-5?(c=c.substring(0,f),a="<li>"+a+"</li></ul>"):a="<ul><li>"+a+"</li></ul>"}else a+="<br>";a=a.replace(/\n/g,"<br>");""===c?this.transcriptText(a):(d||(a="<br>"+a),this.transcriptText(c+a));this.transcriptActivated()&&(!StringHelper.isNullOrEmpty(a)&&!this.transcriptVisible()&&this.maximizeTranscript(),$transcriptContent.stop().animate({scrollTop:b},
800))}};b.prototype.resetTranscriptText=function(){this.transcriptVisible(!1);this.transcriptText("");null!=$transcriptContent&&$transcriptContent[0]&&($transcriptContent.innerHeight(0),$transcriptContent.innerHeight("auto"));this.transcriptVisible(!0)};b.prototype.maximizeTranscript=function(){this.transcriptVisible(!0);$transcriptArea.hide();$transcriptArea.slideDown(500)};b.prototype.minimizeTranscript=function(){var a=this;$transcriptArea.slideUp(500,function(){a.transcriptVisible(!1)})};b.prototype.closeTranscript=
function(){confirm("Do you want to close definitely the transcript popup ?")&&(this.transcriptVisible(!1),this.transcriptActivated(!1),this.applicationViewModel.ajaxLoader.createCookie("TranscriptActivated",this.transcriptActivated(),9999))};return b}(),SwipeDirection;(function(b){b[b.Previous=0]="Previous";b[b.Next=1]="Next"})(SwipeDirection||(SwipeDirection={}));
var EventManager=function(){function b(){this.worker=$.Deferred().resolve().promise();this.courseLoadListeners=[];this.exerciseCompleteListeners=[];this.exerciseLeaveListeners=[];this.exercisePreloadListeners=[];this.resizeListeners=[];this.swipeCancelListeners=[];this.swipeEndListeners=[];this.swipeStartListeners=[];this.transitionEndListeners=[]}b.prototype.addWork=function(a){this.worker=$.when(this.worker,a())};b.prototype.addCourseLoadListener=function(a){this.courseLoadListeners.push(a)};b.prototype.addExerciseCompleteListener=
function(a){this.exerciseCompleteListeners.push(a)};b.prototype.addExerciseLeaveListener=function(a){this.exerciseLeaveListeners.push(a)};b.prototype.addExercisePreloadListener=function(a){this.exercisePreloadListeners.push(a)};b.prototype.addResizeListener=function(a){this.resizeListeners.push(a)};b.prototype.addSwipeCancelListener=function(a){this.swipeCancelListeners.push(a)};b.prototype.addSwipeEndListener=function(a){this.swipeEndListeners.push(a)};b.prototype.addSwipeStartListener=function(a){this.swipeStartListeners.push(a)};
b.prototype.addTransitionEndListener=function(a){this.transitionEndListeners.push(a)};b.prototype.triggerCourseLoadEvent=function(a){var c=this;logger.info("eventManager.triggerCourseLoadEvent");this.addWork(function(){for(var d=0;d<c.courseLoadListeners.length;d++)c.courseLoadListeners[d].onCourseLoaded(a)})};b.prototype.triggerExerciseCompleteEvent=function(a){var c=this;logger.info("eventManager.triggerExerciseCompleteEvent: id="+a.exerciseId);this.addWork(function(){for(var d=0;d<c.exerciseCompleteListeners.length;d++)c.exerciseCompleteListeners[d].onExerciseCompleted(a)})};
b.prototype.triggerExerciseLeaveEvent=function(a){var c=this;logger.info("eventManager.triggerExerciseLeaveEvent: id="+a.exerciseId);this.addWork(function(){for(var d=0,b=c.exerciseLeaveListeners;d<b.length;d++)b[d].onExerciseLeaved(a)})};b.prototype.triggerExercisePreloadEvent=function(a){var c=this;logger.info("eventManager.triggerExercisePreloadEvent");this.addWork(function(){setTimeout(function(){for(var d=0,b=c.exercisePreloadListeners;d<b.length;d++)b[d].onExercisePreloaded(a)},800)})};b.prototype.triggerResizeEvent=
function(a,c){var d=this;logger.info("eventManager.triggerResizeEvent: width="+a+" height="+c);this.addWork(function(){for(var b=0,f=d.resizeListeners;b<f.length;b++)f[b].onResized(a,c)})};b.prototype.triggerSwipeCancelEvent=function(){var a=this;logger.info("eventManager.triggerSwipeCancelEvent");this.addWork(function(){for(var c=0,d=a.swipeCancelListeners;c<d.length;c++)d[c].onSwipeCancelled()})};b.prototype.triggerSwipeEndEvent=function(a){var c=this;logger.info("eventManager.triggerSwipeEndEvent: direction="+
a);this.addWork(function(){for(var d=0,b=c.swipeEndListeners;d<b.length;d++)b[d].onSwipeEnded(a)})};b.prototype.triggerSwipeStartEvent=function(){var a=this;logger.info("eventManager.triggerSwipeStartEvent");this.addWork(function(){for(var c=0,d=a.swipeStartListeners;c<d.length;c++)d[c].onSwipeStarted()})};b.prototype.triggerTransitionEndEvent=function(a){var c=this;logger.info("eventManager.triggerTransitionEndEvent: id="+a.exerciseId);this.addWork(function(){for(var d=0,b=c.transitionEndListeners;d<
b.length;d++)b[d].onTransitionEnded(a)})};return b}(),AccessibilityViewModel=function(){function b(a){this.keyboardNavButtonAriaLabel=ko.observable("");this.transcriptButtonAriaLabel=ko.observable("");this.accessibilityEnabled=ko.observable(!1);this.accessilityToolbarVisible=ko.observable(!1);this.accessibilityFeaturesActivated=ko.observable(!1);this.getDomAccessibilityKeyboardNavButton=function(){return $("#accessibilityToolbar").find("#accessibilityKeyboardNavButton")};this.applicationViewModel=
a}b.prototype.setAccessibilityEnabledOnModule=function(a){this.accessibilityEnabled(a);this.accessilityToolbarVisible(a);this.checkAccessibilityFeaturesActivated()};b.prototype.toggleAccessibleFeature=function(){this.accessibilityFeaturesActivated()&&(this.setAlertContent(localizedText.Accessibility_DisabledAccessibilityAlert()),this.keyboardNavButtonAriaLabel(localizedText.Accessibility_EnableAccessibility()),$html.removeClass("accessibility"));this.accessibilityFeaturesActivated(!this.accessibilityFeaturesActivated());
this.applicationViewModel.ajaxLoader.createCookie("AccessibleFeaturesEnabled",this.accessibilityFeaturesActivated(),9999);this.accessibilityFeaturesActivated()&&($html.addClass("accessibility"),this.setAlertContent(localizedText.Accessibility_EnabledAccessibilityAlert()),this.keyboardNavButtonAriaLabel(localizedText.Accessibility_DisableAccessibility()),audioPlayer.isPlaying()&&audioPlayer.pause())};b.prototype.setTranscriptFeatureState=function(a){a?this.transcriptButtonAriaLabel(localizedText.Accessibility_DisableTranscript()):
this.transcriptButtonAriaLabel(localizedText.Accessibility_EnableTranscript())};b.prototype.setAlertContent=function(a){if(this.accessibilityFeaturesActivated()&&!StringHelper.isNullOrEmpty(a)){var c=$(".accessibility__alert");c.empty();var d=document.createElement("div");d.id="infoAlert";d.setAttribute("role","alert");d.setAttribute("aria-live","polite");var b=document.createElement("span"),a=document.createTextNode(a);b.appendChild(a);$(d).append(b);c.append(d)}};b.prototype.checkAccessibilityFeaturesActivated=
function(){if(this.accessibilityEnabled()){var a=this.applicationViewModel.ajaxLoader.readCookie("AccessibleFeaturesEnabled");a&&"true"==a?(this.accessibilityFeaturesActivated(!0),$html.addClass("accessibilityFeatures"),$html.addClass("accessibility")):logger.info("Accessibility is disabled")}this.accessibilityFeaturesActivated()?this.keyboardNavButtonAriaLabel(localizedText.Accessibility_DisableAccessibility()):this.keyboardNavButtonAriaLabel(localizedText.Accessibility_EnableAccessibility())};b.prototype.playOpeningSound=
function(){if(this.accessibilityFeaturesActivated()){var a=this.applicationViewModel.navigationManager.currentExercise().contentViewModel().openingSound;a&&a.hasSource()&&(a.isPlaying()?a.stop():a.play())}};return b}(),JumpType;(function(b){b[b.Previous=0]="Previous";b[b.Next=1]="Next";b[b.Branching=2]="Branching";b[b.CallToAction=3]="CallToAction";b[b.Past=4]="Past";b[b.Future=5]="Future";b[b.Lock=6]="Lock"})(JumpType||(JumpType={}));
var LifecycleManager=function(){function b(a,c){this.loadedExercises=ko.observableArray();this.applicationViewModel=a;this.navigationManager=c;this.applicationViewModel.eventManager.addExerciseCompleteListener(this);this.applicationViewModel.eventManager.addExerciseLeaveListener(this);this.applicationViewModel.eventManager.addResizeListener(this);this.applicationViewModel.eventManager.addSwipeCancelListener(this);this.applicationViewModel.eventManager.addSwipeStartListener(this);this.applicationViewModel.eventManager.addTransitionEndListener(this)}
b.prototype.onExerciseCompleted=function(a){logger.debug("lifecycleManager.onExerciseCompleted: id="+a.exerciseId);this.applicationViewModel.scorm&&this.applicationViewModel.scorm.completionState&&this.applicationViewModel.scorm.completionState.exerciseCompleted(a.exerciseId);this.unlockPredictableFuture();for(a=0;a<this.navigationManager.alternativeFuturesExercises().length;a++)this.navigationManager.alternativeFuturesExercises()[a].isLocked(!1)};b.prototype.unlockPredictableFuture=function(){logger.debug("lifecycleManager.unlockPredictableFuture");
if(!(null!=this.navigationManager.currentExercise()&&this.navigationManager.currentExercise().getChapter().disableForwardBrowsing&&!this.navigationManager.currentExercise().isCompleted())&&0<this.navigationManager.predictableFutureExercises().length)for(var a=0;a<this.navigationManager.predictableFutureExercises().length;a++){0==a&&this.navigationManager.currentExercise().isCompleted()&&this.navigationManager.predictableFutureExercises()[0].isLocked(!1);if(this.navigationManager.predictableFutureExercises()[a].getChapter().disableForwardBrowsing){this.navigationManager.predictableFutureExercises()[a].getChapter().getExercises()[0].id==
this.navigationManager.predictableFutureExercises()[a].exerciseId&&this.navigationManager.predictableFutureExercises()[a].isLocked(!1);break}this.navigationManager.predictableFutureExercises()[a].isLocked(!1)}};b.prototype.onExerciseLeaved=function(a){logger.debug("lifecycleManager.onExerciseLeaved: id="+a.exerciseId);this.navigationManager.addWork(function(){a.stop()})};b.prototype.onResized=function(a,c){logger.debug("lifecycleManager.onResized: width="+a+" height="+c);var d=this.navigationManager.currentExercise();
null!=d&&d.sizeChanged(a,c);for(var b=this.loadedExercises(),f=0;f<b.length;f++)b[f].isLoaded()&&b[f]!=d&&b[f].sizeChanged(a,c)};b.prototype.onSwipeCancelled=function(){this.navigationManager.currentExercise().swipeCancelled()};b.prototype.onSwipeStarted=function(){var a=this.navigationManager.nextExercise();null!=a&&$("video",$("#"+a.slideId)).each(function(){$(this).load()});this.navigationManager.currentExercise().swipeStarted()};b.prototype.onTransitionEnded=function(a){var c=this;logger.debug("lifecycleManager.onTransitionEnded: id="+
a.exerciseId);this.updateLoadedExercisesList();this.applicationViewModel.modalBoxViewModel.overlayVisible()||this.navigationManager.addWork(function(){a.start();c.applicationViewModel.scorm&&c.applicationViewModel.scorm.completionState&&c.applicationViewModel.scorm.completionState.exerciseStarted(a.exerciseId)})};b.prototype.getExerciseViewModel=function(a,c,d){void 0===c&&(c=!0);void 0===d&&(d=!1);if(null==a)return null;for(var b=0;b<this.loadedExercises().length;b++)if(this.loadedExercises()[b].exerciseId==
a.id&&0>this.navigationManager.historyExercises().indexOf(this.loadedExercises()[b]))return this.loadedExercises()[b];return this.createViewModel(a,c,d)};b.prototype.getExerciseViewModelFromId=function(a){if(null==a)return null;for(var c=0;c<this.loadedExercises().length;c++)if(this.loadedExercises()[c].exerciseId==a)return this.loadedExercises()[c];return null};b.prototype.createViewModel=function(a,c,d){void 0===d&&(d=!1);var b=new ExerciseViewModel(a);b.loadThumbnail();c&&this.navigationManager.addWork(function(){b.load()});
d&&(a=this.loadedExercises(),a.push(b),this.loadedExercises(a));return b};b.prototype.updateLoadedExercisesList=function(){var a=this,c=[];c.push(this.navigationManager.currentExercise());null!=this.navigationManager.previousExercise()&&c.push(this.navigationManager.previousExercise());null!=this.navigationManager.nextExercise()&&c.push(this.navigationManager.nextExercise());if(this.navigationManager.currentExercise().hasCallToAction())for(var d=0;d<this.navigationManager.allExercises().length-1;d++)if(this.navigationManager.allExercises()[d].id==
this.navigationManager.currentExercise().exerciseId){c.push(this.getExerciseViewModel(this.navigationManager.allExercises()[d+1]));break}for(d=0;d<this.navigationManager.alternativeFuturesExercises().length;d++)c.push(this.getExerciseViewModel(this.navigationManager.alternativeFuturesExercises()[d]));for(var b=[],d=[],f=0;f<c.length;f++)-1===b.indexOf(c[f])&&(b.push(c[f]),d.push(c[f].slideId));c=b;for(f=0;f<this.loadedExercises().length;f++)-1==c.indexOf(this.loadedExercises()[f])&&this.navigationManager.addWork(function(){a.loadedExercises()[f].cleanup()});
for(f=0;f<c.length;f++)c[f].isLoaded()?c[f].isActive()&&c[f]!=this.navigationManager.currentExercise()&&this.navigationManager.addWork(function(){c[f].stop()}):this.navigationManager.addWork(function(){c[f].load()});this.loadedExercises(c);var b=document.getElementById("preload"),g=[];if(null!=b){for(var h=0;h<b.children.length;h++)-1==d.indexOf(b.children[h].id)&&g.push(b.children[h]);for(;0<g.length;)b.removeChild(g.pop())}};return b}(),EnumBranchingDestinationType;
(function(b){b[b.None=0]="None";b[b.Next=1]="Next";b[b.Exercise=2]="Exercise";b[b.Chapter=3]="Chapter"})(EnumBranchingDestinationType||(EnumBranchingDestinationType={}));
var EnumBranchingDestinationTypeHelper=function(){function b(){}b.parseEnumBranchingDestinationType=function(a){var c=null;if(a&&(0===a.toLowerCase().localeCompare("chapter")&&(c=EnumBranchingDestinationType.Chapter),0===a.toLowerCase().localeCompare("exercise")&&(c=EnumBranchingDestinationType.Exercise),0===a.toLowerCase().localeCompare("next")&&(c=EnumBranchingDestinationType.Next),0===a.toLowerCase().localeCompare("none")))c=EnumBranchingDestinationType.None;return c};return b}(),BranchingManager=
function(){function b(a,c){this.applicationViewModel=a;this.navigationManager=c;this.applicationViewModel.eventManager.addCourseLoadListener(this);this.branchingLinks=[]}b.prototype.onCourseLoaded=function(a){this.course=a;this.branchingLinks=a.branchingLinks.slice()};b.prototype.redirectDestination=function(a,c,d,b){logger.debug("branchingManager.redirectDestination: fromId="+c+" toId="+b);for(var f=0;f<this.branchingLinks.length;f++)this.branchingLinks[f].destinationType==a&&this.branchingLinks[f].destinationId==
c&&(this.branchingLinks[f].destinationType=d,this.branchingLinks[f].destinationId=b)};b.prototype.getDestination=function(a,c,d,b){void 0===d&&(d=null);void 0===b&&(b=!1);logger.debug("branchingManager.getDestination for type="+EnumBranchingLinkType[c]+" and current="+a);var f=this.navigationManager.getExerciseById(a);if(null===f||b&&"AssessmentResult"===f.type&&(c===EnumBranchingLinkType.CallToAction||c===EnumBranchingLinkType.Alternative))return null;d=this.getBranchingLink(a,c,d);if(null!=d)switch(d.destinationType){case EnumBranchingDestinationType.Exercise:return this.navigationManager.getExerciseById(d.destinationId);
case EnumBranchingDestinationType.Chapter:return this.getFirstExerciseForChapter(d.destinationId);case EnumBranchingDestinationType.Next:return this.navigationManager.getNextExercise(a);case EnumBranchingDestinationType.None:if(!(c===EnumBranchingLinkType.NextButton&&EnumTransitionTypeHelper.parseEnumTransitionType(f.transitionType.toString())===EnumTransitionType.Auto))return null}return c===EnumBranchingLinkType.NextButton||c===EnumBranchingLinkType.CallToAction?this.navigationManager.getNextExercise(a):
null};b.prototype.getBranchingLink=function(a,c,d){void 0===d&&(d=null);for(var b=0,f=this.branchingLinks.length;b<f;b++){var g=this.branchingLinks[b];if(g.exerciseId===a&&g.linkType===c&&g.linkId===d)return g}return null};b.prototype.getDestinationsFrom=function(a,c){void 0===c&&(c=!1);var d=[];if(null==a)return d;logger.debug("branchingManager.getDestinationsFrom: id="+a.id);for(var b=0,f=this.branchingLinks.length;b<f;b++){var g=this.branchingLinks[b];g.exerciseId===a.id&&(g=this.getDestination(a.id,
g.linkType,g.linkId,c),null!=g&&-1===d.indexOf(g)&&d.push(g))}return d};b.prototype.existsAlternativeDestinationFrom=function(a){logger.debug("branchingManager.existsAlternativeDestinationFrom");for(var c=0,d=this.branchingLinks.length;c<d;c++){var b=this.branchingLinks[c];if(b.exerciseId==a&&b.linkType===EnumBranchingLinkType.Alternative)return!0}return!1};b.prototype.getFirstExerciseForChapter=function(a){a=this.course.getChapterById(a);if(null!=a)for(var a=a.getExercises(),c=0;c<a.length;c++){var d=
this.navigationManager.getExerciseById(a[c].id);if(null!=d)return d}return null};return b}(),NavigationManager=function(){function b(a){var c=this;this.longestPathWatchDog=0;this.worker=$.Deferred().resolve().promise();this.allExercises=ko.observableArray();this.historyExercises=ko.observableArray();this.canLeaveCurrentExercise=ko.observable(!1);this.predictableFutureExercises=ko.observableArray();this.computePredictableFutureExercises=function(){var a=[],b=c.historyExercises()[c.historyExercises().length-
1],f=c.branchingManager.getDestination(b.exerciseId,EnumBranchingLinkType.NextButton,null,!0);null==f&&b.hasCallToAction()&&(f=c.branchingManager.getDestination(b.exerciseId,EnumBranchingLinkType.CallToAction,null,!0));if(null==b||null==f)return a;if(0<c.predictableFutureExercises().length&&b==c.predictableFutureExercises()[0])return c.predictableFutureExercises().slice(1);for(var g=c.allExercises()[c.allExercises().length-1],h=c.branchingManager.getDestinationsFrom(b.getData());b.getData()!=g&&(null!=
f&&h&&0==h.length||null!=f&&h&&1==h.length&&f==h[0]);){b=c.lifecycleManager.getExerciseViewModel(f,!1);f=!1;for(h=0;h<a.length;h++)if(a[h].exerciseId==b.exerciseId){f=!0;break}if(f)break;a.push(b);h=c.branchingManager.getDestinationsFrom(b.getData(),!0);f=c.branchingManager.getDestination(b.exerciseId,EnumBranchingLinkType.NextButton,null,!0);null==f&&b.hasCallToAction()&&(f=c.branchingManager.getDestination(b.exerciseId,EnumBranchingLinkType.CallToAction,null,!0))}return a};this.computeAlternativeFuturesExercises=
function(){var a=[];if(null!=c.currentExercise()&&(a=c.branchingManager.getDestinationsFrom(c.currentExercise().getData()),0<a.length)){var b=c.branchingManager.getDestination(c.currentExercise().exerciseId,EnumBranchingLinkType.NextButton),f=c.branchingManager.getDestination(c.currentExercise().exerciseId,EnumBranchingLinkType.CallToAction);null!=b&&0>a.indexOf(b)&&a.push(b);null!=f&&0>a.indexOf(f)&&a.push(f)}return a};this.computeWorstCaseFutureExercises=function(){var a=[];null!=c.currentExercise()&&
(c.longestPathWatchDog=0,a=c.getLongestPath([],c.currentExercise().getData(),!0),2<a.length&&-1<c.getFirstPositionInHistory(a[a.length-1])&&(a=a.slice(0,-1)),a=a.slice(1));return a};this.computeCurrentExercise=function(){return 0<c.historyExercises().length?c.historyExercises()[c.historyExercises().length-1]:null};this.computePreviousExercise=function(){return 1<c.historyExercises().length?c.historyExercises()[c.historyExercises().length-2]:null};this.computeNextExercise=function(){if(null!=c.currentExercise()){logger.debug("navigationManager.ComputeNextExercise "+
c.currentExercise().exerciseId);var a=c.branchingManager.getDestination(c.currentExercise().exerciseId,EnumBranchingLinkType.NextButton);if(null!=a)return c.lifecycleManager.getExerciseViewModel(a,!0,!0)}return null};this.followPreviousLink=function(){1<c.historyExercises().length&&c.gotoHistoryIndex(c.historyExercises().length-2)};this.onVisualAnimationEndedCallback=function(a){isNaN(a)?c.canLeaveCurrentExercise(!0):setTimeout(function(){c.canLeaveCurrentExercise(!0)},a)};this.applicationViewModel=
a;this.branchingManager=new BranchingManager(a,this);this.applicationViewModel.eventManager.addCourseLoadListener(this);this.applicationViewModel.eventManager.addTransitionEndListener(this);this.lifecycleManager=new LifecycleManager(a,this);this.applicationViewModel.eventManager.addSwipeEndListener(this);this.currentExercise=ko.computed(this.computeCurrentExercise);this.previousExercise=ko.computed(this.computePreviousExercise);this.nextExercise=ko.computed(this.computeNextExercise);this.alternativeFuturesExercises=
ko.computed(this.computeAlternativeFuturesExercises);this.worstCaseFutureExercises=ko.computed(this.computeWorstCaseFutureExercises)}b.prototype.addWork=function(a){this.worker=$.when(this.worker,a())};b.prototype.isLast=function(){var a=0===this.worstCaseFutureExercises().length;a&&null!=this.currentExercise()&&"assessmentResult"===this.currentExercise().exerciseType&&(this.currentExercise().isCompleted()?null!=this.currentExercise().callToActionBranchingLinkId&&!1===this.currentExercise().callToActionReset()&&
(a=!1):a=!1);return a};b.prototype.getLongestPath=function(a,c,d){void 0===d&&(d=!1);this.longestPathWatchDog+=1;var b=[];if(null==c)return b;b.push(c);if(1E3<this.longestPathWatchDog)return a;var f=this.allExercises()[this.allExercises().length-1];if(-1<a.indexOf(c)||c==f)return b;var f=this.branchingManager.getDestinationsFrom(c,d),g=[],h=this.branchingManager.getDestination(c.id,EnumBranchingLinkType.NextButton,null,d);null!=h&&f.push(h);c.hasCallToAction()&&(h=this.branchingManager.getDestination(c.id,
EnumBranchingLinkType.CallToAction,null,d),null!=h&&f.push(h));for(var i=[],h=0;h<f.length;h++)-1===i.indexOf(f[h])&&i.push(f[h]);f=i;a=a.slice();a.push(c);for(h=0;h<f.length;h++)c=this.getLongestPath(a,f[h],d),0<c.length&&-1<a.indexOf(c[c.length-1])?b=b.concat(c):c.length>g.length&&(g=c);return b.concat(g)};b.prototype.gotoHistoryIndex=function(a,c){var d=this;void 0===c&&(c=!0);if(this.canLeaveCurrentExercise()&&!(a>this.historyExercises().length-2)){var b=this.historyExercises();if(!b[a].isLocked()){var f=
this.currentExercise(),g=a+1,g=b.splice(g,b.length-g);this.predictableFutureExercises(g.concat(this.predictableFutureExercises()));this.historyExercises(b);var h=1<g.length?JumpType.Past:JumpType.Previous;this.applicationViewModel.runtimeExternalAPI.triggerExerciseChangedEvent(this.currentExercise(),h);c&&(this.leaveExercise(f),this.lifecycleManager.updateLoadedExercisesList(),this.addWork(function(){d.applicationViewModel.sliderViewModel.slideTo(d.currentExercise(),h)}))}}};b.prototype.gotoPredictableFutureIndex=
function(a){var c=this;if(this.canLeaveCurrentExercise()&&!(a>this.predictableFutureExercises().length)){var d=this.predictableFutureExercises();if(!d[a].isLocked()){var b=this.currentExercise(),a=d.splice(0,a+1);this.predictableFutureExercises(d);this.historyExercises(this.historyExercises().concat(a));this.applicationViewModel.runtimeExternalAPI.triggerExerciseChangedEvent(this.currentExercise(),JumpType.Future);this.leaveExercise(b);this.lifecycleManager.updateLoadedExercisesList();this.addWork(function(){c.applicationViewModel.sliderViewModel.slideTo(c.currentExercise(),
JumpType.Future)})}}};b.prototype.followAlternativeLink=function(a,c){var d=this.branchingManager.getDestination(a,EnumBranchingLinkType.Alternative,c);null!=d&&(d=this.lifecycleManager.getExerciseViewModel(d),d.isLocked(!1),this.jumpTo(d,JumpType.Branching))};b.prototype.followCallToActionLink=function(a,c){void 0===c&&(c=null);this.jumpTo(this.lifecycleManager.getExerciseViewModel(this.branchingManager.getDestination(a,EnumBranchingLinkType.CallToAction,c)),JumpType.CallToAction)};b.prototype.followNextLink=
function(){null!=this.nextExercise()&&(this.nextExercise().getChapter().disableForwardBrowsing||this.nextExercise().isLocked(!1),this.jumpTo(this.nextExercise(),JumpType.Next))};b.prototype.canGoToNextExercise=function(){if(null==this.currentExercise())return!1;var a=this.branchingManager.getBranchingLink(this.currentExercise().exerciseId,EnumBranchingLinkType.NextButton);return null!=a&&a.destinationType===EnumBranchingDestinationType.None?!1:null!=this.nextExercise()};b.prototype.jumpTo=function(a,
c,d){var b=this;void 0===d&&(d=!0);this.canLeaveCurrentExercise()&&null!=a&&(a.isLocked()||(this.leaveExercise(this.currentExercise()),this.historyExercises.push(a),this.predictableFutureExercises(this.computePredictableFutureExercises()),this.lifecycleManager.unlockPredictableFuture()),c=a.isLocked()?JumpType.Lock:c,this.applicationViewModel.runtimeExternalAPI.triggerExerciseChangedEvent(a,c),d&&this.addWork(function(){b.applicationViewModel.sliderViewModel.slideTo(a,c)}))};b.prototype.leaveExercise=
function(a){null!=a&&this.applicationViewModel.eventManager.triggerExerciseLeaveEvent(a)};b.prototype.onCourseLoaded=function(a){logger.debug("navigationManager.onCourseLoaded");this.allExercises().splice(0,this.allExercises().length);this.historyExercises().splice(0,this.historyExercises().length);this.predictableFutureExercises().splice(0,this.predictableFutureExercises().length);this.lifecycleManager.loadedExercises().splice(0,this.lifecycleManager.loadedExercises().length);for(var c=!(this.applicationViewModel.uiManager.isPreviewMode()||
this.applicationViewModel.uiManager.isScreenshotMode()),d=[],b=0;b<a.chapters.length;b++){var f=a.chapters[b],g=this.applyChapterBehaviours(f);0<g.length&&this.branchingManager.redirectDestination(EnumBranchingDestinationType.Chapter,f.id,EnumBranchingDestinationType.Exercise,g[0].id);for(f=0;f<g.length;f++){var h=g[f];h.isLocked(c);h.isCompleted(!1);d.push(h)}}this.allExercises(d);c=this.allExercises()[0];d=null;null==this.applicationViewModel.scorm.getNumberOfAttempts()&&this.applicationViewModel.scorm.setNumberOfAttempts(a.numberOfAttempts);
this.applicationViewModel.scorm.trackingEnabled?(this.CheckValidateScormData()||applicationViewModel.scorm.resetModuleData(),this.retrieveCompletionState(),this.retrieveHistoryExercises(),this.retrievePredictableFutureExercises(),this.applicationViewModel.scorm.setPostCompletionIfSuccess(a.postCompletionIfSuccess),d=this.applicationViewModel.scorm.getLessonLocation()):uiManager.isPreviewMode()&&(d=parseInt(this.applicationViewModel.ajaxLoader.getUrlParameterValue("gotoExercise",null)));!isNaN(d)&&
null!=d&&(c=this.getExerciseById(d));if(null!=c){c.isLocked(!1);if(0==this.historyExercises().length){a=this.allExercises().indexOf(c);d=[];for(b=0;b<=a;b++)g=this.lifecycleManager.getExerciseViewModel(this.allExercises()[b],!1),d.push(g);this.historyExercises(d)}a=this.getLastPositionInHistory(c);0>a?(g=this.lifecycleManager.getExerciseViewModel(this.allExercises()[b],!1),g.isLocked(!1),this.historyExercises.push(g)):this.gotoHistoryIndex(a,!1)}this.startNavigation()};b.prototype.CheckValidateScormData=
function(){if(this.applicationViewModel.scorm.completionState)for(var a=this.applicationViewModel.scorm.completionState.states,c=0;c<a.length;c++)if(null==this.getExerciseById(a[c].exerciseId))return!1;if(0<this.applicationViewModel.scorm.getHistory().length)for(c=0;c<this.applicationViewModel.scorm.getHistory().length;c++)if(null==this.lifecycleManager.getExerciseViewModel(this.getExerciseById(this.applicationViewModel.scorm.getHistory()[c]),!1))return!1;if(0<this.applicationViewModel.scorm.getFuture().length)for(a=
0;a<this.applicationViewModel.scorm.getFuture().length;a++)if(null==this.lifecycleManager.getExerciseViewModel(this.getExerciseById(this.applicationViewModel.scorm.getFuture()[a]),!1))return!1;return!0};b.prototype.getFirstPositionInHistory=function(a){for(var c=0;c<this.historyExercises().length-1;c++)if(this.historyExercises()[c].exerciseId==a.id)return c;return-1};b.prototype.getLastPositionInHistory=function(a){for(var c=this.historyExercises().length-1;0<=c;c--)if(this.historyExercises()[c].exerciseId==
a.id)return c;return-1};b.prototype.startNavigation=function(){this.lifecycleManager.updateLoadedExercisesList();this.predictableFutureExercises(this.computePredictableFutureExercises());this.lifecycleManager.unlockPredictableFuture();uiManager.initializeDom();this.applicationViewModel.timelineViewModel.initializeDom();uiManager.computeAndBindDimensions();null==this.previousExercise()?this.currentExercise().onVisualAnimationEnded=this.onVisualAnimationEndedCallback:this.canLeaveCurrentExercise(!0)};
b.prototype.applyChapterBehaviours=function(a){logger.debug("navigationManager.applyChapterBehaviours: id="+a.id);var c=a.getExercises();if(a.shuffleExercises&&applicationViewModel.ajaxLoader.getRuntimeMode()!=EnumRuntimeMode.DRAFT&&!uiManager.isScreenshotMode()){for(var d=0;d<c.length;d++)this.branchingManager.redirectDestination(EnumBranchingDestinationType.Exercise,c[d].id,EnumBranchingDestinationType.Chapter,a.id);if(this.applicationViewModel.scorm.trackingEnabled&&this.applicationViewModel.scorm.chapterShuffled.containsChapter(a.id))for(var d=
this.applicationViewModel.scorm.chapterShuffled.getExercisesIds(a.id),c=[],b=0;b<d.length;b++)c.push(a.getExerciseById(d[b]));else c=a.getShuffledExercises(),!isNaN(a.shuffledExercisesMaximumCount)&&a.shuffledExercisesMaximumCount<c.length&&(c=c.slice(0,a.shuffledExercisesMaximumCount)),this.applicationViewModel.scorm.trackingEnabled&&this.applicationViewModel.scorm.chapterShuffled.addChapter(a,c)}a.setExercicesWithBehavioursApplied(c);return c};b.prototype.reshuffleChapters=function(){logger.debug("navigationManager.shuffleChaptersNotWatched");
this.allExercises().splice(0,this.allExercises().length);for(var a=0;a<applicationViewModel.course().chapters.length;a++){var c=applicationViewModel.course().chapters[a],d=c.getExercises();if(c.shuffleExercises){var b=!0,f=0;a:for(;f<d.length;f++)for(var g=d[f].id,h=0;h<this.historyExercises().length;h++)if(this.historyExercises()[h].exerciseId===g){b=!1;break a}b?(this.applicationViewModel.scorm.trackingEnabled&&this.applicationViewModel.scorm.chapterShuffled.removeChapter(c),d=this.applyChapterBehaviours(c),
0<d.length&&this.branchingManager.redirectDestination(EnumBranchingDestinationType.Chapter,c.id,EnumBranchingDestinationType.Exercise,d[0].id)):d=c.exercisesWithBehavioursApplied}for(c=0;c<d.length;c++)this.allExercises.push(d[c])}};b.prototype.retrieveCompletionState=function(){if(this.applicationViewModel.scorm.completionState)for(var a=this.applicationViewModel.scorm.completionState.states,c=0;c<a.length;c++){var d=this.getExerciseById(a[c].exerciseId);d.isLocked(!1);d.isWatched(!0);d.isCompleted(1<
a[c].completionStatus)}};b.prototype.retrieveHistoryExercises=function(){if(0<this.applicationViewModel.scorm.getHistory().length){for(var a=[],c=0;c<this.applicationViewModel.scorm.getHistory().length;c++){var d=this.lifecycleManager.getExerciseViewModel(this.getExerciseById(this.applicationViewModel.scorm.getHistory()[c]),!1);d.isLocked()&&!d.getChapter().disableForwardBrowsing&&d.isLocked(!1);a.push(d)}this.historyExercises(a)}};b.prototype.retrievePredictableFutureExercises=function(){if(0<this.applicationViewModel.scorm.getFuture().length){for(var a=
[],c=0;c<this.applicationViewModel.scorm.getFuture().length;c++){var d=this.lifecycleManager.getExerciseViewModel(this.getExerciseById(this.applicationViewModel.scorm.getFuture()[c]),!1);a.push(d)}this.predictableFutureExercises(a)}};b.prototype.getExerciseById=function(a){logger.debug("navigationManager.getExerciseById: id="+a);for(var c=null,d=0,b=this.allExercises().length;d<b;d++)if(this.allExercises()[d].id==a){c=d;break}return null!=c?this.allExercises()[c]:null};b.prototype.onSwipeEnded=function(a){logger.debug("navigationManager.onSwipeEnded");
switch(a){case SwipeDirection.Previous:this.gotoHistoryIndex(this.historyExercises().length-2,!1);break;case SwipeDirection.Next:this.jumpTo(this.nextExercise(),JumpType.Next,!1)}};b.prototype.onTransitionEnded=function(a){uiManager.isPreviewMode()&&(window.location.hash="gotoExercise="+a.exerciseId)};b.prototype.existsAlternativeDestinationFrom=function(a){return this.branchingManager.existsAlternativeDestinationFrom(a)};b.prototype.getBranchingManager=function(){return this.branchingManager};b.prototype.getNextExercise=
function(a){a=this.allExercises().indexOf(this.getExerciseById(a));return this.allExercises()[a+1]};return b}(),TimelineGroup=function(){function b(a,c,d){this.title=ko.observable("&nbsp;");this.titleTooltip=ko.observable("");this.exercises=[];this.cssClassValues=ko.observable("");this.titleMaxWidth=ko.observable(0);this.timelineGroupId="timelineGroup_"+GuidHelper.newGuid();this.title(this.formatTitle(a));this.titleTooltip(this.title());this.cssClassValues(d);null!=c&&(this.exercises=c);this.titleMaxWidth(this.exercises.length*
b.FRIEZE_EXERCISE_WIDTH)}b.prototype.formatTitle=function(a){var c=a;"&nbsp; - &nbsp;"==a?c="&nbsp;":0==c.indexOf("&nbsp; - ")?c=c.substring(9):0<c.indexOf(" - &nbsp;")&&(c=c.substring(0,c.indexOf(" - &nbsp;")));return c};b.FRIEZE_EXERCISE_WIDTH=165;return b}(),TimelineViewModel=function(){function b(a){var c=this;this.mouseLeaveTimer=this.scrollMoveTimer=null;this.scrollSpeed=1;this.scrollHighSpeed=4;this.scrollTime=5;this.increaseSpeed=!1;this.firstFriezeHideTimer=null;this.scrolling=!1;this.maxScrollLeft=
this.scrollPosition=0;this.previousExercise=null;this.friezeVisible=ko.observable(!0);this.friezeButtonVisible=ko.observable(!0);this.timers=new Timers;this.computeExercises=function(){return c.applicationViewModel.navigationManager.historyExercises().concat(c.applicationViewModel.navigationManager.predictableFutureExercises())};this.computeCurrentPosition=function(){if(c.applicationViewModel.navigationManager.historyExercises().length)return c.applicationViewModel.navigationManager.historyExercises().length-
1};this.tableContentDeactivatedClickHandler=null;this.computeTimelineGroups=function(){for(var a=[],b=null,f=[],g=0;g<c.exercises().length;g++){var h=c.exercises()[g];h.getChapter()!=b&&(null!=b&&a.push(new TimelineGroup(b.name,f,"frieze__header__chapters")),b=h.getChapter(),f=[]);f.push(h);g==c.exercises().length-1&&a.push(new TimelineGroup(b.name,f,"frieze__header__chapters"))}return a};this.computeMenuButtonVisible=function(){return c.friezeButtonVisible()&&c.applicationViewModel.navigationManager.currentExercise()&&
!(0==c.currentPosition()&&"Intro"==c.applicationViewModel.navigationManager.currentExercise().templateName)&&!(0==c.currentPosition()&&"BrandedIntro"==c.applicationViewModel.navigationManager.currentExercise().templateName)&&!(c.applicationViewModel.navigationManager.currentExercise().contentViewModel()&&c.applicationViewModel.navigationManager.currentExercise().contentViewModel().feedbackVisible())&&!(c.applicationViewModel.navigationManager.currentExercise().contentViewModel()&&c.applicationViewModel.navigationManager.currentExercise().contentViewModel().tooltipOverlayVisible())};
this.scrollTimelineToUnitCalls={};this.applicationViewModel=a;this.applicationViewModel.eventManager.addTransitionEndListener(this);this.exercises=ko.computed(this.computeExercises);this.currentPosition=ko.computed(this.computeCurrentPosition);this.timelineGroups=ko.computed(this.computeTimelineGroups);this.menuButtonVisible=ko.computed(this.computeMenuButtonVisible);this.initialize()}b.prototype.onTransitionEnded=function(a){var c=this;this.friezeVisible(1<this.applicationViewModel.navigationManager.historyExercises().length||
a.exerciseType.toLowerCase()!=enumTemplate[enumTemplate.Intro].toLowerCase());setTimeout(function(){c.changeTimelineCurrentUnit(a)},500)};b.prototype.initialize=function(){this.applicationViewModel.platformFeatures.getIsIE678()&&(this.scrollHighSpeed=12,this.scrollSpeed=3,this.scrollTime=15)};b.prototype.initializeDom=function(){this.tablecontent=$("#tablecontent");this.frieze=$("#frieze");this.buttonMenu=$("#menu");this.frieze_navigation_previous=$("#friezenavigationprevious");this.frieze_navigation_next=
$("#friezenavigationnext");this.frieze_inner=$("#friezeinner");this.frieze_chapters=$("#friezechapters");this.mask=$("#mask");this.progress=$("#progress");this.computeMaxScrollLeft();this.initializeFriezeControls()};b.prototype.onFriezeMenuClick=function(){this.friezeVisible()?this.hideTimeline():this.showTimeline()};b.prototype.initializeFriezeControls=function(){var a=this;this.mask&&this.mask.click(function(){a.hideTimeline()});if(this.applicationViewModel.platformFeatures.getShowFriezeButtons()){this.frieze_navigation_previous&&
(this.frieze_navigation_previous.mouseenter(function(c){c.preventDefault();a.scrolling=!0;a.increaseSpeed=!1;a.timers.setInterval("scrollMoveTimer",function(){a.scrollToLeft()},a.scrollTime);return!1}),this.frieze_navigation_previous.mouseleave(function(){a.timers.clearInterval("scrollMoveTimer");return a.scrolling=!1}),this.frieze_navigation_previous.mousedown(function(c){c.preventDefault();a.increaseSpeed=!0;return!1}),this.frieze_navigation_previous.mouseup(function(c){c.preventDefault();return a.increaseSpeed=
!1}));this.frieze_navigation_next&&(this.frieze_navigation_next.mouseenter(function(c){c.preventDefault();a.scrolling=true;a.increaseSpeed=false;a.timers.setInterval("scrollMoveTimer",function(){a.scrollToRight()},a.scrollTime)}),this.frieze_navigation_next&&this.frieze_navigation_next.mouseleave(function(){a.timers.clearInterval("scrollMoveTimer");return a.scrolling=false}),this.frieze_navigation_next.mousedown(function(c){c.preventDefault();a.increaseSpeed=true;return false}),this.frieze_navigation_next.mouseup(function(c){c.preventDefault();
return a.increaseSpeed=false}));var c=[];c.push(this.frieze);for(var d=0,b=c.length;d<b;d++){var f=c[d];f&&(this.applicationViewModel.platformFeatures.getIsEdge()||f.mouseleave(function(){clearInterval(a.mouseLeaveTimer);a.mouseLeaveTimer=setTimeout(function(){a.hideTimeline()},1E3)}),f.mouseenter(function(){clearInterval(a.mouseLeaveTimer)}))}}};b.prototype.gotoPosition=function(a,c){var d=parseInt($(c.target).text())-1;isNaN(d)&&(d=parseInt($(c.target).parent().find(".frieze__exercise__mask").text())-
1);d<=this.currentPosition()?this.applicationViewModel.navigationManager.gotoHistoryIndex(d):this.applicationViewModel.navigationManager.gotoPredictableFutureIndex(d-(this.currentPosition()+1))};b.prototype.hideTimeline=function(){var a=this;this.friezeVisible(!1);this.applicationViewModel.menuTabindex(-1);this.applicationViewModel.platformFeatures.getAutoHideFrieze()&&this.mask&&this.mask.fadeOut("fast");this.removeClassWithAnimation(this.buttonMenu,"menu--open",200);this.applicationViewModel.sliderViewModel.contentDeactivated(!1);
var c=this.tablecontent.get(0);c&&"undefined"!=typeof c.removeEventListener&&(c.removeEventListener("click",this.tableContentDeactivatedClickHandler,!0),c.removeEventListener("touchstart",this.tableContentDeactivatedClickHandler,!0));this.tableContentDeactivatedClickHandler=null;clearInterval(this.scrollMoveTimer);clearInterval(this.mouseLeaveTimer);this.frieze&&this.timers.setTimeout("frizeopen",function(){a.removeClassWithAnimation(a.frieze,"frieze--open",200)},0);this.progress&&this.timers.setTimeout("progressopen",
function(){a.removeClassWithAnimation(a.progress,"frieze__progress--open",200)},0)};b.prototype.showTimeline=function(){var a=this;if(!this.friezeVisible()){this.friezeVisible(!0);this.applicationViewModel.menuTabindex(1001);this.applicationViewModel.sliderViewModel.contentDeactivated(!0);this.applicationViewModel.platformFeatures.getAutoHideFrieze()&&this.mask&&this.mask.fadeIn("fast");this.addClassWithAnimation(this.buttonMenu,"menu--open",200);clearInterval(this.scrollMoveTimer);this.frieze&&this.timers.setTimeout("frizeopen",
function(){a.addClassWithAnimation(a.frieze,"frieze--open",200)},0);this.progress&&this.timers.setTimeout("progressopen",function(){a.addClassWithAnimation(a.progress,"frieze__progress--open",200)},0);this.computeMaxScrollLeft();this.lockFriezeNavigationButtons();uiManager.buttonPrevious.on("focus",function(){a.hideTimeline()});this.tableContentDeactivatedClickHandler=function(c){a.hideTimeline();c.preventDefault();uiManager.stopPropagation(c)};var c=this.tablecontent.get(0);"undefined"!=typeof c.addEventListener&&
(c.addEventListener("click",this.tableContentDeactivatedClickHandler,!0),c.addEventListener("touchstart",this.tableContentDeactivatedClickHandler,!0))}};b.prototype.computeMaxScrollLeft=function(){this.frieze_chapters&&this.frieze_inner&&(this.maxScrollLeft=this.frieze_chapters.width()-this.frieze_inner.width())};b.prototype.scrollToLeft=function(){if(0<this.scrollPosition){var a=this.scrollSpeed;this.increaseSpeed&&(a=this.scrollHighSpeed);this.scrollPosition-=a;this.frieze_inner&&this.frieze_inner.scrollLeft(this.scrollPosition)}this.lockFriezeNavigationButtons()};
b.prototype.scrollToRight=function(){if(this.scrollPosition<this.maxScrollLeft){var a=this.scrollSpeed;this.increaseSpeed&&(a=this.scrollHighSpeed);this.scrollPosition+=a;this.frieze_inner&&this.frieze_inner.scrollLeft(this.scrollPosition)}this.lockFriezeNavigationButtons()};b.prototype.lockFriezeNavigationButtons=function(){0>=this.scrollPosition?this.frieze_navigation_previous.addClass("frieze__navigationholder__icon--locked"):this.frieze_navigation_previous.removeClass("frieze__navigationholder__icon--locked");
this.scrollPosition<this.maxScrollLeft?this.frieze_navigation_next.removeClass("frieze__navigationholder__icon--locked"):this.frieze_navigation_next.addClass("frieze__navigationholder__icon--locked")};b.prototype.changeTimelineCurrentUnit=function(a){var c=this;clearInterval(this.mouseLeaveTimer);null!=this.previousExercise&&(this.previousExercise.isCurrent(!1),this.previousExercise.isWatched(!0));null!=a&&(a.isCurrent(!0),this.previousExercise=a);this.scrollTimelineToUnit(a.exerciseGuid);this.mouseLeaveTimer=
setTimeout(function(){c.hideTimeline()},1E3)};b.prototype.scrollTimelineToUnit=function(a){var c=this,d=this.scrollTimelineToUnitCalls[a];isNaN(d)&&(d=0);this.log("debug","scrollTimelineToUnit",a,d,"starting");if(2<d)this.log("debug","scrollTimelineToUnit",a,d,"too many calls");else if(this.scrollTimelineToUnitCalls[a]=++d,this.frieze_inner){var b=$("#"+a),f=this.frieze_inner.width(),g=b.position()||{left:0,top:0};if(isNaN(f)||0==g.left){2<d?(this.log("debug","scrollTimelineToUnit",a,d,"must call but already too many calls"),
delete this.scrollTimelineToUnitCalls[a]):(this.log("debug","scrollTimelineToUnit",a,d,"already called but must recall : bad values"),clearTimeout(this.scrollTimelineTimeout),this.scrollTimelineTimeout=setTimeout(function(){c.scrollTimelineToUnit(a)},300));return}f/=2;this.scrollPosition=g.left<f?0:g.left-f+b.width()/2;this.log("info","scrollTimelineToUnit",a,d,"scrollPosition:",this.scrollPosition);this.frieze_inner.animate({scrollLeft:this.scrollPosition},300,"",null);this.lockFriezeNavigationButtons()}delete this.scrollTimelineToUnitCalls[a]};
b.prototype.addClassWithAnimation=function(a,c,d){platformFeatures.getTransitionSupported()==Transition.css?a.addClass(c):a.addClass(c,d)};b.prototype.removeClassWithAnimation=function(a,c,d){platformFeatures.getTransitionSupported()==Transition.css?a.removeClass(c):a.removeClass(c,d)};b.prototype.debug=function(){for(var a=[],c=0;c<arguments.length;c++)a[c-0]=arguments[c];a.unshift("SliderRenderer");logger.debug.apply(logger,a)};b.prototype.info=function(){for(var a=[],c=0;c<arguments.length;c++)a[c-
0]=arguments[c];a.unshift("SliderRenderer");logger.info.apply(logger,a)};b.prototype.log=function(){for(var a=[],c=0;c<arguments.length;c++)a[c-0]=arguments[c];a.unshift("SliderRenderer");logger.log.apply(logger,a)};return b}(),ProgressbarViewModel=function(){function b(a){var c=this;this.timers=new Timers;this.computePercentage=function(){var a=c.applicationViewModel.navigationManager.historyExercises().length;if(0==a)return 0;var b=a+c.applicationViewModel.navigationManager.worstCaseFutureExercises().length;
return 1<b?Math.round(100*((a-1)/(b-1))):100};this.computeCurrentProgressionLabel=function(){return c.percentage()+"%"};this.progressTooltipVisible=ko.observable(!1);this.hideTooltip=ko.observable(!1);this.applicationViewModel=a;this.applicationViewModel.eventManager.addTransitionEndListener(this);this.percentage=ko.computed(this.computePercentage);this.currentProgressionLabel=ko.computed(this.computeCurrentProgressionLabel).extend({throttle:1E3});this.progress=$("#progress")}b.prototype.onTransitionEnded=
function(){1<this.applicationViewModel.navigationManager.historyExercises().length&&0<this.applicationViewModel.navigationManager.worstCaseFutureExercises().length?(this.fadeInProgressTooltip(),this.hideTooltip(!1)):this.hideTooltip(!0)};b.prototype.hideTimeline=function(){var a=this;this.progress&&this.timers.setTimeout("progressopen",function(){a.removeClassWithAnimation(a.progress,"frieze__progress--open",200)},0)};b.prototype.showTimeline=function(){var a=this;this.progress&&this.timers.setTimeout("progressopen",
function(){a.addClassWithAnimation(a.progress,"frieze__progress--open",200)},0)};b.prototype.fadeInProgressTooltip=function(){var a=this;this.progressTooltipVisible(!0);this.timers.setTimeout("progress-tooltip-fade",function(){a.progressTooltipVisible(!1)},2E3)};b.prototype.addClassWithAnimation=function(a,c,d){platformFeatures.getTransitionSupported()==Transition.css?a.addClass(c):a.addClass(c,d)};b.prototype.removeClassWithAnimation=function(a,c,d){platformFeatures.getTransitionSupported()==Transition.css?
a.removeClass(c):a.removeClass(c,d)};return b}(),RuntimeExternalAPI=function(){function b(a){this.exerciseChangedListeners=[];this.applicationViewModel=a;this.applicationViewModel.eventManager.addCourseLoadListener(this)}b.prototype.onCourseLoaded=function(a){this.course=a};b.prototype.addExerciseChangedListener=function(a){this.exerciseChangedListeners.push(a)};b.prototype.isExerciseChangedEventListening=function(a){for(var c=!1,d=0;d<this.exerciseChangedListeners.length;d++)if(this.exerciseChangedListeners[d]==
a){c=!0;break}return c};b.prototype.triggerExerciseChangedEvent=function(a,c){try{if(null!=window.frameElement)for(var d=a.exerciseId,b=this.getExerciseIndex(a),f=0;f<this.exerciseChangedListeners.length;f++)this.exerciseChangedListeners[f].onExerciseChanged(window.frameElement.id,d,b,c)}catch(g){logger.info("window.frameElement != null IE11 error")}};b.prototype.getExerciseIndex=function(a){var c=null;return c=(this.course?this.course.getExercises():[]).indexOf(a.getData())};b.prototype.getCurrentExerciseId=
function(){return this.applicationViewModel.navigationManager.currentExercise().exerciseId};b.prototype.getCurrentExerciseIndex=function(){return this.getExerciseIndex(this.applicationViewModel.navigationManager.currentExercise())};b.prototype.getNextExerciseId=function(){var a=this.applicationViewModel.navigationManager.nextExercise();return null!=a?a.exerciseId:null};b.prototype.getPreviousExerciseId=function(){var a=this.applicationViewModel.navigationManager.previousExercise();return null!=a?
a.exerciseId:null};b.prototype.getNumberOfExercices=function(){return null!=this.course?this.course.getExercises().length:null};b.prototype.goToExercise=function(a,c){this.applicationViewModel.navigationManager.canLeaveCurrentExercise(!0);applicationViewModel.tooltipManager.hideTooltip();switch(c){case JumpType.Branching:this.applicationViewModel.navigationManager.jumpTo(this.applicationViewModel.navigationManager.lifecycleManager.getExerciseViewModelFromId(a),JumpType.Branching);break;case JumpType.CallToAction:this.applicationViewModel.navigationManager.followCallToActionLink(this.getCurrentExerciseId());
break;case JumpType.Future:for(var d=-1,b=this.applicationViewModel.navigationManager.predictableFutureExercises(),f=0;f<b.length;f++)if(b[f].exerciseId==a){d=f;break}this.applicationViewModel.navigationManager.gotoPredictableFutureIndex(d);break;case JumpType.Next:this.applicationViewModel.navigationManager.followNextLink();break;case JumpType.Past:case JumpType.Previous:d=-1;b=this.applicationViewModel.navigationManager.historyExercises();for(f=0;f<b.length;f++)if(b[f].exerciseId==a){d=f;break}this.applicationViewModel.navigationManager.gotoHistoryIndex(d,
!0)}};b.prototype.mute=function(){audioPlayer.mute();VideoPlayerFactory.mute()};b.prototype.unmute=function(){audioPlayer.unmute();VideoPlayerFactory.unmute()};return b}(),SliderButtonViewModel=function(){function b(a,c,d){this.fadeEffectActivated=ko.observable(!0);this.soften=ko.observable(!1);this.isVisible=c;this.isActive=a;this.onClickCallback=d}b.prototype.click=function(){this.onClickCallback()};return b}(),SlickRenderer=function(){function b(a){this.onTransitionEnded=new EventHandler;this.onSwipeStarted=
new EventHandler;this.onSwipeEnded=new EventHandler;this.adapter=a}b.prototype.setup=function(){var a=this;this.slick=$(".slick-container");this.slick.slick({infinite:!1,accessibility:!1,speed:platformFeatures.getSlideAnimationDuration(),cssEase:"ease-out",touchMove:!1,useCSS:!0,easing:"easeOutCubic",dots:!1,arrows:!1,draggable:!1});this.slick.on("beforeChange",function(){a.onSwipeStarted.execute()});this.slick.on("swipe",function(c,d,b){a.onSwipeEnded.execute("left"===b?SwipeDirection.Next:SwipeDirection.Previous)});
this.slick.on("afterChange",function(){a.onTransitionEnded.execute()})};b.prototype.slideToNext=function(a){void 0===a&&(a=!1);a&&this.applyFadeEffect();this.currentSlide()<this.slideCount()&&this.slick.slick("slickNext")};b.prototype.slideToNextLocked=function(){this.currentSlide()<this.slideCount()&&this.slick.slick("slickNextLocked")};b.prototype.addLockedSlide=function(){this.slick.slick("slickAdd","<div id='slick-lock'/>")};b.prototype.slideToPrev=function(){0<this.currentSlide()&&this.slick.slick("slickPrev")};
b.prototype.removeNext=function(){if(this.currentSlide()<this.slideCount()-1){var a=this.currentSlide()+1;""!=this.slick.children()[0].children[0].children[a].innerHTML&&(this.slick.children()[0].children[0].children[a].setAttribute("id","obsoleteSlide"),this.adapter.setContent("obsoleteSlide",null));this.slick.slick("slickRemove",a)}};b.prototype.removePrevious=function(){if(0<this.currentSlide()){var a=this.currentSlide()-1;this.slick.children()[0].children[0].children[a].setAttribute("id","obsoleteSlide");
this.adapter.setContent("obsoleteSlide",null);this.slick.slick("slickRemove",a);this.slick.slick("getSlick").currentSlide=a}};b.prototype.appendSlide=function(a){var c=document.createElement("div");c.setAttribute("id",a+"__container");this.slick.slick("slickAdd",c,!1)};b.prototype.prependSlide=function(a){var c=document.createElement("div");c.setAttribute("id",a+"__container");this.slick.slick("slickAdd",c,0,!0);this.slick.slick("getSlick").currentSlide=1;this.slick.slick("reinit")};b.prototype.reinit=
function(){this.slick.slick("reinit")};b.prototype.isSliding=function(){return this.slick.slick("getSlick").animating};b.prototype.finishCurrentSliding=function(){this.slick.slick("getSlick").$slideTrack.finish()};b.prototype.slideCount=function(){return this.slick.slick("getSlick").slideCount};b.prototype.currentSlide=function(){return this.slick.slick("getSlick").currentSlide};b.prototype.removeSlide=function(a){var c=this.currentSlide();this.slick.slick("slickRemove",a);a<c&&(this.slick.slick("getSlick").currentSlide=
c-1)};b.prototype.resetTransitionEffect=function(){this.slick&&!0===this.slick.slick("getSlick").options.fade&&(this.slick.slick("getSlick").options.fade=!1,this.slick.slick("reinit"),setTimeout(function(){$(".exercise").css("opacity","1")}))};b.prototype.applyFadeEffect=function(){!1===this.slick.slick("getSlick").options.fade&&(this.slick.slick("getSlick").options.fade=!0,this.slick.slick("reinit"))};b.prototype.getDataFor=function(a){return ko.dataFor(a)};return b}(),SlickViewModel=function(){function b(a){var c=
this;this.sliderTemplateName="SlickTemplate";this.timers=new Timers;this.firstCurrentExerciseStarted=this.isMouseOverButtonsActive=!1;this.isRendered=ko.observable(!1);this.contentDeactivated=ko.observable(!1);this.computeNextIsLocked=function(){return null!=c.applicationViewModel.navigationManager.nextExercise()&&c.applicationViewModel.navigationManager.nextExercise().isLocked()};this.transitionEnded=function(){c.applicationViewModel.eventManager.triggerTransitionEndEvent(c.applicationViewModel.navigationManager.currentExercise())};
this.swipeStarted=function(){c.applicationViewModel.eventManager.triggerSwipeStartEvent()};this.swipeCancelled=function(){c.applicationViewModel.eventManager.triggerSwipeCancelEvent()};this.swipeEnded=function(a){c.applicationViewModel.eventManager.triggerSwipeEndEvent(a)};this.computeCurrentSlideId=function(){return null!=c.applicationViewModel.navigationManager.currentExercise()?c.applicationViewModel.navigationManager.currentExercise().slideId:null};this.computeNavigationEnabled=function(){return c.applicationViewModel.navigationManager.canLeaveCurrentExercise()};
this.computeNextButtonVisible=function(){return null==c.applicationViewModel?!1:c.applicationViewModel.navigationManager.canGoToNextExercise()&&c.navigationEnabled()};this.computePreviousButtonVisible=function(){return null==c.applicationViewModel?!1:null!=c.applicationViewModel.navigationManager.previousExercise()&&c.navigationEnabled()};this.computeNextButtonActive=function(){return null==c.applicationViewModel?!1:!c.applicationViewModel.platformFeatures.getIsSwipeEnabled()};this.computePreviousButtonActive=
function(){return null==c.applicationViewModel?!1:!c.applicationViewModel.platformFeatures.getIsSwipeEnabled()};this.setContent=function(c,a){var b=document.getElementById(c);if(null!=b&&b.hasChildNodes()){var g=b.children[0];if(g==a)return;document.getElementById("preload").appendChild(g)}null!=a&&b.appendChild(a)};this.applicationViewModel=a;this.currentSlideId=ko.computed(this.computeCurrentSlideId);this.navigationEnabled=ko.computed(this.computeNavigationEnabled);this.nextButtonVisible=ko.computed(this.computeNextButtonVisible);
this.previousButtonVisible=ko.computed(this.computePreviousButtonVisible);this.nextButtonActive=ko.computed(this.computeNextButtonActive);this.previousButtonActive=ko.computed(this.computePreviousButtonActive);this.previousButton=new SliderButtonViewModel(this.previousButtonActive,this.previousButtonVisible,this.applicationViewModel.navigationManager.followPreviousLink.bind(this.applicationViewModel.navigationManager));this.nextButton=new SliderButtonViewModel(this.nextButtonActive,this.nextButtonVisible,
this.applicationViewModel.navigationManager.followNextLink.bind(this.applicationViewModel.navigationManager));this.nextIsLocked=ko.computed(this.computeNextIsLocked);this.applicationViewModel.eventManager.addExercisePreloadListener(this)}b.prototype.loadSlider=function(){this.slickRenderer=new SlickRenderer(this);this.slickRenderer.onTransitionEnded.subscribe(this,this.onTransitionEnded);this.slickRenderer.onSwipeStarted.subscribe(this,this.onSwipeStarted);this.slickRenderer.onSwipeEnded.subscribe(this,
this.onSwipeEnded);this.slickRenderer.setup()};b.prototype.slideTo=function(a,c){var d=this;logger.info("[Slickjs] slideTo "+a.exerciseId+" jumpType: "+c);if(this.slickRenderer.isSliding()&&(this.slickRenderer.finishCurrentSliding(),c!==JumpType.Lock))this.onTransitionEnded(!1);if(c===JumpType.Lock)return applicationViewModel.setAlertContent(localizedText.Accessibility_SlideLocked()),this.slickRenderer.slideToNextLocked(),$.Deferred().resolve().promise();this.slickRenderer.removeNext();this.hideVideoFlashIe8(a.slideId);
switch(c){case JumpType.Future:case JumpType.Branching:case JumpType.Next:case JumpType.CallToAction:c===JumpType.Branching&&this.slickRenderer.applyFadeEffect();this.slickRenderer.appendSlide(a.slideId);var b=document.getElementById(this.currentSlideId());a.isRendered()&&null!=b&&this.setContent(this.currentSlideId()+"__container",b);requestAnimationFrame(function(){d.slickRenderer.slideToNext()});break;case JumpType.Past:case JumpType.Previous:this.slickRenderer.prependSlide(a.slideId),b=document.getElementById(this.currentSlideId()),
a.isRendered()&&null!=b&&this.setContent(this.currentSlideId()+"__container",b),this.slickRenderer.slideToPrev()}return $.Deferred().resolve().promise()};b.prototype.onTransitionEnded=function(a){void 0===a&&(a=!0);logger.info("[Slickjs] triggerTransitionEndEvent ");this.slickRenderer.removePrevious();this.slickRenderer.removeNext();this.slickRenderer.resetTransitionEffect();a&&this.applicationViewModel.eventManager.triggerTransitionEndEvent(this.applicationViewModel.navigationManager.currentExercise());
this.slickRenderer.addLockedSlide()};b.prototype.hideVideoFlashIe8=function(a){platformFeatures.getIsIE8()&&$(".vjs-tech",$("#"+a)).each(function(c,a){$(a).css("visibility","hidden")})};b.prototype.onSwipeStarted=function(){};b.prototype.onSwipeEnded=function(){};b.prototype.debug=function(){for(var a=[],c=0;c<arguments.length;c++)a[c-0]=arguments[c];a.unshift("SliderViewModel");logger.debug.apply(logger,a)};b.prototype.info=function(){for(var a=[],c=0;c<arguments.length;c++)a[c-0]=arguments[c];a.unshift("SliderViewModel");
logger.info.apply(logger,a)};b.prototype.log=function(){for(var a=[],c=0;c<arguments.length;c++)a[c-0]=arguments[c];a.unshift("SliderViewModel");logger.log.apply(logger,a)};b.prototype.onMouseOver=function(a,c){var d=this;if(!this.isMouseOverButtonsActive){this.timers.setTimeout("mouseover",function(){d.onMouseOverTimeoutCompleted()},2E3);var b=0,b=c.pageX?c.pageX:c.clientX,f=$window.width();if(b<0.2*f||b>f-0.2*f)this.nextButton.soften(!1),this.previousButton.soften(!1)}};b.prototype.onMouseOverTimeoutCompleted=
function(){this.timers.clearTimeout("mouseover");platformFeatures.getAutoHideNavigationButton()&&(this.nextButton.soften(!0),this.previousButton.soften(!0))};b.prototype.onExercisePreloaded=function(a){var c=document.getElementById(a.slideId);null==document.getElementById(a.slideId+"__container")?!1==this.firstCurrentExerciseStarted&&a.slideId==this.currentSlideId()&&(this.firstCurrentExerciseStarted=!0,this.slickRenderer.appendSlide(a.slideId),this.setContent(a.slideId+"__container",c),this.onTransitionEnded(),
this.isRendered(!0)):this.setContent(a.slideId+"__container",c)};return b}(),CkSliderRenderer=function(){function b(a,c,d){var b=this;this.transitionEvent=this.whichTransitionEvent();this.animationEvent=this.whichAnimationEvent();this.swipeDirection=null;this.canSwipeRight=this.canSwipeLeft=!0;this.panstartTriggered=this.panmoveInNextFrame=this.swipeInProgress=!1;this.adapter=d;c&&Modernizr&&Modernizr.touch&&(this.mc=new Hammer(a,{touchAction:"pan-x"}),a=new Hammer.Pan({event:"panv",direction:Hammer.DIRECTION_VERTICAL,
velocity:0,threshold:5}),c=new Hammer.Pan({direction:Hammer.DIRECTION_HORIZONTAL,velocity:0,threshold:5}),d=new Hammer.Swipe({direction:Hammer.DIRECTION_HORIZONTAL}),a.requireFailure(c),d.recognizeWith(c),this.mc.add(d),this.mc.add(a),this.mc.add(c),this.mc.on("panstart",function(c){b.panstartTriggered=!0;b.swipeInProgress||(document.getElementById("nextSlide").classList.add("moving"),document.getElementById("currentSlide").classList.add("moving"),document.getElementById("previousSlide").classList.add("moving"),
b.panStartHandler(c))}),this.mc.on("panmove",function(c){!b.swipeInProgress&&!b.panmoveInNextFrame&&b.panMoveHandler(c)}),this.mc.on("panend",function(c){b.panstartTriggered&&(b.panEndHandler(c),document.getElementById("nextSlide").classList.remove("moving"),document.getElementById("currentSlide").classList.remove("moving"),document.getElementById("previousSlide").classList.remove("moving"),b.panstartTriggered=!1)}),this.mc.on("swipeleft",function(c){b.swipeInProgress||b.swipeLeftHandler(c)}),this.mc.on("swiperight",
function(c){b.swipeInProgress||b.swipeRightHandler(c)}))}b.prototype.slideTo=function(a){this.adapter.swipeStarted();switch(a){case JumpType.Next:this.nextAnimation();break;case JumpType.Previous:this.previousAnimation();break;case JumpType.Branching:this.branchAnimation();break;case JumpType.CallToAction:this.callToActionAnimation();break;case JumpType.Past:this.pastAnimation();break;case JumpType.Future:this.futureAnimation();break;case JumpType.Lock:this.lockAnimation()}a!==JumpType.Lock&&this.resetTranslation()};
b.prototype.bind=function(){null!=this.mc&&(this.mc.get("pan").set({enable:!0}),this.mc.get("swipe").set({enable:!0}))};b.prototype.unbind=function(){null!=this.mc&&(this.mc.get("pan").set({enable:!1}),this.mc.get("swipe").set({enable:!1}))};b.prototype.disableSwipeLeft=function(){this.canSwipeLeft=!1};b.prototype.enableSwipeLeft=function(){this.canSwipeLeft=!0};b.prototype.disableSwipeRight=function(){this.canSwipeRight=!1};b.prototype.enableSwipeRight=function(){this.canSwipeRight=!0};b.prototype.panStartHandler=
function(){this.previousTranslationX=this.getTranslateXValue("previousSlide");this.currentTranslationX=this.getTranslateXValue("currentSlide");this.nextTranslationX=this.getTranslateXValue("nextSlide");this.adapter.swipeStarted()};b.prototype.panMoveHandler=function(a){var c=this,d,b,f,g=33*document.getElementById("lock").offsetWidth/100,h=0<document.getElementById("previousSlide").children.length,i=0<document.getElementById("nextSlide").children.length;!h&&0<a.deltaX||!i&&0>a.deltaX||(!this.adapter.nextIsLocked()||
a.deltaX>-g?(d=this.nextTranslationX+a.deltaX,b=this.currentTranslationX+a.deltaX,f=this.previousTranslationX+a.deltaX):(d=this.nextTranslationX-g,b=this.currentTranslationX-g,f=this.previousTranslationX-g),this.panmoveInNextFrame=!0,requestAnimationFrame(function(){document.getElementById("currentSlide").style.transform="translateX("+b+"px)";document.getElementById("previousSlide").style.transform="translateX("+f+"px)";c.adapter.nextIsLocked()?document.getElementById("lock").style.transform="translateX("+
d+"px)":document.getElementById("nextSlide").style.transform="translateX("+d+"px)";c.panmoveInNextFrame=false}))};b.prototype.panEndHandler=function(){this.resetTranslationWithAnimation();null===this.swipeDirection&&this.adapter.swipeCancelled()};b.prototype.swipeLeftHandler=function(){var a=this;this.canSwipeLeft&&!this.adapter.nextIsLocked()&&(this.swipeDirection=SwipeDirection.Next,this.swipeInProgress=!0,this.nextAnimation(),this.one(this.transitionEvent,function(){null!==a.swipeDirection&&(a.adapter.swipeEnded(a.swipeDirection),
a.swipeDirection=null);a.swipeInProgress=!1;a.adapter.transitionEnded()},"currentSlide"))};b.prototype.swipeRightHandler=function(){var a=this;this.canSwipeRight&&(this.swipeDirection=SwipeDirection.Previous,this.swipeInProgress=!0,this.previousAnimation(),this.one(this.transitionEvent,function(){null!==a.swipeDirection&&(a.adapter.swipeEnded(a.swipeDirection),a.swipeDirection=null);a.swipeInProgress=!1;a.adapter.transitionEnded()},"currentSlide"))};b.prototype.branchAnimation=function(){var a=this;
this.swipeInProgress=!0;this.unbind();var c=document.getElementById("swipe-container"),d=document.getElementById("currentSlide"),b=document.getElementById("previousSlide"),f=document.getElementById("nextSlide"),g=document.getElementById("branchSlide");b.hidden=!0;f.hidden=!0;c.classList.add("playAnimationScale");this.one(this.animationEvent,function(){g.classList.remove("inactive");g.classList.add("playAnimationTop");a.one(a.animationEvent,function(){c.classList.add("reverseAnimationScale");a.one(a.animationEvent,
function(){c.classList.remove("reverseAnimationScale");c.classList.remove("playAnimationScale");g.classList.remove("playAnimationTop");a.clean(b);d.id="previousSlide";g.id="currentSlide";var h=document.createElement("div");h.id="branchSlide";h.classList.add("inactive");document.getElementById("swipe-container").appendChild(h);document.getElementById("nextSlide").style.transform="translateX(100%)";g.style.transform="translateX(0)";d.style.transform="translateX(-100%)";a.adapter.transitionEnded();a.bind();
a.swipeInProgress=!1;f.hidden=!1},"swipe-container")},"branchSlide")},"swipe-container")};b.prototype.nextAnimation=function(){var a=this;this.enableTransition();this.clean(document.getElementById("previousSlide"));document.getElementById("currentSlide").id="previousSlide";document.getElementById("nextSlide").id="currentSlide";var c=document.createElement("div");c.id="nextSlide";document.getElementById("swipe-container").appendChild(c);this.one(this.transitionEvent,function(){a.disableTransition();
null==a.swipeDirection&&a.adapter.transitionEnded()},"currentSlide")};b.prototype.futureAnimation=function(){var a=this;this.enableTransition();this.clean(document.getElementById("previousSlide"));document.getElementById("currentSlide").id="previousSlide";document.getElementById("futureSlide").id="currentSlide";var c=document.createElement("div");c.id="futureSlide";document.getElementById("swipe-container").appendChild(c);this.one(this.transitionEvent,function(){a.disableTransition();a.adapter.transitionEnded()},
"currentSlide")};b.prototype.previousAnimation=function(){var a=this;this.enableTransition();this.clean(document.getElementById("nextSlide"));document.getElementById("currentSlide").id="nextSlide";document.getElementById("previousSlide").id="currentSlide";var c=document.createElement("div");c.id="previousSlide";document.getElementById("swipe-container").appendChild(c);this.one(this.transitionEvent,function(){a.disableTransition();null==a.swipeDirection&&a.adapter.transitionEnded()},"currentSlide")};
b.prototype.pastAnimation=function(){var a=this;this.enableTransition();this.clean(document.getElementById("nextSlide"));document.getElementById("currentSlide").id="nextSlide";document.getElementById("pastSlide").id="currentSlide";var c=document.createElement("div");c.id="pastSlide";document.getElementById("swipe-container").appendChild(c);this.one(this.transitionEvent,function(){a.disableTransition();a.adapter.transitionEnded()},"currentSlide")};b.prototype.callToActionAnimation=function(){var a=
this;this.enableTransition();this.clean(document.getElementById("previousSlide"));document.getElementById("currentSlide").id="previousSlide";document.getElementById("CTASlide").id="currentSlide";var c=document.createElement("div");c.id="CTASlide";document.getElementById("swipe-container").appendChild(c);this.one(this.transitionEvent,function(){a.disableTransition();a.adapter.transitionEnded()},"currentSlide")};b.prototype.lockAnimation=function(){var a=this;this.enableTransition();this.previousTranslationX=
this.getTranslateXValue("previousSlide");this.currentTranslationX=this.getTranslateXValue("currentSlide");this.nextTranslationX=this.getTranslateXValue("nextSlide");var c=Math.floor(33*document.getElementById("lock").offsetWidth/100),d=this.nextTranslationX-c,b=this.currentTranslationX-c,c=this.previousTranslationX-c;document.getElementById("currentSlide").style.transform="translateX("+b+"px)";document.getElementById("previousSlide").style.transform="translateX("+c+"px)";document.getElementById("lock").style.transform=
"translateX("+d+"px)";this.one(this.transitionEvent,function(){a.resetTranslationWithAnimation(!0)},"currentSlide")};b.prototype.resetTranslationWithAnimation=function(a){var c=this;void 0===a&&(a=!1);this.enableTransition();requestAnimationFrame(function(){document.getElementById("nextSlide").style.transform="translateX(100%)";document.getElementById("lock").style.transform="translateX(100%)";document.getElementById("currentSlide").style.transform="translateX(0)";document.getElementById("previousSlide").style.transform=
"translateX(-100%)";c.one(c.transitionEvent,function(){c.disableTransition();a&&c.adapter.swipeCancelled()},"currentSlide")})};b.prototype.resetTranslation=function(){document.getElementById("nextSlide").style.transform="translateX(100%)";document.getElementById("lock").style.transform="translateX(100%)";document.getElementById("currentSlide").style.transform="translateX(0)";document.getElementById("previousSlide").style.transform="translateX(-100%)"};b.prototype.getTranslateXValue=function(a){a=
getComputedStyle(document.getElementById(a)).transform.replace(/[^0-9\-.,]/g,"").split(",");return parseInt(a[4])};b.prototype.whichAnimationEvent=function(){var a,c=document.createElement("fakeelement"),d={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(a in d)if(void 0!==c.style[a])return d[a]};b.prototype.whichTransitionEvent=function(){var a,c=document.createElement("fakeelement"),d={transition:"transitionend",OTransition:"oTransitionEnd",
MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(a in d)if(void 0!==c.style[a])return d[a]};b.prototype.enableTransition=function(){var a=document.getElementById("previousSlide");null!=a&&a.classList.add("transitionTransform");a=document.getElementById("currentSlide");null!=a&&a.classList.add("transitionTransform");a=document.getElementById("nextSlide");null!=a&&a.classList.add("transitionTransform");a=document.getElementById("lock");null!=a&&a.classList.add("transitionTransform");
a=document.getElementById("CTASlide");null!=a&&a.classList.add("transitionTransform");a=document.getElementById("pastSlide");null!=a&&a.classList.add("transitionTransform");a=document.getElementById("futureSlide");null!=a&&a.classList.add("transitionTransform")};b.prototype.disableTransition=function(){var a=document.getElementById("previousSlide");null!=a&&a.classList.remove("transitionTransform");a=document.getElementById("currentSlide");null!=a&&a.classList.remove("transitionTransform");a=document.getElementById("nextSlide");
null!=a&&a.classList.remove("transitionTransform");a=document.getElementById("lock");null!=a&&a.classList.remove("transitionTransform");a=document.getElementById("CTASlide");null!=a&&a.classList.remove("transitionTransform");a=document.getElementById("pastSlide");null!=a&&a.classList.remove("transitionTransform");a=document.getElementById("futureSlide");null!=a&&a.classList.remove("transitionTransform")};b.prototype.clean=function(a){a.hasChildNodes()&&this.adapter.setContent(a.attributes.id.value,
null);a.parentElement.removeChild(a)};b.prototype.one=function(a,c,d){var b=function(f){f.target&&f.target.id==d&&(c(f),window.removeEventListener(a,b))};window.addEventListener(a,b)};return b}(),CKSlider=function(){function b(a){var c=this;this.contentDeactivated=ko.observable(!1);this.firstCurrentExerciseStarted=!1;this.computeNavigationEnabled=function(){if(c.applicationViewModel.navigationManager.canLeaveCurrentExercise())return c.hammerRenderer&&c.hammerRenderer.bind(),!0;c.hammerRenderer&&c.hammerRenderer.unbind();
return!1};this.computeCurrentSlideId=function(){return null!=c.applicationViewModel.navigationManager.currentExercise()?c.applicationViewModel.navigationManager.currentExercise().slideId:null};this.computeNextSlideId=function(){return null!=c.applicationViewModel.navigationManager.nextExercise()?c.applicationViewModel.navigationManager.nextExercise().slideId:null};this.computePreviousSlideId=function(){return null!=c.applicationViewModel.navigationManager.previousExercise()?c.applicationViewModel.navigationManager.previousExercise().slideId:
null};this.isMouseOverButtonsActive=!1;this.isRendered=ko.observable(!1);this.computeNextButtonVisible=function(){return null==c.applicationViewModel?!1:c.applicationViewModel.navigationManager.canGoToNextExercise()&&c.navigationEnabled()};this.computeNextIsLocked=function(){return null!=c.applicationViewModel.navigationManager.nextExercise()&&c.applicationViewModel.navigationManager.nextExercise().isLocked()};this.computePreviousButtonVisible=function(){return null!=c.applicationViewModel.navigationManager.previousExercise()&&
c.navigationEnabled()};this.computeNextButtonActive=function(){return!c.applicationViewModel.platformFeatures.getIsSwipeEnabled()};this.computePreviousButtonActive=function(){return!c.applicationViewModel.platformFeatures.getIsSwipeEnabled()};this.swipeToNextAllowed=function(a){c.hammerRenderer&&(null==a?c.hammerRenderer.disableSwipeLeft():c.hammerRenderer.enableSwipeLeft())};this.swipeToPreviousAllowed=function(a){c.hammerRenderer&&(null==a?c.hammerRenderer.disableSwipeRight():c.hammerRenderer.enableSwipeRight())};
this.transitionEnded=function(){c.applicationViewModel.eventManager.triggerTransitionEndEvent(c.applicationViewModel.navigationManager.currentExercise());var a=document.getElementById(c.currentSlideId());null!=a&&((c.setContent("currentSlide",a),c.nextSlideId()?(a=document.getElementById(c.nextSlideId()),null!=a&&"nextSlide"!=a.parentElement.id&&c.applicationViewModel.navigationManager.nextExercise().isRendered()&&c.setContent("nextSlide",a)):c.setContent("nextSlide",null),c.previousSlideId())?(a=
document.getElementById(c.previousSlideId()),null!=a&&"previousSlide"!=a.parentNode.attributes.id.value&&c.applicationViewModel.navigationManager.previousExercise().isRendered()&&c.setContent("previousSlide",a)):c.setContent("previousSlide",null))};this.swipeStarted=function(){c.applicationViewModel.eventManager.triggerSwipeStartEvent()};this.swipeCancelled=function(){c.applicationViewModel.eventManager.triggerSwipeCancelEvent()};this.swipeEnded=function(a){c.applicationViewModel.eventManager.triggerSwipeEndEvent(a)};
this.setContent=function(a,b,f){void 0===f&&(f=!0);var g=document.getElementById(a);if(g.hasChildNodes()){var h=g.children[0];if(h==b)return;f&&"currentSlide"!=a&&h.attributes.id.value==c.currentSlideId()?c.setContent("currentSlide",h,!1):f&&"nextSlide"!=a&&h.attributes.id.value==c.nextSlideId()?c.setContent("nextSlide",h,!1):f&&"previousSlide"!=a&&h.attributes.id.value==c.previousSlideId()?c.setContent("previousSlide",h,!1):document.getElementById("preload").appendChild(h)}null!=b&&g.appendChild(b)};
this.applicationViewModel=a;this.sliderTemplateName="CKSliderTemplate";this.navigationEnabled=ko.computed(this.computeNavigationEnabled);this.nextButtonVisible=ko.computed(this.computeNextButtonVisible);this.previousButtonVisible=ko.computed(this.computePreviousButtonVisible);this.nextButtonActive=ko.computed(this.computeNextButtonActive);this.previousButtonActive=ko.computed(this.computePreviousButtonActive);this.nextIsLocked=ko.computed(this.computeNextIsLocked);this.currentSlideId=ko.computed(this.computeCurrentSlideId);
this.nextSlideId=ko.computed(this.computeNextSlideId);this.previousSlideId=ko.computed(this.computePreviousSlideId);this.previousButton=new SliderButtonViewModel(this.previousButtonActive,this.previousButtonVisible,this.applicationViewModel.navigationManager.followPreviousLink.bind(this.applicationViewModel.navigationManager));this.nextButton=new SliderButtonViewModel(this.nextButtonActive,this.nextButtonVisible,this.applicationViewModel.navigationManager.followNextLink.bind(this.applicationViewModel.navigationManager));
this.applicationViewModel.eventManager.addExercisePreloadListener(this);a.navigationManager.nextExercise.subscribe(this.swipeToNextAllowed);a.navigationManager.previousExercise.subscribe(this.swipeToPreviousAllowed)}b.prototype.loadSlider=function(){this.hammerRenderer=new CkSliderRenderer(document.getElementById("swipe-container"),this.applicationViewModel.platformFeatures.getIsSwipeEnabled(),this);this.swipeToNextAllowed(applicationViewModel.navigationManager.nextExercise());this.swipeToPreviousAllowed(applicationViewModel.navigationManager.previousExercise())};
b.prototype.slideTo=function(a,c){var d=document.getElementById(a.slideId);if(null!=d){switch(c){case JumpType.Branching:this.setContent("branchSlide",d);break;case JumpType.CallToAction:this.setContent("CTASlide",d);break;case JumpType.Future:this.setContent("futureSlide",d);break;case JumpType.Lock:this.applicationViewModel.setAlertContent(localizedText.Accessibility_SlideLocked());break;case JumpType.Past:this.setContent("pastSlide",d)}this.hammerRenderer.slideTo(c)}};b.prototype.onMouseOver=function(a,
c){var d=this;if(!this.isMouseOverButtonsActive){setTimeout(function(){d.onMouseOverTimeoutCompleted()},2E3);var b=void 0,b=c.pageX?c.pageX:c.clientX,f=$window.width();if(b<0.2*f||b>f-0.2*f)this.nextButton.soften(!1),this.previousButton.soften(!1)}};b.prototype.onMouseOverTimeoutCompleted=function(){platformFeatures.getAutoHideNavigationButton()&&(this.nextButton.soften(!0),this.previousButton.soften(!0))};b.prototype.onExercisePreloaded=function(a){var c=document.getElementById(a.slideId);null!=
c&&(a.slideId==this.currentSlideId()?(this.setContent("currentSlide",c),!1==this.firstCurrentExerciseStarted&&(this.firstCurrentExerciseStarted=!0,this.transitionEnded())):a.slideId==this.nextSlideId()?this.setContent("nextSlide",c):a.slideId==this.previousSlideId()&&this.setContent("previousSlide",c))};return b}(),SliderViewModelFactory=function(){function b(a){this.applicationViewModel=a}b.prototype.getSliderViewModel=function(){var a=platformFeatures.getSliderName(),c=this.applicationViewModel.ajaxLoader.getUrlParameterValue("slider");
null!=c&&(a=c);return"slickjs"===a?new SlickViewModel(this.applicationViewModel):"ckslider"===a?new CKSlider(this.applicationViewModel):null};return b}(),TooltipManager=function(){function b(a){this.glossary=ko.observableArray();this.tooltips=[];this.applicationViewModel=a}b.prototype.addTooltip=function(a){for(var c=!0,b=0;b<this.tooltips.length;b++)if(this.tooltips[b].id===a.id){c=!1;break}c&&this.tooltips.push(a)};b.prototype.showTooltip=function(a){for(var c=this,b=0;b<this.tooltips.length;b++)if(this.tooltips[b].id===
a){this.applicationViewModel.navigationManager.currentExercise().swipeStarted();this.applicationViewModel.navigationManager.canLeaveCurrentExercise(!1);this.applicationViewModel.navigationManager.currentExercise().contentViewModel().tooltipViewModel(this.tooltips[b]);this.applicationViewModel.navigationManager.currentExercise().contentViewModel().tooltipOverlayVisible(!0);setTimeout(function(){c.applicationViewModel.navigationManager.currentExercise().contentViewModel().tooltipOverlayFadeIn(!0)},
0);break}};b.prototype.hideTooltip=function(){var a=this;this.applicationViewModel.navigationManager.currentExercise().contentViewModel().tooltipOverlayFadeIn(!1);setTimeout(function(){a.applicationViewModel.navigationManager.currentExercise().contentViewModel().tooltipOverlayVisible(!1)},500);this.applicationViewModel.navigationManager.currentExercise().contentViewModel().feedbackVisible()||(this.applicationViewModel.navigationManager.canLeaveCurrentExercise(!0),this.applicationViewModel.navigationManager.currentExercise().swipeCancelled())};
b.prototype.onTransitionEnded=function(a){this.glossary([]);for(var c=0;c<this.tooltips.length;c++)this.tooltips[c].exerciseId==a.exerciseId&&this.glossary.push(this.tooltips[c]);this.glossary.sort(function(c,a){return c.text.localeCompare(a.text)});this.glossary(this.glossary())};return b}(),ApplicationViewModel=function(){function b(a,c,b){var e=this;this.isRTL=!1;this.platform=Platform.Tablet;this.courseName=ko.observable("");this.courseDescription=ko.observable("");this.fontSize=ko.observable(0);
this.width=ko.observable(0);this.height=ko.observable(0);this.menuTabindex=ko.observable(-1);this.isDesktopMode=ko.observable(!1);this.timers=new Timers;this.computeModuleIsReady=function(){return e.sliderViewModel.isRendered()&&SkinManager.getInstance().isSkinLoaded()};this.course=ko.observable();this.ajaxLoader=a;this.scorm=c;this.platformFeatures=b;this.interactionManager=new InteractionManager(mohiveScorm);this.uiManager=new UIManager(this,this.platformFeatures);this.eventManager=new EventManager;
this.runtimeExternalAPI=new RuntimeExternalAPI(this);this.navigationManager=new NavigationManager(this);this.keyboardManager=new KeyboardManager(this);this.tooltipManager=new TooltipManager(this);this.modalBoxViewModel=new ModalBoxViewModel(this);this.progressbarViewModel=new ProgressbarViewModel(this);this.timelineViewModel=new TimelineViewModel(this);this.transcriptViewModel=new TranscriptViewModel(this);this.accessibilityViewModel=new AccessibilityViewModel(this);this.eventManager.addTransitionEndListener(this);
this.eventManager.addExerciseCompleteListener(this);this.eventManager.addTransitionEndListener(this.tooltipManager);this.sliderViewModel=(new SliderViewModelFactory(this)).getSliderViewModel();this.moduleIsReady=ko.computed(this.computeModuleIsReady)}b.prototype.getIsRTLDirection=function(){return this.isRTL};b.prototype.onLoad=function(){this.navigationManager.currentExercise()&&this.navigationManager.currentExercise().start()};b.prototype.onUnload=function(){this.scorm&&this.scorm.finish&&"function"==
typeof this.scorm.finish&&this.scorm.finish();this.navigationManager.currentExercise()&&this.navigationManager.currentExercise().stop()};b.prototype.bindDimensions=function(a,c){logger.debug("applicationViewModel.bindDimensions",a,c);this.width(a);this.height(c);this.fontSize(platformFeatures.getFontSize(a,c))};b.prototype.loadExercises=function(){logger.info("LoadExercises");null!=uiManager.screenshotMode&&uiManager.screenshotMode!==EnumScreenshotMode.Test?this.ajaxLoader.loadExercises(this,this.ajaxLoader.getUrlParameterValue("gotoExercise",
null)):this.ajaxLoader.loadExercises(this)};b.prototype.template=function(a){return null!=a&&null!=a.Template?a.Template():"NotFoundTemplate"};b.prototype.onTransitionEnded=function(a){this.debug("onTransitionEnded",a.exerciseId);this.scormReport()};b.prototype.onExerciseCompleted=function(a){this.debug("onExerciseCompleted",a.exerciseId);this.scormReport()};b.prototype.setAlertContent=function(a){this.accessibilityViewModel.setAlertContent(a)};b.prototype.scormReport=function(){if(this.scorm){for(var a=
[],c=0;c<this.navigationManager.historyExercises().length;c++)a.push(this.navigationManager.historyExercises()[c].exerciseId);this.scorm.setHistory(a);a=[];for(c=0;c<this.navigationManager.predictableFutureExercises().length;c++)a.push(this.navigationManager.predictableFutureExercises()[c].exerciseId);this.scorm.setFuture(a);this.scorm.setCountDowns(this.interactionManager.getSerializedCountDowns());c=this.navigationManager.currentExercise();a=this.progressbarViewModel.percentage();c&&this.scorm.suspendCourse(c.exerciseId,
a);this.navigationManager.isLast()&&this.course()&&(this.scorm.trackingEnabled&&this.course().isAssessment()&&"1.2"===LMS.SCORMversion&&!this.scorm.getPostCompletionIfSuccess()&&this.scorm.setScore(0,this.interactionManager.getNumberOfInteraction(),this.interactionManager.getNumberOfCorrectInteraction(),this.interactionManager.getScore(),this.interactionManager.getSuccessStatus()),(!this.course().isAssessment()||!this.scorm.getPostCompletionIfSuccess()||this.scorm.getPostCompletionIfSuccess()&&this.interactionManager.getIsAssessmentPassed())&&
this.scorm.courseCompleted())}};b.prototype.onLoadExercisesCompleted=function(a,c){if(null==c){logger.info("applicationViewModel.onLoadExercisesCompleted Completed");this.onCourseJSONReceived(a);if(userCulture=this.course().culture)$html.attr("lang",userCulture.split("-")[0]),void 0!=userCulture.split("-")[0]&&("ar"==userCulture.split("-")[0]||"fa"==userCulture.split("-")[0]||"he"==userCulture.split("-")[0])?($html.attr("mohivedirection","RTL"),this.isRTL=!0):($html.attr("mohivedirection","LTR"),
this.isRTL=!1);var b=this.navigationManager.currentExercise(),b=b&&b!=this.navigationManager.historyExercises()[0]&&this.platformFeatures.getShowOverlayAtStartup();!1==b&&(platformFeatures.getIsDesktopMode()||platformFeatures.getIsDeviceForced())&&this.modalBoxViewModel.displayOverlay(b);b&&this.modalBoxViewModel.displayOverlay(b);localizedText.initialize(a.localizedText);this.courseName(this.ajaxLoader.isDemoModule()?"Mohive":a.coursename);this.courseDescription(a.coursedescription);this.accessibilityViewModel.setAccessibilityEnabledOnModule(a.accessibilityEnabled);
this.transcriptViewModel.checkTranscriptActivated();null==uiManager.screenshotMode&&uiManager.dotify();setTimeout(function(){uiManager.bindEvents()})}};b.prototype.koGetMediaTemplateName=function(a){if(null!=a){if(a.template)return a.template();if(a().template)return a().template()}return"EmptyMediaTemplate"};b.prototype.onCourseJSONReceived=function(a){SkinManager.getInstance().init(a);this.course(new Course(a));this.interactionManager.initialize(this.course());this.eventManager.triggerCourseLoadEvent(this.course());
logger.info("Number of exercises : "+this.navigationManager.allExercises().length)};b.prototype.createScrollbarManager=function(a,c){var b=this;return new ScrollbarManager(a.getDom,this.platformFeatures,c,function(c,a){for(var g=[],h=2;h<arguments.length;h++)g[h-2]=arguments[h];h=["["+b.navigationManager.currentExercise().templateName+"]("+b.navigationManager.currentExercise().slideId+")["+a+"]: "];h.concat(g);logger[c].apply(logger,h)})};b.prototype.debug=function(){for(var a=[],c=0;c<arguments.length;c++)a[c-
0]=arguments[c];a.unshift("SliderViewModel");logger.debug.apply(logger,a)};b.prototype.info=function(){for(var a=[],c=0;c<arguments.length;c++)a[c-0]=arguments[c];a.unshift("SliderViewModel");logger.info.apply(logger,a)};b.prototype.log=function(){for(var a=[],c=0;c<arguments.length;c++)a[c-0]=arguments[c];a.unshift("SliderViewModel");logger.log.apply(logger,a)};return b}(),AnimationType={Fade:"fade",Wipe:"wipe",Zoom:"zoom",Normal:"normal",Blinds:"blinds",Fly:"fly",Parse:function(b){switch(b){case AnimationType.Fade:case AnimationType.Normal:case AnimationType.Fly:return b;
default:return AnimationType.Fade}}},Platform={Tablet:"tablet",Desktop:"desktop"},Size=function(){return function(b,a){this.width=b;this.height=a}}(),KeyboardManager=function(){function b(a){this.applicationViewModel=a;this.activateKeyup()}b.prototype.deactivateKeyup=function(){$document.unbind("keyup")};b.prototype.activateKeyup=function(){var a=this;$document.unbind("keyup").bind("keyup",function(c){a.onKeyUp(c.keyCode);platformFeatures.getIsIE9()&&$window.focus()})};b.prototype.onKeyUp=function(a){switch(a){case 37:this.applicationViewModel.navigationManager.followPreviousLink();
break;case 39:this.applicationViewModel.navigationManager.canGoToNextExercise()&&this.applicationViewModel.navigationManager.followNextLink();break;case 27:this.applicationViewModel.timelineViewModel.friezeVisible()?this.applicationViewModel.timelineViewModel.hideTimeline():this.applicationViewModel.navigationManager.currentExercise().contentViewModel().feedback.onCloseClick();break;case 32:$(document.activeElement).trigger("click");break;case 36:this.applicationViewModel.accessibilityEnabled()&&
this.applicationViewModel.navigationManager.currentExercise().focusFirstTabIndexElement()}this.previousKeyCode=a};return b}(),UIManager=function(){function b(a,c){this.screenshotMode=null;this.isMouseOverButtonsActive=this.swipeInitialized=!1;this.htmlSkinPath="";this.timers=new Timers;this.audioPlayerRestrictionsRemoved=!1;this.mouseOverTimer=null;this.applicationViewModel=a;this.platformFeatures=c;this.screenshotMode=EnumScreenshotModeHelper.parseEnumScreenshotMode(this.applicationViewModel.ajaxLoader.getUrlParameterValue("thumbnail"));
this.manageCss()}b.prototype.initializeDom=function(){this.tablecontent=$("#tablecontent");this.tablecontent.show();this.buttonNext=$("#buttonnext");this.tdNext=$("#next");this.tdContent=$("#tdcontent");this.tdPrevious=$("#previous");this.buttonPrevious=$("#buttonprevious");this.audioPlayer=$("#audio-player");this.initializePlatformClass();this.initializeThumbnailMode()};b.prototype.isPreviewMode=function(){return null==this.applicationViewModel.ajaxLoader.runtimeMode?!1:this.applicationViewModel.ajaxLoader.runtimeMode==
EnumRuntimeMode.DRAFT};b.prototype.isScreenshotMode=function(){return null!=this.screenshotMode};b.prototype.initializeThumbnailMode=function(){this.screenshotMode===EnumScreenshotMode.Exercise&&($html.addClass("thumbnail"),$body.addClass("thumbnail-mode"))};b.prototype.bindEvents=function(){var a=this;$window.bind("resize",function(){a.onWindowResize()});$window.bind("pagehide",function(){a.applicationViewModel.onUnload()});$window.bind("beforeunload",function(){$window.unbind("pagehide pageshow");
a.applicationViewModel.onUnload()})};b.prototype.isAudioRestrictionRemoved=function(){return this.audioPlayerRestrictionsRemoved};b.prototype.getIsPhonePortrait=function(){return this.platformFeatures.getIsPhone()&&window.innerHeight>window.innerWidth?!0:!1};b.prototype.onWindowResize=function(){var a=this;this.debug("requesting window resizing");this.timers.setTimeout("window-resizing",function(){if($window.height()!=windowHeight||$window.width()!=windowWidth){a.setWindowSize();a.computeAndBindDimensions();
var c=a.applicationViewModel.width(),b=a.applicationViewModel.height();a.applicationViewModel.eventManager.triggerResizeEvent(c,b)}},100)};b.prototype.setWindowSize=function(){windowHeight=$window.height();windowWidth=$window.width()};b.prototype.initializePlatformClass=function(){var a="";this.applicationViewModel.ajaxLoader.getRuntimeMode()==EnumRuntimeMode.DRAFT&&(a+="draft ");this.platformFeatures.getIsIE()&&(this.platformFeatures.getIsIE678()?a+="ie ie8 lt-ie9 lt-ie10 ":this.platformFeatures.getIsIE9()?
a+="ie ie9 lt-ie10 ":this.platformFeatures.getIsIE10()?a+="ie ie10 ":this.platformFeatures.getIsIE11()?a+="ie ie11 ":this.platformFeatures.getIsEdge()&&(a+="ie ieEdge "),this.platformFeatures.getIsWin8Touch()&&(a+="ie win8touch "));this.platformFeatures.isFirefox&&(a+="firefox ");this.platformFeatures.isWebKit&&(a+="webkit ");this.platformFeatures.getIsIPad()&&(a+="ipad tablet ios ");this.platformFeatures.getIsPhone()&&(a+="phone ");this.platformFeatures.getIsIPhone()&&(a+="iphone ios ");this.platformFeatures.getIsAndroid()&&
(a+="android ",this.platformFeatures.getIsPhone()||(a+="tablet "));this.platformFeatures.getIsMobileDevice()&&(a+="mobile ");this.platformFeatures.getIsDesktopMode()&&(a+="desktop ");this.platformFeatures.getIsWindowsPhone()&&(a+="ie windowsphone phone ");this.platformFeatures.getIsHudl()&&(a+="hudl ");this.platformFeatures.getIsChrome()&&!this.platformFeatures.getIsIE()&&(a+="chrome ");$html.addClass(a)};b.prototype.dotify=function(){platformFeatures.getIsIPad()||this.timers.setTimeout("dotify",
function(){$(".timelineGroupTitle").dotdotdot();$(".frieze__exercise__label").dotdotdot()},5E3)};b.prototype.computeDimensions=function(){var a=0,c=0;platformFeatures.getIsMobileDevice()&&($body.css("height",windowHeight),$html.css("height",windowHeight));platformFeatures.innerWidth(window.innerWidth);platformFeatures.innerHeight(window.innerHeight);c=windowHeight-0-$(".progressbar").outerHeight(!0);a=windowWidth;logger.info("adjust: width="+a+", height="+c);return{width:a,height:c}};b.prototype.computeAndBindDimensions=
function(){var a=this.computeDimensions();0<a.width&&0<a.height&&this.applicationViewModel.bindDimensions(a.width,a.height);this.platformFeatures.getIsDesktopMode()&&0!==document.documentElement.scrollTop&&window.scrollTo(0,0);this.tablecontent.addClass("tablecontent--ready")};b.prototype.getOrientation=function(){return this.applicationViewModel.width()>this.applicationViewModel.height()?Orientation.Landscape:Orientation.Portrait};b.prototype.manageCss=function(){this.addCssFile(this.platformFeatures.getCss());
this.screenshotMode===EnumScreenshotMode.Exercise&&this.addCssFile("css/thumb.css");this.screenshotMode===EnumScreenshotMode.Test&&this.addCssFile("css/visualTesting.css");this.screenshotMode===EnumScreenshotMode.Test&&this.addCssFile("css/visualTesting.css");var a=this.applicationViewModel.ajaxLoader.getUrlParameterValue("css");a&&this.addCssFile(a)};b.prototype.applySkinCss=function(a){this.htmlSkinPath=a;""!=this.htmlSkinPath&&this.addCssFile(this.htmlSkinPath+"/runtime/style.css")};b.prototype.removeAudioUserTouchRestrictions=
function(){this.audioPlayerRestrictionsRemoved||(this.audioPlayer.load(),this.audioPlayerRestrictionsRemoved=!0)};b.prototype.addCssFile=function(a){document.createStyleSheet?document.createStyleSheet(a):$("head").append('<link rel="stylesheet" href="'+a+'" type="text/css" />')};b.prototype.debug=function(){for(var a=[],c=0;c<arguments.length;c++)a[c-0]=arguments[c];a.unshift("SliderRenderer");logger.debug.apply(logger,a)};b.prototype.info=function(){for(var a=[],c=0;c<arguments.length;c++)a[c-0]=
arguments[c];a.unshift("SliderRenderer");logger.info.apply(logger,a)};b.prototype.log=function(){for(var a=[],c=0;c<arguments.length;c++)a[c-0]=arguments[c];a.unshift("SliderRenderer");logger.log.apply(logger,a)};b.prototype.stopPropagation=function(a){a||(a=window.event);a.cancelBubble=!0;a.stopPropagation&&a.stopPropagation()};return b}(),Orientation;(function(b){b[b.Landscape=0]="Landscape";b[b.Portrait=1]="Portrait"})(Orientation||(Orientation={}));
var AudioPlayerBase=function(){function b(){this.audioSrc=""}b.prototype.src=function(a){null!=a&&(this.audioSrc=a,this.playerSrc(a));return this.audioSrc};b.prototype.play=function(){null!=this.audioSrc&&""!=this.audioSrc&&this.playerPlay()};b.prototype.pause=function(){this.playerPause()};b.prototype.stop=function(){this.playerStop()};b.prototype.raiseCanPlayEvent=function(){if(this.onCanPlayCallback)this.onCanPlayCallback()};b.prototype.raiseEndedEvent=function(){this.onEndedCallback&&(this.timerOnEnded=
setTimeout($.proxy(this.onEndedCallback,this),0))};b.prototype.onCanPlay=function(a){this.onCanPlayCallback=a};b.prototype.onEnded=function(a){this.onEndedCallback=a};b.prototype.cleanup=function(){try{clearTimeout(this.timerOnEnded),this.stop(),this.onEndedCallback=this.onCanPlayCallback=null}catch(a){logger.error("AudioPlayerBase.cleanup error : "+a)}};b.prototype.getCurrentTime=function(){throw"Not implemented";};b.prototype.setCurrentTime=function(){throw"Not implemented";};b.prototype.getDuration=
function(){throw"Not implemented";};b.prototype.playerSrc=function(){throw"Not implemented";};b.prototype.playerPlay=function(){throw"Not implemented";};b.prototype.playerPause=function(){throw"Not implemented";};b.prototype.playerStop=function(){throw"Not implemented";};b.prototype.isPlaying=function(){throw"Not implemented";};b.prototype.mute=function(){throw"Not implemented";};b.prototype.unmute=function(){throw"Not implemented";};return b}(),Html5AudioPlayer=function(b){function a(){var c=this;
b.call(this);this.mustStop=this.canPlay=this.ended=!1;this.player=document.getElementById("audio-player");this.player.addEventListener("canplaythrough",function(){c.canplaythroughListener()},!1);this.player.addEventListener("ended",function(a){c.endedListener(a)},!1);this.player.addEventListener("pause",function(a){c.pauseListener(a)},!1)}__extends(a,b);a.prototype.pauseListener=function(c){this.log("info","paused handler","checking");this.ended?this.log("info","ended handler","marked as ended, not executing"):
(this.log("info","paused handler","executing"),this.onSoundEnded(c))};a.prototype.endedListener=function(c){this.log("info","ended handler","checking");this.ended?this.log("info","ended handler","marked as ended, not executing"):(this.log("info","ended handler","executing"),this.onSoundEnded(c))};a.prototype.canplaythroughListener=function(){this.log("debug","canplaythrough handler","executing");this.mustStop&&(this.log("debug","canplaythrough","forcingLoad = true, mustStop = true => NOT playing"),
this.player.pause(),this.mustStop=!1);this.raiseCanPlayEvent()};a.prototype.playerSrc=function(c){this.log("info","playerSrc","setting src : "+c);null!=c&&this.player&&(platformFeatures.getIsIPad()&&(this.player.pause(),this.player.setAttribute("src",""),this.player.load()),this.player.setAttribute("src",c))};a.prototype.playerPlay=function(){var c=this;this.log("info","playerPlay","requesting playing : checking");this.mustStop=!1;if(void 0!=this.player.src&&""!=this.player.src){if(this.log("info",
"playerPlay","requesting playing : executing"),this.ended=!1,platformFeatures.getIsIPad()?setTimeout(function(){c.player.play()},100):this.player.play(),platformFeatures.getIsMobileDevice()&&!uiManager.isAudioRestrictionRemoved())this.onSoundEnded(jQuery.Event("ended",{type:"ended"}))}else this.log("info","playerPlay","requesting playing : no source has been set : not requesting playing")};a.prototype.playerPause=function(){this.log("info","playerPause","requesting pause");this.player.pause()};a.prototype.playerStop=
function(){this.log("info","playerStop","requesting stop");this.mustStop=!0;if(void 0!=this.player.src&&""!=this.player.src&&this.isPlaying())try{0!=this.player.currentTime&&(this.player.pause(),this.player.currentTime=0),this.ended=!1,this.player.pause()}catch(c){this.log("error","playerStop","Error on audioPlayer stop"+c)}};a.prototype.isPlaying=function(){return!this.player.paused};a.prototype.onSoundEnded=function(c){var a=!1;"ended"==c.type?a=!0:!this.ended&&this.player.duration==this.player.currentTime&&
(a=!0);a&&(this.log("debug","onSoundEnded","ended"),this.ended=!0,this.raiseEndedEvent())};a.prototype.hasBeenPlayed=function(){return this.ended};a.prototype.cleanup=function(){var c=this;b.prototype.cleanup.call(this);this.player.removeEventListener("canplaythrough",function(){c.canplaythroughListener()},!1);this.player.removeEventListener("pause",function(a){c.pauseListener(a)},!1);this.player.removeEventListener("ended",function(a){c.endedListener(a)},!1)};a.prototype.log=function(c,a,b){logger[c]("[Html5AudioPlayer] "+
this.player.src+" ["+a+"] "+b)};a.prototype.getCurrentTime=function(){return this.player.currentTime};a.prototype.setCurrentTime=function(c){this.player.currentTime=c};a.prototype.getDuration=function(){return this.player.duration};a.prototype.mute=function(){this.player.muted=!0};a.prototype.unmute=function(){this.player.muted=!1};return a}(AudioPlayerBase),AudioPlayerFactory=function(){function b(){}b.createAudioPlayer=function(){return new Html5AudioPlayer};return b}(),ExerciseCompletionState=
function(){function b(){this.successStatus=this.completionStatus=this.exerciseId=0}b.prototype.loadData=function(a){a=a.split(RegExp("[:|]","g"));3==a.length&&(this.exerciseId=a[0],this.completionStatus=a[1],this.successStatus=a[2])};return b}(),CompletionState=function(){function b(){this.CompletionStatus={incomplete:1,completed:2};this.SuccesStatus={unknown:1,passed:2,failed:3};this.states=[]}b.prototype.loadData=function(a){this.states=[];if(!StringHelper.isNullOrEmpty(a))for(var a=a.split(","),
c=0,b=a.length;c<b;c++){var e=new ExerciseCompletionState;e.loadData(a[c]);0!=e.exerciseId&&this.states.push(e)}};b.prototype.serializeData=function(){for(var a="",c=0,b=this.states.length;c<b;c++){var e=this.states[c],a=a+(e.exerciseId+":"),a=a+(e.completionStatus+"|"),a=a+e.successStatus;c<this.states.length-1&&(a+=",")}return a};b.prototype.exerciseStarted=function(a){for(var c=0,b=this.states.length;c<b;c++){var e=this.states[c];if(e.exerciseId==a)return}e=new ExerciseCompletionState;e.exerciseId=
a;e.completionStatus=this.CompletionStatus.incomplete;e.successStatus=this.SuccesStatus.unknown;this.states.push(e)};b.prototype.exerciseCompleted=function(a){for(var c=0,b=this.states.length;c<b;c++){var e=this.states[c];if(e.exerciseId==a){e.completionStatus=this.CompletionStatus.completed;return}}e=new ExerciseCompletionState;e.exerciseId=a;e.completionStatus=this.CompletionStatus.completed;e.successStatus=this.SuccesStatus.unknown;this.states.push(e)};b.prototype.deleteCompletionState=function(a){for(var c=
[],b=0,e=this.states.length;b<e;b++){var f=this.states[b];f.exerciseId!=a&&c.push(f)}this.states=c};return b}(),ScormApiBase=function(){function b(a){this.trackingEnabled=!1;this.noApiScormFoundMessage="This module requires a SCORM compliant LMS (Learning Management System) to run properly. \nNo such LMS was found.\nPlease contact your system administrator. ";this.forceSCORMversion="";this.history=[];this.future=[];this.countDowns=[];this.postCompletionIfSuccess=this.numberOfAttempts=this.certificateTS=
null;null!=a&&(this.trackingEnabled=a);this.trackingEnabled&&(this.completionState=new CompletionState,this.chapterShuffled=new ChapterShuffled)}b.prototype.displayErrorMessage=function(a){if(this.trackingEnabled)throw alert(a),Error(a);};b.prototype.finish=function(){this.trackingEnabled&&this.finishAbstract()};b.prototype.finishAbstract=function(){throw"Not implemented.";};b.prototype.resetModuleData=function(){this.setHistory([]);this.setFuture([]);this.setCompletionState([]);this.setCountDowns([]);
this.chapterShuffled=new ChapterShuffled;var a=getSuspendData(),a=ScormHelper.addOrUpdateSuspendData(a,this.getHistorySerializedData(),EnumSuspendData.History),a=ScormHelper.addOrUpdateSuspendData(a,this.getFutureSerializedData(),EnumSuspendData.Future),a=ScormHelper.addOrUpdateSuspendData(a,this.completionState.serializeData(),EnumSuspendData.CompletionState),a=ScormHelper.addOrUpdateSuspendData(a,this.chapterShuffled.serializeData(),EnumSuspendData.ChapterShuffled),a=ScormHelper.addOrUpdateSuspendData(a,
this.getCertificateTSSerializedData(),EnumSuspendData.CertificateTS),a=ScormHelper.addOrUpdateSuspendData(a,this.getCountDownsSerializedData(),EnumSuspendData.CountDowns);setSuspendData(a);resetModuleStatus();this.suspendCourse(null,0)};b.prototype.resetModuleStatusOnly=function(){resetModuleStatusOnly()};b.prototype.getLessonLocation=function(){var a=null;this.trackingEnabled&&(a=this.getLessonLocationAbstract());return a};b.prototype.getLessonLocationAbstract=function(){throw"Not implemented.";
};b.prototype.suspendCourse=function(a,c){this.trackingEnabled&&(c||(c=0),this.suspendCourseAbstract(""+a,Math.floor(c)))};b.prototype.suspendCourseAbstract=function(){throw"Not implemented.";};b.prototype.courseCompleted=function(){this.trackingEnabled&&this.courseCompletedAbstract()};b.prototype.courseCompletedAbstract=function(){throw"Not implemented.";};b.prototype.addInteraction=function(){throw"Not implemented.";};b.prototype.removeInteraction=function(){throw"Not implemented.";};b.prototype.getInteractions=
function(){throw"Not implemented.";};b.prototype.getSuccessStatus=function(){throw"Not implemented.";};b.prototype.setScore=function(){throw"Not Implemented.";};b.prototype.getScore=function(){throw"Not Implemented.";};b.prototype.getNumberOfAttempts=function(){return this.numberOfAttempts};b.prototype.setNumberOfAttempts=function(a){this.numberOfAttempts=a};b.prototype.setPostCompletionIfSuccess=function(a){this.postCompletionIfSuccess=a};b.prototype.getPostCompletionIfSuccess=function(){return this.postCompletionIfSuccess};
b.prototype.decrementNumberOfAttempts=function(){0<this.numberOfAttempts&&(this.numberOfAttempts-=1,this.suspendCourse(applicationViewModel.navigationManager.currentExercise().exerciseId))};b.prototype.unserializeNumberOfAttempts=function(a){return!StringHelper.isNullOrEmpty(a)?parseInt(a):null};b.prototype.getNumberOfAttemptsSerializedData=function(){return this.numberOfAttempts.toString()};b.prototype.getHistory=function(){return this.history};b.prototype.setHistory=function(a){this.history=a};
b.prototype.unserializeHistory=function(a){return!StringHelper.isNullOrEmpty(a)?ko.utils.parseJson(a):[]};b.prototype.getHistorySerializedData=function(a){void 0===a&&(a=!0);var c=this.history.join(",");a&&(c="["+c+"]");return c};b.prototype.getFuture=function(){return this.future};b.prototype.setFuture=function(a){this.future=a};b.prototype.unserializeFuture=function(a){return!StringHelper.isNullOrEmpty(a)?ko.utils.parseJson(a):[]};b.prototype.getFutureSerializedData=function(a){void 0===a&&(a=!0);
var c=this.future.join(",");a&&(c="["+c+"]");return c};b.prototype.getCountDownsSerializedData=function(){return this.countDowns.join(",")};b.prototype.unserializeCountDowns=function(a){return!StringHelper.isNullOrEmpty(a)?a.split(","):[]};b.prototype.setCountDowns=function(a){this.countDowns=a};b.prototype.getCountDowns=function(){for(var a=[],c=0;c<this.countDowns.length;c++){var b=this.countDowns[c].split("|"),e=null;!StringHelper.isNullOrEmpty(b[1])&&!isNaN(parseInt(b[1]))&&(e=new Date,e.setTime(parseInt(b[1])));
a.push(new CountDown(parseInt(b[0]),e))}return a};b.prototype.getCompletionStateSerializedData=function(){return this.completionState.serializeData()};b.prototype.setCompletionState=function(){this.completionState.states=[]};b.prototype.getUserName=function(){throw"Not Implemented.";};b.prototype.setCertificateTS=function(a){this.certificateTS=a};b.prototype.getCertificateTS=function(){return this.certificateTS};b.prototype.getCertificateTSSerializedData=function(){return null!=this.certificateTS?
this.certificateTS.toString():"null"};b.prototype.unserializeCertificateTs=function(a){return"null"!=a&&""!=a?parseInt(a):null};return b}(),EnumSuspendData;(function(b){b[b.CompletionState=0]="CompletionState";b[b.ChapterShuffled=1]="ChapterShuffled";b[b.Interactions=2]="Interactions";b[b.NumberAttempts=3]="NumberAttempts";b[b.History=4]="History";b[b.Future=5]="Future";b[b.CountDowns=6]="CountDowns";b[b.CertificateTS=7]="CertificateTS"})(EnumSuspendData||(EnumSuspendData={}));
var EnumSuspendDataHelper=function(){function b(){}b.parseEnumSuspendData=function(a){var c=null;if(null==a)return null;0===a.localeCompare("exerciseCompletion")&&(c=EnumSuspendData.CompletionState);0===a.localeCompare("chapterShuffled")&&(c=EnumSuspendData.ChapterShuffled);0===a.localeCompare("interactions")&&(c=EnumSuspendData.Interactions);0===a.localeCompare("numberOfAttempts")&&(c=EnumSuspendData.NumberAttempts);0===a.localeCompare("history")&&(c=EnumSuspendData.History);0===a.localeCompare("future")&&
(c=EnumSuspendData.Future);0===a.localeCompare("countDowns")&&(c=EnumSuspendData.CountDowns);0===a.localeCompare("certificateTS")&&(c=EnumSuspendData.CertificateTS);return c};b.toString=function(a){var c="";if(null==a)return null;switch(a){case EnumSuspendData.CompletionState:c="exerciseCompletion";break;case EnumSuspendData.ChapterShuffled:c="chapterShuffled";break;case EnumSuspendData.Interactions:c="interactions";break;case EnumSuspendData.NumberAttempts:c="numberOfAttempts";break;case EnumSuspendData.History:c=
"history";break;case EnumSuspendData.Future:c="future";break;case EnumSuspendData.CountDowns:c="countDowns";break;case EnumSuspendData.CertificateTS:c="certificateTS"}return c};return b}(),ScormHelper=function(){function b(){}b.arrayToString=function(a){for(var c=0;c<a.length;c++)0<=a[c].toString().indexOf(",")&&(a[c]=a[c].toString().replace(",","\u263c"));return a.toString().replace(/,/g,this.separator).replace(/\u263c/g,",")};b.stringToArray=function(a){if(null==a)a=null;else{if(b.isArray(a))return a;
a=-1==a.indexOf(this.separator)?a.split(","):a.split(this.separator)}return a};b.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)};b.getDataFromSuspendData=function(a,c){if(null!=a)for(var b=a.split("&"),e=0;e<b.length;e++){var f=b[e].split("=");if(f[0]===EnumSuspendDataHelper.toString(c))return StringHelper.isNullOrEmpty(f[1])?"":f[1]}return""};b.addOrUpdateSuspendData=function(a,c,b){if(null!=a){var e=EnumSuspendDataHelper.toString(b)+"=",a=a.split("&");if(1==a.length&&
""==a[0])return e+c;for(var f=0;f<a.length;f++)if(a[f].split("=")[0]===EnumSuspendDataHelper.toString(b))return a[f]=e+c,a.join("&");a.push(e+c);return a.join("&")}return null};b.separator="[,]";return b}(),AICCApi=null;
function AICCLMS(b){this.AICC_sid=this.AICC_url=null;this.startTime=new Date;this.endTime=new Date;this.LessonStatus=this.StudentName=this.StudentId=null;this.initializeLms=function(a){a=new QueryString;this.AICC_url=a.getValue("aicc_url");this.AICC_sid=a.getValue("aicc_sid");document.write('<div id="debug" style="height:320px;width:160px;');document.write("overflow:scroll;border:solid 1px #E0E0E0;");document.write('font-family:courier new;font-size:8px;display:none">&nbsp;</div>');this.debug("URL: "+
this.AICC_url);this.debug("SID: "+this.AICC_sid);this.httpReq=this.createHttpRequestObject();this.getData()};this.addInteraction=function(a,c,b,e,f,g){this.debug(a+", "+c+", "+b+", "+e+", "+f+", "+g);this.putInteraction(a,c,b,e,f,g)};this.initialize=function(a){this.startTime=a;this.debug("initialize("+a.toString()+")");this.setScoreAndCompletion(0,"incomplete")};this.courseCompleted=function(){this.debug("courseCompleted()");this.putParam("completed",null,this.trackTime())};this.setCompletion=function(a){this.debug("setCompletion("+
a+")");this.putParam(a,null,this.trackTime())};this.setScore=function(a){this.debug("setScore("+a+")");this.putParam(null,a,this.trackTime())};this.setScoreAndCompletion=function(a,c){this.debug("setScoreAndCompletion("+a+", "+c+")");this.putParam(c,a,this.trackTime())};this.finish=function(){this.debug("finish()");this.exitSystem(this.trackTime())};this.suspendCourse=function(a,c){this.debug("suspendCourse("+a+", "+c+")")};this.debug=function(a){this.debugDiv||(this.debugDiv=document.getElementById("debug"));
this.debugDiv&&"none"!=this.debugDiv.style.display&&(this.debugDiv.innerHTML=("&nbsp;"==this.debugDiv.innerHTML?"":this.debugDiv.innerHTML)+a+"<br>")};this.trackTime=function(){this.endTime=new Date;var a=Math.floor((this.endTime.getTime()-this.startTime.getTime())/1E3),c=Math.floor(a/60);return this.padNumber(Math.floor(c/60))+":"+this.padNumber(c%60)+":"+this.padNumber(a%60)};this.padNumber=function(a){return 10>a?"0"+a:a};this.LMSDetected=function(){return this.AICC_sid&&this.AICC_url&&0<this.AICC_sid.length&&
0<this.AICC_url.length?!0:!1};this.putParam=function(a,c,b){var e="[CORE]";a&&this.LessonStatus&&0<this.LessonStatus.length&&"c"!=this.LessonStatus.charAt(0)&&"p"!=this.LessonStatus.charAt(0)&&(e+="\nLESSON_STATUS="+a);c&&(e+="\nSCORE="+c);this.sendData("putParam",e+("\nTIME="+b))};this.putInteraction=function(a,c,b,e,f,g){this.sendData("putInteractions",'"course_id", "student_id", "lesson_id", "date", "time","interaction_id","objective_id", "type_interaction","correct_response","student_response", "result", "weighting", "latency"\r\n'+
(", this.StudentId, , , , "+a+', "", "'+c+'", "'+b+'", "'+e+'", "'+f+'",, '+g))};this.exitSystem=function(a){this.sendData("ExitAU","[CORE]\nTIME="+a)};this.sendData=function(a,c){this.LMSDetected()&&this.parseResults(this.sendHttpRequest(a,c))};this.getData=function(){this.LMSDetected()&&this.parseResults(this.sendHttpRequest("getparam",""))};this.parseResults=function(a){if(a){for(var a=this.unescapeex(a),a=a.split("\r"),c=0;c<a.length;c++){var b=a[c].split("=");if(2==b.length){var e=this.trim(b[0]).toLowerCase();
if(b=this.trim(b[1]).toLowerCase())switch(e){case "student_id":this.StudentId=b;break;case "student_name":this.StudentName=b;break;case "lesson_status":this.LessonStatus=b}}}this.debug("Student ID:   "+this.StudentId);this.debug("Student Name: "+this.StudentName);this.debug("LessonStatus: "+this.LessonStatus)}};this.AICCResultError=function(a,c){this.debug("err: "+c)};this.createHttpRequestObject=function(){var a=null;try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(c){try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(b){a=
null}}!a&&"undefined"!=typeof XMLHttpRequest&&(a=new XMLHttpRequest);return a};this.sendHttpRequest=function(){};this.trim=function(a){return a.replace(/^\s+|\s+$/g,"")};this.unescapeex=function(a){return a.replace(/\+/g," ")};this.initializeLms(b)}
function QueryString(){var b=location.search;this.q=1<b.length?b.substring(1,b.length):null;this.keyValuePairs=[];if(this.q)for(b=0;b<this.q.split("&").length;b++)this.keyValuePairs[b]=this.q.split("&")[b];this.getKeyValuePairs=function(){return this.keyValuePairs};this.getValue=function(a){for(var c=0;c<this.keyValuePairs.length;c++)if(this.keyValuePairs[c].split("=")[0].toLowerCase()==a.toLowerCase()){for(var a=this.keyValuePairs[c].split("="),c="",b=1;b<a.length;b++)c+=(""==c?"":"=")+a[b];return c}return"-1"};
this.getParameters=function(){for(var a=Array(this.getLength()),c=0;c<this.keyValuePairs.length;c++)a[c]=this.keyValuePairs[c].split("=")[0];return a};this.getLength=function(){return this.keyValuePairs.length}}var errorScormAPIMessage="Error during SCORM API Call",errorSuspendDataWriting="Error during SCORM API Call on SuspendData";
function addInteraction(b,a,c,d,e,f,g){if("undefined"==typeof QUnit)if(API){var h="";if("1.2"==LMS.SCORMversion)try{for(var d=!1,i,j=getInteractionsJsonArray(!0),c=0;c<j.length;c++)if(i=j[c],i.exerciseId==b){d=!0;break}d?(i.nbInteractions=""+(parseInt(i.nbInteractions)+1),i.type=a,i.learnerResponse=e,i.result=f,i.weighting=g):(i={},i.exerciseId=b,i.nbInteractions=1,i.type=a,i.learnerResponse=e,i.result=f,i.weighting=g,j.push(i));b="";for(c=0;c<j.length;c++)b+=j[c].exerciseId+";"+j[c].nbInteractions+
";"+getNumericValueForStatus(j[c].result)+";"+j[c].type+";"+j[c].learnerResponse.toString()+";"+j[c].weighting,c<j.length-1&&(b+="|");setSuspendData(ScormHelper.addOrUpdateSuspendData(getSuspendData(),b,EnumSuspendData.Interactions))}catch(k){mohiveScorm.displayErrorMessage(errorScormAPIMessage)}else if("2004"==LMS.SCORMversion){var l=Array(4),l=["00","00","00"],l="PT"+l[0]+"H"+l[1]+"M"+l[2]+"S";i=new Date;var j=i.getFullYear(),n=i.getUTCMonth()+1,g=n.toString(),j=j%100,j=j+(38>j?2E3:1900);9>=n&&
(g="0"+n.toString());i=i.getUTCDate();n=i.toString();9>=i&&(n="0"+i);j=j+"-"+g+"-"+n+"T"+SCORMtime(new Date);"wrong"==f&&(f="incorrect");try{var m="cmi.interactions."+API.GetValue("cmi.interactions._count"),h=API.SetValue(m+".id",b+"_RAND"+Math.floor(1E5*Math.random()));checkResult(h);h=API.SetValue(m+".timestamp",j);checkResult(h);"fill-in"==a&&(a="long-fill-in");h=API.SetValue(m+".type",a);checkResult(h);h=API.SetValue(m+".correct_responses.0.pattern",d);checkResult(h);h=API.SetValue(m+".weighting",
"1");checkResult(h);c=c.slice(0,249);h=API.SetValue(m+".description",c);checkResult(h);h=API.SetValue(m+".learner_response",e.toString());checkResult(h);h=API.SetValue(m+".result",f);checkResult(h);h=API.SetValue(m+".latency",l);checkResult(h);API.Commit("")}catch(o){mohiveScorm.displayErrorMessage(errorScormAPIMessage)}}}else AICCApi?AICCApi.addInteraction(b,a,d,e,f,l):mohiveScorm.displayErrorMessage(errorScormAPIMessage)}
function removeInteraction(b){if(API)if("1.2"==LMS.SCORMversion){for(var a=getInteractionsJsonArray(!0),c=[],d=0;d<a.length;d++)a[d].exerciseId.toString()!==b&&c.push(a[d]);b="";for(d=0;d<c.length;d++)b+=c[d].exerciseId+";"+c[d].nbInteractions+";"+getNumericValueForStatus(c[d].result)+";"+c[d].type+";"+c[d].learnerResponse.toString()+";"+c[d].weighting,d<c.length-1&&(b+="|");setSuspendData(ScormHelper.addOrUpdateSuspendData(getSuspendData(),b,EnumSuspendData.Interactions))}else if(API&&"2004"==LMS.SCORMversion){c=
this.getInteractionsCount();for(d=0;d<c;d++)API.GetValue("cmi.interactions."+d+".id").split("_")[0]==b&&(a="matching"==API.GetValue("cmi.interactions."+d+".type")?API.SetValue("cmi.interactions."+d+".learner_response","null[.]null"):API.SetValue("cmi.interactions."+d+".learner_response","null"),checkResult(a),a=API.SetValue("cmi.interactions."+d+".result","0"),checkResult(a),API.Commit(""))}}
function resetModuleStatusOnly(){API&&("1.2"==LMS.SCORMversion?(API.LMSSetValue("cmi.core.lesson_status","incomplete"),API.LMSCommit(""),API.LMSSetValue("cmi.core.score.raw",0),API.LMSCommit(""),reseted=!0):API&&"2004"==LMS.SCORMversion&&(API.SetValue("cmi.success_status","unknown"),API.Commit(""),API.SetValue("cmi.completion_status","incomplete"),API.Commit("")))}function getNumericValueForStatus(b){switch(b){case "correct":b=1;break;default:b=0}return b}
function getStringValueForStatus(b){switch(b){case "1":b="correct";break;default:b="incorrect"}return b}function checkResult(b){if(null==API||null==LMS)throw"error";if("true"!=b.toString()){var a,c=b="";"1.2"==LMS.SCORMversion?(a=API.LMSGetLastError(),b=API.LMSGetErrorString(a),c=API.LMSGetDiagnostic(a)):"2004"==LMS.SCORMversion&&(a=API.GetLastError(),b=API.GetErrorString(a),c=API.GetDiagnostic(a));if("401"!=a)throw"error : "+b+"\n"+c;}}
function getScormValue(b,a){var c=null;null!=API&&("1.2"==LMS.SCORMversion?c=API.LMSGetValue(b):"2004"==LMS.SCORMversion&&(c=API.GetValue(a)));return c}var timeOfInit,lessonStatus,successStatus,reseted=!1;
function initialize(){timeOfInit=new Date;if(null!=API)if("1.2"==LMS.SCORMversion)try{var b=API.LMSInitialize("").toString();if("true"!=b)return!1;lessonStatus=API.LMSGetValue("cmi.core.lesson_status");if(0==lessonStatus.length||0<lessonStatus.length&&"p"!=lessonStatus.charAt(0)&&"c"!=lessonStatus.charAt(0)&&"f"!=lessonStatus.charAt(0))API.LMSSetValue("cmi.core.lesson_status","incomplete"),API.LMSCommit("")}catch(a){return!1}else{if("2004"==LMS.SCORMversion)try{b=API.Initialize("");if("true"!=b)return!1;
var c=""+API.GetValue("cmi.completion_status");if(0==c.length||0<c.length&&"c"!=c.charAt(0))API.SetValue("cmi.completion_status","incomplete"),API.Commit("")}catch(d){return!1}}else if(AICCApi)AICCApi.initialize(timeOfInit);else return!1;return!0}function getLessonLocation(){return getScormValue("cmi.core.lesson_location","cmi.location")}function getSuspendData(){return getScormValue("cmi.suspend_data","cmi.suspend_data")}
function getInteractionsJsonArray(b){void 0===b&&(b=!1);var a=[];if("1.2"==LMS.SCORMversion){var c=ScormHelper.getDataFromSuspendData(getSuspendData(),EnumSuspendData.Interactions);if(!StringHelper.isNullOrEmpty(c))for(var d=c.split("|"),c=0;c<d.length;c++)for(var e=d[c].split(";"),f=e[1],g=!0==b?1:f,h=0;h<g;h++){var i={exerciseId:null,type:"",nbInteractions:null,learnerResponse:"",result:"",weighting:"1"};i.exerciseId=parseInt(e[0]);i.result=getStringValueForStatus(e[2]);i.type=e[3];i.learnerResponse=
e[4];i.weighting=5<e.length?e[5]:"1";i.nbInteractions=!0==b?f:null;a.push(i)}}else if("2004"==LMS.SCORMversion){b=this.getInteractionsCount();for(c=0;c<b;c++)d={exerciseId:null,correct:"",type:"",learnerResponse:"",result:"",weighting:"1"},e="cmi.interactions."+c,d.exerciseId=parseInt(this.getInteractionData(e+".id").split("_")[0]),d.correct=this.getInteractionData(e+".result"),d.type=this.getInteractionData(e+".type"),d.learnerResponse=this.getInteractionData(e+".learner_response"),d.result=this.getInteractionData(e+
".result"),d.weighting=this.getInteractionData(e+".weighting"),a.push(d)}return a}function getInteractionsCount(){return getScormValue("cmi.interactions._count","cmi.interactions._count")}function getInteractionData(b){return getScormValue(b,b)}function getSuccessStatus(){var b=getScormValue("cmi.core.lesson_status","cmi.success_status");return API&&"1.2"==LMS.SCORMversion&&(this.reseted||"passed"!=b&&"failed"!=b)?"unknown":b}
function getScore(){var b=getScormValue("cmi.core.score.raw","cmi.score.scaled");API&&"2004"==LMS.SCORMversion&&(b*=100);return b}
function setScore(b,a,c,d,e){API&&("1.2"==LMS.SCORMversion?(API.LMSSetValue("cmi.core.score.raw",d),API.LMSSetValue("cmi.core.lesson_status",e),API.LMSCommit("")):API&&"2004"==LMS.SCORMversion&&(API.SetValue("cmi.score.min",b),API.SetValue("cmi.score.max",a),API.SetValue("cmi.score.raw",c),API.SetValue("cmi.score.scaled",(parseInt(d)/100).toString()),API.SetValue("cmi.success_status",e),API.Commit("")))}
function resetModuleStatus(){if(API)if("1.2"==LMS.SCORMversion)API.LMSSetValue("cmi.core.lesson_status","incomplete"),API.LMSCommit(""),API.LMSSetValue("cmi.core.score.raw",0),API.LMSCommit(""),reseted=!0,setSuspendData(ScormHelper.addOrUpdateSuspendData(getSuspendData(),"",EnumSuspendData.Interactions));else if(API&&"2004"==LMS.SCORMversion){API.SetValue("cmi.success_status","unknown");API.Commit("");API.SetValue("cmi.completion_status","incomplete");API.Commit("");for(var b=this.getInteractionsCount(),
a=0;a<b;a++){var c;c="matching"==API.GetValue("cmi.interactions."+a+".type")?API.SetValue("cmi.interactions."+a+".learner_response","null[.]null"):API.SetValue("cmi.interactions."+a+".learner_response","null");checkResult(c);c=API.SetValue("cmi.interactions."+a+".result","0");checkResult(c);API.Commit("")}}}
function courseCompleted(){if(API)if("1.2"==LMS.SCORMversion)lessonStatus=API.LMSGetValue("cmi.core.lesson_status"),"p"!=lessonStatus.charAt(0)&&"f"!=lessonStatus.charAt(0)&&"c"!=lessonStatus.charAt(0)&&(API.LMSSetValue("cmi.core.lesson_status","completed"),API.LMSCommit(""));else{if("2004"==LMS.SCORMversion){var b=""+API.GetValue("cmi.completion_status");if(0==b.length||0<b.length&&"c"!=b.charAt(0))API.SetValue("cmi.completion_status","completed"),API.Commit("")}}else AICCApi&&AICCApi.courseCompleted()}
function finish(){API?(trackTime(),"1.2"==LMS.SCORMversion?API.LMSFinish(""):"2004"==LMS.SCORMversion&&API.Terminate("")):AICCApi&&AICCApi.finish()}function trackTime(){if(API){var b=Math.floor(((new Date).getTime()-timeOfInit.getTime())/1E3);"1.2"==LMS.SCORMversion?(b=secsToTime(b),API.LMSSetValue("cmi.core.session_time",b)):"2004"==LMS.SCORMversion&&(b=secsToTime2004(b),API.SetValue("cmi.session_time",b))}}
function setSuspendData(b){try{if(API)if("1.2"==LMS.SCORMversion){var a=API.LMSSetValue("cmi.suspend_data",b);checkResult(a);API.LMSCommit("")}else"2004"==LMS.SCORMversion&&(a=API.SetValue("cmi.suspend_data",b),checkResult(a),API.Commit(""))}catch(c){mohiveScorm.displayErrorMessage(errorSuspendDataWriting)}}
function suspendCourse(b,a){"string"!=typeof b&&(console.trace(),alert("location is not a string"));if(API)if(trackTime(),"1.2"==LMS.SCORMversion){var c=API.LMSSetValue("cmi.core.exit","suspend");checkResult(c);c=API.LMSSetValue("cmi.core.lesson_location",b);checkResult(c);c=API.LMSSetValue("cmi.suspend_data",a);checkResult(c);API.LMSCommit("")}else"2004"==LMS.SCORMversion&&(c=API.SetValue("cmi.exit","suspend"),checkResult(c),c=API.SetValue("cmi.location",b),checkResult(c),c=API.SetValue("cmi.suspend_data",
a),checkResult(c),API.Commit(""));else AICCApi&&AICCApi.suspendCourse(b,a)}var Lms=function(){return function(){this.today=SCORMdate(new Date);this.lesson_id="lesson2";this.SCORMversion=null}}(),LMS=new Lms,API=null;function join(b,a){var c="",d;for(d=0;d<b.length;d++)d&&(c+=a),9>=b[d]&&(c+="0"),c+=b[d];return c}function SCORMdate(b){return join([b.getFullYear(),b.getMonth()+1,b.getDate()],"/")}function SCORMtime(b){return join([b.getHours(),b.getMinutes(),b.getSeconds()],":")}
function secsToTime(b){return join([Math.floor(b/3600),Math.floor(b%3600/60),b%60],":")}function secsToTime2004(b){return"PT"+Math.floor(b/3600)+"H"+Math.floor(b%3600/60)+"M"+b%60+"S"}function FindAPIinWin(b,a){var c="API";"2004"==a&&(c="API_1484_11");for(var d=0;null==b[c]&&null!=b.parent&&b.parent!=b;){d++;if(7<d)return null;b=b.parent}return b[c]}
function scanForAPI(b){var a=null;LMS.SCORMversion=null;try{a=FindAPIinWin(window,b)}catch(c){return null}if(null==a&&null!=window.opener&&"undefined"!=typeof window.opener)try{a=FindAPIinWin(window.opener,b)}catch(d){return null}LMS.SCORMversion="2004"==b?"2004":"1.2";return a}function findAPI(b){var a=null;null==b||""==b?(a=scanForAPI("2004"),null==a&&(a=scanForAPI("1.2"))):a=scanForAPI(b);return a}
var MohiveScorm=function(b){function a(c,a){b.call(this,c);this.noApiScormFoundMessage="This module requires a SCORM compliant LMS (Learning Management System) to run properly. \nNo such LMS was found.\nPlease contact your system administrator. ";this.forceSCORMversion=a;this.initializeAbstract()}__extends(a,b);a.prototype.initializeAbstract=function(){API=findAPI(this.forceSCORMversion);if(null!=API){initialize();var c=LMS.SCORMversion;"1.2"==c?(this.userID=API.LMSGetValue("cmi.core.student_id"),
this.userName=API.LMSGetValue("cmi.core.student_name")):"2004"==c&&(this.userID=API.GetValue("cmi.learner_id"),this.userName=API.GetValue("cmi.learner_name"));this.loggingEnabled=!0;c=getSuspendData();this.completionState.loadData(ScormHelper.getDataFromSuspendData(c,EnumSuspendData.CompletionState));this.chapterShuffled.loadData(ScormHelper.getDataFromSuspendData(c,EnumSuspendData.ChapterShuffled));this.setNumberOfAttempts(this.unserializeNumberOfAttempts(ScormHelper.getDataFromSuspendData(c,EnumSuspendData.NumberAttempts)));
this.history=this.unserializeHistory(ScormHelper.getDataFromSuspendData(c,EnumSuspendData.History));this.future=this.unserializeFuture(ScormHelper.getDataFromSuspendData(c,EnumSuspendData.Future));this.certificateTS=this.unserializeCertificateTs(ScormHelper.getDataFromSuspendData(c,EnumSuspendData.CertificateTS));this.countDowns=this.unserializeCountDowns(ScormHelper.getDataFromSuspendData(c,EnumSuspendData.CountDowns))}else this.userName=this.userID="",this.loggingEnabled=!1,this.displayErrorMessage(this.noApiScormFoundMessage)};
a.prototype.finishAbstract=function(){finish()};a.prototype.getLessonLocationAbstract=function(){if(this.trackingEnabled){var c=getLessonLocation();if(null==c||void 0==c||""==c)c=null;return c}return null};a.prototype.suspendCourseAbstract=function(c){var a=getSuspendData(),a=ScormHelper.addOrUpdateSuspendData(a,this.completionState.serializeData(),EnumSuspendData.CompletionState),a=ScormHelper.addOrUpdateSuspendData(a,this.chapterShuffled.serializeData(),EnumSuspendData.ChapterShuffled),a=ScormHelper.addOrUpdateSuspendData(a,
this.getNumberOfAttemptsSerializedData(),EnumSuspendData.NumberAttempts),a=ScormHelper.addOrUpdateSuspendData(a,this.getHistorySerializedData(),EnumSuspendData.History),a=ScormHelper.addOrUpdateSuspendData(a,this.getFutureSerializedData(),EnumSuspendData.Future),a=ScormHelper.addOrUpdateSuspendData(a,this.getCertificateTSSerializedData(),EnumSuspendData.CertificateTS),a=ScormHelper.addOrUpdateSuspendData(a,this.getCountDownsSerializedData(),EnumSuspendData.CountDowns);suspendCourse(c,a)};a.prototype.courseCompletedAbstract=
function(){courseCompleted()};a.prototype.addInteraction=function(c,a,b,f,g,h){addInteraction(""+c,a,"",b,f,g,h)};a.prototype.removeInteraction=function(c){removeInteraction(""+c)};a.prototype.getInteractions=function(){for(var c=getInteractionsJsonArray(),a=[],b=0;b<c.length;b++){var f=new Interaction,g=c[b];f.setValues(g.exerciseId,g.type,"",g.learnerResponse,g.result,g.weighting);null!=f.learnerResponse&&"null"!=f.learnerResponse&&a.push(f)}return a};a.prototype.getSuccessStatus=function(){return getSuccessStatus()};
a.prototype.setScore=function(c,a,b,f,g){setScore(""+c,""+a,""+b,""+f,g)};a.prototype.getScore=function(){return getScore()};a.prototype.getUserName=function(){return this.userName};return a}(ScormApiBase),WindowHelper=function(){function b(){}b.prototype.redirect=function(a){a&&void 0!=a&&""!=a&&(window.location.href=a)};return b}(),WindowHelperMock=function(){function b(){this.currentUrl=""}b.prototype.redirect=function(a){this.currentUrl=a};return b}(),WindowHelperFactory=function(){function b(){}
b.getInstance=function(){null==b.instance&&(b.instance=this.mock?new WindowHelperMock:new WindowHelper);return b.instance};b.setMock=function(a){b.mock=a;b.instance=null};b.mock=!1;b.instance=null;return b}(),CKPlayerScorm=function(b){function a(c){b.call(this,c);this.trackingData=null;this.currentUrl=window.location.href;this.lastReportTime=new Date;c=ajaxLoader.getUrlParameterValue("ckplayer",this.currentUrl);this.trackingUrl=c+"tracking.aspx";this.lessonLocationUrl=c+"sessonLocation.aspx";this.keepAliveUrl=
c+"KeepAlive.aspx";this.errorUrl=c+"errorreport.aspx?code=1";this.getLessonLocationAbstract();this.keepAlive()}__extends(a,b);a.prototype.getLessonLocationAbstract=function(){var c=this,a=null;$.ajax(this.lessonLocationUrl,{cache:!1,dataType:"json",async:!1,success:function(b){a=c.onGetLessonLocationCompleted(b)},error:function(a,b,d){c.onGetLessonLocationError(a,b,d)}});return a};a.prototype.suspendCourseAbstract=function(c,a){null!=this.trackingData&&(this.updateTrackingDataBeforeSuspendCourse(c,
a),this.sendTracking(this.getQuerystringTrackingData()))};a.prototype.courseCompletedAbstract=function(){if(null!=this.trackingData){var c=this.trackingData.units[0];c.stat="completed";this.sendTracking("u="+c.code+"&"+this.getQuerystringTrackingData())}};a.prototype.finishAbstract=function(){null!=this.trackingData&&this.sendTracking("end=1&"+this.getQuerystringTrackingData())};a.prototype.sendTracking=function(c){$.ajax(this.trackingUrl,{data:c,type:"POST",contentType:"application/x-www-form-urlencoded",
success:this.onSendTrackingCompleted,error:this.onSendTrackingError})};a.prototype.onGetLessonLocationCompleted=function(c){var a=null;this.checkGetLessonLocationResult(c)&&(this.trackingData=c,this.accessToModuleIsAllowed()?(this.completionState.loadData(unescape(ScormHelper.getDataFromSuspendData(this.trackingData.units[0].sDat,EnumSuspendData.CompletionState))),this.history=this.unserializeHistory("["+ScormHelper.getDataFromSuspendData(this.trackingData.units[0].sDat,EnumSuspendData.History)+"]"),
this.future=this.unserializeFuture("["+ScormHelper.getDataFromSuspendData(this.trackingData.units[0].sDat,EnumSuspendData.Future)+"]"),a=parseInt(this.trackingData.units[0].lesLoc),isNaN(a)&&(a=null),c=this.trackingData.units[0],"completed"!=c.stat&&(c.stat="incomplete"),this.sessionStartTime=new Date):(logger.warning("User are not allowed to access to this module."),WindowHelperFactory.getInstance().redirect(this.errorUrl)));return a};a.prototype.accessToModuleIsAllowed=function(){var c=this.trackingData.units[0].code.substring(0,
7);return-1!=this.currentUrl.toLowerCase().indexOf("/runtimehtml/")||-1!=this.currentUrl.indexOf(c)?!0:!1};a.prototype.onGetLessonLocationError=function(){WindowHelperFactory.getInstance().redirect(this.errorUrl)};a.prototype.onSendTrackingCompleted=function(){logger.info("Datas sended to CKPlayer.")};a.prototype.onSendTrackingError=function(c,a,b){logger.error("Error to send tracking to CKPlayer.",b)};a.prototype.checkGetLessonLocationResult=function(c){return null==c||null==c.units||1!=c.units.length?
!1:!0};a.prototype.getElapsedTime=function(){return this.formatMillisecondsIntoTime((new Date).getTime()-this.lastReportTime.getTime())};a.prototype.getTotalTime=function(){return this.formatMillisecondsIntoTime((new Date).getTime()-this.sessionStartTime.getTime())};a.prototype.formatMillisecondsIntoTime=function(c){var a,b=Math.floor(c/36E5);a=c%36E5;c=Math.floor(a/6E4);a=Math.floor(a%6E4/1E3);return this.convertNumberToString(b)+":"+this.convertNumberToString(c)+":"+this.convertNumberToString(a)};
a.prototype.convertNumberToString=function(c){return 10>c?"0"+c.toString():c.toString()};a.prototype.serializeTrackingData=function(){for(var c='{"units":[',a=this.trackingData.units,b=0,f=a.length;b<f;b++)var g=a[b],c=c+"{",c=c+('"code":"'+g.code),c=c+('","stat":"'+g.stat),c=c+('","prog":"'+g.prog),c=c+('","sDat":"'+encodeURI(g.sDat)),c=c+('","lesLoc":"'+encodeURI(g.lesLoc)),c=c+('","time":"'+g.time),c=c+'"}';return c+"]}"};a.prototype.getQuerystringTrackingData=function(){this.updateTrackingData();
return"mohiveTrackingData="+escape(this.serializeTrackingData())};a.prototype.updateTrackingData=function(){if(null!=this.trackingData&&this.sessionStartTime){var c=this.trackingData.units[0];c.sDat=ScormHelper.addOrUpdateSuspendData("",this.completionState.serializeData(),EnumSuspendData.CompletionState);c.sDat=ScormHelper.addOrUpdateSuspendData(c.sDat,this.getHistorySerializedData(!1),EnumSuspendData.History);c.sDat=ScormHelper.addOrUpdateSuspendData(c.sDat,this.getFutureSerializedData(!1),EnumSuspendData.Future);
c.time=this.getTotalTime();this.lastReportTime=new Date}};a.prototype.updateTrackingDataBeforeSuspendCourse=function(c,a){if(null!=this.trackingData){var b=this.trackingData.units[0];if(""==b.prog||isNaN(parseInt(b.prog))||parseInt(b.prog)<a)b.prog=Math.floor(a).toString();b.lesLoc=c?c:""}};a.prototype.keepAlive=function(){var c=this;setInterval(function(){$.ajax(c.keepAliveUrl,{type:"POST",contentType:"application/x-www-form-urlencoded"})},6E4)};a.prototype.addInteraction=function(){};a.prototype.removeInteraction=
function(){};a.prototype.getInteractions=function(){return[]};a.prototype.getInteractionCountForExercise=function(){return 0};a.prototype.getSuccessStatus=function(){return"unknown"};a.prototype.setScore=function(){};a.prototype.getScore=function(){return 0};return a}(ScormApiBase),CKPlayerTrackingData=function(){return function(){this.units=[]}}(),CKPlayerUnit=function(){return function(){}}(),StandaloneScorm=function(b){function a(c){b.call(this,c);this.timeOfInit=new Date;this.score=0;this.successStatus=
"unknown";this.lastExerciseIdLoaded=null}__extends(a,b);a.prototype.finishAbstract=function(){};a.prototype.suspendCourse=function(c){this.lastExerciseIdLoaded=applicationViewModel.interactionManager.isAssessment()?applicationViewModel.navigationManager.allExercises()[0].id:c};a.prototype.getLessonLocation=function(){return this.lastExerciseIdLoaded};a.prototype.courseCompleted=function(){"passed"!=this.successStatus&&"failed"!=this.successStatus&&(this.successStatus="completed")};a.prototype.addInteraction=
function(){};a.prototype.removeInteraction=function(){};a.prototype.getInteractions=function(){return[]};a.prototype.getSuccessStatus=function(){return this.successStatus};a.prototype.setScore=function(c,a,b,f,g){this.score=f;this.successStatus=g};a.prototype.getScore=function(){return this.score};a.prototype.getSessionTime=function(){return Math.floor(((new Date).getTime()-this.timeOfInit.getTime())/1E3)};a.prototype.getLessonStatus=function(){return"unknown"==this.successStatus?"incomplete":this.successStatus};
return a}(ScormApiBase),ScormApiFactory=function(){function b(){}b.getInstance=function(){var a;switch(ajaxLoader.getUrlParameterValue("tracking")){case "scorm":a=new MohiveScorm(trackingEnabled,exportScormVersion);break;case "ckplayer":a=new CKPlayerScorm(trackingEnabled);break;case "standalone":a=new StandaloneScorm(trackingEnabled);break;default:a=new MohiveScorm(trackingEnabled,exportScormVersion)}return a};return b}(),logger=new Logger,uiManager,mohiveScorm,applicationViewModel,localizedText,
ajaxLoader,audioPlayer,platformFeatures,userCulture,$body=$("body"),$html=$("html"),$window=$(window),$document=$(document),windowHeight=$window.height(),windowWidth=$window.width(),$transcriptArea=$("#transcriptArea"),$transcriptContent=$("#contentTranscript"),main=function(){return function(){ajaxLoader=new AjaxLoader(window.location.href);platformFeatures=new PlatformFeatures;platformFeatures.isPlatformSupported()?(logger=new Logger,logger.setLogLevel(ajaxLoader.getUrlParameterValue("loglevel",
null)),mohiveScorm=ScormApiFactory.getInstance(),localizedText=new LocalizedText,applicationViewModel=new ApplicationViewModel(ajaxLoader,mohiveScorm,platformFeatures),uiManager=applicationViewModel.uiManager,audioPlayer=AudioPlayerFactory.createAudioPlayer(),$html.one(platformFeatures.getIsAndroid()?"touchend":"touchstart",function(){uiManager.removeAudioUserTouchRestrictions()}),applicationViewModel.isDesktopMode(platformFeatures.getIsDesktopMode()),applicationViewModel.loadExercises(),ko.applyBindings(applicationViewModel,
$html[0]),platformFeatures.getIsIE()&&($body[0].onselectstart=function(){return!1}),platformFeatures.getIsIPad()&&document.addEventListener("focusout",function(){window.scrollTo(0,0)})):alert("Unsupported device.");main=null}}(),EnumRuntimeMode;(function(b){b[b.DRAFT=0]="DRAFT";b[b.LEARNER=1]="LEARNER";b[b.LEARNER_LOCAL=2]="LEARNER_LOCAL"})(EnumRuntimeMode||(EnumRuntimeMode={}));
var EnumRuntimeModeHelper=function(){function b(){}b.parseEnumRuntimeMode=function(a){var c=EnumRuntimeMode.LEARNER;if(a&&(0==a.toLowerCase().localeCompare("draft")&&(c=EnumRuntimeMode.DRAFT),0==a.toLowerCase().localeCompare("learner")))c=EnumRuntimeMode.LEARNER_LOCAL;return c};return b}(),AjaxLoader=function(){function b(a){this.viewModel=this.courseId=null;this.completeCourseInfo="";this.unittest=!1;this.runtimeMode=EnumRuntimeMode.DRAFT;this.courseId=this.getUrlParameterValue("courseid",a);null!=
this.getUrlParameterValue("unittest",a)&&(this.unittest=!0);this.runtimeMode=EnumRuntimeModeHelper.parseEnumRuntimeMode(this.getUrlParameterValue("runtimeMode",a))}b.prototype.loadExerciseAsync=function(a){var c=$.Deferred(),b,e;$.when(this.loadExerciseViewModelAsync(a).done(function(c){b=c}),this.loadDataAsync(a).done(function(c){e=c})).done(function(){c.resolve(a,b,e)});return c};b.prototype.loadExerciseViewModelAsync=function(a){var c=$.Deferred();if("undefined"!=window[a.viewModelName])a=new window[a.viewModelName](a),
c.resolve(a);else throw"The viewModel "+a.viewModelName+" does not exist";return c};b.prototype.loadDataAsync=function(a){var c=$.Deferred();if(0!=a.exerciseId){var b=this.getExerciseDataUrl(a.exerciseId);this.log("debug","loadData","Type: "+a.exerciseType+" exerciseDataFileUrl:"+b);$.ajax(b,{dataType:"json",success:function(a){c.resolve(a)},error:function(){}})}return c};b.prototype.loadExercises=function(a,c){this.viewModel=a;var b=this.getCompleteCourseInfoUrl(c);this.log("debug","loadExercises",
"jsonUrl:"+b);return $.ajax(b,{dataType:"json",context:this,success:this.onGetCompleteCourseInfoSuccess,error:this.onLoadExercisesError})};b.prototype.loadSubtitles=function(a,c){var b=this;this.log("debug","loadSubtitles","jsonConfigUrl:"+c);$.ajax(c,{dataType:"json",context:this,success:function(c){b.onLoadSubtitlesSuccess(a,c)},error:function(c,f,g){b.onLoadSubtitlesError(a,c,f,g)}})};b.prototype.onLoadSubtitlesSuccess=function(a,c){a.onLoadSubtitlesCompleted.call(a,c)};b.prototype.onLoadSubtitlesError=
function(a,c,b,e){a.onLoadSubtitlesCompleted.call(a,null,e)};b.prototype.loadManifestXml=function(a,c,b){var e=this,a=this.getHtmlSkinBaseUrl()+a+"/runtime/manifest.xml";this.log("debug","loadManifestXml","manifestSkinUrl:"+a);$.ajax(a,{async:!1,dataType:"xml",success:c,error:function(c,a,h){e.log("error","error while loading the manifestFile: "+h);b()}})};b.prototype.onGetCompleteCourseInfoSuccess=function(a){this.log("debug","onGetCompleteCourseInfoSuccess");this.completeCourseInfo=a;this.viewModel.onLoadExercisesCompleted.call(this.viewModel,
a)};b.prototype.onLoadExercisesError=function(a,c,b){this.log("debug","onLoadExercisesError");-1<a.responseText.indexOf("ErrorCode=1")?(a=encodeURIComponent(window.location.href),$(location).attr("href","../index2.asp?requestedUrl="+a)):-1<a.responseText.indexOf("ErrorCode=2")&&(c=StringHelper.GetURLParameter(a.responseText,"Msg"),a=encodeURIComponent(window.location.href),$(location).attr("href","../administration/NotAuthorized.aspx?msg="+c+"&requestedUrl="+a));this.viewModel.onLoadExercisesCompleted.call(this.viewModel,
null,b)};b.prototype.getCompleteCourseInfoUrl=function(a){if(this.unittest)return"unitTest/mocks/getCompleteCourseInfo.js";if(this.runtimeMode==EnumRuntimeMode.LEARNER&&null==uiManager.screenshotMode)return"datas/getCompleteCourseInfo.js";var c="../administration/dbCommunication/GetCompleteCourseInfo.aspx?contentType=json&courseid="+this.courseId+"&random="+(new Date).getTime(),b=this.getUrlParameterValue("skin");null!=b&&(c+="&skinoverride="+b);a&&(c+="&exerciseId="+a);a=this.getUrlParameterValue("thumbnailtoken");
null!=a&&(c+="&thumbnailtoken="+a);return c};b.prototype.getExerciseDataUrl=function(a){if(this.unittest)return"unitTest/mocks/getExercise"+a+".js";if(this.runtimeMode==EnumRuntimeMode.LEARNER&&null==uiManager.screenshotMode)return"datas/getExercise"+a+".js";var a="../administration/dbCommunication/GetExercise.aspx?contentType=json&id="+a+"&random="+(new Date).getTime(),c=this.getUrlParameterValue("thumbnailtoken");null!=c&&(a+="&thumbnailtoken="+c);return a};b.prototype.getCloudBaseUrl=function(a){a=
this.getUrlParameterValue("cloudBaseURL",a);return null!=a?(StringHelper.endsWith(a,"/")||(a+="/"),a):""};b.prototype.getSkinMediaBaseUrl=function(a){a=this.getCloudBaseUrl(a);return""!=a?a:""};b.prototype.getStandardMediaBaseUrl=function(a){a=this.getCloudBaseUrl(a);return""!=a?a+"medias/":this.runtimeMode!=EnumRuntimeMode.LEARNER||null!=uiManager.screenshotMode?"../media/content/":"medias/"};b.prototype.getThumbnailBaseUrl=function(a,c){var b=this.getCloudBaseUrl(c);return""!=b?b+a:this.runtimeMode!=
EnumRuntimeMode.LEARNER||null!=uiManager.screenshotMode?"../"+a:a};b.prototype.getSubtitleBaseUrl=function(){return this.runtimeMode==EnumRuntimeMode.LEARNER&&null==uiManager.screenshotMode?"subtitles/":"../media/subtitles/"};b.prototype.getHtmlSkinBaseUrl=function(){return"undefined"!=typeof isDemoMode&&isDemoMode?this.urlLevelUp(this.getBaseUrl(),2)+"/themes/":this.runtimeMode!=EnumRuntimeMode.LEARNER||null!=uiManager.screenshotMode?this.urlLevelUp(this.getBaseUrl(),1)+"/themes/":this.urlLevelUp(this.getBaseUrl(),
0)+"/themes/"};b.prototype.urlLevelUp=function(a,c){for(var b=a.substring(0,a.lastIndexOf("/")),e=0;e<c;e++)b=b.substring(0,b.lastIndexOf("/"));return b};b.prototype.isDemoModule=function(){return isDemoMode};b.prototype.getRuntimeMode=function(){return this.runtimeMode};b.prototype.setRuntimeMode=function(a){this.runtimeMode=a};b.prototype.getUrlParameters=function(a){var c=[],b;a||(a=window.location.href);a=a.toLowerCase();b=this.extractParameterString(a);if(null!=b)for(var e=b.split("&"),f=0,g=
e.length;f<g;f++)b=e[f].split("="),""!=b[0]&&(c.push(b[0]),c[b[0]]=b[1]);a=this.extractHashString(a);if(null!=a){e=a.split("/");f=0;for(g=e.length;f<g;f++)b=e[f].split("="),""!=b[0]&&(c.push(b[0]),c[b[0]]=b[1])}return c};b.getUrlParameters=function(a){var c=[],b;a||(a=window.location.href);a=a.toLowerCase();b=this.extractParameterString(a);if(null!=b)for(var e=b.split("&"),f=0,g=e.length;f<g;f++)b=e[f].split("="),""!=b[0]&&(c.push(b[0]),c[b[0]]=b[1]);a=this.extractHashString(a);if(null!=a){e=a.split("/");
f=0;for(g=e.length;f<g;f++)b=e[f].split("="),""!=b[0]&&(c.push(b[0]),c[b[0]]=b[1])}return c};b.prototype.extractParameterString=function(a){var c=a.indexOf("?"),b=a.indexOf("#"),e="";-1<c&&(e=-1<b?a.substring(c+1,b):a.substring(c+1));if(void 0==e||""==e)e=null;return e};b.extractParameterString=function(a){var c=a.indexOf("?"),b=a.indexOf("#"),e="";-1<c&&(e=-1<b?a.substring(c+1,b):a.substring(c+1));if(void 0==e||""==e)e=null;return e};b.prototype.extractHashString=function(a){var c=a.indexOf("#"),
b="";-1<c&&(b=a.substring(c+1));if(void 0==b||""==b)b=null;return b};b.extractHashString=function(a){var c=a.indexOf("#"),b="";-1<c&&(b=a.substring(c+1));if(void 0==b||""==b)b=null;return b};b.prototype.getUrlParameterValue=function(a,c){var b=this.getUrlParameters(c)[a.toLowerCase()];return void 0==b||""==b?null:b};b.getUrlParameterValue=function(a,c){var d=b.getUrlParameters(c)[a.toLowerCase()];return void 0==d||""==d?null:d};b.prototype.getBaseUrl=function(){return-1==window.location.href.indexOf("?")?
window.location.href:window.location.href.substring(0,window.location.href.indexOf("?"))};b.prototype.createCookie=function(a,c,b){var e="";b&&(e=new Date,e.setTime(e.getTime()+864E5*b),e="; expires="+e.toUTCString());document.cookie=a+"="+c+e+"; path=/"};b.prototype.readCookie=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var f=c[b];" "==f.charAt(0);)f=f.substring(1,f.length);if(0==f.indexOf(a))return f.substring(a.length,f.length)}return null};b.prototype.log=
function(a,c,b){logger[a]("[AjaxLoader] "+c+" "+(b?b:""))};return b}(),Shaker=function(){function b(a,c,b){this.el=a;this.delay=c;this.cssClass=b}b.prototype.cleanup=function(){clearTimeout(this.timerCss);clearTimeout(parseInt(this.el.data("shake-timer")))};b.prototype.animateCss=function(){var a=this;this.el.addClass(this.cssClass+" shake");this.timerCss=setTimeout(function(){a.el.removeClass(a.cssClass+" shake")},this.delay)};b.prototype.animateJquery=function(){var a;switch(this.cssClass){case "animated":a=
500;break;case "animatedfast":a=300;break;case "animatedlong":a=1E3}this.el.shake(3,20,a)};b.prototype.shake=function(){platformFeatures.getTransitionSupported()==Transition.css?this.animateCss():this.animateJquery()};return b}();
jQuery.fn.shake=function(b,a,c){this.each(function(){var d=this,e=$(this)[0].getAttribute("style");$(this).css("position","relative");for(var f=1;f<=b;f++)$(this).animate({left:-1*a},c/b/4).animate({left:a},c/b/2).animate({left:0},c/b/4);$(this).data("shake-timer",setTimeout(function(){$(d).data("shake-timer",null);$(d)[0].setAttribute("style",e)},c))});return this};var EnumDragItemType;
(function(b){b[b.fullStep=0]="fullStep";b[b.title=1]="title";b[b.image=2]="image";b[b.caption=3]="caption"})(EnumDragItemType||(EnumDragItemType={}));
var EnumDragItemTypeHelper=function(){function b(){}b.parseEnumDragItemType=function(a){var c=null;if(null==a)return null;0==a.localeCompare("Complete area")&&(c=EnumDragItemType.fullStep);0==a.localeCompare("Titles")&&(c=EnumDragItemType.title);0==a.localeCompare("Pictures")&&(c=EnumDragItemType.image);0==a.localeCompare("Captions")&&(c=EnumDragItemType.caption);return c};b.toString=function(a){var c="";if(null==a)return null;switch(a){case EnumDragItemType.fullStep:c="puzzle-fullstep";break;case EnumDragItemType.title:c=
"puzzle-title";break;case EnumDragItemType.image:c="puzzle-image";break;case EnumDragItemType.caption:c="puzzle-caption"}return c};return b}(),RandomHelper=function(){function b(){}b.randomFromInterval=function(a,c){return Math.floor(Math.random()*(c-a+1)+a)};return b}(),FeedbackInlineViewModel=function(){function b(a,c){var b=this;this.inlineFeedbackId=GuidHelper.newGuid();this.marginInlineFeedback=5;this.heightFeedback=ko.observable(null);this.topFeedback=ko.observable(null);this.rightContainer=
this.leftContainer=this.bottomContainer=this.topContainer=0;this.inlineFeedbackIsVisible=ko.observable(!1);this.inlineFeedbackVisited=!1;this.displayNone=ko.observable(!1);this.feedbackContent=ko.observable("");this.feedbackContentAriaLabel="";this.feedbackTitle=ko.observable("");this.feedbackSound=new MediaSound;this.feedbackMedia=ko.observable(null);this.isImage=ko.observable(!1);this.isVideo=ko.observable(!1);this.domOverviewSaving=0;this.hasFeedbackTitle=ko.computed(function(){return""!=b.feedbackTitle()});
this.hasFeedbackContent=ko.computed(function(){return""!=b.feedbackContent()&&null!=b.feedbackContent()});this.hasFeedbackSound=ko.observable(!1);this.hasFeedbackMedia=ko.observable(!1);this.hasFeedbackToDisplay=ko.computed(function(){return b.hasFeedbackContent()||b.hasFeedbackMedia()});this.getDomContentWrapper=function(){return b.getDomExercise().find(".exercise__content-wrapper")};this.getDomInlineFeedback=function(){return $("#"+b.inlineFeedbackId)};this.getDomOverview=function(){return b.getDomExercise().find(".overview")};
this.getDomTriangle=function(){return b.getDomInlineFeedback().find(".feedback__inline__triangle")};this.getDomVideo=function(){return b.getDomExercise().find("video")};this.getDomVideoWrapper=function(){return b.getDomExercise().find(".video")};this.getDomViewport=function(){return b.getDomExercise().find(".viewport")};this.getDomBottomMenu=function(){return $(".menu")};this.getDomBottomProgressBar=function(){return $(".progressbar")};this.getDomFeedbacks=function(){return $(".feedback__inline")};
this.getDomHeaderWrapper=function(){return b.getDomOverview().find(".header-wrapper")};this._tabindexCloseCross=ko.observable(100);this._tabindex=ko.observable(100);this.tabIndexValue=-1;this.callbackOnFeedbackHidden=function(){};this.callbackOnFeedbackShown=function(){};this.inlineFeedbackIsInLeft=c;this.timers=new Timers;this.scrollbarUpdater=a;this.tabindexCloseCross=ko.observable(-1);this.tabindex=ko.observable(-1)}b.prototype.setTabindex=function(a,c){if(void 0!=c&&(a&&(this.tabIndexValue=a),
this.contextViewModel=c,this._tabindex(a),this.tabindex=c.generateTabIndexComputed("_tabindex",this),this._tabindexCloseCross(a+1),this.tabindexCloseCross=c.generateTabIndexComputed("_tabindexCloseCross",this),this.feedbackSound.hasSource()&&(this.feedbackSound.setTranscriptTitle(this.feedbackTitle()),this.feedbackSound.setTranscriptDisplayedAsList(!0)),(this.isImage()||this.isVideo())&&this.feedbackMedia().setTabindex(a),this.isVideo()))this.feedbackMedia().setTranscriptTitle(this.feedbackTitle()),
this.feedbackMedia().setTranscriptDisplayedAsList(!0)};b.prototype.resetTabindex=function(){void 0!=this.contextViewModel&&this.contextViewModel&&(this._tabindex(-1),this.tabindex=this.contextViewModel.generateTabIndexComputed("_tabindex",this),this._tabindexCloseCross(-1),this.tabindexCloseCross=this.contextViewModel.generateTabIndexComputed("_tabindexCloseCross",this),(this.isImage()||this.isVideo())&&this.feedbackMedia().resetTabindex())};b.prototype.setMedia=function(a){if(a.type==MediaType.image||
a.type==MediaType.video)this.feedbackMedia(a),this.hasFeedbackMedia(!0);a.type==MediaType.image&&this.isImage(!0);a.type==MediaType.video&&this.isVideo(!0)};b.prototype.setSound=function(a){this.feedbackSound=a;""!=a.url()&&this.hasFeedbackSound(!0)};b.prototype.setTitle=function(a){this.feedbackTitle(a)};b.prototype.setContentTextAriaLabel=function(a){this.feedbackContentAriaLabel=a};b.prototype.setContentText=function(a){this.feedbackContent(a)};b.prototype.setCallbackOnHideFeedbackAfterUpdateScrollbar=
function(a){this.callbackOnFeedbackHidden=a};b.prototype.setCallbackOnShowFeedbackBeforeUpdateScrollbar=function(a){this.callbackOnFeedbackShown=a};b.prototype.initDom=function(a,c,b){var e=this;this.getDomElemTrigger=a;this.getDomContainerElement=c;this.getDomExercise=b;this.inlineFeedbackIsVisible(!1);this.displayNone(!0);this.timers.setTimeout("getInitHeight"+this.inlineFeedbackId,function(){e.displayNone(!1)},0)};b.prototype.showFeedback=function(){var a=this;if(this.feedbackSound.isPlaying())this.hideInlineFeedback();
else if(this.hasFeedbackContent()||this.hasFeedbackMedia()||this.hasFeedbackSound()){this.inlineFeedbackVisited=!0;if(this.hasFeedbackContent()||this.hasFeedbackMedia()||this.hasFeedbackSound()){!applicationViewModel.accessibilityViewModel.accessibilityFeaturesActivated()&&!this.hasFeedbackContent()&&!this.hasFeedbackMedia()?this.inlineFeedbackIsVisible(!1):this.inlineFeedbackIsVisible(!0);if(this.isVideo()){if(platformFeatures.getIsIPad()){var c=this.feedbackMedia();this.feedbackMedia(new MediaVideo);
this.feedbackMedia().loadData(c.json)}var b=this.feedbackMedia();b.isVisible(!0);null!=this.onClickCallback&&b.onEnded.subscribe(this,function(){a.onClickCallback()});this.timers.setTimeout("goodHeightCalculate"+this.inlineFeedbackId,function(){var c,f=a.getDomVideo().height();if(0!=(c=b.getOriginalWidth()))f=a.getDomInlineFeedback().width()/c*b.getOriginalHeight();platformFeatures.isFirefox||a.getDomVideo().height(f);b.fitToContent(a.getDomVideo().width(),f,null,null);applicationViewModel.accessibilityViewModel.accessibilityFeaturesActivated()?
b.initializePlayerSize():b.play()},0)}this.hasFeedbackSound()&&this.playFeedbackSound();this.timers.setTimeout("feedbackHasBeenClicked"+this.inlineFeedbackId,function(){a.getDomExercise().on("click",function(c){if(a.inlineFeedbackIsVisible()&&(!a.isVideo()||!a.feedbackMedia().getDom().find(c.target).length)){if("A"==c.target.parentElement.tagName)return!0;if(!applicationViewModel.accessibilityViewModel.accessibilityFeaturesActivated())return a.hideInlineFeedback(),!0}})},0);this.timers.setTimeout("feedbackToggleVisible"+
this.inlineFeedbackId,function(){a.callbackOnFeedbackShown();if(applicationViewModel.accessibilityViewModel.accessibilityFeaturesActivated()){a.setTabindex(a.tabIndexValue,a.contextViewModel);var c=$("[tabindex="+a.tabIndexValue+"]");a.tabIndexValue&&c&&1<c.length&&c.get(1).focus()}},50)}this.sizeChanged();if(null!=this.onClickCallback&&!this.hasFeedbackSound()&&!this.isVideo())this.onClickCallback()}};b.prototype.closeButtonClicked=function(a,c){c.stopImmediatePropagation();this.hideInlineFeedback()};
b.prototype.hideInlineFeedback=function(){var a=this;if(this.inlineFeedbackIsVisible()){this.resetTabindex();this.isVideo()&&(platformFeatures.getIsIE8()?(this.feedbackMedia().loadUrl(),this.feedbackMedia().pause()):this.feedbackMedia().stop(),this.feedbackMedia().isVisible(!1));this.inlineFeedbackIsVisible(!1);this.getDomContentWrapper().removeClass("scrollable");for(var c=0;c<this.getDomFeedbacks().length;c++)$("#"+this.getDomFeedbacks()[c].id).show();platformFeatures.getIsPhone()||this.scrollbarUpdater(0);
this.timers.setTimeout("callBackAfterHidden"+this.inlineFeedbackId,function(){a.callbackOnFeedbackHidden();a.getDomExercise().off("click")},0)}this.hasFeedbackSound()&&this.feedbackSound.stop()};b.prototype.isSoundPlaying=function(){return this.hasFeedbackSound()&&this.feedbackSound.isPlaying()};b.prototype.playFeedbackSound=function(){var a=this;this.hasFeedbackSound()&&(this.feedbackSound.isPlaying()&&this.feedbackSound.stop(),this.hasFeedbackToDisplay()||this.feedbackSound.onEnded.subscribe(this,
function(){applicationViewModel.accessibilityViewModel.accessibilityFeaturesActivated()||a.hideInlineFeedback()}),null!=this.onClickCallback&&this.feedbackSound.onEnded.subscribe(this,function(){a.onClickCallback()}),(!this.contextViewModel||!this.contextViewModel.isActiveAndAccessibilityEnabled())&&setTimeout(function(){a.feedbackSound.play()},0))};b.prototype.cleanup=function(){this.feedbackMedia()&&this.feedbackMedia().cleanup();this.hasFeedbackSound()&&this.feedbackSound.cleanup();this.timers.cleanup();
clearTimeout(this.request)};b.prototype.sizeChanged=function(){this.isImage()&&this.feedbackMedia().resize()};b.prototype.checkVerticalCurrentPosition=function(){var a=this.inlineFeedbackIsVisible(),c,b;if(0==this.getDomContainerElement().length||0==this.getDomInlineFeedback().length)return feedbackPositionning.good;this.inlineFeedbackIsVisible(!1);this.displayNone(!0);this.topContainer=this.getDomContainerElement().offset().top+this.marginInlineFeedback+this.getDomHeaderWrapper().height();this.bottomContainer=
this.topContainer+this.getDomContainerElement().height();this.leftContainer=this.getDomContainerElement().offset().left+this.marginInlineFeedback;this.rightContainer=this.leftContainer+this.getDomContainerElement().outerWidth(!0)-this.marginInlineFeedback;this.displayNone(!1);c=this.getDomInlineFeedback().offset().top;b=c+this.getDomInlineFeedback().outerHeight(!0)+2*this.marginInlineFeedback;this.inlineFeedbackIsVisible(a);return c>this.topContainer&&b<this.bottomContainer?feedbackPositionning.good:
c<this.topContainer?feedbackPositionning.UP:feedbackPositionning.DOWN};b.prototype.setTopTrianglePosition=function(){if(0!=this.getDomElemTrigger().length){var a;a=this.getDomElemTrigger().outerHeight(!0);this.getDomInlineFeedback().addClass("feedback__inline__transform-y--no");this.getDomElemTrigger().offset();this.getDomInlineFeedback().outerHeight(!0);var c=this.getDomTriangle().outerHeight(!0);a=Math.abs(parseInt(this.getDomInlineFeedback().css("top")))+a/2+c/2-2*this.marginInlineFeedback+this.getDomBottomProgressBar().outerHeight(!0)/
2;this.getDomTriangle().css({top:a})}};b.prototype.getBottomMargin=function(){var a=this.marginInlineFeedback,c=this.getDomBottomMenu().outerHeight(!0);return 2*this.getDomBottomProgressBar().outerHeight(!0)+c+a};b.prototype.setCorrectPosition=function(a){var c=this;a==feedbackPositionning.good?(this.getDomTriangle().hasClass("defaultCenter")||this.setTopTrianglePosition(),this.checkIfNeedScrollBar()):(this.getDomTriangle().removeClass("defaultCenter"),this.getDomInlineFeedback().addClass("feedback__inline__transform-y--no"),
this.timers.requestAnimationFrame("raf_feedback_"+this.inlineFeedbackId,function(){var b,e=null,f=null;c.getDomInlineFeedback().css({top:"",left:""});c.getDomTriangle().css({top:"",left:""});b=c.getDomInlineFeedback().outerHeight(!0);a==feedbackPositionning.UP&&(e=c.topContainer+c.marginInlineFeedback,c.getDomInlineFeedback().offset({left:null,top:e}));a==feedbackPositionning.DOWN&&(e=b+c.marginInlineFeedback>c.getDomOverview().outerHeight()-c.getBottomMargin()?c.topContainer+c.marginInlineFeedback:
c.getDomOverview().outerHeight()-c.getDomInlineFeedback().height()-c.getBottomMargin());a==feedbackPositionning.LEFT&&(f=c.leftContainer+c.marginInlineFeedback);a==feedbackPositionning.RIGHT&&(f=c.rightContainer-c.getDomInlineFeedback().outerWidth(!0)-c.marginInlineFeedback);c.getDomInlineFeedback().offset({left:f,top:e});c.setTopTrianglePosition();c.displayNone(!0);c.checkIfNeedScrollBar()}))};b.prototype.checkIfNeedScrollBar=function(){if(this.hasFeedbackContent()||this.hasFeedbackMedia())for(var a=
0;a<this.getDomFeedbacks().length;a++)this.getDomFeedbacks()[a].id!=this.inlineFeedbackId&&$("#"+this.getDomFeedbacks()[a].id).hide();0!=this.getDomInlineFeedback().length&&(this.heightFeedback(this.getDomInlineFeedback().outerHeight(!0)),this.topFeedback(this.getDomInlineFeedback().offset().top));this.heightFeedback()+this.topFeedback()>this.getDomContentWrapper().outerHeight(!0)?this.getDomContentWrapper().addClass("scrollable"):this.getDomContentWrapper().removeClass("scrollable");this.scrollbarUpdater()};
b.prototype.updatePosition=function(){var a=this;if(platformFeatures.getIsIE8()){var c;c=this.getDomElemTrigger().outerHeight(!0);c=-((this.getDomInlineFeedback().outerHeight(!0)-c)/2);this.getDomInlineFeedback().removeClass("feedback__inline__transform-y--no");this.getDomInlineFeedback().css({top:c+"px"});this.timers.setTimeout("checkPositionForIE"+this.inlineFeedbackId,function(){a.setCorrectPosition(a.checkVerticalCurrentPosition())},0)}else this.getDomInlineFeedback()[0]&&this.getDomInlineFeedback()[0].style.removeProperty("top"),
this.timers.setTimeout("checkPosition"+this.inlineFeedbackId,function(){a.setCorrectPosition(a.checkVerticalCurrentPosition())},0);if(this.isVideo()){var b=this.feedbackMedia();this.timers.setTimeout("goodVideoHeight"+this.inlineFeedbackId,function(){var c,f=a.getDomVideo().height();if(0!=(c=b.getOriginalWidth()))f=a.getDomVideo().width()/c*b.getOriginalHeight();platformFeatures.isFirefox||a.getDomVideoWrapper().height(f);b.sizeChanged(a.getDomVideo().width(),f)},0)}};return b}(),feedbackPositionning;
(function(b){b[b.good=0]="good";b[b.UP=1]="UP";b[b.DOWN=2]="DOWN";b[b.LEFT=3]="LEFT";b[b.RIGHT=4]="RIGHT"})(feedbackPositionning||(feedbackPositionning={}));TemplateSettings.defaults={bulletpoint:{bulleturl:"images/bullet.png"},intro:{backgroundurl:"",slidepageimageurl:"images/slide-page-to-right.png"},ending:{backgroundurl:""}};
var ProcessCommonItem=function(){function b(a,c,b,e,f){var g=this;void 0===f&&(f=null);this.id=ko.observable(GuidHelper.newGuid());this.idImages="";this.feedbackContentId=GuidHelper.newGuid();this.getDomFeedbackContent=function(){return $("#"+g.feedbackContentId+" .process-common__feedback-text")};this.domFeedbackContainer=function(){return $("#"+g.feedbackContentId)};this.index=ko.observable(0);this.isSelected=ko.observable(!1);this.isCompleted=!1;this.text=ko.observable("");this.responseText=ko.observable(new MediaText);
this.responseTextAriaLabel=ko.observable("");this.caption=this.title="";this.sound=new MediaSound;this.image=ko.observable(new MediaImage);this.feedbackImage=ko.observable(new MediaImage);this.triangleLeft=ko.observable(0);this.phylacteryMarginLeft=ko.observable(0);this.feedbackCssClass=ko.observable("");this.phylacteryCssClass=ko.observable("");this.hasFeedback=ko.observable(!1);this.presentingFeedbackImage=ko.observable(!1);this.isFirst=ko.observable(!1);this.hasPolaroid=ko.observable(!1);this.isLast=
ko.observable(!1);this.isPortrait=ko.observable(!1);this.triangleId=ko.observable(GuidHelper.newGuid());this.customisedSeparator="";this._itemTabindex=ko.observable(-1);this.itemTabindex=null;this._dragItemTabindex=ko.observable(-1);this.keepValueOfTabindex=-1;this.feedbackTextStretched=ko.observable(!1);this.getDomImageFeedback=function(){return $(".process-common__item-image--feedback",g.getDomImages())};this.getDomImages=function(){return $("#"+g.id())};this.parent=a;this.index(c);this.feedbackCssClass(b);
this.idImages=this.id+"_images";this._itemTabindex(100*(c+1));this.keepValueOfTabindex=100*(c+1);this.itemTabindex=this.parent.getOwnerViewModel().generateTabIndexComputed("_itemTabindex",this);this.dragTabindex=this.getParent().getOwnerViewModel().generateTabIndexComputed("_dragItemTabindex",this);this.textStretcher=f}b.prototype.sizeChanged=function(){this.image().resize();this.feedbackImage().resize();this.textStretcher&&this.textStretcher.nodeMustBeStretched(this.getDomFeedbackContent(),1)&&this.feedbackTextStretched(!0);
this.isPortrait(uiManager.getIsPhonePortrait())};b.prototype.loadData=function(a){this.text(a.text["#text"]);this.responseText().loadData(a.response.text,this.parent.ownerViewModel.parent.exerciseId);this.responseTextAriaLabel(this.responseText().transformStringForAriaLabel());this.caption=void 0==a.response.graphiccaption?"":a.response.graphiccaption;this.title=void 0==a.response.graphictitle?"":a.response.graphictitle;this.customisedSeparator=StringHelper.isNullOrEmpty(a.response["customised-separator"])?
"":a.response["customised-separator"];this.loadMedias(a);this.hasPolaroid()&&this.feedbackImage().polaroidTitle(this.title);this.image().isPolaroid()&&this.image().polaroidTitle(this.title);(!StringHelper.isNullOrEmpty(this.responseText().text())||this.feedbackImage().hasSourceUrl())&&this.hasFeedback(!0);this.unselect()};b.prototype.cleanup=function(){this.sound.cleanup();this.image().cleanup();this.feedbackImage().cleanup();this.isCompleted=!1};b.prototype.resetTabindex=function(){this._itemTabindex(-1)};
b.prototype.setTabindex=function(){this._itemTabindex(this.keepValueOfTabindex)};b.prototype.setDragTabindex=function(){this._dragItemTabindex(100)};b.prototype.resetDragTabindex=function(){this._dragItemTabindex(-1)};b.prototype.start=function(){this.image().play()};b.prototype.checkExerciseCompleted=function(){this.parent.checkExerciseCompleted()&&this.parent.getOwnerViewModel().parent.setExerciseCompleted()};b.prototype.stop=function(){this.sound.hasSource()&&this.sound.onEnded.unSubscribe(this,
this.onSoundEnded)};b.prototype.onSoundEnded=function(){this.isCompleted=!0;this.checkExerciseCompleted()};b.prototype.unselect=function(){this.isSelected(!1);this.parent.unselectCurrentItem();this.sound.stop();this.presentingFeedbackImage(!1)};b.prototype.reset=function(){this.unselect();this.isCompleted=!1};b.prototype.select=function(){var a=this;if(this.isSelected())this.unselect();else if(this.isSelected(!0),this.parent.selectItem(this),this.sound.hasSource()&&!platformFeatures.getIsPhone()?
(this.sound.onEnded.subscribe(this,function(){a.onSoundEnded()}),this.parent.getOwnerViewModel().isActiveAndAccessibilityEnabled()||this.sound.play()):(this.isCompleted=!0,this.checkExerciseCompleted()),""!=this.feedbackImage().mediaId)this.presentingFeedbackImage(!0),this.feedbackImage().play()};b.prototype.loadMedias=function(a){this.image(MediaFactory.createMedia(a.media));var c=a.response.media;if(void 0!=c)for(var c=ArrayHelper.getArrayFromJson(c),b=0,e=c.length;b<e;b++){var f=MediaFactory.createMedia(c[b]);
f.type==MediaType.sound?this.sound=f:f.type==MediaType.image&&(platformFeatures.getIsPhone()&&!f.hasUrl()?this.feedbackImage(MediaFactory.createMedia(a.media)):this.feedbackImage(f))}this.hasPolaroid(this.feedbackImage().isPolaroid())};b.prototype.getParent=function(){return this.parent};return b}(),ImageSize;(function(b){b[b.Small=0]="Small";b[b.Large=1]="Large"})(ImageSize||(ImageSize={}));
var ProcessCommon=function(){function b(a,c,b,e,f,g,h,i,j,k,l,n,m,o){var p=this;this.exerciseIntro=new MediaText;this.height=this.width=0;this.customisedSeparatorsUsed=ko.observable(!1);this.getDomListRowTitles=function(){return $(".process-common__row-titles",p.ownerViewModel.getDom()).children()};this.getDomFeedbackNode=function(){return p.getExerciseDom().find(".process-common__stretchable-feedback")};this.ownerViewModel=a;this.title=c;this.instruction=b;this.items=e;this.hasPolaroid=f;this.selectedItem=
g;this.selectedIndex=h;this.stretchablefeedbackVisible=i;this.selectedItemResponseText=j;this.selectedItemFeedbackCssClass=k;this.arrowVisible=l;this.itemFactory=null!=o?o:function(c,a,b,d,e){return new ProcessCommonItem(c,a,b,d,e)};this.canDisplayArrow=n;this.canDisplayAllCaptions=m}b.prototype.loadData=function(a){this.title(a.exercise.title);a.exercise.intro&&this.exerciseIntro.loadData(a.exercise.intro.text,this.ownerViewModel.parent.exerciseId);this.instruction(a.exercise.instruction);this.loadItems(a.exercise.alternatives);
var c=-1!==a.exercise["@layout"].indexOf("Large")?ImageSize.Large:ImageSize.Small;this.columnNumberClass="process-common--"+this.items().length+"columns__"+ImageSize[c].toLowerCase()+"-images";this.stickyColumnNumberClass="sticky-puzzle--"+this.items().length+"columns__"+ImageSize[c].toLowerCase()+"-images";this.loadMedias(a.exercise.media)};b.prototype.loadItems=function(a){var c=!1;if(void 0!=a&&void 0!=a.alternative)for(var a=ArrayHelper.getArrayFromJson(a.alternative),b=new TextStretcher(function(){}),
e=0,f=a.length;e<f;e++){var g=a[e],h=this.itemFactory(this,e,"processcommonfeedback processcommonfeedback"+(e+1)+"of"+f,"processcommonphylacteryWrapper processcommonphylactery"+(e+1)+"of"+f,b);h.loadData(g);h.hasPolaroid()&&(c=!0);0==e&&h.isFirst(!0);e==a.length-1&&h.isLast(!0);StringHelper.isNullOrEmpty(h.customisedSeparator)||this.customisedSeparatorsUsed(!0);this.items().push(h)}c&&this.hasPolaroid(!0)};b.prototype.loadMedias=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a),c=
0,b=a.length;c<b;c++){var e=MediaFactory.createMedia(a[c]);e.type==MediaType.sound&&(this.ownerViewModel.openingSound=e)}};b.prototype.start=function(){this.checkExerciseCompleted();for(var a=0,c=this.items().length;a<c;a++)this.items()[a].start()};b.prototype.stop=function(){this.reset();this.selectItem(null);this.selectedIndex(-1);this.selectedItem(null)};b.prototype.reset=function(){this.stretchablefeedbackVisible(!1);for(var a=this.items(),c=0,b=a.length;c<b;c++)a[c].reset();this.items(a)};b.prototype.cleanup=
function(){try{this.ownerViewModel.clearInterval("timerAnimateItems");for(var a=this.items(),c=0,b=a.length;c<b;c++)a[c].cleanup();this.items.removeAll()}catch(e){logger.error("ProcessCommon.cleanup error : "+e)}};b.prototype.render=function(){this.getExerciseDom().addClass(this.columnNumberClass)};b.prototype.unselectCurrentItem=function(){this.selectedItem(null)};b.prototype.selectItem=function(a){var c=this,b=this.selectedItem();if(b&&b==a)b.unselect(),this.selectedItem(null);else if(null!=a)if(b&&
b.unselect(),b!=a&&(this.selectedItem(a),this.selectedIndex(a.index())),platformFeatures.getIsPhone())b=new MediaImage,a.feedbackImage().hasSourceUrl()?b.duplicateFrom(a.feedbackImage()):b.duplicateFrom(a.image()),this.ownerViewModel.feedback.setFeedback(a.feedbackImage(),a.sound,a.responseText(),function(){c.selectedItem()&&c.selectedItem().unselect()}),this.ownerViewModel.feedback.sizeChanged(this.width,this.height),this.ownerViewModel.showFeedback();else if(this.stretchablefeedbackVisible(!1),
this.selectedItemResponseText(a.responseText().text()),this.selectedItemFeedbackCssClass(a.feedbackCssClass()),this.stretchablefeedbackVisible(!0),a.sound&&(a.sound.setTranscriptTitle(a.image().metadataDescription),a.sound.setTranscriptDisplayedAsList(!0)),this.ownerViewModel.isActiveAndAccessibilityEnabled())setTimeout(function(){a.getDomImageFeedback().focus()},100),platformFeatures.getIsIE()&&BrowserHelper.refreshDom()};b.prototype.applyHeighest=function(){var a=this;platformFeatures.getIsPhone()||
this.ownerViewModel.requestAnimationFrame("processcommon_applyHeighest",function(){for(var c=a.items(),b=0,e=0,f=0,g,h,i=0,j=c.length;i<j;i++){var k=c[i];g=k.image().getIllustrationDom().outerHeight(!0);h=k.feedbackImage().getIllustrationDom().outerHeight(!0);k.image().isPolaroid()||(f=$(a.getDomListRowTitles().get(i)).children("h3").height());e=Math.max(e,f);b=Math.max(b,Math.max(g,h))}a.getExerciseDom().find(".process-common__row-titles").height(e);a.getExerciseDom().find(".process-common__cell-images, .process-common__item-images-wrapper").outerHeight(b);
a.canDisplayArrow&&a.arrowVisible(!0)});return this};b.prototype.getExerciseDom=function(){return this.ownerViewModel.getDom()};b.prototype.sizeChanged=function(a,c){this.height=c;this.width=a;for(var b=this.items(),e=0,f=b.length;e<f;e++)b[e].sizeChanged();this.canDisplayArrow&&this.arrowVisible(!0)};b.prototype.getOwnerViewModel=function(){return this.ownerViewModel};b.prototype.checkExerciseCompleted=function(){for(var a=this.items(),c=a.length-1;0<=c;c--)if(!a[c].isCompleted)return;this.ownerViewModel.parent.setExerciseCompleted()};
b.prototype.resetTabindex=function(){for(var a=this.items(),c=a.length-1;0<=c;c--)a[c].resetTabindex()};b.prototype.setTabindex=function(){for(var a=this.items(),c=a.length-1;0<=c;c--)a[c].setTabindex()};b.prototype.resetDragTabindex=function(){for(var a=this.items(),c=a.length-1;0<=c;c--)a[c].resetDragTabindex()};b.prototype.setDragTabindex=function(){for(var a=this.items(),c=a.length-1;0<=c;c--)a[c].setDragTabindex()};b.prototype.checkAnswers=function(){return this.selectedDragItem.draggableId==
this.selectedDropZone.draggableId};return b}(),AboutImagesViewModel=function(b){function a(c){b.call(this,c);this.items=ko.observableArray([]);this.selectedItem=ko.observable(null);this.selectedIndex=ko.observable(-1);this.tableId=ko.observable(GuidHelper.newGuid());this.selectedItemResponseText=ko.observable("");this.selectedItemFeedbackCssClass=ko.observable("");this.stretchablefeedbackVisible=ko.observable(!1);this.hasPolaroid=ko.observable(!1);this.arrowVisible=ko.observable(!1);this.helper=new ProcessCommon(this,
this.title,this.instruction,this.items,this.hasPolaroid,this.selectedItem,this.selectedIndex,this.stretchablefeedbackVisible,this.selectedItemResponseText,this.selectedItemFeedbackCssClass,this.arrowVisible,!1,!1,null)}__extends(a,b);a.prototype.loadData=function(c){this.layout("AboutImagesStandardLayout");platformFeatures.getIsPhone()?(this.template("FluidBoxLayout"),this.layoutTemplate("FluidBoxLayout")):(this.template("ProcessCommonLayout"),this.layoutTemplate("ProcessCommonLayout"));this.helper.loadData(c);
return b.prototype.loadData.call(this,c)};a.prototype.sizeChanged=function(c,a){this.helper.sizeChanged(c,a);this.helper.applyHeighest();return $.Deferred().resolve().promise()};a.prototype.start=function(){b.prototype.start.call(this);this.helper.start();this.helper.applyHeighest();return this};a.prototype.startThumbnail=function(){return this};a.prototype.stop=function(){b.prototype.stop.call(this);this.helper.stop();return this};a.prototype.updateScrollbar=function(){this.helper.applyHeighest();
return b.prototype.updateScrollbar.call(this)};a.prototype.reset=function(){this.helper.reset();return this};a.prototype.render=function(){b.prototype.render.call(this);this.helper.render();return this};a.prototype.cleanup=function(){try{b.prototype.cleanup.call(this),this.helper.cleanup()}catch(c){logger.error("ProcessAbout.cleanup error : "+c)}return this};a.prototype.getItemsFluidBoxRenderer=function(){return"AboutImagesItemsFluidBoxRenderer"};a.prototype.hasExerciseIntro=function(){return!StringHelper.isNullOrEmpty(this.helper.exerciseIntro.text())};
return a}(BaseContentViewModel),AnimatedImageViewModel=function(b){function a(c){b.call(this,c);this.title=ko.observable("");this.exerciseIntro=ko.observable("");this.exerciseConclusion=ko.observable("");this.titleId=GuidHelper.newGuid();this.introductionId=GuidHelper.newGuid();this.conclusionId=GuidHelper.newGuid();this.contentId=GuidHelper.newGuid();this.titleIsVisible=ko.observable(!0);this.conclusionIsVisible=ko.observable(!1);this.sound=new MediaSound;this.animatedImageItems=ko.observableArray([]);
this.calibration=!1;this.duration=0;this.currentTime=ko.observable(0);this.progress=ko.observable("0%");this.playControlClasses=ko.observable("play-control playing");this.hideControls=ko.observable(!0);this.isEnded=this.isPaused=!1;this._tabindex=ko.observable(100);this.tabindex=this.generateTabIndexComputed("_tabindex",this)}__extends(a,b);a.prototype.loadData=function(c){this.duration=c.exercise["@duration"];this.calibration="true"==c.exercise["@calibration"]?!0:!1;this.loadItems(c);this.loadTexts(c);
this.loadMedias(c.exercise.media);return b.prototype.loadData.call(this,c)};a.prototype.sizeChanged=function(c,a){for(var b=$(".title-wrapper",this.getDom()).outerHeight(!0),f=$("#"+this.introductionId).outerHeight(!0),g=$("#"+this.conclusionId).outerHeight(!0),h=$("#"+this.contentId),i=null,b=a-b-f-g,f=0,g=this.animatedImageItems().length;f<g;f++){var j=this.animatedImageItems()[f];this.calibration?null==i&&(i=j.mediaImage.fitToContent(c,b,null,null,!0),h.height(j.mediaImage.height()),h.width(j.mediaImage.width())):
(j.mediaImage.x=0,j.mediaImage.y=0,h.height(b),h.width(c),$("#"+j.mediaImage.idImage).height(b).width(c),j.mediaImage.switchImageQualityIfNecessary())}return $.Deferred().resolve().promise()};a.prototype.start=function(){this.play();this.sizeChanged(this.parent.width,this.parent.height);return this};a.prototype.stop=function(){this.sound.stop();return this};a.prototype.reset=function(){return this};a.prototype.loadTexts=function(c){this.title(c.exercise.title);this.exerciseIntro(c.exercise.intro.text);
this.exerciseConclusion(c.exercise.conclusion.text)};a.prototype.loadItems=function(c){if(c.exercise.items)for(var c=ArrayHelper.getArrayFromJson(c.exercise.items.item),a=0,b=c.length;a<b;a++){var f=new AnimatedImageItem(c[a],a,this.calibration);f.mediaImage&&this.animatedImageItems.push(f)}};a.prototype.loadMedias=function(c){if(void 0!=c)for(var c=ArrayHelper.getArrayFromJson(c),a=0;a<c.length;a++){var b=MediaFactory.createMedia(c[a]);b.type==MediaType.sound&&(this.sound=b,this.sound.onEnded.subscribe(this,
this.soundEndedHandler))}};a.prototype.playPause=function(c){c&&uiManager.stopPropagation(c);this.isPaused?this.play():this.pause()};a.prototype.play=function(){this.isEnded?(this.isEnded=!1,this.replay(null)):(clearInterval(this.intervalTimer),this.intervalTimer=setInterval($.proxy(this.updateAnimation,this),100),this.isPaused=!1,this.hideControls(!0),this.playControlClasses("play-control playing"),this.sound&&this.sound.play())};a.prototype.soundEndedHandler=function(){this.currentTime()>this.duration&&
(this.pause(),this.isEnded=!0,this.conclusionIsVisible(!0))};a.prototype.pause=function(){this.isPaused=!0;this.hideControls(!1);clearInterval(this.intervalTimer);this.playControlClasses("play-control paused");this.sound&&this.sound.pause()};a.prototype.contentClickHandler=function(c){var a=this;c&&uiManager.stopPropagation(c);this.hideControls(!1);this.isPaused||this.setTimeout("hide-controls",function(){a.hideControls(!0)},2E3)};a.prototype.contentMouseMoveHandler=function(){this.contentClickHandler(null)};
a.prototype.updateAnimation=function(){this.currentTime(this.currentTime()+0.1);this.currentTime()>this.duration?(this.pause(),this.isEnded=!0,this.conclusionIsVisible(!0)):this.isEnded=!1;var c=100*this.currentTime()/this.duration;this.progress(Math.min(c,100)+"%");for(var c=this.animatedImageItems()[0],a=0;a<this.animatedImageItems().length;a++){var b=this.animatedImageItems()[a];b.startTime<=this.currentTime()&&c&&c.startTime<=b.startTime&&(c=b)}for(a=0;a<this.animatedImageItems().length;a++)this.animatedImageItems()[a]==
c?this.animatedImageItems()[a].isVisible(!0):this.animatedImageItems()[a].isVisible(!1)};a.prototype.replay=function(c){c&&uiManager.stopPropagation(c);this.pause();this.currentTime(0);this.sound&&this.sound.stop();this.play()};a.prototype.cleanup=function(){try{this.sound.cleanup(),clearInterval(this.intervalTimer)}catch(c){logger.error("AnimatedImageViewModel.cleanup error : "+c)}return this};return a}(BaseContentViewModel),AnimatedImageItem=function(){function b(a,c,b){this.isVisible=ko.observable(!1);
this.noCalibration=ko.observable(!1);this.startTime=parseFloat(a["@startTime"]);this.index=c;this.noCalibration(!b);this.mediaImage=MediaFactory.createMedia(a.media)}b.prototype.fitToContent=function(){};b.prototype.setImageSizeAndPositionFromRatio=function(){};return b}(),AssessmentClickableZonesViewModel=function(b){function a(c){var a=this;b.call(this,c);this.id=GuidHelper.newGuid();this.charmBarId=GuidHelper.newGuid();this.image=ko.observable(new MediaImage);this.items=ko.observableArray([]);
this.selectedItem=ko.observable(null);this.inlineFeedbackLayout=!1;this.displayLowImage=ko.observable(!1);this.displayHighImage=ko.observable(!1);this.imageHeight=ko.observable("");this.labelListHeight=ko.observable("");this.showLabelsInList=ko.observable(!1);this.hasLabeledItem=!1;this.hotspotsTop=ko.observable("0px");this.isHighQualityLoaded=this.isLowQualityLoaded=this.hotspotsVisible=!1;this.getDomIexploreImagesContainer=function(){return a.parent.getExerciseDom().find(".iexplore__images")};this.submitButtonId=
"submit-button-"+this.id;this.getDomSubmitButton=function(){return $("#"+a.submitButtonId)};this._tabSubmitIndex=ko.observable(120);this.tabSubmitIndex=this.generateTabIndexComputed("_tabSubmitIndex",this);this.getDomImage=function(){if(!a.getDomIexploreImagesContainer())return null;var c=a.getDomIexploreImagesContainer().find(".iexplore__image");return a.isHighQualityLoaded?c.last():c.first()};this.imageRatio=0;this._tabindex=ko.observable(100);this.tabindexImg=this.generateTabIndexComputed("_tabindex",
this);this.checkResponses=function(){for(var c=!0,b=0,g=a.items().length;b<g;b++){var h=a.items()[b];h.isCorrect()&&h.isChecked()||!h.isCorrect()&&!h.isChecked()?h.isFound(!0):(h.isFound(!1),c=!1)}return c};this.exerciseComplteted=function(){a.parent.setExerciseCompleted();for(var c=0,b=a.items();c<b.length;c++)b[c].showIconFeedback(!0);setTimeout(function(){var c=a.getExerciseDom().find(".assessment_charm_bar").first().outerHeight(!0);a.getDomContent().css("padding-bottom",Math.min(0.33*windowHeight,
c+(platformFeatures.getIsIPad()?20:0))+"px");a.updateScrollbar()},0)};this.retrieveAnswers=function(){for(var c={type:"choice",correct:"",given:"",weighting:a.parent.getChapter().isAssessment?"1":"0"},b=[],g=0,h=a.items().length;g<h;g++)a.items()[g].isChecked()&&b.push(g.toString());c.given=ScormHelper.arrayToString(b);return c};this.resumeAnswers=function(c){if(null!=c&&(c=ScormHelper.stringToArray(c),null!=c&&0<c.length&&""!=c[0]))for(var b=0;b<c.length;b++)null!=c[b]&&null!=a.items()[c[b]]&&a.items()[b].isChecked(!0)};
this.resetAllUserAnswers=function(){for(var c=0,b=a.items();c<b.length;c++)b[c].isChecked(!1)};this.displayAnswerCallback=function(){for(var c=!1,b=0,g=a.items();b<g.length;b++)c=g[b],c.showAnswer(!c.showAnswer()),c=c.showAnswer();c?a.getExerciseDom().find(".assessment__buttonShowMeTheAnswer").addClass("assessment__buttonShowMeTheAnswer--focus"):a.getExerciseDom().find(".assessment__buttonShowMeTheAnswer").removeClass("assessment__buttonShowMeTheAnswer--focus")};this.interactionApi=new InteractionApi;
c.initInteractionApi(this.interactionApi);this.assessmentManager=new AssessmentManager(this.parent.exerciseId,this.interactionApi,this.isActiveAndAccessibilityEnabled,!1,!0);this.selectedItem(new AssessmentClickableZonesItemBase(this,0))}__extends(a,b);a.prototype.cleanup=function(){b.prototype.cleanup.call(this);this.feedback.cleanup();this.selectedItem()&&this.setSelectedItem(null);for(var c=this.items(),a=0,e=c.length;a<e;a++)c[a].cleanup();this.items.removeAll();return this};a.prototype.loadData=
function(c){this.title(c.exercise.title);this.instruction(c.exercise.instruction);var a=c.exercise["@layout"],e;switch(a){case "AssessmentClickableZonesInlineFeedbackFullscreenLayout":this.inlineFeedbackLayout=!0;case "AssessmentClickableZonesFullscreenLayout":a="iexplore--fullscreen";e="AssessmentClickableZonesWithoutTitleFullscreenLayout";break;case "AssessmentClickableZonesWithTitleInlineFeedbackFullscreenLayout":this.inlineFeedbackLayout=!0;case "AssessmentClickableZoneseWithTitleFullscreenLayout":a=
"iexplore--title";e="AssessmentClickableZonesWithTitleFullscreenLayout";break;default:a="iexplore--fullscreen",e="AssessmentClickableZonesWithTitleFullscreenLayout"}this.layout(a);this.layoutTemplate(e);this.loadMedias(c.exercise.media);this.loadItems(c.exercise.alternatives);this.assessmentManager.initialize(c.exercise.assessment,this.checkResponses.bind(this),this.exerciseComplteted.bind(this),this.retrieveAnswers.bind(this),this.resumeAnswers.bind(this),this.resetAllUserAnswers.bind(this),this.displayAnswerCallback.bind(this));
return b.prototype.loadData.call(this,c)};a.prototype.loadMedias=function(c){if(void 0!=c)for(var c=ArrayHelper.getArrayFromJson(c),a=0,b=c.length;a<b;a++){var f=MediaFactory.createMedia(c[a],!0);f.type==MediaType.sound?this.openingSound=f:f.type==MediaType.image&&(f.addCssClass("background"),this.image(f))}};a.prototype.loadItems=function(c){if(void 0!=c){var a;this.hotspotsVisible="visible"==c["@displaytype"]?!0:!1;c=ArrayHelper.getArrayFromJson(c.alternative);a=[];for(var b=0,f=c.length;b<f;b++){c[b].label&&
(this.hasLabeledItem=!0);var g;g=new AssessmentClickableZonesItemBase(this,b);g.loadData(c[b]);g.visible(this.hotspotsVisible);a.push(g)}this.items(a)}};a.prototype.initDom=function(){b.prototype.initDom.call(this);for(var c=this.items(),a=0,e=c.length;a<e;a++)c[a].initDom();return this};a.prototype.lowImageLoaded=function(){this.isHighQualityLoaded||(this.isLowQualityLoaded=!0,this.displayLowImage(!0),this.requestRendering())};a.prototype.highImageLoaded=function(){this.isHighQualityLoaded=!0;this.displayHighImage(!0);
this.displayLowImage(!1);this.requestRendering()};a.prototype.requestRendering=function(){this.sizeChanged(this.parent.width,this.parent.height)};a.prototype.sizeChanged=function(c,a){var e=this;b.prototype.sizeChanged.call(this,c,a);platformFeatures.getIsPhone()&&uiManager.getIsPhonePortrait()&&this.hasLabeledItem?this.showLabelsInList(!0):this.showLabelsInList(!1);var f=$.Deferred();this.getDomImage().css({display:"none"});var g=this.getDomTitleWrapper()?this.getDomTitleWrapper().outerHeight(!0):
0,h=$(this.getExerciseDom().find(".assessment_submit_button--center")[0]).outerHeight(!0);if(this.showLabelsInList())h=0.7*(a-g-h);else var i=this.getDomContent().outerHeight(!1)-this.getDomContent().height(),h=a-g-h-i;this.getDomIexploreImagesContainer().css({width:this.getDomContent().width(),height:h});this.imageHeight("");h=c/h;this.imageRatio=this.getDomImage().outerWidth(!0)/this.getDomImage().outerHeight(!1);h>this.imageRatio?this.getDomImage().css({height:"100%",width:"auto"}):this.getDomImage().css({height:"auto",
width:"100%"});this.getDomImage().css({display:""});this.image().resize();this.requestAnimationFrame("iexplore_renderHotspots",function(){var c=e.getDomImage().outerHeight(),b=e.getDomIexploreImagesContainer()[0].offsetTop;e.getDomIexploreImagesContainer().css({height:c});e.imageHeight(c+"px");e.hotspotsTop(b+"px");e.renderHotspots(e.getDomIexploreImagesContainer().width(),c);e.labelListHeight(a-g-c-applicationViewModel.timelineViewModel.buttonMenu.outerHeight(!0)+"px");f.resolve()});this.updateScrollbar();
return f.promise()};a.prototype.renderHotspots=function(c){var a,b,f,c=c||this.parent.width;a=this.getDomImage().outerWidth(!0);b=this.getDomImage().outerHeight(!0);c=(c-a)/2;f=this.items();for(var g=0,h=f.length;g<h;g++){var i=f[g];i.sizeChanged(a,b,c);i.hasVisualMedia()&&i.visualMedia.type==MediaType.image&&i.visualMedia.resize()}};a.prototype.start=function(){b.prototype.start.call(this);for(var c=0,a=this.items();c<a.length;c++)a[c].initialize();return this};a.prototype.stop=function(){var c=
this.items();this.feedback&&this.feedback.stop();for(var a=0,e=c.length;a<e;a++)c[a].stop();b.prototype.stop.call(this);return this};a.prototype.reset=function(){for(var c=this.items(),a=0,b=c.length;a<b;a++)c[a].stop(),c[a].visible(!1);this.hideFeedback();return this};a.prototype.loadCompleted=function(){b.prototype.loadCompleted.call(this);this.image().resize();return this};a.prototype.setSelectedItem=function(c){var a=this;this.hasOpeningSound()&&this.openingSound.stop();this.feedback&&this.feedback.stop();
var b=this.selectedItem();b!=c&&(b&&b.stop(),this.selectedItem(c),c&&!this.displaysInline(c)&&(this.assessmentManager.hideCharmBar(),setTimeout(function(){a.feedback.setFeedback(c.visualMedia,c.sound,c.feedbackText);a.feedback.sizeChanged(a.parent.width,a.parent.height);a.image().resize();a.showFeedback();c.videoPlay()},200)))};a.prototype.displaysInline=function(c){var a=this.inlineFeedbackLayout;platformFeatures.getIsPhone()&&c.hasVisualMedia()&&(a=!1);return a};a.prototype.onFeedbackCloseClick=
function(){b.prototype.onFeedbackCloseClick.call(this);var c=this.selectedItem();if(c&&c.visualMedia&&c.visualMedia.type==MediaType.video){var a=c.visualMedia;a.stop();a.isVisible(!1)}this.tabindexTitleComponent(BaseContentViewModel.TITLE_COMPONENT_TABINDEX_ORDER_VALUE);this.setTabindex();c&&$("#"+c.hotspotId).focus();this.isActiveAndAccessibilityEnabled()&&platformFeatures.getIsIE()&&BrowserHelper.refreshDom();this.assessmentManager.showCharmBar();this.selectedItem(null)};a.prototype.setTabindex=
function(){this._tabindex(100);for(var c=this.items(),a=c.length-1;0<=a;a--)c[a].setTabindex()};a.prototype.resetTabindex=function(){this._tabindex(-1);for(var c=this.items(),a=c.length-1;0<=a;a--)c[a].resetTabindex()};return a}(BaseContentViewModel),AssessmentClickableZonesItemBase=function(){function b(a,c){var b=this;this.isCorrect=ko.observable(!1);this.isFound=ko.observable(!1);this.showAnswer=ko.observable(!1);this.isChecked=ko.observable(!1);this.hasBeenClicked=ko.observable(!1);this.showIconFeedback=
ko.observable(!1);this.scrollHeight=ko.observable(0);this.mustScroll=!1;this.isStarted=ko.observable(0);this.sizeLoaded=ko.observable(!1);this.id=GuidHelper.newGuid();this.inlineFeedbackId=GuidHelper.newGuid();this.captionId=GuidHelper.newGuid();this.hotspotId=GuidHelper.newGuid();this.visible=ko.observable(!1);this.originalHeight=this.originalWidth=this.originalY=this.originalX=0;this.isRectangleHotspot=ko.observable(!1);this.width=ko.observable(0);this.height=ko.observable(0);this.x=ko.observable(0);
this.y=ko.observable(0);this.labelNumberTop=ko.observable(0);this.labelNumberLeft=ko.observable(0);this.textLabel=ko.observable("");this.hotspotLabel=localizedText.Accessibility_IexploreZone();this.positionLabel=ko.observable("southwest");this.marginInlineFeedback=10;this.sound=null;this.feedbackText=new MediaText;this.visualMedia=new MediaBase;this.isClickable=ko.observable(!1);this.inlineFeedbackIsVisible=ko.observable(!1);this.inlineFeedbackIsInLeft=ko.observable(!1);this.inlineFeedback=null;this.getDomInlineFeedback=
function(){return null==b.inlineFeedback?null:$("#"+b.inlineFeedback.inlineFeedbackId)};this.getDomHotspots=function(){return null==b.parent?null:b.parent.getDomIexploreImagesContainer()};this.getDomTriangle=function(){return null==b.getDomInlineFeedback()?null:b.getDomInlineFeedback().find(".feedback__inline__triangle")};this.getDomHotspot=function(){return $("#"+b.hotspotId)};this.getDomCaption=function(){return $("#"+b.captionId)};this.getDomLabelNumber=function(){return $(".iexplore__label-number",
b.getDomHotspot())};this._tabindexItem=ko.observable(100);this.isNorth=ko.computed(function(){return"north"==b.positionLabel()});this.isSouth=ko.computed(function(){return"south"==b.positionLabel()});this.isEast=ko.computed(function(){return"east"==b.positionLabel()});this.isWest=ko.computed(function(){return"west"==b.positionLabel()});this.isNorthEast=ko.computed(function(){return"northeast"==b.positionLabel()});this.isNorthWest=ko.computed(function(){return"northwest"==b.positionLabel()});this.isSouthEast=
ko.computed(function(){return"southeast"==b.positionLabel()});this.isSouthWest=ko.computed(function(){return"southwest"==b.positionLabel()});this.isCenter=ko.computed(function(){return"center"==b.positionLabel()});this.fallback=null!=uiManager.screenshotMode||platformFeatures.getIsIE8();this.parent=a;this.positionInItemsList=c+1;this.setTabindex()}b.prototype.initialize=function(){this.isStarted(1)};b.prototype.setTabindex=function(){this._tabindexItem(100*(this.positionInItemsList+1));this.tabindexItem=
this.parent.generateTabIndexComputed("_tabindexItem",this)};b.prototype.resetTabindex=function(){this._tabindexItem(-1)};b.prototype.cleanup=function(){this.stop();this.visualMedia&&this.visualMedia.cleanup();this.sound&&this.sound.cleanup();this.visible(!1)};b.prototype.getOriginalX=function(){return this.originalX};b.prototype.getOriginalY=function(){return this.originalY};b.prototype.getOriginalWidth=function(){return this.originalWidth};b.prototype.getOriginalHeight=function(){return this.originalHeight};
b.prototype.loadData=function(a){var c=this;null!=a["@correct"]&&"true"==a["@correct"]&&this.isCorrect(!0);null!=a["@radiusWidth"]&&(this.originalWidth=parseFloat(a["@radiusWidth"]),this.originalHeight=parseFloat(a["@radiusHeight"]),this.isRectangleHotspot("true"==a["@isRectangle"]),this.isTwoDimensions=!0);this.originalX=parseFloat(a["@xpos"]);this.originalY=parseFloat(a["@ypos"]);this.altNum=+a["@altnum"];0.5<this.originalX&&this.inlineFeedbackIsInLeft(!0);a.label&&(this.textLabel(a.label),this.hotspotLabel+=
", "+this.textLabel());a["@positionCaption"]&&this.positionLabel(a["@positionCaption"]);a.response&&a.response.text&&this.feedbackText.loadData(a.response.text,this.parent.parent.exerciseId);a.response&&this.loadMedias(a.response.media);this.parent.displaysInline(this)?(this.inlineFeedback=new FeedbackInlineViewModel(this.parent.updateScrollbar.bind(this.parent),this.inlineFeedbackIsInLeft()),this.inlineFeedback.setTitle(this.textLabel()),this.inlineFeedback.setContentText(this.feedbackText.text()),
this.inlineFeedback.setContentTextAriaLabel(this.feedbackText.transformStringForAriaLabel()),this.sound&&this.inlineFeedback.setSound(this.sound),this.hasVisualMedia()&&this.inlineFeedback.setMedia(this.visualMedia),this.inlineFeedback.setTabindex(100*(this.positionInItemsList+1),this.parent),this.isClickable(this.inlineFeedback.hasFeedbackMedia()||this.inlineFeedback.hasFeedbackContent()||this.inlineFeedback.hasFeedbackSound()),this.inlineFeedback.setCallbackOnHideFeedbackAfterUpdateScrollbar(function(){if(c.parent!=
null){c.parent.selectedItem()&&$("#"+c.parent.selectedItem().hotspotId).focus();c===c.parent.selectedItem()&&c.parent.setSelectedItem(null)}})):this.isClickable(!StringHelper.isNullOrEmpty(this.visualMedia.url())||null!=this.sound||0!=StringHelper.getHtmlTextLength(this.feedbackText.text()))};b.prototype.loadMedias=function(a){if(void 0!=a){for(var a=ArrayHelper.getArrayFromJson(a),c=a.length,b=0;b<c;b++){var e=MediaFactory.createMedia(a[b],!0);e.type==MediaType.sound?""!=e.url()&&(this.sound=e):
this.visualMedia=e}e.type==MediaType.video&&e.isVisible(!1)}};b.prototype.initDom=function(){null!=this.parent&&this.inlineFeedback&&this.inlineFeedback.initDom(this.getDomHotspot,this.parent.getDomOverview,this.parent.getDom)};b.prototype.sizeChanged=function(a,c,b){var e=this;if(a&&c&&(this.x(Math.floor(b+a*this.getOriginalX())),this.y(Math.floor(c*this.getOriginalY())),this.isTwoDimensions?this.width(Math.floor(a*this.getOriginalWidth())):this.width(Math.floor(c*this.getOriginalHeight())),this.height(Math.floor(c*
this.getOriginalHeight())),platformFeatures.getIsPhone()&&this.width()<this.getDomLabelNumber().outerWidth()&&this.width(this.getDomLabelNumber().outerWidth()),this.getDomHotspots()&&(platformFeatures.getIsIE8()&&this.parent.requestAnimationFrame("iexploreItem_sizechanged"+this.captionId,function(){var c=e.getDomCaption().parent(),a=c.outerHeight(),a=e.height()/2-a/2;("center"==e.positionLabel()||"east"==e.positionLabel()||"west"==e.positionLabel())&&c.css({top:a+"px"})}),this.inlineFeedback&&this.inlineFeedback.inlineFeedbackIsVisible()&&
this.calculateInlineFeedbackPosition(),this.parent.showLabelsInList())))if("center"==this.positionLabel())this.labelNumberLeft(this.width()/2-this.getDomLabelNumber().outerWidth()/2),this.labelNumberTop(this.height()/2-this.getDomLabelNumber().outerHeight()/2);else{a=0;"east"==this.positionLabel()&&(a=0);"southeast"==this.positionLabel()&&(a=1);"south"==this.positionLabel()&&(a=2);"southwest"==this.positionLabel()&&(a=3);"west"==this.positionLabel()&&(a=4);"northwest"==this.positionLabel()&&(a=5);
"north"==this.positionLabel()&&(a=6);"northeast"==this.positionLabel()&&(a=7);for(var c=this.width()/2,b=0,f=2*Math.PI/8,g=0,h=0,i=0;8>i;i++)g=Math.round(this.width()/2+c*Math.cos(b)-this.getDomLabelNumber().outerWidth()/2),h=Math.round(this.height()/2+c*Math.sin(b)-this.getDomLabelNumber().outerHeight()/2),i==a&&(this.labelNumberLeft(g),this.labelNumberTop(h)),b+=f}};b.prototype.calculateInlineFeedbackPosition=function(){var a=this;if(platformFeatures.getIsIE8()){var c=this.parent.getDomViewport().width()/
3;this.getDomInlineFeedback().css("width",c)}else{var c=this.parent.getDomViewport().width()/(platformFeatures.getIsDesktopMode()?4:3),b=this.parent.getDomViewport().width()/2-this.width()/2;platformFeatures.getIsPhone()&&(b=this.inlineFeedback.inlineFeedbackIsInLeft?this.x():this.parent.getDomViewport().width()-this.x()-this.width());var e=c;this.getDomInlineFeedback().css("width",e)}requestAnimationFrame(function(){(new TextStretcher(function(){})).nodeMustBeStretched(a.getDomInlineFeedback(),3)&&
(e=b);a.getDomInlineFeedback().css("width",e);a.inlineFeedback.updatePosition();a.inlineFeedbackIsVisible()||(a.inlineFeedbackIsVisible(!0),a.inlineFeedback.showFeedback())})};b.prototype.onClick=function(){this.parent.parent.isCompleted()?this.isClickable()&&(this.parent.displaysInline(this)||(this.parent.resetTabindex(),this.parent.tabindexTitleComponent(BaseContentViewModel.DISABLED_TABINDEX_ORDER_VALUE)),this.parent.setSelectedItem(this),this.inlineFeedback&&!this.inlineFeedbackIsVisible()?this.calculateInlineFeedbackPosition():
this.stop()):this.isChecked(!this.isChecked())};b.prototype.stop=function(){this.inlineFeedbackIsVisible()&&(this.inlineFeedbackIsVisible(!1),this.visualMedia.stop(),this.inlineFeedback&&this.inlineFeedback.hideInlineFeedback())};b.prototype.videoPlay=function(){var a=this.visualMedia;a&&a.type==MediaType.video&&(a.isVisible(!0),a.play())};b.prototype.hasVisualMedia=function(){return this.visualMedia&&this.visualMedia.hasUrlData()};return b}(),nbCharMaxByLine=50,FillInBlanksCommon=function(b){function a(c){var a=
this;b.call(this,c);this.effect=TextEffect.text;this.fixedSize=!0;this.items=ko.observableArray([]);this.blanks=[];this.ariaLabelWrapper=ko.observable("");this._tabindex=ko.observable(100);this.tabindex=this.generateTabIndexComputed("_tabindex",this);this.globalTextId=GuidHelper.newGuid();this._tabIndexAssessmentFeedback=ko.observable(800);this.tabIndexAssessmentFeedback=this.generateTabIndexComputed("_tabIndexAssessmentFeedback",this);this.forceTabIndex=ko.observable(!1);this.isAssessment=!1;this.emptyFielMode=
!0;this.AllResponsesFound=function(){for(var c=!0,b=0,g=a.blanks.length;b<g;b++){var h=a.blanks[b];a.updateAccessibility(b);h.correct()||(c=!1)}return c};this.generateBehaviorTabIndexComputed=function(c){return a.generateTabIndexComputed(c,a)}}__extends(a,b);a.prototype.loadData=function(c){this.isAssessment=null==c.exercise.assessment?!1:!0;this.title(c.exercise.title);this.instruction(c.exercise.instruction);this.question(c.exercise.question);this.layout("FillInBlanksTemplateLayout");this.layoutTemplate("FillInBlanksTemplateLayout");
this.applySmallSizeLayout();"false"==c.exercise.texts["@fixedsize"]&&(this.fixedSize=!1);void 0!=c.exercise.texts["@effects"]&&""!=c["@effects"]&&(this.effect=c.exercise.texts["@effects"]);"false"==c.exercise.texts["@isEmptyFieldMode"]&&(this.emptyFielMode=!1);this.loadItems(c.exercise.texts);this.loadMedias(c.exercise.media);this.loadResponseWidth();this.assessmentManager&&this.assessmentManager.initialize(c.exercise.assessment,this.AllResponsesFound.bind(this),this.parent.setExerciseCompleted.bind(this.parent),
this.retrieveAnswers.bind(this),this.resumeAnswers.bind(this));return b.prototype.loadData.call(this,c)};a.prototype.sizeChanged=function(){this.updateScrollbar();return $.Deferred().resolve().promise()};a.prototype.start=function(){b.prototype.start.call(this);this.parent.isActive()&&!applicationViewModel.accessibilityViewModel.accessibilityFeaturesActivated()?this.forceTabIndex(!0):this.forceTabIndex(!1);return this};a.prototype.stop=function(){b.prototype.stop.call(this);this.forceTabIndex(!1);
return this};a.prototype.reset=function(){for(var c=0,a=this.blanks.length;c<a;c++)this.blanks[c].reset();return this};a.prototype.render=function(){b.prototype.render.call(this);this.sizeChanged(this.parent.width,this.parent.height);return this};a.prototype.cleanup=function(){b.prototype.cleanup.call(this);for(var c=0,a=this.blanks.length;c<a;c++)this.blanks[c].cleanup();return this};a.prototype.loadItems=function(c){var a=localizedText.Accessibility_TextToFind();this.blanks=[];var b="",f=RegExp("(&lt;br&gt;)",
"g");if(void 0!=c){for(var c=ArrayHelper.getArrayFromJson(c.zone),g=[],h=0,i=0,j=c.length;i<j;i++){var k=c[i];k.text?(g.push(new FillInBlanksItemText(this,k.text)),b+=k.text):k["input-text"]&&(k=new FillInBlanksItemBlank(this,k["input-text"],h),g.push(k),this.blanks.push(k),b+="[[ "+a+" "+(h+1)+" ]]",h++)}this.ariaLabelWrapper(StringHelper.transformStringForAriaLabel(b.replace(f,"\n")));this.items(g)}};a.prototype.updateAccessibility=function(c){if(!(-1==c||c>this.blanks.length-1)){var a=localizedText.Accessibility_TextToFind(),
a=this.ariaLabelWrapper().split("[[ "+a+" "+(c+1)+" ]]"),b="";if(1!=a.length){var f=this.blanks[c],b="";f.validated()||(b=" , "+localizedText.Accessibility_WrongAnswer()+" "+f.response()+" ");f=" , "+localizedText.Accessibility_CorrectAnswer()+" "+f.texts[0]+" ";b=a[0]+b+f+a[1];this.ariaLabelWrapper(this.transformStringForAriaLabel(b));this.focusOn(c+1)}}};a.prototype.focusOn=function(c){c<this.blanks.length&&this.isActiveAndAccessibilityEnabled()&&this.blanks[c]&&$("#"+this.blanks[c].id).focus()};
a.prototype.loadMedias=function(c){if(void 0!=c)for(var c=ArrayHelper.getArrayFromJson(c),a=0,b=c.length;a<b;a++){var f=MediaFactory.createMedia(c[a]);f.type==MediaType.sound&&(this.openingSound=f)}};a.prototype.loadResponseWidth=function(){var c=0;if(this.fixedSize){for(var a=this.items(),b=0,f=a.length;b<f;b++){var g=a[b];g.getMaxResponseLength()>c&&(c=g.getMaxResponseLength())}b=0;for(f=a.length;b<f;b++)a[b].setMaxResponseLength(c)}};a.prototype.koGetItemTemplateName=function(c){return c?c.getTemplate():
"FillInBlanksItemEmptyTemplate"};a.prototype.exerciseEnded=function(){for(var c=!0,a=this.blanks.length-1;0<=a;a--)if(!1==this.blanks[a].validated()){c=!1;break}c&&this.parent&&($("#"+this.globalTextId).focus(),this.parent.setExerciseCompleted())};a.prototype.retrieveAnswers=function(){for(var c={type:"fill-in",correct:"",given:"",weighting:this.parent.getChapter().isAssessment?"1":"0"},a=[],b=[],f=0,g=this.blanks.length;f<g;f++){var h=this.blanks[f];a.push(h.texts);b.push(h.response())}c.correct=
ScormHelper.arrayToString(a);c.given=ScormHelper.arrayToString(b);return c};a.prototype.resumeAnswers=function(c){if(null!=c&&(c=ScormHelper.stringToArray(c),null!=c&&0<c.length))for(var a=0,b=this.blanks.length;a<b;a++)null!=c[a]&&this.blanks[a].response(c[a])};return a}(BaseContentViewModel),FillInBlanksItemBase=function(){function b(a){this.id=GuidHelper.newGuid();this.parent=a}b.prototype.getTemplate=function(){return"FillInBlanksItemEmptyTemplate"};b.prototype.getMaxResponseLength=function(){return-1};
b.prototype.setMaxResponseLength=function(){};return b}(),FillInBlanksItemText=function(b){function a(c,a){b.call(this,c);this.text="";this.text=StringHelper.replace(a,"&nbsp;"," ");this.text=this.text.replace(/&lt;br&gt;/g,"<br />")}__extends(a,b);a.prototype.getTemplate=function(){return"FillInBlanksItemTextTemplate"};return a}(FillInBlanksItemBase),FillInBlanksItemBlank=function(b){function a(c,a,e){var f=this;b.call(this,c);this.textsShuffled=[""];this.correct=ko.observable(!1);this.validated=
ko.observable(!1);this.filled=ko.observable(!1);this.selected=ko.observable(!1);this.isValidateButtonVisible=ko.computed(function(){return f.parent.behavior.revealValidateButton&&(f.selected()||f.parent.isActiveAndAccessibilityEnabled()&&!f.validated())});this.isIconWrongVisible=ko.computed(function(){return f.parent.behavior.revealIconWrong(f.validated(),f.selected(),f.correct(),f.filled())&&!f.parent.isActiveAndAccessibilityEnabled()});this.isIconRightVisible=ko.computed(function(){return f.parent.behavior.revealIconRight(f.validated())});
this.isInputVisible=ko.computed(function(){return f.parent.behavior.revealInput(f.validated())});this.isUserResponseWrongVisible=ko.computed(function(){return f.parent.behavior.revealUserResponseWrong(f.validated())});this.isUserResponseRightVisible=ko.computed(function(){return f.parent.behavior.revealUserResponseRight(f.validated())});this.isUserResponseVisible=ko.computed(function(){return f.parent.behavior.revealUserResponse(f.validated())});this.isSolutionVisible=ko.computed(function(){return f.parent.behavior.revealSolution(f.validated())});
this.response=ko.observable("");this.selectedResponse=ko.observable([""]);this.isLong=ko.observable(!1);this.maxResponseLength=0;this.responseLength=ko.observable(10);this.indexOfBlank=e;this.texts=[];this.loadData(a);this.texts[0].length>nbCharMaxByLine&&this.isLong(!0);this.computedResponse=ko.computed(function(){f.parent.parent.isActive()&&(f.parent.emptyFielMode?f.checkResponse(f.response()):(f.checkResponse(f.selectedResponse()[0]),f.response(f.selectedResponse()[0])))},this)}__extends(a,b);
a.prototype.getTemplate=function(){return this.parent.behavior.getTemplate()};a.prototype.getMaxResponseLength=function(){return this.maxResponseLength};a.prototype.setMaxResponseLength=function(c){c>nbCharMaxByLine&&(c=nbCharMaxByLine);this.maxResponseLength=c;this.responseLength(this.maxResponseLength)};a.prototype.reset=function(){this.response("");this.validated(!1);this.filled(!1)};a.prototype.checkResponse=function(c){if(c&&0<c.length){this.filled(!0);for(var a=0,b=this.texts.length;a<b;a++){if(StringHelper.compareHtmlText(this.texts[a],
c)){this.correct(!0);this.validated(!0);this.parent.exerciseEnded();this.response(c);var f=$("#"+this.id);f&&(this.timerBlurInput=setTimeout(function(){f.blur()},0));this.parent.isAssessment||this.parent.updateAccessibility(this.indexOfBlank);break}else this.correct(!1),this.validated(!1);if(!this.parent.emptyFielMode)break}}else this.filled(!1)};a.prototype.validate=function(){this.response(this.texts[0]);this.selectedResponse([this.texts[0]]);this.validated(!0);this.selected(!1);this.parent.exerciseEnded();
this.parent.updateScrollbar();this.parent.updateAccessibility(this.indexOfBlank);this.parent.focusOn(this.indexOfBlank+1)};a.prototype.select=function(){this.selected(!0);applicationViewModel.keyboardManager.deactivateKeyup()};a.prototype.unselect=function(){var c=this;this.timerUnselect=setTimeout(function(){c.selected(!1)},200);applicationViewModel.keyboardManager.activateKeyup()};a.prototype.loadData=function(c){var a=c.alternatives;if(a){a=ArrayHelper.getArrayFromJson(a.alternative);if(0<a.length){var c=
this.cleanText(a[0].text["#text"]),b=StringHelper.getHtmlTextLength(c);this.texts.push(c);b>this.maxResponseLength&&this.setMaxResponseLength(b)}if(1<a.length)for(var c=a[1].text["#text"],a=c.split(","),f=0,g=a.length;f<g;f++)c=this.cleanText(StringHelper.htmlTrim(a[f])),b=StringHelper.getHtmlTextLength(c),this.texts.push(c),b>this.maxResponseLength&&this.setMaxResponseLength(b)}this.textsShuffled=this.textsShuffled.concat(ArrayHelper.shuffle(this.texts))};a.prototype.cleanText=function(c){StringHelper.startsWith(c,
"\r\n")&&(c=c.substring(2));return c=StringHelper.htmlTrim(c)};a.prototype.cleanup=function(){clearTimeout(this.timerBlurInput);clearTimeout(this.timerUnselect)};return a}(FillInBlanksItemBase),AssessmentFillInBlanksBehavior=function(){function b(a){this.revealValidateButton=!1;this.assessmentManager=a}b.prototype.getTemplate=function(){return"FillInBlanksItemBlankTemplate"};b.prototype.itemsEnabled=function(){return this.assessmentManager.exerciseEnabled()};b.prototype.revealIconRight=function(a){return this.assessmentManager.getExerciseCompleted()&&
a&&this.assessmentManager.showSolution()};b.prototype.revealIconWrong=function(a){return this.assessmentManager.getExerciseCompleted()&&!a&&this.assessmentManager.showSolution()};b.prototype.revealInput=function(){return!this.assessmentManager.getExerciseCompleted()};b.prototype.revealUserResponseWrong=function(a){return this.assessmentManager.getExerciseCompleted()&&!a&&this.assessmentManager.showSolution()};b.prototype.revealUserResponseRight=function(a){return this.assessmentManager.getExerciseCompleted()&&
a&&this.assessmentManager.showSolution()};b.prototype.revealUserResponse=function(){return this.assessmentManager.getExerciseCompleted()&&!this.assessmentManager.showSolution()};b.prototype.revealSolution=function(a){return this.assessmentManager.getExerciseCompleted()&&!a&&this.assessmentManager.showSolution()};return b}(),AssessmentFillInBlanksViewModel=function(b){function a(c){b.call(this,c);var a=new InteractionApi;c.initInteractionApi(a);this.assessmentManager=new AssessmentManager(this.parent.exerciseId,
a,this.isActiveAndAccessibilityEnabled);this.behavior=new AssessmentFillInBlanksBehavior(this.assessmentManager)}__extends(a,b);return a}(FillInBlanksCommon),AssessmentMatchToDropzone=function(){function b(a){this.title=ko.observable("");this.itemScreenReaderDescription=localizedText.Accessibility_DropZone();this.alternatives=[];this.alternativesTrueFalseAnswers=ko.observableArray([]);this.alternativesCorrectAnswers=ko.observableArray([]);this.containerId=GuidHelper.newGuid();this.dropId=GuidHelper.newGuid();
this.tabindexDropzone=ko.observable(-1);this.parent=a}b.prototype.loadData=function(a){null!=a.text&&null!=a.text["#text"]&&(this.title(a.text["#text"]),this.itemScreenReaderDescription=this.title()+", "+localizedText.Accessibility_DropZone());a.image&&null!=a.image.media&&(this.image=MediaFactory.createMedia(a.image.media),this.itemScreenReaderDescription=this.title()+", "+this.image.metadataScreenReaderDescription+", "+localizedText.Accessibility_DropZone())};b.prototype.removeAlternative=function(a){a=
this.alternatives.indexOf(a);-1!=a&&this.alternatives.splice(a,1)};b.prototype.cleanup=function(){};b.prototype.getContainerDom=function(){return $("#"+this.containerId)};b.prototype.enableKeyboardFocus=function(){this.tabindexDropzone(110)};b.prototype.disableKeyboardFocus=function(){this.tabindexDropzone(-1)};b.prototype.setTabIndexDropZone=function(a){this.tabindexDropzone(a)};b.prototype.getTabIndexDropZone=function(){return this.tabindexDropzone()};return b}(),AssessmentMatchToLabelItem=function(){function b(a){this.isAlternativeVisible=
ko.observable(!1);this.correctAnswer=ko.observable(!1);this.iconTrueFalse=ko.observable("X");this.labelItemScreenReaderDescription=localizedText.Accessibility_SelectDestination();this.draggableId=GuidHelper.newGuid();this.alternativeId=GuidHelper.newGuid();this.answerFound=ko.observable(!1);this.cron=null;this._tabindexDragItem=ko.observable(-1);this.isDropped=!1;this.wrapper=this.lastContainerId=null;this.parent=a;this.tabindexDragItem=this.parent.generateTabIndexComputed("_tabindexDragItem",this)}
b.prototype.activateDraggable=function(a){var c=this;this._tabindexDragItem(100);a&&this.parent.parent.setTimeout("dragAccessibilityFocus",function(){$("#"+c.draggableId).focus()},500)};b.prototype.loadData=function(a){this.responseText=a;this.setLabelItemScreenReaderDescription()};b.prototype.setLabelItemScreenReaderDescription=function(a,c){void 0===a&&(a=!0);void 0===c&&(c=!1);this.labelItemScreenReaderDescription=a?this.responseText+", "+localizedText.Accessibility_SelectDestination():c?this.correctAnswer()?
localizedText.Accessibility_CorrectAnswer()+", "+this.responseText:localizedText.Accessibility_WrongAnswer()+", "+this.responseText:this.responseText};b.prototype.onSelectForAccessibility=function(a,c){this.parent.isActiveAndAccessibilityEnabled()&&(this.parent.setSelectedDraggable(this),this.parent.enableKeyboardNavigationOnDropZones());uiManager.stopPropagation(c)};b.prototype.onDragStarted=function(){var a=this;if(platformFeatures.getIsPhone()){this.parent.getExerciseDom().addClass("bounceAll");
setTimeout(function(){a.parent.getExerciseDom().removeClass("bounceAll")},700);if(this.isDropped){this.wrapper=$("#wrapper_"+this.draggableId);this.lastContainerId=this.wrapper.parent().attr("id");var c=$("#"+this.draggableId).offset();this.wrapper.remove();this.parent.getExerciseDom().find(".viewport").append("<div id='tempDiv'></div>");$("#tempDiv").css("position","fixed");$("#tempDiv").offset(c);$("#tempDiv").append(this.wrapper);$("#"+this.draggableId).css("transform","translateZ(0)")}this.cron=
setInterval(function(){a.itemPositionManagement()},500)}};b.prototype.onDragStopped=function(){platformFeatures.getIsPhone()&&(this.isDropped&&(0<$("#tempDiv").children().length&&$("#"+this.lastContainerId).append(this.wrapper),$("#tempDiv").remove()),clearInterval(this.cron))};b.prototype.cleanup=function(){};b.prototype.onDrop=function(){var a=this;this._tabindexDragItem(-1);this.isDropped=!0;if(platformFeatures.getIsPhone()){var c=$("#"+this.draggableId).offset().top,b=document.documentElement.clientHeight/
2,e=this.parent.getExerciseDom().find(".viewport");e.animate({scrollTop:e.scrollTop()-(b-c)},500)}0==this.parent.getDomStickyFooterContent().children().length&&(this.parent.getExerciseDom().find(".assessment_submit_button").addClass("call-to-action--clickMe"),setTimeout(function(){a.parent.getExerciseDom().find(".assessment_submit_button").removeClass("call-to-action--clickMe")},1E3))};b.prototype.itemPositionManagement=function(){var a=this.parent.getExerciseDom().find(".viewport");$("#"+this.draggableId).offset().top<
0.2*document.documentElement.clientHeight?a.animate({scrollTop:a.scrollTop()-200},500):$("#"+this.draggableId).offset().top>0.8*document.documentElement.clientHeight&&a.animate({scrollTop:a.scrollTop()+200},500)};b.prototype.setTabindexDragItem=function(a){this._tabindexDragItem(a)};return b}(),AssessmentMatchToViewModel=function(b){function a(c){b.call(this,c);this.exerciseIntro=ko.observable("");this.containers=ko.observableArray([]);this.alternatives=ko.observableArray([]);this.stackedAlternatives=
[];this.isDragging=ko.observable(!1);this.hasImage=ko.observable(!1);this.userAnswersArray=[];this.correctAnswersArray=[];this.showCorrectAnswersTable=ko.observable(!1);this.correctAnwsersDisplayed=ko.observable(!1);this.correctTableDisplayed=!1;var a=new InteractionApi;c.initInteractionApi(a);this.assessmentManager=new AssessmentManager(this.parent.exerciseId,a,this.isActiveAndAccessibilityEnabled,!1,!0,this.parent.getChapter().isAssessment);this.isDragDropTemplate=!0}__extends(a,b);a.prototype.loadData=
function(c){platformFeatures.getIsPhone()?(this.template("FluidBoxDragAndDropLayout"),this.layoutTemplate("FluidBoxDragAndDropLayout")):this.layoutTemplate("AssessmentMatchToTemplate");this.question(c.exercise.question);this.instruction(c.exercise.instruction);this.loadMedias(c.exercise.media);for(var a=c.exercise["@layout"],b=0,f=ArrayHelper.getArrayFromJson(c.exercise.containers.container),g=0;g<f.length;g++)("AssessmentMultiboxesStandardLayout"==a&&null!=f[g].text["#text"]||-1!=a.indexOf("AssessmentLabeledImages")&&
""!=f[g].image.media["@url"])&&b++;switch(a){case "AssessmentMultiboxesStandardLayout":a=1==b||2==b?"assessmentMatchToTexts--small":"assessmentMatchToTexts--large";break;case "AssessmentLabeledImagesSmallLayout":a="exercise--assessmentMatchToImages--medium--"+b+"columns";break;case "AssessmentLabeledImagesLargeLayout":a="exercise--assessmentMatchToImages--large--"+b+"columns"}this.layout(a);this.loadAlternatives(c.exercise.containers);this.loadContainers(c.exercise.containers);this.alternatives(ArrayHelper.shuffle(this.alternatives()));
this.alternatives()[0]&&(this.alternatives()[0].isAlternativeVisible(!0),this.showStickyFooter());!1==this.parent.getChapter().isAssessment&&this.parent.isCompleted(!1);this.assessmentManager.initialize(c.exercise.assessment,this.checkResponses.bind(this),this.endingAssessmentManagerCallback.bind(this),this.retrieveAnswers.bind(this),this.resumeAnswers.bind(this),this.retryProcess.bind(this),this.displayAnswers.bind(this));this.assessmentManager.resumeLearnerResponses();return this};a.prototype.retryProcess=
function(){this.initializeDraggable();this.displayUserTable();platformFeatures.getIsIE()&&BrowserHelper.refreshDom()};a.prototype.endingAssessmentManagerCallback=function(){this.displayCorrectTable();this.parent.setExerciseCompleted()};a.prototype.displayAnswers=function(){this.toggleDisplayCorrectTable()};a.prototype.allResponsesFound=function(){for(var c=0;c<this.correctAnswersArray.length;c++)for(var a=0;a<this.correctAnswersArray[c].length;a++)if(!this.userAnswersArray[c]||!this.userAnswersArray[c][a]||
-1===this.correctAnswersArray[c].indexOf(this.userAnswersArray[c][a]))return!1;return!0};a.prototype.checkResponses=function(){var c=this.allResponsesFound();if(1==this.assessmentManager.getAttemptsLeft()||c)this.displayCorrectTable();else{this.hideStickyFooter();for(var a=0;a<this.stackedAlternatives.length;a++)try{webkit_DragManager.removeDraggable(this.stackedAlternatives[a].draggableId)}catch(b){logger.info("assessmentMatchTo.removeDragAndDrop error : "+b)}}return c};a.prototype.retrieveAnswers=
function(){var c={type:"matching",correct:"",given:"",weighting:this.parent.getChapter().isAssessment?"1":"0"};c.correct=this.getCorrectAnswersArrayScorm();c.given=this.getUserAnswersArrayScorm();return c};a.prototype.resumeAnswers=function(c){this.userAnswersArray=[];for(var a=0;a<this.correctAnswersArray.length;a++)this.userAnswersArray.push([]);if(null!=c&&"null[.]null"!=c){c=c.split("[,]");for(a=0;a<c.length;a++){var b=c[a].split("[.]");this.userAnswersArray[b[0]].push(decodeURIComponent(b[1]))}}};
a.prototype.getCorrectAnswersArrayScorm=function(){for(var c="",a=0;a<this.correctAnswersArray.length;a++)for(var b=0;b<this.correctAnswersArray[a].length;b++)c+=a+"[.]"+encodeURIComponent(this.correctAnswersArray[a][b])+"[,]";return c=""!=c?c.substring(0,c.length-3):"null[.]null"};a.prototype.getUserAnswersArrayScorm=function(){for(var c="",a=0;a<this.userAnswersArray.length;a++)for(var b=0;b<this.userAnswersArray[a].length;b++)c+=a+"[.]"+encodeURIComponent(this.userAnswersArray[a][b])+"[,]";return c=
""!=c?c.substring(0,c.length-3):"null[.]null"};a.prototype.loadMedias=function(c){if(void 0!=c)for(var c=ArrayHelper.getArrayFromJson(c),a=0,b=c.length;a<b;a++){var f=MediaFactory.createMedia(c[a]);f.type==MediaType.sound&&(this.openingSound=f)}};a.prototype.loadAlternatives=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a.container),b=void 0,e=0;e<a.length;e++)if(b=[],-1!=this.layout().indexOf("assessmentMatchToTexts")&&null!=a[e].text["#text"]||-1!=this.layout().indexOf("assessmentMatchToImages")&&
""!=a[e].image.media["@url"]){var f=a[e].alternatives;if(void 0!=f)for(var f=ArrayHelper.getArrayFromJson(f.alternative),g=0;g<f.length;g++){var h=new AssessmentMatchToLabelItem(this),i="";null!=f[g]["#text"]&&(i=f[g]["#text"],b.push(f[g]["#text"]));h.loadData(i);this.alternatives.push(h);this.stackedAlternatives.push(h)}this.correctAnswersArray.push(b)}};a.prototype.loadContainers=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a.container),b=0,e=a.length;b<e;b++)null!=a[b].image&&
""!==a[b].image.media["@url"]?this.loadContainer(a[b],!0):null!=a[b].text&&null!=a[b].text["#text"]&&this.loadContainer(a[b],!1)};a.prototype.loadContainer=function(a,b){var e=new AssessmentMatchToDropzone(this);e.loadData(a);this.containers.push(e);this.hasImage(b)};a.prototype.resumeAlternatives=function(){for(var a=0;a<this.userAnswersArray.length;a++)for(var b=0;b<this.userAnswersArray[a].length;b++)for(var e=0;e<this.alternatives().length;e++)if(this.userAnswersArray[a][b]==this.alternatives()[e].responseText&&
this.containers()[a].alternatives.length<this.userAnswersArray[a].length){var f=document.getElementById("wrapper_"+this.alternatives()[e].draggableId);this.containers()[a].alternatives.push(this.alternatives()[e]);this.alternatives()[e].isAlternativeVisible(!0);null!=f&&(document.getElementById("droppedzone_"+this.containers()[a].containerId).appendChild(f),document.getElementById(f.id).style.top="0px",document.getElementById(f.id).style.left="0px",this.alternatives().splice(e,1))}this.selectNextItem();
this.updateStickyFooterHeight()};a.prototype.selectNextItem=function(a){var b=this;void 0===a&&(a=!1);0==this.alternatives().length?(this.hideStickyFooter(),this.isActiveAndAccessibilityEnabled()&&this.setTimeout("submitButtonFocus",function(){b.getExerciseDom().find("#assessmentSubmitButton").focus()},500)):null!=this.alternatives()[0]&&(this.alternatives()[0].isAlternativeVisible(!0),this.alternatives()[0].activateDraggable(a))};a.prototype.render=function(){b.prototype.render.call(this);1===this.containers().length?
this.getDom().addClass("assessmentMatchTo--2columns"):this.getDom().addClass("assessmentMatchTo--"+this.containers().length+"columns");return this};a.prototype.sizeChanged=function(a,d){return b.prototype.sizeChanged.call(this,a,d)};a.prototype.start=function(){b.prototype.start.call(this);this.initializeDragAndDrop();this.resumeAlternatives();for(var a=0;a<this.containers().length;a++)this.containers()[a].image&&this.containers()[a].image.play();return this};a.prototype.startThumbnail=function(){var a=
this;b.prototype.startThumbnail.call(this);this.setTimeout("sticky-footer-move-i-e",function(){a.updateStickyFooterHeight();a.setTimeout("sticky-footer-show",function(){a.showStickyFooter()},0)});this.initializeDragAndDrop();return this};a.prototype.stop=function(){b.prototype.stop.call(this);this.disableDropZonesKeyboardFocus();return this};a.prototype.reset=function(){this.isDragging(!1);for(var a=0,b=this.containers().length;a<b;a++)this.containers()[a].alternatives=[];this.userAnswersArray=[];
this.alternatives(this.stackedAlternatives);this.alternatives(ArrayHelper.shuffle(this.alternatives()));this.alternatives()[0].isAlternativeVisible(!0);this.showStickyFooter();return this};a.prototype.swipeStarted=function(){this.stickyOnSwipeStarted();return this};a.prototype.swipeCancelled=function(){this.stickyOnSwipeCancel();return this};a.prototype.swipeEnded=function(){this.stickyOnSwipeCancel();return this};a.prototype.cleanup=function(){try{b.prototype.cleanup.call(this);for(var a=this.containers(),
d=0,e=a.length;d<e;d++)a[d].cleanup();this.containers.removeAll()}catch(f){logger.error("AssessmentMatchToViewModel.cleanup error : "+f)}return this};a.prototype.initializeDragAndDrop=function(){webkit_DragManager.reset();for(var a=this.containers(),b=0,e=a.length;b<e;b++)this.initializeContainerDragAndDrop(a[b]);this.initializeDraggable()};a.prototype.initializeDraggable=function(){for(var a=this,b=0;b<this.stackedAlternatives.length;b++){var e=this.stackedAlternatives[b],f={revert:!0,container:$body[0],
onStart:function(b){return function(){a.isDragging(!0);b.onDragStarted()}}(e),onEnd:function(b){return function(){a.isDragging(!1);b.onDragStopped()}}(e)};try{webkit_DragManager.addDraggable(e.draggableId,f)}catch(g){logger.info("assessmentMatchTo.initializeDragAndDrop error : "+g)}}};a.prototype.initializeContainerDragAndDrop=function(a){logger.info("assessmentMatchTo.initializeContainerDragAndDrop");for(var b=[],e=0;e<this.stackedAlternatives.length;e++)b.push(this.stackedAlternatives[e].draggableId);
e={accept:b,hoverClass:"dropzone--dragging-hover hover",hoverAllDropZone:!0,onDrop:this.onDrop.bind(this,a)};if(null!=b&&0<b.length)try{webkit_DragManager.addDropZone(a.containerId,e),webkit_DragManager.addDropZone(a.dropId,e)}catch(f){logger.info("assessmentMatchTo.initializeDragAndDrop error : "+f)}};a.prototype.onDropAccessibility=function(a){null!=this.selectedDraggable?(this.onDrop(a,document.getElementById(this.selectedDraggable.draggableId)),this.selectedDraggable.tabindexDragItem(-1),this.selectedDraggable=
null):this.resetTabIndexes(a)};a.prototype.resetTabIndexes=function(a){if(!this.correctTableDisplayed)for(var b=0,e=this.containers();b<e.length;b++)for(var f=e[b],g=0,h=f.alternatives;g<h.length;g++){var i=h[g];a===f?i.tabindexDragItem(105):i.tabindexDragItem(-1)}a&&(this.correctTableDisplayed?this.correctAnwsersDisplayed()?this.resetAlternativesTabIndexes(a,a.alternativesCorrectAnswers(),!0):this.resetAlternativesTabIndexes(a,a.alternativesTrueFalseAnswers(),!1):this.parent.setTimeout("dragAccessibilityFocus",
function(){a.alternatives[0]&&$("#"+a.alternatives[0].draggableId).focus()},500))};a.prototype.resetAlternativesTabIndexes=function(a,b,e){for(var f=0,g=this.containers();f<g.length;f++){var h=g[f];if(e)for(var i=0,j=h.alternativesCorrectAnswers();i<j.length;i++){var k=j[i];a===h?k.setTabindexDragItem(a.getTabIndexDropZone()):k.setTabindexDragItem(-1)}else{i=0;for(j=h.alternativesTrueFalseAnswers();i<j.length;i++)k=j[i],a===h?k.setTabindexDragItem(a.getTabIndexDropZone()):k.setTabindexDragItem(-1)}}this.parent.setTimeout("dragAccessibilityFocus",
function(){b[0]&&$("#"+b[0].draggableId).focus()},500);platformFeatures.getIsIE()&&BrowserHelper.refreshDom()};a.prototype.onDrop=function(a,b){$("#droppedzone_"+a.containerId).removeClass("dropzone--dragging-hover");document.getElementById("droppedzone_"+a.containerId).appendChild(b.parentElement);document.getElementById(b.id).style.top="0px";document.getElementById(b.id).style.left="0px";var e=this.getAlternativeById(b.id);e.onDrop();for(var f=0;f<this.alternatives().length;f++)this.alternatives()[f]==
e&&this.alternatives().splice(f,1);this.updateContainers(a,e);this.updateUserAnswersArray();this.selectNextItem(!0);this.updateStickyFooterHeight()};a.prototype.updateContainers=function(a,b){for(var e=[],f=0;f<this.containers().length;f++)for(var e=this.containers()[f].alternatives,g=0;g<e.length;g++)e[g]==b&&this.containers()[f].removeAlternative(b);a.alternatives.push(b)};a.prototype.updateUserAnswersArray=function(){for(var a=[],b=0;b<this.containers().length;b++){a.push([]);for(var e=0;e<this.containers()[b].alternatives.length;e++)a[b].push(this.containers()[b].alternatives[e].responseText)}this.userAnswersArray=
a};a.prototype.getAlternativeById=function(a){for(var b=0;b<this.stackedAlternatives.length;b++)if(this.stackedAlternatives[b].draggableId==a)return this.stackedAlternatives[b]};a.prototype.displayCorrectTable=function(){var a=this;this.createCorrectAnswsers();this.createTrueFalseAnswers();this.showCorrectAnswersTable(!0);this.correctTableDisplayed=!0;this.hideStickyFooter();this.isActiveAndAccessibilityEnabled()&&this.setContainersTabIndexes();setTimeout(function(){var b=a.getExerciseDom().find(".assessment_charm_bar").first().outerHeight(!0);
a.getDomContent().css("padding-bottom",Math.min(0.33*windowHeight,b+(platformFeatures.getIsIPad()?20:0))+"px");a.updateScrollbar()},0)};a.prototype.displayUserTable=function(){this.showCorrectAnswersTable(!1);0<this.alternatives().length&&this.showStickyFooter()};a.prototype.toggleDisplayCorrectTable=function(){var a=this;this.correctAnwsersDisplayed()?(this.correctAnwsersDisplayed(!1),this.getExerciseDom().find(".assessment__buttonShowMeTheAnswer").removeClass("assessment__buttonShowMeTheAnswer--focus"),
this.isActiveAndAccessibilityEnabled()&&0<this.containers().length&&this.setTimeout("dropAccessibilityFocus",function(){$("#assessmentMatchTo__trueFalseAnswers-wrapper__"+a.containers()[0].containerId).focus()},500)):(this.correctAnwsersDisplayed(!0),this.getExerciseDom().find(".assessment__buttonShowMeTheAnswer").addClass("assessment__buttonShowMeTheAnswer--focus"),this.isActiveAndAccessibilityEnabled()&&0<this.containers().length&&this.setTimeout("dropAccessibilityFocus",function(){$("#assessmentMatchTo__correctAnswers-wrapper__"+
a.containers()[0].containerId).focus()},500))};a.prototype.setContainersTabIndexes=function(){for(var a=0;a<this.containers().length;a++)this.containers()[a].setTabIndexDropZone(100*(a+1)+30)};a.prototype.enableKeyboardNavigationOnDropZones=function(){var a=this;if(this.isActiveAndAccessibilityEnabled()){for(var b=0;b<this.containers().length;b++)this.containers()[b].enableKeyboardFocus();this.setTimeout("dropAccessibilityFocus",function(){a.containers()[0].getContainerDom().focus()},500)}};a.prototype.disableKeyboardFocus=
function(){this.tabindexTitleComponent(-1);this.disableDropZonesKeyboardFocus()};a.prototype.disableDropZonesKeyboardFocus=function(){for(var a=0;a<this.containers().length;a++)this.containers()[a].disableKeyboardFocus()};a.prototype.createCorrectAnswsers=function(){for(var a=0;a<this.containers().length;a++){this.containers()[a].alternativesCorrectAnswers([]);for(var b=!1,e=0;e<this.correctAnswersArray[a].length;e++){var b=!1,f=new AssessmentMatchToLabelItem(this);f.loadData(this.correctAnswersArray[a][e]);
if(this.userAnswersArray[a])for(var g=0;g<this.userAnswersArray[a].length;g++)if(this.correctAnswersArray[a][e]==this.userAnswersArray[a][g]){b=!0;f.answerFound(!0);f.iconTrueFalse("\u2714");break}b||f.answerFound(!1);f.setLabelItemScreenReaderDescription(!1,!1);this.containers()[a].alternativesCorrectAnswers.push(f)}}};a.prototype.createTrueFalseAnswers=function(){for(var a=0;a<this.containers().length;a++){this.containers()[a].alternativesTrueFalseAnswers([]);var b=!1;if(this.userAnswersArray[a])for(var e=
0;e<this.userAnswersArray[a].length;e++){var b=!1,f=new AssessmentMatchToLabelItem(this);f.loadData(this.userAnswersArray[a][e]);for(var g=0;g<this.correctAnswersArray[a].length;g++)if(this.userAnswersArray[a][e]==this.correctAnswersArray[a][g]){b=!0;f.correctAnswer(!0);f.iconTrueFalse("\u2714");break}b||f.correctAnswer(!1);f.setLabelItemScreenReaderDescription(!1,!0);this.containers()[a].alternativesTrueFalseAnswers.push(f)}}};a.prototype.getItemsFluidBoxRenderer=function(){return-1!=this.layout().indexOf("assessmentMatchToTexts")?
"AssessmentMatchToTextsItemsFluidBoxRenderer":"AssessmentMatchToImagesItemsFluidBoxRenderer"};a.prototype.hasExerciseIntro=function(){return!StringHelper.isNullOrEmpty(this.exerciseIntro())};a.prototype.setSelectedDraggable=function(a){this.selectedDraggable=a;this.resetTabIndexes()};return a}(BaseContentViewModel),AssessmentMCQItem=function(){function b(a){var c=this;this.id=ko.observable(0);this.textAriaLabel=ko.observable("");this.isCorrect=ko.observable(!1);this.isFound=ko.observable(!1);this.isChecked=
ko.observable(!1);this.isRollOver=ko.observable(!1);this.answerId=GuidHelper.newGuid();this.checkBoxSolutionId="checkbox-solution"+this.answerId;this.getDomCheckBoxSolutionId=function(){return $("#"+c.checkBoxSolutionId)};this._tabindex=ko.observable(120);this.text="";this.computeCheckBoxSolutionStyle=function(){var a="assessmentmcq__answer__checkbox__solution--"+c.id();c.isCorrect()&&(a+=" assessmentmcq__answer__checkbox--right");return a=c.isCheckBoxSolutionVisible()?a+" assessmentmcq__answer__checkbox__solution--show":
a+" assessmentmcq__answer__checkbox__solution--hide"};this.parent=a;this.tabindex=this.parent.generateTabIndexComputed("_tabindex",this);this.isCheckBoxSolutionVisible=ko.computed(function(){return c.parent.parent.isCompleted()&&c.isCorrect()&&c.parent.assessmentManager.showSolution()?c.parent.assessmentManager.showSolution():!1});this.checkBoxSolutionFontIcon=ko.computed(function(){return c.isCorrect()?"\u2713":"x"});this.checkBoxFontIcon=ko.computed(function(){return c.isChecked()?c.parent.hasOnlyOneAnswer()?
"\u29bf":"\u2611":platformFeatures.getIsDesktopMode()&&c.isRollOver()&&a.assessmentManager.exerciseEnabled()?c.parent.hasOnlyOneAnswer()?"\u2299":"\u2680":c.parent.hasOnlyOneAnswer()?"O":"\u2610"});this.checkBoxSolutionStyle=ko.computed(this.computeCheckBoxSolutionStyle)}b.prototype.showCheckBoxRollOverFontIcon=function(){this.isRollOver(!0)};b.prototype.hideCheckBoxRollOverFontIcon=function(){this.isRollOver(!1)};b.prototype.cleanup=function(){};b.prototype.loadData=function(a){this.text=a.text;
this.textAriaLabel(this.text);"true"==a["@correct"]&&this.isCorrect(!0)};b.prototype.onClick=function(){this.parent.assessmentManager.exerciseEnabled()&&(this.parent.hasOnlyOneAnswer()&&this.parent.uncheckAll(),this.isChecked()?(this.uncheck(),this.parent.setAlertContent(localizedText.Accessibility_Unselected()),this.textAriaLabel(this.text)):(this.check(),this.parent.setAlertContent(localizedText.Accessibility_Selected()),this.textAriaLabel(localizedText.Accessibility_Selected()+", "+this.text)))};
b.prototype.check=function(){this.isChecked(!0);this.parent.updateScrollbar()};b.prototype.uncheck=function(){this.isChecked(!1);this.parent.updateScrollbar()};return b}(),AssessmentMCQViewModel=function(b){function a(a){var d=this;b.call(this,a);this.id=GuidHelper.newGuid();this.charmBarId=GuidHelper.newGuid();this.domButtonnext=function(){return $("#buttonnext")};this.questionDetailsId="question-details-"+this.id;this.domQuestionDetails=function(){return $("#"+d.questionDetailsId)};this.isMediaImage=
!1;this.submitButtonId="submit-button-"+this.id;this.getDomSubmitButton=function(){return $("#"+d.submitButtonId)};this.items=ko.observableArray([]);this.media=ko.observable(new MediaBase);this.questionDetails=new MediaText;this.isAllItemsFound=ko.observable(!1);this.computeHasOnlyOneAnswer=function(){for(var a=0,c=0,b=d.items().length;c<b;c++)d.items()[c].isCorrect()&&a++;return 2>a};this.feedbackFontIcon=ko.computed(function(){return d.isAllItemsFound()?"\u2713":"x"});this.isItemsEnable=ko.observable(!0);
this.isRetryMode=ko.observable(!1);this._tabindexQuestionDetails=ko.observable(100);this.tabindexQuestionDetails=this.generateTabIndexComputed("_tabindexQuestionDetails",this);this._tabindex=ko.observable(100);this.tabindex=this.generateTabIndexComputed("_tabindex",this);this._tabSubmitIndex=ko.observable(120);this.tabSubmitIndex=this.generateTabIndexComputed("_tabSubmitIndex",this);this._tabIndexAssessmentFeedback=ko.observable(800);this.tabIndexAssessmentFeedback=this.generateTabIndexComputed("_tabIndexAssessmentFeedback",
this);this.tabindexCalltoAction=120;this.interactionApi=new InteractionApi;a.initInteractionApi(this.interactionApi);this.assessmentManager=new AssessmentManager(this.parent.exerciseId,this.interactionApi,this.isActiveAndAccessibilityEnabled);this.hasOnlyOneAnswer=ko.computed(this.computeHasOnlyOneAnswer)}__extends(a,b);a.prototype.loadData=function(a){this.layout(a.exercise["@layout"]);this.layoutTemplate(a.exercise["@layout"]);this.applyMediumSizeLayout();this.question(a.exercise.question);this.instruction(a.exercise.instruction);
this.questionDetails.loadData(a.exercise.text,this.parent.exerciseId);this.loadAlternatives(a.exercise.alternatives);this.loadMedias(a.exercise.media);this.assessmentManager.initialize(a.exercise.assessment,this.checkResponses.bind(this),this.parent.setExerciseCompleted.bind(this.parent),this.retrieveAnswers.bind(this),this.resumeAnswers.bind(this),this.uncheckAll.bind(this));return b.prototype.loadData.call(this,a)};a.prototype.generateTabIndexComputed=function(a,b){var e=this;return ko.computed({read:function(){return e.isActiveAndAccessibilityEnabled()?
b[a]():-1},write:function(f){if(e.isActiveAndAccessibilityEnabled())b[a](f);else b[a](-1)}})};a.prototype.uncheckAll=function(){for(var a=0,b=this.items().length;a<b;a++)this.items()[a].uncheck()};a.prototype.checkResponses=function(){for(var a=!0,b=0,e=this.items().length;b<e;b++){var f=this.items()[b];f.isCorrect()&&f.isChecked()||!f.isCorrect()&&!f.isChecked()?f.isFound(!0):(f.isFound(!1),a=!1)}this.isAllItemsFound(a);return a};a.prototype.retrieveAnswers=function(){for(var a={type:"choice",correct:"",
given:"",weighting:this.parent.getChapter().isAssessment?"1":"0"},b=[],e=[],f=0,g=this.items().length;f<g;f++){var h=this.items()[f];h.isCorrect()&&b.push(f.toString());h.isChecked()&&e.push(f.toString())}a.correct=ScormHelper.arrayToString(b);a.given=ScormHelper.arrayToString(e);return a};a.prototype.resumeAnswers=function(a){if(null!=a&&(a=ScormHelper.stringToArray(a),null!=a&&0<a.length&&""!=a[0]))for(var b=0;b<a.length;b++)null!=a[b]&&null!=this.items()[a[b]]&&this.items()[a[b]].isChecked(!0)};
a.prototype.getAllRightAnswersText=function(){var a=localizedText.Accessibility_CorrectAnswer()+": ";if(this.assessmentManager.showSolution())for(var b=0,e=this.items().length;b<e;b++){var f=this.items()[b];f.isCorrect()&&(a+=f.text+". ")}return a};a.prototype.loadMedias=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a),b=0,e=a.length;b<e;b++){var f=MediaFactory.createMedia(a[b]);switch(f.type){case MediaType.sound:this.openingSound=f;this.openingSound.onEnded.subscribe(this,this.onSoundEnded);
break;case MediaType.image:this.media(f);this.isMediaImage=!0;break;case MediaType.video:this.media(f)}}};a.prototype.onSoundEnded=function(){this.hasVideo()&&!this.isActiveAndAccessibilityEnabled()&&this.getVideo().play()};a.prototype.loadCompleted=function(){b.prototype.loadCompleted.call(this);return this};a.prototype.start=function(){var a=this;b.prototype.start.call(this);this.hasVideo()&&(this.getVideo().play(),this.hasOpeningSound()&&(platformFeatures.getIsIE8()?this.getVideo().onCanPlay.subscribe(this,
function(){a.getVideo().pause()}):this.getVideo().pause()));this.isMediaImage&&this.media().play();this.isActiveAndAccessibilityEnabled()&&null!=this.getVideo()&&(this.getVideo().pause(),this.media().setTabindex(100));this.parent.isCompleted()&&(this.parent.isCompleted(!1),this.parent.isCompleted(!0));return this};a.prototype.hasVideo=function(){return null!=this.getVideo()&&!StringHelper.isNullOrEmpty(this.getVideo().url())};a.prototype.getVideo=function(){return this.media().type==MediaType.video?
this.media():null};a.prototype.stop=function(){b.prototype.stop.call(this);this.hasVideo()&&(this.getVideo().stop(),this.media().resetTabindex());return this};a.prototype.reset=function(){b.prototype.reset.call(this);for(var a=this.items(),d=0,e=a.length;d<e;d++)a[d].uncheck(),a[d].isChecked(!1);return this};a.prototype.sizeChanged=function(a,d){b.prototype.sizeChanged.call(this,a,d);return $.Deferred().resolve().promise()};a.prototype.cleanup=function(){b.prototype.cleanup.call(this);var a=this.items();
try{for(var d=0,e=a.length;d<e;d++)a[d].cleanup();this.media().cleanup()}catch(f){logger.error("AssessmentMCQViewModel.cleanup error : "+f)}this.items.removeAll();return this};a.prototype.loadAlternatives=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a.alternative),b=0,e=0,f=a.length;e<f;e++){var g=new AssessmentMCQItem(this);g.loadData(a[e]);g.isCorrect()&&(b+=1,g.id(b));null!=g.text&&this.items.push(g)}};return a}(BaseContentViewModel),AssessmentResultItem=function(){function b(a){this.response=
new MediaText;this.text="";this.media=ko.observable(new MediaBase);this.callToAction=null;this.callToActionText="";this.callToActionReset=!1;this.resetModule=null;this.parent=a}b.prototype.loadData=function(a){this.response=this.response.loadData(a.text,this.parent.parent.exerciseId);this.loadMedias(a.media);a.response&&null!=a.response.callToAction&&(this.callToAction=new BranchingLink({destinationType:a.response.callToAction["@destinationType"],destinationId:a.response.callToAction["@destinationId"],
linkType:"calltoaction",linkId:a.response.callToAction["@linkId"],exerciseId:this.parent.parent.exerciseId}),this.callToActionText=a.response.callToAction["@callToActionLabel"],this.callToActionReset=1===parseInt(a.response.callToAction["@callToActionIsReset"]));a.response&&null!=a.response.resetModule&&(this.resetModule=new BranchingLink({destinationType:a.response.resetModule["@destinationType"],destinationId:a.response.resetModule["@destinationId"],linkType:"calltoaction",linkId:a.response.resetModule["@linkId"],
exerciseId:this.parent.parent.exerciseId}));this.min=parseInt(a["@min"]);this.max=parseInt(a["@max"])};b.prototype.loadMedias=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a),c=0,b=a.length;c<b;c++){var e=MediaFactory.createMedia(a[c]);switch(e.type){case MediaType.image:this.media(e)}}};return b}(),AssessmentResultViewModel=function(b){function a(a){b.call(this,a);this.id=GuidHelper.newGuid();this.progressBarId=GuidHelper.newGuid();this.scoreCaptionId=GuidHelper.newGuid();this.imageId=
GuidHelper.newGuid();this._assessmentresultTabIndexes=ko.observable(100);this.assessmentresultTabIndexes=this.generateTabIndexComputed("_assessmentresultTabIndexes",this);this.intervals=[];this.currentInterval=ko.observable(null);this.intervalIndexForPreviewMode=1;this.score=ko.observable(100);this.scoreText=ko.observable("");this.contentHeight=ko.observable(0);this.circleAnimationEnded=ko.observable(!1);this.animationEnded=ko.observable(!1);this.scoreDisplayed=ko.observable(!1);this.hasImage=!1;
this.percentageMode=!0;this.scoreAPI=new ScoreApi;this.interactionApi=new InteractionApi;this.parent.initScoreApi(this.scoreAPI);this.parent.initInteractionApi(this.interactionApi)}__extends(a,b);a.prototype.loadData=function(a){this.layout(a.exercise["@layout"]);this.layoutTemplate(a.exercise["@layout"]);this.applyMediumSizeLayout();this.title(a.exercise.title);this.intervalIndexForPreviewMode=a.exercise["@currentSelected"];this.threshold=a.exercise["@threshold"];"false"==a.exercise["@percentageMode"]&&
(this.percentageMode=!1);this.loadAlternatives(a.exercise.alternatives);this.parent.callToActionRotateAnimation(!0);this.parent.hasRestartButton(null===applicationViewModel.scorm.getNumberOfAttempts()||-1===applicationViewModel.scorm.getNumberOfAttempts()||1<applicationViewModel.scorm.getNumberOfAttempts());this.scoreText(a.exercise.score?a.exercise.score:"");return b.prototype.loadData.call(this,a)};a.prototype.computeScoreText=function(){var a;a=applicationViewModel.ajaxLoader.getRuntimeMode()==
EnumRuntimeMode.DRAFT||this.parent.screenshotMode?20:this.scoreAPI.getNumberOfInteraction();var b="",b=this.percentageMode?this.score()+"%":Math.round(this.score()/100*a).toFixed(0)+"/"+a;this.scoreText(this.scoreText().replace("[X%]",b).replace("[X]",b))};a.prototype.computeScore=function(){if(applicationViewModel.ajaxLoader.getRuntimeMode()==EnumRuntimeMode.DRAFT||this.parent.screenshotMode)this.currentInterval(this.intervals[this.intervalIndexForPreviewMode]),this.score(Math.ceil((this.currentInterval().min+
this.currentInterval().max)/2));else{this.score(this.scoreAPI.computeScore(this.threshold));var a=null,b;for(b in this.intervals){var e=this.intervals[b];this.score()>=e.min&&this.score()<=e.max&&(a=e)}this.currentInterval(a)}this.computeScoreText()};a.prototype.loadCompleted=function(){b.prototype.loadCompleted.call(this);return this};a.prototype.startThumbnail=function(){this.computeScore();this.hasImage=!StringHelper.isNullOrEmpty(this.currentInterval().media().url());$("#"+this.progressBarId).length&&
!platformFeatures.getIsIE8()&&(this.circleThreshold=new ProgressBar.Circle("#"+this.progressBarId,{strokeWidth:6,trailWidth:6,text:{value:this.percentageMode?this.score():"x/y",className:"progressBar__percentage-text",autoStyle:!1}}),this.circleThreshold.svg.setAttribute("style","position:relative;"),this.circleThreshold.path.setAttribute("class","progressbar__scoreSvg--passed"),this.circleThreshold.path.removeAttribute("stroke"),this.circleThreshold.trail.removeAttribute("stroke"),this.circleThreshold.trail.setAttribute("class",
"progressbar__trail"),this.circleThreshold.set(0.33));return this};a.prototype.start=function(){var a=this;setTimeout(function(){a.parent.getDomCallToAction().hide()});b.prototype.start.call(this);this.computeScore();this.hasImage=!StringHelper.isNullOrEmpty(this.currentInterval().media().url());if($("#"+this.progressBarId).length&&!platformFeatures.getIsIE8()&&!platformFeatures.getIsIE9()){this.circleThreshold=new ProgressBar.Circle("#"+this.progressBarId,{strokeWidth:6,trailWidth:6});this.circleThreshold.path.removeAttribute("stroke");
this.circleThreshold.trail.removeAttribute("stroke");this.circleThreshold.path.setAttribute("class","progressbar__threshold");this.circleThreshold.trail.setAttribute("class","progressbar__trail");this.circleThreshold.set(this.threshold/100);var d;d=applicationViewModel.ajaxLoader.getRuntimeMode()==EnumRuntimeMode.DRAFT||this.parent.screenshotMode?20:this.scoreAPI.getNumberOfInteraction();this.circle=new ProgressBar.Circle("#"+this.progressBarId,{strokeWidth:6,text:{value:this.percentageMode?"0":"0/"+
d,className:"progressBar__percentage-text",autoStyle:!1}});this.circle.path.setAttribute("class","progressbar__scoreSvg--notPassed");this.circle.path.removeAttribute("stroke");setTimeout(function(){a.circle.animate(a.score()/100,{duration:0===a.score()?0:3E3,easing:"easeOut",step:function(b,d){if(a.percentageMode)d.setText(Math.abs(100*d.value()).toFixed(0)+"");else{var g=a.scoreAPI.getNumberOfInteraction();if(applicationViewModel.ajaxLoader.getRuntimeMode()==EnumRuntimeMode.DRAFT||a.parent.screenshotMode)g=
20;var h=Math.round(d.value()*g).toFixed(0);d.setText(h+"/"+g)}parseInt(Math.abs(100*d.value()).toFixed(0))>=a.threshold&&(a.circle.path.setAttribute("class","progressbar__scoreSvg--passed"),a.circle.svg.setAttribute("class","progressbar__thresholdPassed"),a.circleThreshold.svg.setAttribute("class","progressbar__thresholdPassed"))}},function(){setTimeout(function(){a.circleAnimationEnded(!0)},500)})},500);$("#"+this.progressBarId).cssPromise().then(function(){a.animationEnded(!0)});$("#"+this.scoreCaptionId).cssPromise().then(function(){a.scoreDisplayed(!0);
a.updateScrollbar();a.hasImage&&a.currentInterval().media().play();a.setTimeout("checkExerciseCompleted",function(){a.setCompleted()},1E3)})}else this.circleAnimationEnded(!0),this.animationEnded(!0),this.scoreDisplayed(!0),this.setTimeout("checkExerciseCompleted",function(){a.setCompleted()},500);this.isActiveAndAccessibilityEnabled()&&(this.openingSound.pause(),this.openingSound.setTabindex(90));this.fixHeightInIE();return this};a.prototype.setCompleted=function(){null!=this.currentInterval().callToAction?
(this.parent.callToActionBranchingLinkId=parseInt(this.currentInterval().callToAction.linkId),this.parent.callToActionText=StringHelper.htmlTrim(this.currentInterval().callToActionText),this.parent.hasCallToAction(!0),this.currentInterval().callToActionReset&&(this.parent.callToActionReset(!0),this.parent.hasCallToAction(!1))):(this.parent.callToActionBranchingLinkId=null,this.parent.callToActionReset(!1),this.parent.hasCallToAction()||(this.parent.callToActionText=""));this.parent.resetBranchingLinkId=
null!=this.currentInterval().resetModule?parseInt(this.currentInterval().resetModule.linkId):null;this.parent.getDomCallToAction().show();this.parent.setExerciseCompleted()};a.prototype.stop=function(){b.prototype.stop.call(this);!platformFeatures.getIsIE8()&&!platformFeatures.getIsIE9()&&(this.circle&&null!=this.circle.svg&&this.circle.destroy(),null!=this.circleThreshold.svg&&this.circleThreshold.destroy());this.circleAnimationEnded(!1);this.animationEnded(!1);this.scoreDisplayed(!1);this.parent.showCallToAction(!1);
this.parent.showConfirmButtonRestart(!1);this.reset();return this};a.prototype.reset=function(){b.prototype.reset.call(this);return this};a.prototype.sizeChanged=function(a,b){this.contentHeight(b-this.getDomTitleWrapper().outerHeight(!0));this.fixHeightInIE();return $.Deferred().resolve().promise()};a.prototype.fixHeightInIE=function(){platformFeatures.isIE&&$("#"+this.progressBarId).height($("#"+this.progressBarId).width())};a.prototype.cleanup=function(){b.prototype.cleanup.call(this);this.circleAnimationEnded(!1);
this.animationEnded(!1);this.scoreDisplayed(!1);return this};a.prototype.loadAlternatives=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a.alternative),b=0,e=a.length;b<e;b++){var f=new AssessmentResultItem(this);f.loadData(a[b]);null!=f.text&&this.intervals.push(f)}};return a}(BaseContentViewModel),BrandedOutroViewModel=function(b){function a(a){var d=this;b.call(this,a);this.brandAnimationStarted=ko.observable(!1);this.brandedVideoId=GuidHelper.newGuid();this.brandedVideoControlId=
GuidHelper.newGuid();this.brandedVideoFilePath=ko.observable("");this._startTabIndex=ko.observable(1);this.startTabIndex=this.generateTabIndexComputed("_startTabIndex",this);this.sound=ko.observable(new MediaSound);this.soundHasBeenPlayed=!1;this.animateVisualElements=ko.observable(!1);this.imageLoaded=!1;this.getBrandedVideoPlayer=function(){return $("#"+d.brandedVideoId)};this.getBrandedVideoControl=function(){return $("#"+d.brandedVideoControlId)};this.loadSkinData()}__extends(a,b);a.prototype.loadSkinData=
function(){var a=SkinManager.getInstance();this.soundPath=a.getTemplateSetting(this.parent.templateName,"sound",!0);this.sound().url(this.soundPath);this.brandedVideoFilePath(a.getTemplateSetting(this.parent.templateName,"animatedLogo",!0))};a.prototype.loadData=function(a){this.layout("BrandedOutroStandardLayout");this.layoutTemplate("BrandedOutroStandardLayout");this.applySmallSizeLayout();return b.prototype.loadData.call(this,a)};a.prototype.start=function(){b.prototype.start.call(this);var a=
this.getBrandedVideoPlayer()[0];a.addEventListener("ended",this.onBrandedVideoEndend.bind(this));a.addEventListener("pause",this.showVideoControls.bind(this));a.addEventListener("playing",this.hideVideoControls.bind(this));this.playBrandedVideo();this.parent.setExerciseCompleted();return this};a.prototype.stop=function(){if(a){var a=this.getBrandedVideoPlayer()[0];a.pause()}this.brandedVideoFilePath("");b.prototype.stop.call(this);return this};a.prototype.cleanup=function(){try{var a=this.getBrandedVideoPlayer()[0];
a&&(a.removeEventListener("ended",this.onBrandedVideoEndend.bind(this)),a.removeEventListener("pause",this.showVideoControls.bind(this)),a.removeEventListener("playing",this.hideVideoControls.bind(this)),$(a).src="",$(a).load(),$(a).remove());b.prototype.cleanup.call(this)}catch(d){logger.error("EndingViewModel.cleanup error : "+d)}return this};a.prototype.playBrandedVideo=function(){var a=this,b=this.getBrandedVideoPlayer()[0];b.play();this.setTimeout("checkAutoplay",function(){b.paused&&a.showVideoControls()},
1E3)};a.prototype.showVideoControls=function(){var a=this.getBrandedVideoControl()[0];$(a).removeClass("playing").addClass("paused")};a.prototype.hideVideoControls=function(){var a=this.getBrandedVideoControl()[0];$(a).removeClass("paused").addClass("playing")};a.prototype.onBrandedVideoEndend=function(){var a=this;this.hideVideoControls();this._startTabIndex(-1);if(platformFeatures.getIsQQBrowser()){var d=this.getBrandedVideoPlayer()[0];d.style.display="none";setTimeout(function(){d.style.display=
"";a.showVideoControls()},1500)}b.prototype.start.call(this)};a.prototype.startThumbnail=function(){this.showVideoControls();return this};return a}(BaseContentViewModel),BrandedIntroViewModel=function(b){function a(a){var d=this;b.call(this,a);this.brandAnimationFinished=ko.observable(!1);this.titleId=GuidHelper.newGuid();this.titleIsVisible=ko.observable(!1);this.subtitle=ko.observable("");this.subtitleId=GuidHelper.newGuid();this.subtitleIsVisible=ko.observable(!1);this.image=ko.observable(new MediaImage);
this.imageId=GuidHelper.newGuid();this.imageIsVisible=ko.observable(!1);this.hasSubtitle=ko.observable(!1);this.hasImage=ko.observable(!1);this.hasTitle=ko.observable(!1);this.brandedVideoId=GuidHelper.newGuid();this.brandedVideoControlId=GuidHelper.newGuid();this.brandedVideoFilePath=ko.observable("");this.soundHasBeenPlayed=!1;this.animateVisualElements=ko.observable(!1);this._titlesIntroTabindex=ko.observable(10);this.titlesIntroTabindex=this.generateTabIndexComputed("_titlesIntroTabindex",this);
this._introTabindex=ko.observable(100);this.introTabindex=this.generateTabIndexComputed("_introTabindex",this);this._startTabIndex=ko.observable(2);this.startTabIndex=this.generateTabIndexComputed("_startTabIndex",this);this.getDomImage=function(){return $("#"+d.imageId)};this.getDomTitleIntro=function(){return $("#"+d.titleId)};this.getDomSubtitle=function(){return $("#"+d.subtitleId)};this.getBrandedVideoPlayer=function(){return $("#"+d.brandedVideoId)};this.getBrandedVideoControl=function(){return $("#"+
d.brandedVideoControlId)};this.loadSkinData()}__extends(a,b);a.prototype.loadSkinData=function(){this.brandedVideoFilePath(SkinManager.getInstance().getTemplateSetting(this.parent.templateName,"animatedLogo",!0))};a.prototype.loadData=function(a){this.loadTexts(a);this.layout("BrandedIntroStandardLayout");this.layoutTemplate("BrandedIntroStandardLayout");this.applyMediumSizeLayout();this.loadMedias(a.exercise.media);return b.prototype.loadData.call(this,a)};a.prototype.playBrandedVideo=function(){var a=
this,b=this.getBrandedVideoPlayer()[0];b.play();this.setTimeout("checkAutoplay",function(){b.paused&&a.showVideoControls()},1E3)};a.prototype.showVideoControls=function(){var a=this.getBrandedVideoControl()[0];$(a).removeClass("playing").addClass("paused")};a.prototype.hideVideoControls=function(){var a=this.getBrandedVideoControl()[0];$(a).removeClass("paused").addClass("playing")};a.prototype.onBrandedVideoEndend=function(){this.hideVideoControls();this._startTabIndex(-1);this.brandAnimationFinished(!0);
platformFeatures.getIsQQBrowser()&&(this.getBrandedVideoPlayer()[0].style.display="none");b.prototype.start.call(this);this.checkExerciseIsCompleted()};a.prototype.initDom=function(){b.prototype.initDom.call(this);var a=this.getBrandedVideoPlayer()[0];a.addEventListener("ended",this.onBrandedVideoEndend.bind(this));a.addEventListener("pause",this.showVideoControls.bind(this));a.addEventListener("playing",this.hideVideoControls.bind(this));return this};a.prototype.start=function(){!1==this.brandAnimationFinished()?
this.playBrandedVideo():b.prototype.start.call(this);return this};a.prototype.stop=function(){var a=this.getBrandedVideoPlayer()[0];a&&a.pause();this.brandedVideoFilePath("");b.prototype.stop.call(this);return this};a.prototype.startThumbnail=function(){this.brandAnimationFinished(!0);return this};a.prototype.cleanup=function(){try{var a=this.getBrandedVideoPlayer()[0];a&&(a.removeEventListener("ended",this.onBrandedVideoEndend.bind(this)),a.removeEventListener("pause",this.showVideoControls.bind(this)),
a.removeEventListener("playing",this.hideVideoControls.bind(this)),$(a).src="",$(a).load(),$(a).remove());b.prototype.cleanup.call(this)}catch(d){logger.error("IntroViewModel.cleanup error : "+d)}return this};a.prototype.loadTexts=function(a){this.loadTitle(a);this.loadSubtitle(a)};a.prototype.loadTitle=function(a){var b=!0;a.exercise.title&&a.exercise.title["@useModuleTitle"]&&(b="false"==a.exercise.title["@useModuleTitle"]?!1:!0);a=b?applicationViewModel.courseName():a.exercise.title["#text"];this.title(a);
a&&this.hasTitle(!0)};a.prototype.loadSubtitle=function(a){for(var b,e=!0,a=ArrayHelper.getArrayFromJson(a.exercise.text),f=0,g=a.length;f<g;f++){var h=a[f];"subtitle"==h["@name"]&&(h["@useModuleDescription"]&&(e="false"==h["@useModuleDescription"]?!1:!0),b=e?applicationViewModel.courseDescription():h["#text"])}this.subtitle(b);b&&this.hasSubtitle(!0)};a.prototype.loadMedias=function(a){if(void 0!=a){for(var a=ArrayHelper.getArrayFromJson(a),b=0,e=a.length;b<e;b++){var f=MediaFactory.createMedia(a[b]);
f.type==MediaType.sound?(this.openingSound=f,this.openingSound.onEnded.subscribe(this,this.onSoundEnded)):f.type==MediaType.image&&(this.image(f),this.hasImage(!0))}this.hasOpeningSound()||(this.soundHasBeenPlayed=!0)}};a.prototype.sizeChanged=function(a,d){b.prototype.sizeChanged.call(this,a,d);this.image().resize();return $.Deferred().resolve().promise()};a.prototype.checkExerciseIsCompleted=function(){this.soundHasBeenPlayed&&this.brandAnimationFinished()&&this.parent.setExerciseCompleted();return this.soundHasBeenPlayed?
!0:!1};a.prototype.onSoundEnded=function(){this.soundHasBeenPlayed=audioPlayer instanceof Html5AudioPlayer?this.openingSound.hasBeenPlayed():!0;this.checkExerciseIsCompleted()};return a}(BaseContentViewModel),BulletPointViewModel=function(b){function a(a){var d=this;b.call(this,a);this.currentBulletPointItemIndex=-1;this.TIME_BULLET_POINT_DISPLAY=1500;this.bulletImageUrl="images/bullet.png";this.bulletImageHeight=this.bulletImageWidth=0;this.items=ko.observableArray([]);this.bulletPoints=ko.observableArray([]);
this.introItem=ko.observable(null);this.conclusionItem=ko.observable(null);this.domIntro=function(){return $(".intro",d.parent.getExerciseDom())};this._tabindex=ko.observable(100);this.tabindex=this.generateTabIndexComputed("_tabindex",this);this.loadBulletPointUrl();this.allBulletHasBeenRead=ko.observable(!1)}__extends(a,b);a.prototype.loadData=function(a){this.log("info","loadData","loading");this.title(a.exercise.title);this.layoutTemplate("BulletPointStandardLayout");var d=this.bulletsContainsSound(a.exercise.bulletPoints);
this.log("info","loadData","bulletsContainSound: "+(d?"true":"false"));this.LoadBulletPoints((new MediaText).loadData(a.exercise.intro.text,this.parent.exerciseId).text(),a.exercise.media,a.exercise.bulletPoints,(new MediaText).loadData(a.exercise.conclusion.text,this.parent.exerciseId).text(),d);this.loadBulletImageSize();this.applySmallSizeLayout();return b.prototype.loadData.call(this,a)};a.prototype.initDom=function(){b.prototype.initDom.call(this);for(var a=this.items(),d=0,e=a.length;d<e;d++)a[d].initDom();
return this};a.prototype.sizeChanged=function(a,b){this.log("info","sizeChanged","width: "+a+" height: "+b);this.overviewHeight=this.getDom().innerHeight();this.titleHeight=this.getDomTitleWrapper().outerHeight(!0);this.scrolledHeightContent=parseInt(this.getDomOverview().css("top"));this.updateScrollbar();this.itemsSizeChanged();return $.Deferred().resolve().promise()};a.prototype.start=function(a){void 0===a&&(a=-1);b.prototype.start.call(this);this.log("info","start","starting",a);this.currentBulletPointItemIndex=
a;this.loadNextBullet();this.bindClick();return this};a.prototype.bindClick=function(){var a=this;this.getExerciseDom().on("click.bulletpoint",function(b){if(a.getDomScrollbar().find(b.target).length)return!1;if("A"==b.target.tagName)return!0;a.forceEndCurrentBullet();return!1})};a.prototype.unbindClick=function(){this.getExerciseDom().unbind("click.bulletpoint")};a.prototype.startThumbnail=function(){this.displayAllBulletPoints();return this};a.prototype.stop=function(){b.prototype.stop.call(this);
this.log("info","stop","stopping");this.resetAllBulletPoints();this.unbindClick();this.updateScrollbar(ScrollbarManager.TOP);return this};a.prototype.reset=function(){this.resetAllBulletPoints();return this};a.prototype.cleanup=function(){this.log("info","cleanup");try{b.prototype.cleanup.call(this);for(var a=this.items(),d=0,e=a.length;d<e;d++)a[d].cleanup();this.items.removeAll();this.allBulletHasBeenRead(!1)}catch(f){this.log("error","cleanup","error: "+f)}return this};a.prototype.forceEndCurrentBullet=
function(){var a=this.items();a.length>=this.currentBulletPointItemIndex+1&&a[this.currentBulletPointItemIndex].clearEndTimeout().end(!0)};a.prototype.loadBulletPointUrl=function(){this.bulletImageUrl=SkinManager.getInstance().getTemplateSetting("bulletPoint","bulleturl",!0)};a.prototype.itemsSizeChanged=function(){for(var a=this.items(),b=0,e=a.length;b<e;b++)a[b].sizeChanged(this.parent.width,this.parent.height,this.bulletImageWidth,this.bulletImageHeight)};a.prototype.loadBulletImageSize=function(){var a=
this,b=new Image;b.onload=function(){a.parent.loader.done(function(){a.bulletImageWidth=b.width;a.bulletImageHeight=b.height;a.itemsSizeChanged()})};b.src=this.bulletImageUrl};a.prototype.resetAllBulletPoints=function(){for(var a=this.items(),b=0,e=a.length;b<e;b++)a[b].reset()};a.prototype.displayAllBulletPoints=function(){for(var a=this.items(),b=0,e=a.length;b<e;b++)a[b].display()};a.prototype.LoadBulletPoints=function(a,b,e,f,g){var h=[],i=[],j;j=new BulletPointItem(this,this.bulletImageUrl);
j.loadData(a,b,BulletPointType.INTRODUCTION,this.TIME_BULLET_POINT_DISPLAY,g,!1,!1);this.introItem(j);h.push(j);if(void 0!=e){a=ArrayHelper.getArrayFromJson(e.bulletPoint);b=0;for(e=a.length;b<e;b++)j=new BulletPointItem(this,this.bulletImageUrl),j.loadData((new MediaText).loadData(a[b].text,this.parent.exerciseId).text(),a[b].media,BulletPointType.ITEM,this.TIME_BULLET_POINT_DISPLAY,g,0==b,b==a.length-1),h.push(j),i.push(j)}a=new BulletPointItem(this,this.bulletImageUrl);a.loadData(f,null,BulletPointType.CONCLUSION,
this.TIME_BULLET_POINT_DISPLAY,g,!1,!1);this.conclusionItem(a);h.push(a);this.bulletPoints(i);this.items(h)};a.prototype.bulletsContainsSound=function(a){var b=!1;if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a.bulletPoint),e=0,f=a.length;e<f;e++){var g=a[e].media;if(g&&g["@url"]&&null!=g["@url"]&&""!=g["@url"]){b=!0;break}}return b};a.prototype.loadNextBullet=function(a){void 0===a&&(a=!1);this.log("info","loadNextBullet");this.currentBulletPointItemIndex++;var b=this.items();b.length>=this.currentBulletPointItemIndex+
1?b[this.currentBulletPointItemIndex].start(a):(this.allBulletHasBeenRead(!0),this.parent.setExerciseCompleted());this.updateScrollbar();platformFeatures.getIsIPad()&&b.length-1==this.currentBulletPointItemIndex&&this.parent.getExerciseDom().css("-webkit-transform","translate3d(0, 0, 0)")};return a}(BaseContentViewModel),BulletPointType;(function(b){b[b.INTRODUCTION=0]="INTRODUCTION";b[b.ITEM=1]="ITEM";b[b.CONCLUSION=2]="CONCLUSION"})(BulletPointType||(BulletPointType={}));
var BulletPointItem=function(){function b(a,c){var b=this;this.id=GuidHelper.newGuid();this.text="";this.bulletImageUrl=ko.observable("");this.bulletImageWidth=ko.observable(0);this.bulletImageHeight=ko.observable(0);this.isBulletPoint=ko.observable(!1);this.isIntro=ko.observable(!1);this.isConclusion=ko.observable(!1);this.isFirst=ko.observable(!1);this.isLast=ko.observable(!1);this.isActive=ko.observable(!1);this.isVisited=ko.observable(!1);this.isPlayingBack=ko.observable(!1);this.hasStarted=ko.observable(!1);
this.isEndingForced=ko.observable(!1);this.isPreviousEndedForced=ko.observable(!1);this.wasPreviousForcedEnding=ko.observable(!1);this.sound=null;this.barHeight=ko.observable(0);this.getDomBullet=function(){return $("#"+b.id)};this.getDomBulletIcon=function(){return b.getDomBullet().find(".bullet__points__icon")};this.ariaLabelItem=ko.observable("");this.parent=a;this.bulletImageUrl(c)}b.prototype.loadData=function(a,c,b,e,f,g,h){this.TIME_BULLET_POINT_DISPLAY=e;this.bulletsContainSound=f;a&&(this.text=
a,this.ariaLabelItem(this.parent.transformStringForAriaLabel(this.text)));this.isBulletPoint(BulletPointType.ITEM==b);this.isIntro(BulletPointType.INTRODUCTION==b);this.isConclusion(BulletPointType.CONCLUSION==b);this.isFirst(g);this.isLast(h);c&&""!=c["@url"]&&(a=MediaFactory.createMedia(c),null!=a&&a.type==MediaType.sound&&""!=a.url()&&(this.sound=a,this.sound.setTranscriptDisplayedAsList(this.isBulletPoint()),this.ariaLabelItem(this.ariaLabelItem()+".\n"+localizedText.Accessibility_AudioToggle())))};
b.prototype.reset=function(){this.isActive(!1);this.isPlayingBack(!1);this.isVisited(!1);this.hasStarted(!1);this.isPreviousEndedForced(!1);this.wasPreviousForcedEnding(!1);this.clearEndTimeout();this.sound&&this.sound.stop()};b.prototype.display=function(){this.log("info","display","displaying");this.isVisited(!0)};b.prototype.initDom=function(){this.bulletPosition=this.getDomBullet().position();this.bulletHeight=this.getDomBullet().height()};b.prototype.cleanup=function(){this.log("info","cleanup",
"cleaning up");try{null!=this.sound&&this.sound.cleanup()}catch(a){this.log("error","cleanup","error "+a)}};b.prototype.start=function(a){var c=this;void 0===a&&(a=!1);this.log("info","start","starting");var b=null!=this.parent.introItem().text&&""!=this.parent.introItem().text;a&&(this.isPreviousEndedForced(!0),this.wasPreviousForcedEnding(!0));this.display();this.isActive(!0);this.hasStarted(!0);if(this.parent.isActiveAndAccessibilityEnabled())this.end();else if(this.parent.scrollIfNecessary(this.bulletPosition,
this.isIntro()||!b&&this.isFirst()),this.sound&&this.bulletsContainSound?(this.log("info","start","setting onEnded for waitEndOfGlobalSound"),this.sound.onEnded.subscribe(this,this.onSoundEnded)):(this.log("info","start","setting timeout for end"),this.parent.setTimeout("endBulletPoint"+this.id,function(){c.end()},this.TIME_BULLET_POINT_DISPLAY)),this.sound)this.log("info","start","playing sound"),this.toggleSound()};b.prototype.stop=function(){this.log("info","stop","stopping");this.isActive(!1);
this.sound&&(this.sound.onEnded.unSubscribe(this,this.onSoundEnded),this.sound.stop())};b.prototype.toggleSound=function(){this.sound.toggle()};b.prototype.sizeChanged=function(a,c,b,e){var f=this;this.log("info","sizeChanged","changing size");a*=0.05;c*=0.05;b/a>e/c?(this.bulletImageWidth(a),0<b&&this.bulletImageHeight(this.bulletImageWidth()*e/b)):(this.bulletImageHeight(c),0<e&&this.bulletImageWidth(this.bulletImageHeight()*b/e));this.bulletPosition=this.getDomBullet().position();this.bulletHeight=
this.getDomBullet().height();if(platformFeatures.isFirefox||platformFeatures.isIE)this.getDomBulletIcon().height(""),this.parent.setTimeout("bulletPointResize"+this.id,function(){f.getDomBulletIcon().height(f.getDomBulletIcon().height())},0)};b.prototype.onSoundEnded=function(){this.log("info","onSoundEnded","checking html5 ?"+(audioPlayer instanceof Html5AudioPlayer?"true":"false"));(audioPlayer instanceof Html5AudioPlayer?this.sound.hasBeenPlayed():1)?(this.log("info","onSoundEnded","sound has been marked as it has been played"),
this.end()):this.log("info","onSoundEnded","sound has NOT been marked as it has been played")};b.prototype.clearEndTimeout=function(){this.parent.clearTimeout("endBulletPoint"+this.id);return this};b.prototype.end=function(a){void 0===a&&(a=!1);this.log("info","end","ended");this.bulletsContainSound&&(this.log("info","end","waitEndOfGlobalSound = true => stopping"),this.stop());this.isActive(!1);this.isPlayingBack(!1);this.isEndingForced(a);this.isPreviousEndedForced(!1);this.log("info","end","loading next bullet");
this.parent.loadNextBullet(a)};b.prototype.manuallyPlaySound=function(a,c){if("A"==c.target.tagName)return!0;if(this.parent.isActiveAndAccessibilityEnabled()||!this.isIntro())return this.parent.isActiveAndAccessibilityEnabled()?this.toggleSound():this.parent.allBulletHasBeenRead()&&(this.parent.currentBulletManuallyRead&&this.parent.currentBulletManuallyRead.stop(),this.parent.currentBulletManuallyRead=this,this.sound&&(this.log("info","start","playing sound"),this.sound.play())),!0};b.prototype.log=
function(a,c){for(var b=[],e=2;e<arguments.length;e++)b[e-2]=arguments[e];for(var e=[a,"BulletPointItem","("+this.parent.currentBulletPointItemIndex+") ["+c+"] "],f=0,g=b.length;f<g;f++)e.push(b[f]);this.parent.log.apply(this.parent,e)};return b}(),CertificateViewModel=function(b){function a(a){b.call(this,a);this.PRINTING_HEIGHT=730;this.PRINTING_WIDTH=990;this.scaleValue=ko.observable(1);this.certificateHeight=ko.observable(this.PRINTING_HEIGHT);this.certificateWidth=ko.observable(this.PRINTING_WIDTH);
this.imageLogo=ko.observable(new MediaImage);this.imageSignature=ko.observable(new MediaImage);this.hasImage=ko.observable(!1);this.certificateTitle=ko.observable("");this.text1=ko.observable("");this.text2=ko.observable("");this.userName=ko.observable("");this.moduleTitle=ko.observable("");this.teacherName=ko.observable("");this.date=ko.observable("");this.alignRight=this.alignLeft=!1;this._logoTabindex=ko.observable(10);this.logoTabindex=this.generateTabIndexComputed("_logoTabindex",this);this._signatureTabindex=
ko.observable(100);this.signatureTabindex=this.generateTabIndexComputed("_signatureTabindex",this);this.background=ko.observable(new MediaImage)}__extends(a,b);a.prototype.loadData=function(a){if(a.exercise){this.certificateTitle(a.exercise.title);this.text1(a.exercise.text1);this.text2(a.exercise.text2);this.teacherName(a.exercise.teacherName);this.moduleTitle(a.exercise.moduleTitle);this.userName("");this.userName(applicationViewModel.scorm.getUserName());this.loadMedias(a.exercise.media);var d=
SkinManager.getInstance().getTemplateSetting("certificate","certificatebackgroundurl"),d=SkinManager.getInstance().getHtmlSkinPath()+"/"+d;this.background().setSourceForImageWithoutQuality(d,!1);this.layout("CertificateSimpleLayout");this.layoutTemplate(this.layout());d=a.exercise["@layout"];"CertificateLeftLayout"===d?this.alignLeft=!0:"CertificateRightLayout"===d&&(this.alignRight=!0);this.date(null);d=applicationViewModel.scorm.getCertificateTS();null!=d&&this.date((new Date(d)).toLocaleDateString())}return b.prototype.loadData.call(this,
a)};a.prototype.start=function(){b.prototype.start.call(this);if(null==this.date()){var a=Date.now();applicationViewModel.scorm.setCertificateTS(a);this.date((new Date(a)).toLocaleDateString())}this.parent.setExerciseCompleted();return this};a.prototype.sizeChanged=function(a,d){b.prototype.sizeChanged.call(this,a,d);var e=this.getExerciseDom().find(".print__button").outerHeight(),f=this.getExerciseDom().find("#"+this.parent.callToActionId).outerHeight(),g=document.getElementById("menu").offsetHeight,
e=Math.ceil(d-e-f-g-5)/this.PRINTING_HEIGHT,f=a/this.PRINTING_WIDTH,e=Math.min(e<f?e:f,1);this.scaleValue(e);this.certificateHeight(this.PRINTING_HEIGHT*e);this.certificateWidth(this.PRINTING_WIDTH*e);return $.Deferred().resolve().promise()};a.prototype.loadMedias=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a),b=0,e=a.length;b<e;b++){var f=new MediaImage(!0,!0);f.loadData(a[b]);f.type==MediaType.image&&(0==b?this.imageLogo(f):this.imageSignature(f),this.hasImage(!0))}};return a}(BaseContentViewModel),
CheckListViewModel=function(b){function a(a){var d=this;b.call(this,a);this.conceptClickableIndex=0;this.DISPLAY_TIME_CONCEPTS_MS=1500;this.items=ko.observableArray([]);this.introduction=new MediaText;this.conclusion=new MediaText;this.isConclusionShown=ko.observable(!1);this.isAllConceptsChecked=ko.observable(!1);this.getDomIntro=function(){return d.parent.getExerciseDom().find(".checklist__introduction")};this.getDomConclusion=function(){return d.parent.getExerciseDom().find(".checklist__conclusion")};
this._tabindexIntro=ko.observable(100);this._tabindexConclusion=ko.observable(100);this.tabindexIntro=this.generateTabIndexComputed("_tabindexIntro",this);this.tabindexConclusion=this.generateTabIndexComputed("_tabindexConclusion",this)}__extends(a,b);a.prototype.loadData=function(a){this.log("info","loadData","loading");this.title(a.exercise.title);this.introduction.loadData(a.exercise.introduction.text,this.parent.exerciseId);this.conclusion.loadData(a.exercise.conclusion.text,this.parent.exerciseId);
var d=a.exercise["@layout"];"CheckListSmallLayout"==d?d="exercise--checklist--small":"ChecklistLargeImagesLayout"==d&&(d="exercise--checklist--large");this.layout(d);this.layoutTemplate("CheckListStandardLayout");this.loadMedias(a.exercise.media);this.loadConcepts(a.exercise.items);this.applySmallSizeLayout();this._tabindexConclusion(100*(this.items().length+1));return b.prototype.loadData.call(this,a)};a.prototype.loadMedias=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a),b=0,
e=a.length;b<e;b++){var f=MediaFactory.createMedia(a[b]);f.type==MediaType.sound&&""!=f.url()&&(this.openingSound=f)}};a.prototype.loadConcepts=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a.item),b=0,e=a.length;b<e;b++){var f=new CheckConceptItem(this,b);f.loadData(a[b]);this.items.push(f)}};a.prototype.initDom=function(){b.prototype.initDom.call(this);for(var a=this.items(),d=0,e=a.length;d<e;d++)a[d].initDom();return this};a.prototype.sizeChanged=function(a,b){this.log("info",
"sizeChanged","width: "+a+" height: "+b);this.overviewHeight=this.getDom().innerHeight();this.titleHeight=this.getDomTitleWrapper().outerHeight(!0);this.scrolledHeightContent=parseInt(this.getDomOverview().css("top"));this.conclusionHeight=this.getDomConclusion().height();this.conclusionPosition=this.getDomConclusion().position();for(var e=this.items(),f=0,g=e.length;f<g;f++)e[f].sizeChanged();this.updateScrollbar();return $.Deferred().resolve().promise()};a.prototype.start=function(){this.log("info",
"start","starting");b.prototype.start.call(this);this.hasOpeningSound()&&!this.isActiveAndAccessibilityEnabled()?this.openingSound.onEnded.subscribe(this,this.onSlideSoundEnded):this.highlightNextConcept();return this};a.prototype.startThumbnail=function(){this.highlightNextConcept();return this};a.prototype.stop=function(){this.log("info","stop","stopping");this.openingSound.onEnded.unSubscribe(this,this.onSlideSoundEnded);b.prototype.stop.call(this);this.reset();this.clearTimeout("checklistTimerStart");
this.updateScrollbar(ScrollbarManager.TOP);return this};a.prototype.reset=function(){this.conceptClickableIndex=0;this.isConclusionShown(!1);this.isAllConceptsChecked(!1);for(var a=this.items(),b=0,e=a.length;b<e;b++)a[b].reset();this.items(a);return this};a.prototype.cleanup=function(){this.log("info","cleanup");try{b.prototype.cleanup.call(this);for(var a=this.items(),d=0,e=a.length;d<e;d++)a[d].cleanup();this.items.removeAll()}catch(f){this.log("error","cleanup","error: "+f)}return this};a.prototype.scrollToConclusionIfNecessary=
function(){var a=!1,a=this.overviewHeight-this.titleHeight-this.scrolledHeightContent;this.conclusionPosition&&(this.conclusionPosition=this.conclusionPosition.top+this.conclusionHeight);a=this.conclusionPosition>a;this.conclusionPosition&&a&&this.updateScrollbar(this.conclusionPosition-this.conclusionHeight)};a.prototype.highlightNextConcept=function(){if(!this.isConclusionShown()){var a=this.items();a.length>=this.conceptClickableIndex+1?(a[this.conceptClickableIndex].start(),this.log("info"," play item "+
this.conceptClickableIndex)):(!this.isActiveAndAccessibilityEnabled()&&this.scrollToConclusionIfNecessary(),this.isConclusionShown(!0));this.conceptClickableIndex++}};a.prototype.onSlideSoundEnded=function(){this.log("info","onSoundEnded","checking html5 ?"+(audioPlayer instanceof Html5AudioPlayer?"true":"false"));(audioPlayer instanceof Html5AudioPlayer?this.openingSound.hasBeenPlayed():1)?(this.log("info","onSoundEnded","sound has been marked as it has been played"),this.highlightNextConcept()):
this.log("info","onSoundEnded","sound has NOT been marked as it has been played")};a.prototype.checkIfAllConceptsChecked=function(){for(var a=this.items(),b=0;b<a.length;b++)if(!a[b].isChecked())return;this.parent.setExerciseCompleted()};return a}(BaseContentViewModel),CheckConceptItem=function(){function b(a,c){var b=this;this.id=GuidHelper.newGuid();this.title=ko.observable("");this.description=new MediaText;this.sound=null;this.image=new MediaImage;this.isVisited=ko.observable(!1);this.sonarLaunched=
ko.observable(!1);this.isChecked=ko.observable(!1);this.hasBeenChecked=!1;this.getDomConcept=function(){return $("#"+b.id)};this._tabindexItem=ko.observable(100);this.parent=a;this.positionInItemsList=c+1;this._tabindexItem(100*this.positionInItemsList);this.tabindexItem=this.parent.generateTabIndexComputed("_tabindexItem",this)}b.prototype.loadData=function(a){this.log("info","LoadData","Start loading data");this.title(a.title&&a.title.text?a.title.text:a.title);this.description.loadData(a.description.text,
this.parent.parent.exerciseId);this.loadMedias(a.media)};b.prototype.loadMedias=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a),c=0,b=a.length;c<b;c++){var e=MediaFactory.createMedia(a[c]);e.type==MediaType.sound&&""!=e.url()?(this.sound=e,this.sound.setTranscriptDisplayedAsList(!0)):e.type==MediaType.image&&""!=e.url()&&(this.image=e)}};b.prototype.reset=function(){this.sonarLaunched(!1);this.isVisited(!1);this.isChecked(!1);this.hasBeenChecked=!1;this.stop()};b.prototype.initDom=
function(){this.conceptHeight=this.getDomConcept().height();this.conceptPosition=this.getDomConcept().position()};b.prototype.sizeChanged=function(){this.image&&this.image.resize();this.conceptHeight=this.getDomConcept().height();this.conceptPosition=this.getDomConcept().position()};b.prototype.cleanup=function(){this.log("info","cleanup","cleaning up");try{null!=this.sound&&this.sound.cleanup()}catch(a){this.log("error","cleanup","error "+a)}};b.prototype.start=function(){var a=this;this.log("info",
"start","starting");!this.parent.isActiveAndAccessibilityEnabled()&&this.parent.scrollIfNecessary(this.conceptPosition,1>=this.positionInItemsList);!this.parent.isActiveAndAccessibilityEnabled()&&this.sound?(this.log("info","start","sound founded : setting onEnded event"),this.sound.onEnded.subscribe(this,function(){a.sonarLaunched(!0)}),this.parent.setTimeout("checklistTimerStart",function(){a.sound.play()},500)):this.sonarLaunched(!0);this.isVisited(!0)};b.prototype.select=function(){this.log("info",
"select","Selected item "+this.id);this.start();this.parent.isActiveAndAccessibilityEnabled()&&this.sound.toggle()};b.prototype.check=function(){this.image.play(!1);this.isChecked()?this.isChecked(!1):(this.isChecked(!0),this.hasBeenChecked||(this.parent.highlightNextConcept(),this.hasBeenChecked=!0));this.parent.checkIfAllConceptsChecked()};b.prototype.stop=function(){var a=this;this.log("info","stop","stopping");this.sound&&(this.sound.onEnded.unSubscribe(this,function(){a.sonarLaunched(!0)}),this.sound.stop())};
b.prototype.log=function(a,c){for(var b=[],e=2;e<arguments.length;e++)b[e-2]=arguments[e];for(var e=[a,"ConceptItem","("+this.parent.conceptClickableIndex+") ["+c+"] "],f=0,g=b.length;f<g;f++)e.push(b[f]);this.parent.log.apply(this.parent,e)};return b}(),ClassicMCViewModel=function(b){function a(a){var d=this;b.call(this,a);this.image=ko.observable(new MediaImage);this.imageContentHeight=ko.observable(0);this.currentSelectedItem=null;this.intro=new MediaText;this.viewportMaxHeight=ko.observable("");
this.items=ko.observableArray([]);this.slideHeight=ko.observable(0);this.isLargeImage=ko.observable(!1);this.slideWidth=ko.observable(0);this.openupHeaderBackgroundUrl=ko.observable("");this.isStarted=!1;this.getDomAnswers=function(){return d.parent.getExerciseDom().find(".classicmc__answers")};this._tabindexIntro=ko.observable(100);this.tabindexIntro=this.generateTabIndexComputed("_tabindexIntro",this);this._tabindex=ko.observable(110);this.tabindex=this.generateTabIndexComputed("_tabindex",this)}
__extends(a,b);a.prototype.loadData=function(a){a.exercise.text&&this.intro.loadData(a.exercise.text,this.parent.exerciseId);this.instruction(a.exercise.instruction);this.question(a.exercise.question);this.layout(a.exercise["@layout"]);this.loadViewForLayout(this.layout());this.loadAlternatives(a.exercise.alternatives);this.loadMedias(a.exercise.media);return b.prototype.loadData.call(this,a)};a.prototype.getHeaderBackgroundUrl=function(){return b.prototype.getHeaderBackgroundUrl.call(this)};a.prototype.itemSelected=
function(a){null!=this.currentSelectedItem&&this.currentSelectedItem.unselect();this.currentSelectedItem=a};a.prototype.afterItemUnselected=function(a){this.updateLayout(a.answerId)};a.prototype.afterItemSelected=function(a){this.updateLayout(a.inlinefeedbackGuidId)};a.prototype.loadViewForLayout=function(c){switch(c){case a.layouts.mediumImageStandardLayout:case a.layouts.smallImageStandardLayout:this.layoutTemplate("ClassicMCStandardLayout");this.applySmallSizeLayout();break;case a.layouts.largeImageStandardLayout:this.layoutTemplate("ClassicMCStandardLayout");
this.isLargeImage(!0);this.applySmallSizeLayout();break;default:this.layoutTemplate("ClassicMCOpeningFromBottomLayout"),this.isLayoutOpenup(!0),this.applyFullScreenSizeLayout()}};a.prototype.loadMedias=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a),b=0,e=a.length;b<e;b++){var f=MediaFactory.createMedia(a[b]);f.type==MediaType.sound?(this.openingSound=f,this.openingSound.onEnded.subscribe(this,this.checkExerciseCompleted)):f.type==MediaType.image&&this.image(f)}};a.prototype.loadCompleted=
function(){b.prototype.loadCompleted.call(this);return this};a.prototype.initDom=function(){b.prototype.initDom.call(this);"ClassicMCOpeningFromBottomLayout"==this.layoutTemplate()&&this.getDom().find(".classicmc--openup__header-wrapper").addClass("header");return this};a.prototype.getAvailableHeightContentWrapper=function(){return this.slideHeight()-this.imageContentHeight()};a.prototype.getBottomContentWrapper=function(){var a=this.getDomContentWrapper().height(),b=this.getAvailableHeightContentWrapper(),
e=-1*(a-b)+"px";a<=b&&(e="0px");return e};a.prototype.startThumbnail=function(){this.start();return this};a.prototype.start=function(){b.prototype.start.call(this);this.isStarted=!0;this.repositionBottomContent();this.image().play();return this};a.prototype.stop=function(){b.prototype.stop.call(this);this.isStarted=!1;this.checkExerciseCompleted();this.resetBottomContentPosition();this.reset();return this};a.prototype.resetBottomContentPosition=function(){"ClassicMCOpeningFromBottomLayout"==this.layoutTemplate()&&
this.getDomContentWrapper().css("bottom",-1*this.getDomAnswers().height()+"px")};a.prototype.repositionBottomContent=function(){var a=this;if("ClassicMCOpeningFromBottomLayout"==this.layoutTemplate()){var b=!uiManager.screenshotMode&&!this.isActiveAndAccessibilityEnabled(),e=this.baseContentBackgroundViewModel.hasBackground()?1E3:200,f=this.getBottomContentWrapper();b?this.setTimeout("repositionBottom"+(new Date).getMilliseconds,function(){a.getDomContentWrapper().animate({bottom:f},1E3,function(){a.updateScrollbar()})},
e):this.getDomContentWrapper().css({bottom:f})}};a.prototype.centerElement=function(a){if("ClassicMCOpeningFromBottomLayout"==this.layoutTemplate()){var b=!uiManager.screenshotMode&&!this.isActiveAndAccessibilityEnabled(),e=this.baseContentBackgroundViewModel.hasBackground()?1E3:200,f=$("#"+a).offset().top,g=document.documentElement.clientHeight/2,h=this.parent.getExerciseDom().find(".viewport");b?this.setTimeout("repositionBottom"+(new Date).getMilliseconds,function(){h.animate({scrollTop:h.scrollTop()-
(g-f)})},e):h.css({scrollTop:h.scrollTop()-(g-f)})}};a.prototype.reset=function(){b.prototype.reset.call(this);for(var a=this.items(),d=0,e=a.length;d<e;d++)a[d].unselect(),a[d].isClicked(!1);return this};a.prototype.resetSize=function(){for(var a=this.items(),b=0,e=a.length;b<e;b++)a[b].getDomAnswerTable().width("");return $.Deferred().resolve().promise()};a.prototype.updateImageContentHeight=function(a){this.imageContentHeight(this.slideHeight()*a/100);var a=this.getDomContentWrapper().height(),
b=this.getAvailableHeightContentWrapper();a<b&&this.imageContentHeight(this.slideHeight()-a)};a.prototype.sizeChanged=function(a,d){b.prototype.sizeChanged.call(this,a,d);this.slideHeight(d);this.slideWidth(a);this.updateLayout();return $.Deferred().resolve().promise()};a.prototype.updateLayout=function(a){var b=100*(this.image().getDimensions().image.height/this.slideHeight());b&&(b+=2);this.updateImageContentHeight(b);this.image().switchImageQualityIfNecessary();this.isStarted?null==a||platformFeatures.getIsIE89()?
this.repositionBottomContent():this.centerElement(a):this.resetBottomContentPosition()};a.prototype.cleanup=function(){b.prototype.cleanup.call(this);var a=this.items();try{for(var d=0,e=a.length;d<e;d++)a[d].cleanup();this.image().cleanup()}catch(f){logger.error("ClassicMCViewModel.cleanup error : "+f)}this.items.removeAll();return this};a.prototype.checkExerciseCompleted=function(){for(var a=this.items(),b=!0,e=!0,f=!1,g=0,h=a.length;g<h;g++)a[g].isCorrect?(f=!0,b=b&&a[g].isClicked()):e=e&&a[g].isClicked();
f?b&&!this.openingSound.isPlaying()&&this.parent.setExerciseCompleted():e&&!this.openingSound.isPlaying()&&this.parent.setExerciseCompleted();this.updateScrollbar()};a.prototype.loadAlternatives=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a.alternative),b=0,e=a.length;b<e;b++){var f=new ClassicMCItem(this);f.loadData(a[b]);f.isLast=b==e-1;this.items.push(f)}};a.layouts={smallImageOpeningFromBottomLayout:"ClassicMCSmallImageOpeningFromBottomLayout",smallImageStandardLayout:"ClassicMCSmallImageStandardLayout",
mediumImageStandardLayout:"ClassicMCMediumImageStandardLayout",largeImageStandardLayout:"ClassicMCLargeImageStandardLayout"};return a}(BaseContentViewModel),ClassicMCItem=function(){function b(a){var c=this;this.feedback=this.text="";this.feedbackVisible=ko.observable(!1);this.isCorrect=!1;this.isSelected=ko.observable(!1);this.isClicked=ko.observable(!1);this.isLast=!1;this.cssClass=ko.observable("classicmcanswers");this.media=new MediaBase;this.sound=new MediaSound;this.answerId=GuidHelper.newGuid();
this.inlinefeedbackGuidId=GuidHelper.newGuid();this.getDomAnswer=function(){return $("#"+c.answerId)};this.getDomAnswerTable=function(){return c.getDomAnswer().find(".classicmc__answer-table")};this._tabindex=ko.observable(200);this.ariaLabel=ko.observable("");this.parent=a;this.tabindex=this.parent.generateTabIndexComputed("_tabindex",this)}b.prototype.cleanup=function(){try{null!=this.media&&this.media.cleanup(),null!=this.sound&&this.sound.cleanup()}catch(a){logger.error("ClassicMCItem.cleanup error : "+
a)}};b.prototype.loadData=function(a){a.text&&(this.text=StringHelper.getHtmlFormat(a.text));a.response&&(this.feedback=StringHelper.getHtmlFormat(a.response));"true"==a["@correct"]&&(this.isCorrect=!0);this.ariaLabel(this.text)};b.prototype.onClick=function(){this.isClicked(!0);this.isSelected()?this.unselect():this.select()};b.prototype.select=function(){var a=this.isCorrect?localizedText.Accessibility_CorrectAnswer():localizedText.Accessibility_WrongAnswer();this.isSelected(!0);this.parent.itemSelected(this);
this.parent.checkExerciseCompleted();this.feedbackVisible(!0);this.parent.updateScrollbar();this.ariaLabel(a+", "+this.text+", "+this.feedback);this.parent.setAlertContent(a+", "+this.feedback);this.parent.afterItemSelected(this)};b.prototype.unselect=function(){this.isSelected(!1);this.feedbackVisible(!1);this.parent.updateScrollbar();this.parent.afterItemUnselected(this)};b.prototype.setCssClass=function(){var a="classicmcanswers";this.isSelected&&(a=this.isCorrect?a+" right":a+" wrong");this.cssClass(a)};
return b}(),CombineViewModel=function(b){function a(a){var d=this;b.call(this,a);this.introduction=new MediaText;this.isCompleted=!1;this.availableHeight=ko.observable(0);this.centerTdId=GuidHelper.newGuid();this.titleId=GuidHelper.newGuid();this.combinecontainerId=GuidHelper.newGuid();this.labelColumnId=GuidHelper.newGuid();this.dropZoneColumnId=GuidHelper.newGuid();this.items=ko.observableArray([]);this.alternatives=ko.observableArray([]);this.selectedItem=ko.observable(null);this.maxWidthDropZone=
ko.observable(0);this._tabindexIntro=ko.observable(100);this.tabindexIntro=this.generateTabIndexComputed("_tabindexIntro",this);this.getDomCombineContainer=function(){return $("#"+d.combinecontainerId)};this.getDomSpecificTitle=function(){return $("#"+d.titleId)};this.getDomCenterTd=function(){return $("#"+d.centerTdId)};this.getDomContentWrapTable=function(){return d.parent.getExerciseDom().find(".combine__table")};this.getDomIntro=function(){return d.parent.getExerciseDom().find(".combine__introduction")};
this.isDragDropTemplate=!0;this.dragContainerId=GuidHelper.newGuid()}__extends(a,b);a.prototype.loadData=function(a){this.title(a.exercise.title);this.instruction(a.exercise.instruction);this.layout(a.exercise["@layout"]);this.layoutTemplate(a.exercise["@layout"]);this.introduction.loadData(a.exercise.text,this.parent.exerciseId);this.loadMedias(a.exercise.media);this.loadItems(a.exercise.containers);this.introAriaLabel=this.introduction.transformStringForAriaLabel();return b.prototype.loadData.call(this,
a)};a.prototype.start=function(){var a=this;b.prototype.start.call(this);this.calculateDropZonesWidths();this.setTimeout("init-drag-drop",function(){a.initializeDragAndDrop()},50);this.getDomStickyFooterContainer().addClass("sticky__container--inline");return this};a.prototype.stop=function(){b.prototype.stop.call(this);this.getDomStickyFooterContainer().removeClass("sticky__container--inline");return this};a.prototype.startThumbnail=function(){var a=this;b.prototype.startThumbnail.call(this);this.calculateDropZonesWidths();
this.setTimeout("init-drag-drop",function(){a.initializeDragAndDrop()},50);return this};a.prototype.cleanup=function(){try{b.prototype.cleanup.call(this);for(var a=this.items(),d=0,e=a.length;d<e;d++)a[d].cleanup();this.items.removeAll();this.alternatives(null)}catch(f){logger.error("CombineViewModel.cleanup error : "+f)}return this};a.prototype.swipeStarted=function(){this.stickyOnSwipeStarted();return this};a.prototype.swipeCancelled=function(){this.stickyOnSwipeCancel();return this};a.prototype.swipeEnded=
function(){this.stickyOnSwipeCancel();return this};a.prototype.render=function(){b.prototype.render.call(this);return this};a.prototype.sizeChanged=function(a,d){b.prototype.sizeChanged.call(this,a,d);this.calculateDropZonesWidths();return $.Deferred().resolve().promise()};a.prototype.resetSize=function(){this.getDomIntro().width("auto");return $.Deferred().resolve().promise()};a.prototype.calculateDropZonesWidths=function(){var a=0,b=0,e=this.getDomContentWrapTable().width()/2,f=this.items();if(null!=
this.alternatives())for(var g=0,h=f.length;g<h;g++)a=f[g].getDomDroppedElement().outerWidth(),b=Math.max(b,a);0==b&&(b=0.8*$(".combine-tpl__label",this.getDom()).width());b>e?this.maxWidthDropZone(e):this.maxWidthDropZone(b)};a.prototype.fetchNextDragItemIndex=function(){for(var a=0,b=this.alternatives().length;a<b;a++)if(this.alternatives()[a].isAlternativeVisible())return a;return-1};a.prototype.setDragItemTabindex=function(){for(var a=this,b=this.fetchNextDragItemIndex(),e=0,f=this.items().length;e<
f;e++)this.items()[e].setTabindexDragItem();-1!=b&&this.setTimeout("dragAccessibilityFocus",function(){$("#"+a.alternatives()[b].draggableId).focus()},500)};a.prototype.setDropItemTabindex=function(){for(var a=this,b=0,e=this.items().length;b<e;b++)this.items()[b].setTabindexDropitem();this.setTimeout("dropAccessibilityFocus",function(){$("#"+a.accessibilityDropBoxSelected.trDropZoneId).focus()},1E3)};a.prototype.setSelectedItem=function(a){this.selectedItem(a)};a.prototype.onDropped=function(){var a=
this,b=this.selectedItem();null!=b&&(this.setAlertContent(localizedText.Accessibility_CorrectAnswer()),b.selected(!1),b.isAlternativeVisible(!1),this.selectedItem(null),this.updateStickyFooterHeight());setTimeout(function(){a.checkIfIsCompleted()},0)};a.prototype.validateDrop=function(a){0<=this.accessibilityDropBoxSelected.dropZoneId.indexOf(a)?(this.onDropped(this.accessibilityDropBoxSelected),this.setDropItemTabindex()):this.setAlertContent(localizedText.Accessibility_WrongAnswer())};a.prototype.checkIfIsCompleted=
function(){var a=this.items();if(null!=a)for(var b=0,e=a.length;b<e;b++)if(a[b].isAlternativeVisible()){this.isCompleted=!1;return}this.isCompleted=!0;this.parent.setExerciseCompleted()};a.prototype.loadItems=function(a){if(void 0!=a){for(var a=ArrayHelper.getArrayFromJson(a.container),b=[],e=[],f=0,g=a.length;f<g;f++){var h=new CombineItem(this);h.loadData(a[f]);e.push(h);b.push(h)}b=ArrayHelper.shuffle(b);this.items(e);this.alternatives(b)}};a.prototype.loadMedias=function(a){if(void 0!=a)for(var a=
ArrayHelper.getArrayFromJson(a),b=0;b<a.length;b++){var e=MediaFactory.createMedia(a[b]);e.type==MediaType.sound&&(this.openingSound=e)}};a.prototype.initializeDragAndDrop=function(){logger.info("combine.initializeDragAndDrop");webkit_DragManager.reset();for(var a=this.items(),b=0;b<a.length;b++){var e=a[b],f={revert:!0,container:$body[0],onStart:function(a){return function(){a.onDragStarted()}}(e)};webkit_DragManager.addDraggable(e.draggableId,f);f={accept:[e.draggableId],hoverClass:"dropzone--dragging-hover",
hoverAllDropZone:!0,onDrop:function(a){return function(){a.onSetResponse()}}(e)};webkit_DragManager.addDropZone(e.dropZoneId,f)}};return a}(BaseContentViewModel),CombineItem=function(){function b(a){var c=this;this.labelItemScreenReaderDescription=localizedText.Accessibility_SelectDestination();this.id=GuidHelper.newGuid();this.tdDropZoneHeight=ko.observable("");this.isAlternativeVisible=ko.observable(!0);this.selected=ko.observable(!1);this.minDropZoneWidth=80;this.dragZoneWidth=ko.observable();
this.getDomLabel=function(){return $("#"+c.tdDropZoneId).prev()};this.getDomDroppedElement=function(){return $("#"+c.droppedElementId)};this._tabindexDropItem=ko.observable(100);this._tabindexDragItem=ko.observable(-1);this.parent=a;this.draggableId="drag-"+this.id;this.dropZoneId="drop-"+this.id;this.tdDropZoneId="td-drag-"+this.id;this.droppedElementId="td-dropped-"+this.id;this.trDropZoneId="tr-drop"+this.id;this.tabindexDropItem=this.parent.generateTabIndexComputed("_tabindexDropItem",this);this.tabindexDragItem=
this.parent.generateTabIndexComputed("_tabindexDragItem",this)}b.prototype.loadData=function(a){for(var c=0;2>c;c++){var b=a.text[c];"target"==b["@name"]?this.text=b["#text"]:"alternative"==b["@name"]&&(this.responseText=b["#text"])}};b.prototype.cleanup=function(){this.isAlternativeVisible(!1)};b.prototype.setTabindexDropitem=function(){this._tabindexDropItem(100);this._tabindexDragItem(-1)};b.prototype.setTabindexDragItem=function(){this._tabindexDragItem(100);this._tabindexDropItem(-1)};b.prototype.onSelectForAccessibility=
function(){this.parent.isActiveAndAccessibilityEnabled()&&this.parent.accessibilityDropBoxSelected&&(this.selected(!0),this.parent.setSelectedItem(this),this.parent.validateDrop(this.dropZoneId))};b.prototype.selectDropBox=function(){this.isAlternativeVisible()&&(this.parent.accessibilityDropBoxSelected=this,this.parent.setDragItemTabindex())};b.prototype.onSetResponse=function(){this.parent.onDropped(this)};b.prototype.onDragStarted=function(){this.selected(!0);this.parent.setSelectedItem(this)};
return b}(),ConceptListViewModel=function(b){function a(a){b.call(this,a);this.conceptClickableIndex=0;this.DISPLAY_TIME_CONCEPTS_MS=1500;this.items=ko.observableArray([]);this.introduction=new MediaText;this.conclusion=new MediaText;this.isConclusionShown=ko.observable(!1);this._tabindexIntro=ko.observable(100);this._tabindexConclusion=ko.observable(100);this.tabindexIntro=this.generateTabIndexComputed("_tabindexIntro",this);this.tabindexConclusion=this.generateTabIndexComputed("_tabindexConclusion",
this);this.ariaLabelIntro=ko.observable("");this.ariaLabelConclu=ko.observable("")}__extends(a,b);a.prototype.loadData=function(a){this.log("info","loadData","loading");this.title(a.exercise.title);this.introduction.loadData(a.exercise.introduction.text,this.parent.exerciseId);this.conclusion.loadData(a.exercise.conclusion.text,this.parent.exerciseId);var d=a.exercise["@layout"];"ConceptListSmallLayout"==d?d="exercise--conceptlist--small":"ConceptlistLargeImageLayout"==d&&(d="exercise--conceptlist--large");
this.layout(d);this.layoutTemplate("ConceptListStandardLayout");this.loadMedias(a.exercise.media);this.loadConcepts(a.exercise.items);this.applySmallSizeLayout();this.ariaLabelIntro(this.introduction.transformStringForAriaLabel());this.ariaLabelConclu(this.conclusion.transformStringForAriaLabel());""!=this.ariaLabelConclu()?this._tabindexConclusion(100*(this.items().length+1)):this._tabindexConclusion(-1);return b.prototype.loadData.call(this,a)};a.prototype.loadMedias=function(a){if(void 0!=a)for(var a=
ArrayHelper.getArrayFromJson(a),b=0,e=a.length;b<e;b++){var f=MediaFactory.createMedia(a[b]);f.type==MediaType.sound&&""!=f.url()&&(this.openingSound=f)}};a.prototype.loadConcepts=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a.item),b=0,e=a.length;b<e;b++){var f=new ConceptItem(this,b);f.loadData(a[b]);this.items.push(f)}};a.prototype.initDom=function(){b.prototype.initDom.call(this);this.domIntro=$(".conceptlist__introduction",this.getDom());this.domConclusion=$(".conceptlist__conclusion",
this.getDom());for(var a=this.items(),d=0,e=a.length;d<e;d++)a[d].initDom();return this};a.prototype.sizeChanged=function(a,b){this.log("info","sizeChanged","width: "+a+" height: "+b);this.overviewHeight=this.getDom().innerHeight();this.titleHeight=this.getDomTitleWrapper().outerHeight(!0);this.scrolledHeightContent=parseInt(this.getDomOverview().css("top"));this.conclusionHeight=this.domConclusion.height();this.conclusionPosition=this.domConclusion.position();for(var e=this.items(),f=0,g=e.length;f<
g;f++)e[f].sizeChanged();this.updateScrollbar();return $.Deferred().resolve().promise()};a.prototype.start=function(){b.prototype.start.call(this);this.log("info","start","starting");this.hasOpeningSound()&&!this.isActiveAndAccessibilityEnabled()?this.openingSound.onEnded.subscribe(this,this.onSlideSoundEnded):this.playNextConcept();this.bindClick();return this};a.prototype.startThumbnail=function(){for(var a=this.items(),b=0,e=a.length;b<e;b++)a[b].isVisited(!0);this.isConclusionShown(!0);return this};
a.prototype.bindClick=function(){var a=this;this.getDom().on("click.conceptlist",function(b){if(a.getDomScrollbar().find(b.target).length)return!1;if("A"==b.target.tagName)return!0;a.forceEndCurrentConcept();return!1})};a.prototype.unbindClick=function(){this.getExerciseDom().unbind("click.conceptlist")};a.prototype.forceEndCurrentConcept=function(){var a=this.items();0==this.conceptClickableIndex?this.playNextConcept():a.length>=this.conceptClickableIndex+1?(a[this.conceptClickableIndex].stop(),
this.playNextConcept()):(!this.isActiveAndAccessibilityEnabled()&&this.scrollToConclusionIfNecessary(),this.isConclusionShown(!0),this.parent.setExerciseCompleted())};a.prototype.scrollToConclusionIfNecessary=function(){var a=!1,a=this.overviewHeight-this.titleHeight-this.scrolledHeightContent;this.conclusionPosition&&(this.conclusionPosition=this.conclusionPosition.top+this.conclusionHeight);a=this.conclusionPosition>a;this.conclusionPosition&&a&&this.updateScrollbar(this.conclusionPosition-this.conclusionHeight)};
a.prototype.stop=function(){this.log("info","stop","stopping");this.reset();this.hasOpeningSound()&&!this.isActiveAndAccessibilityEnabled()&&this.openingSound.onEnded.unSubscribe(this,this.onSlideSoundEnded);b.prototype.stop.call(this);this.updateScrollbar(ScrollbarManager.TOP);this.clearTimeout("conceptlistTimerStart");return this};a.prototype.reset=function(){this.conceptClickableIndex=0;for(var a=this.items(),b=0,e=a.length;b<e;b++)a[b].stop();this.unbindClick();this.isConclusionShown(!1);return this};
a.prototype.cleanup=function(){this.log("info","cleanup");try{b.prototype.cleanup.call(this);for(var a=this.items(),d=0,e=a.length;d<e;d++)a[d].cleanup();this.items.removeAll()}catch(f){this.log("error","cleanup","error: "+f)}return this};a.prototype.playNextConcept=function(){if(!this.isConclusionShown()){var a=this.items();a.length>=this.conceptClickableIndex+1?(a[this.conceptClickableIndex].start(),this.log("info"," play item "+this.conceptClickableIndex)):(!this.isActiveAndAccessibilityEnabled()&&
this.scrollToConclusionIfNecessary(),this.isConclusionShown(!0),this.parent.setExerciseCompleted());this.conceptClickableIndex++}};a.prototype.onSlideSoundEnded=function(){this.log("info","onSoundEnded","checking html5 ?"+(audioPlayer instanceof Html5AudioPlayer?"true":"false"));(audioPlayer instanceof Html5AudioPlayer?this.openingSound.hasBeenPlayed():1)?(this.log("info","onSoundEnded","sound has been marked as it has been played"),this.playNextConcept()):this.log("info","onSoundEnded","sound has NOT been marked as it has been played")};
return a}(BaseContentViewModel),ConceptItem=function(){function b(a,c){this.id=GuidHelper.newGuid();this.title=ko.observable("");this.description=new MediaText;this.image=this.sound=null;this.isVisited=ko.observable(!1);this._tabindexItem=ko.observable(100);this.ariaLabelItem=ko.observable("");this.parent=a;this.parent.isActiveAndAccessibilityEnabled()&&this.isVisited(!0);this.positionInItemsList=c+1;this.tabindexItem=this.parent.generateTabIndexComputed("_tabindexItem",this);this._tabindexItem(100*
this.positionInItemsList)}b.prototype.loadData=function(a){this.log("info","LoadData","Start loading data");this.title(a.title&&a.title.text?a.title.text:a.title);this.description.loadData(a.description.text,this.parent.parent.exerciseId);this.ariaLabelItem((void 0==this.title()?"":this.title())+"\n"+this.description.transformStringForAriaLabel());this.loadMedias(a.media)};b.prototype.loadMedias=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a),c=0,b=a.length;c<b;c++){var e=MediaFactory.createMedia(a[c]);
e.type==MediaType.sound&&""!=e.url()?(this.sound=e,this.sound.setTranscriptDisplayedAsList(!0)):e.type==MediaType.image&&""!=e.url()&&(this.image=e)}};b.prototype.toggleSound=function(){null!=this.sound&&this.parent.isActiveAndAccessibilityEnabled()&&this.sound.toggle()};b.prototype.cleanup=function(){this.log("info","cleanup","cleaning up");try{null!=this.sound&&this.sound.cleanup()}catch(a){this.log("error","cleanup","error "+a)}};b.prototype.initDom=function(){this.domConcept=$("#"+this.id);this.conceptHeight=
this.domConcept.height();this.conceptPosition=this.domConcept.position()};b.prototype.sizeChanged=function(){this.image&&this.image.resize();this.conceptHeight=this.domConcept.height();this.conceptPosition=this.domConcept.position()};b.prototype.start=function(){var a=this;this.log("info","start","starting");var c=1>=this.positionInItemsList,b=null==this.parent.introduction;this.parent.isActiveAndAccessibilityEnabled()?this.parent.setTimeout("conceptlistTimerStart",function(){a.parent.playNextConcept()},
0):(this.parent.scrollIfNecessary(this.conceptPosition,!b&&c),this.sound?(this.log("info","start","sound founded : setting onEnded event"),this.sound.onEnded.subscribe(this,this.onSoundEnded),this.sound.play()):(this.log("info","start","setting timeout for end"),this.parent.setTimeout("conceptlistTimerStart",function(){a.parent.playNextConcept()},this.parent.DISPLAY_TIME_CONCEPTS_MS)));this.image&&this.image.play(!1);this.isVisited(!0)};b.prototype.select=function(){this.log("info","select","Selected item "+
this.id);this.start();return!0};b.prototype.stop=function(){this.log("info","stop","stopping");this.sound&&(this.sound.onEnded.unSubscribe(this,this.onSoundEnded),this.sound.stop());this.isVisited(!1)};b.prototype.onSoundEnded=function(){this.log("info","onSoundEnded","checking html5 ?"+(audioPlayer instanceof Html5AudioPlayer?"true":"false"));(audioPlayer instanceof Html5AudioPlayer?this.sound.hasBeenPlayed():1)?(this.log("info","onSoundEnded","sound has been marked as it has been played"),this.parent.playNextConcept()):
this.log("info","onSoundEnded","sound has NOT been marked as it has been played")};b.prototype.log=function(a,c){for(var b=[],e=2;e<arguments.length;e++)b[e-2]=arguments[e];for(var e=[a,"ConceptItem","("+this.parent.conceptClickableIndex+") ["+c+"] "],f=0,g=b.length;f<g;f++)e.push(b[f]);this.parent.log.apply(this.parent,e)};return b}(),CardPresenterEnum=function(){function b(){}b.layouts={top:"top",bottom:"bottom",left:"left",leftEmphasized:"left-emphasized",right:"right",rightEmphasized:"right-emphasized"};
b.transitionDirections={backwards:"backwards",forward:"forward"};b.transitionTypes={none:"none",fade:"fade",scroll:"scroll",flip:"flip",cardDeck:"carddeck",zoomFade:"zoomFade",wipe:"wipe"};b.transitionTriggers={manual:"manual",media:"media",delay:"delay"};return b}(),CardViewModel=function(){function b(a,c){var b=this;this.cardId=GuidHelper.newGuid();this.introId=GuidHelper.newGuid();this.slideId="item_"+this.cardId;this.navigationButtonId=GuidHelper.newGuid();this.isLastItem=!1;this.isSelected=ko.observable(!1);
this.isVisited=ko.observable(!1);this.upwardsway=ko.observable(!1);this.downwardsway=ko.observable(!1);this.scrollbarManager=null;this.timers=new Timers;this.layout=ko.observable(CardPresenterEnum.layouts.left);this.parentAvailableHeight=ko.observable(0);this.cardContentHeight=ko.observable(0);this.keepNavigationButtonSpace=this.keepCallToActionSpace=!1;this.callToActionHeight=0;this.sound=new MediaSound;this.soundEnded=!1;this.dots=ko.observableArray([]);this.dotsTableHeight=ko.observable(0);this.dotsMarginTop=
ko.observable(0);this.navigationButtonLabel="";this.showNavigationButton=ko.observable(!1);this.previousButtonId=ko.observable(GuidHelper.newGuid());this.nextButtonId=ko.observable(GuidHelper.newGuid());this.transitionTrigger=CardPresenterEnum.transitionTriggers.manual;this.transitionTriggerValue="";this.totalAnimationDuration=0;this.animateVisualElements=ko.observable(!1);this.audioButtonAccessibilityGuid=GuidHelper.newGuid();this.previousButtonAccessibilityGuid=GuidHelper.newGuid();this._tabindex=
ko.observable(100);this._tabindexCard=ko.observable(100);this._tabindexSound=ko.observable(20);this.hideForIE8=ko.observable(!0);this.getDomSlide=function(){return $("#"+b.slideId)};this.getDomCardViewport=function(){return b.getDomSlide().find(".viewport")};this.getDomCardOverview=function(){return $("#"+b.cardId)};this.getDomNavButton=function(){return $("#"+b.navigationButtonId)};this.getDomIntro=function(){return $("#"+b.introId)};this.getDomAudioButtonAccessibility=function(){return $("#"+b.audioButtonAccessibilityGuid)};
this.getDomPreviousButtonAccessibility=function(){return $("#"+b.previousButtonAccessibilityGuid)};this.getDomNextButton=function(){return $("#"+b.nextButtonId())};this.getDomCardContent=function(){return b.getDomSlide().find(".discussion-card-content")};this.index=a;this.parent=c;this._tabindex(100);this.tabindex=this.parent.generateTabIndexComputed("_tabindex",this);this.tabindexCard=this.parent.generateTabIndexComputed("_tabindexCard",this);this.tabindexSound=this.parent.generateTabIndexComputed("_tabindexSound",
this)}b.prototype.loadData=function(a,c,b){this.animateVisualElements(b);applicationViewModel.accessibilityViewModel.accessibilityFeaturesActivated()&&(this.isLastItem||this.displayNavigationButton(!0),this.animateVisualElements(!1));this.loadTexts(a.text);this.loadMedias(a.media);this.navigationButtonLabel=a.navigationButtonLabel;this.initializeDots(c)};b.prototype.initializeDots=function(a){if(1<a)for(var c=0;c<a;c++)this.dots.push(new CardDotViewModel(this,c))};b.prototype.loadTexts=function(){};
b.prototype.loadMedias=function(a){if(void 0!=a)for(var c=ArrayHelper.getArrayFromJson(a),b=0,a=a.length;b<a;b++){var e=MediaFactory.createMedia(c[b]);switch(e.type){case MediaType.sound:this.sound=e,this.sound.setTranscriptDisplayedAsList(!0),this.sound.onEnded.subscribe(this,this.onSoundEnded)}}};b.prototype.onSoundEnded=function(){var a=this;this.soundEnded=!0;this.navigationButtonMustBeShown()&&this.timers.setTimeout("onSoundEnded_sequencer_"+this.cardId,function(){a.displayNavigationButton(!0)},
250);this.transitionTrigger==CardPresenterEnum.transitionTriggers.media&&this.selectNext(!1);this.checkSlideCompleted()};b.prototype.start=function(a){var c=this;void 0===a&&(a=!1);this.clearTimeouts();this.hasSound()&&!applicationViewModel.accessibilityViewModel.accessibilityFeaturesActivated()&&this.sound.play();this.transitionTrigger==CardPresenterEnum.transitionTriggers.delay&&this.startNextSlideTransitionTimer();this.navigationButtonMustBeShown()&&!this.animateVisualElements()&&!this.hasSound()&&
this.timers.setTimeout("start sequencer item",function(){c.displayNavigationButton(!0)},1E3);applicationViewModel.accessibilityViewModel.accessibilityFeaturesActivated()&&a&&setTimeout(function(){c.sound.hasSource()?c.getDomAudioButtonAccessibility().focus():c.getDomCardContent().focus()},100);this.checkSlideCompleted()};b.prototype.stop=function(){var a=this;this.sound.stop();this.clearTimeouts();this.parent.setTimeout("stop_sequenceritem"+this.cardId,function(){a.scrollbarManager&&a.scrollbarManager.updateTo(ScrollbarManager.TOP);
a.centerDots()},1500)};b.prototype.startNextSlideTransitionTimer=function(){var a=this,c=parseInt(this.transitionTriggerValue);NaN!=c&&(c+=this.totalAnimationDuration,this.timers.setTimeout("startNextSlideTransition"+c,function(){a.checkSlideCompleted();a.transitionTrigger!=CardPresenterEnum.transitionTriggers.manual&&a.selectNext(!1)},c))};b.prototype.checkSlideCompleted=function(){this.notifySlideCompletedCallback()};b.prototype.navigationButtonMustBeShown=function(){var a=this.transitionTrigger!=
CardPresenterEnum.transitionTriggers.manual&&StringHelper.isNullOrEmpty(this.navigationButtonLabel);return!this.isLastItem&&!a};b.prototype.selectItem=function(a){a>this.index&&this.selectNext(!0);a<this.index&&this.selectPrevious()};b.prototype.selectNext=function(a){null!=this.selectNextCallback&&this.selectNextCallback(a)};b.prototype.selectPrevious=function(){null!=this.selectPreviousCallback&&this.selectPreviousCallback()};b.prototype.centerDots=function(){var a=this;this.parent.requestAnimationFrame("sequenceritem_centerdots_"+
this.slideId,function(){a.dotsTableHeight(a.getDomCardViewport().height());a.dotsMarginTop(-a.getPositionY())})};b.prototype.navigationButtonDomInclusion=function(){var a=this.transitionTrigger!=CardPresenterEnum.transitionTriggers.manual,c=!StringHelper.isNullOrEmpty(this.navigationButtonLabel);return!this.isLastItem&&(!a||a&&c)};b.prototype.displayNavigationButton=function(a){platformFeatures.getIsIE8()&&a!=this.showNavigationButton()&&this.applyFadeEffect(this.getDomNavButton(),a);this.showNavigationButton(a)};
b.prototype.applyFadeEffect=function(a,c){a.css("opacity",c?0:1);this.hideForIE8(!c);this.parent.setTimeout("sequenceritem_applyFadeEffect"+this.cardId,function(){a.animate({opacity:c?1:0},1E3,"linear")},1E3)};b.prototype.hasSound=function(){return this.sound.hasSource()};b.prototype.disposeVideoPlayer=function(){};b.prototype.getPositionY=function(){return this.getDomCardOverview().position()?this.getDomCardOverview().position().top:0};b.prototype.resetTabindex=function(){this._tabindex(-1);this._tabindexCard(-1);
this._tabindexSound(-1)};b.prototype.setTabindex=function(){this._tabindex(100);this._tabindexCard(this._tabindex());this._tabindexSound(20)};b.prototype.toggleSound=function(){this.parent.isActiveAndAccessibilityEnabled()&&this.sound.toggle()};b.prototype.sizeChanged=function(a,c){var b=this.nextButtonHeight||(this.nextButtonHeight=this.getDomNextButton().outerHeight(!0));this.parentAvailableHeight(c);platformFeatures.getIsPhone()?this.cardContentHeight("auto"):this.cardContentHeight(c-b+"px");this.centerDots();
this.updateScrollBar()};b.prototype.createScrollbar=function(){var a=this;this.scrollbarManager=new ScrollbarManager(this.getDomSlide,platformFeatures,null,function(c,b){for(var e=[],f=2;f<arguments.length;f++)e[f-2]=arguments[f];f=["["+a.parent.parent.templateName+"]("+a.parent.parent.exerciseClass()+")["+b+"]: "];f.concat(e);logger[c].apply(logger,f)});this.scrollbarManager.initialize();this.getDomSlide().bind("move",function(){a.centerDots()})};b.prototype.initDom=function(){};b.prototype.updateScrollBar=
function(){var a=this;platformFeatures.getIsIPad()?this.scrollbarManager?this.scrollbarManager.update():this.createScrollbar():this.parent.setTimeout(this.slideId,function(){a.dotsMarginTop(0);a.scrollbarManager&&a.scrollbarManager.update()||a.createScrollbar();a.centerDots()},800)};b.prototype.clearTimeouts=function(){this.parent.clearTimeout("stop_sequenceritem"+this.cardId);this.timers.cleanup()};b.prototype.cleanup=function(){this.hasSound()&&this.sound.cleanup();this.clearTimeouts()};return b}(),
CardDotViewModel=function(){function b(a,c){this.parent=a;this.index=c}b.prototype.select=function(a,c){c.preventDefault();this.parent.selectItem(this.index)};return b}(),AbstractCardPresenterViewModel=function(b){function a(a){var d=this;b.call(this,a);this.titleId=ko.observable(GuidHelper.newGuid());this.sequencersliderid=GuidHelper.newGuid();this.availableHeight=ko.observable(0);this.availableWidth=ko.observable(0);this.callToActionHeight=ko.observable(0);this.animateVisualElements=ko.observable(!1);
this.transitionType=ko.observable(CardPresenterEnum.transitionTypes.none);this.transitionTrigger=CardPresenterEnum.transitionTriggers.manual;this.transitionTriggerValue="";this.transitionDirection=ko.observable(CardPresenterEnum.transitionDirections.forward);this.items=ko.observableArray([]);this.renderedItems=ko.observableArray([]);this._tabindexCalltoAction=ko.observable(100);this.currentItem=null;this.transitionEnabled=!0;this.getDomSequencerSlider=function(){return $("#"+d.sequencersliderid)};
this.getDomDot1=function(){return $(".sequencer__dots-container",d.getDom()).first()};this.getDomDot2=function(){return $(".sequencer__dots-container",d.getDom()).last()};this.animationCanStart=ko.observable(!1);this.animationIsReversed=ko.observable(!1);this._isTransitingSequence=ko.observable(!1);this.keepNavigationButtonSpace=this.keepCallToActionSpace=!1;applicationViewModel.accessibilityViewModel.accessibilityFeaturesActivated()&&(this.animateVisualElements(!1),this.transitionTrigger=CardPresenterEnum.transitionTriggers.manual);
this.tabindexCalltoAction=this.generateTabIndexComputed("_tabindexCalltoAction",this);this.afterItemAdded=function(a,c,b){d.initItem(b);d.transitionType()==CardPresenterEnum.transitionTypes.scroll&&b.index<d.currentItem.index&&d.getDomSequencerSlider().scrollTop(2*d.availableHeight())};this.beforeRemovedItem=function(a,c,b){$(a).remove();a.nodeType==1&&b.disposeVideoPlayer();if(d.transitionType()==CardPresenterEnum.transitionTypes.scroll&&b.index<d.currentItem.index){d.renderedItems.indexOf(b);d.getDomSequencerSlider().scrollTop(0)}};
this.isTransitingSequence=ko.computed({read:function(){return d.transitionType()==CardPresenterEnum.transitionTypes.scroll?d._isTransitingSequence():false},write:function(a){d._isTransitingSequence(a)}})}__extends(a,b);a.prototype.initDom=function(){b.prototype.initDom.call(this);for(var a=0,d=this.items();a<d.length;a++)d[a].initDom();this.getDom().addClass(this.transitionType());return this};a.prototype.loadData=function(a){this.title(a.exercise.title);this.instruction(a.exercise.instruction);this.layout(a.exercise["@layout"]);
this.layoutTemplate(a.exercise["@layout"]);"true"==a.exercise.animateVisualElements&&this.animateVisualElements(!0);uiManager.screenshotMode&&this.animateVisualElements(!1);a.exercise.transition&&this.loadTransition(a.exercise.transition);this.loadItems(a.exercise.containers);this.isTransitingSequence(!1);this.selectItem(this.items()[0],!this.title()||""==this.title(),!1);return b.prototype.loadData.call(this,a)};a.prototype.loadTransition=function(a){var b=a["@type"];if((platformFeatures.getIsIE8()||
platformFeatures.getIsIE9()||platformFeatures.getIsAndroid())&&b==CardPresenterEnum.transitionTypes.cardDeck)b=CardPresenterEnum.transitionTypes.scroll;if((platformFeatures.getIsIE()||platformFeatures.isFirefox)&&b==CardPresenterEnum.transitionTypes.wipe)b=CardPresenterEnum.transitionTypes.fade;this.transitionType(b);this.transitionTrigger=a["@trigger"];applicationViewModel.accessibilityViewModel.accessibilityFeaturesActivated()&&(this.transitionTrigger=CardPresenterEnum.transitionTriggers.manual);
a.param&&(this.transitionTriggerValue=a.param["@value"])};a.prototype.instantiateCard=function(){throw Error("Cannot instantiate this kind of card");};a.prototype.loadItems=function(a){var b=this;null!=a&&void 0!=a&&(a=ArrayHelper.getArrayFromJson(a.container));for(var e=0,f=a.length;e<f;e++){var g=this.instantiateCard(e,this);g.loadData(a[e],a.length,this.animateVisualElements());g.mainTitleId=this.titleId();g.transitionTrigger=this.transitionTrigger;g.transitionTriggerValue=this.transitionTriggerValue;
g.selectNextCallback=function(a){b.selectNext(a)};g.selectPreviousCallback=function(){b.selectPrevious()};g.selectItemCallback=function(a){b.selectItem(b.items()[a])};g.notifySlideCompletedCallback=function(){b.checkExerciseCompleted()};e===f-1&&(g.isLastItem=!0);this.items.push(g)}if(this.parent.hasCallToAction())this.keepCallToActionSpace=!0,this.keepNavigationButtonSpace=!1;else for(e=0;e<this.items().length;e++)if(this.items()[e].navigationButtonDomInclusion()){this.keepNavigationButtonSpace=
!0;break}for(e=0;e<this.items().length;e++)this.items()[e].keepCallToActionSpace=this.keepCallToActionSpace,this.items()[e].keepNavigationButtonSpace=this.keepNavigationButtonSpace};a.prototype.clearTabindex=function(){for(var a=0,b=this.items().length;a<b;a++)this.items()[a].resetTabindex()};a.prototype.setTabindex=function(a){this.clearTabindex();a.setTabindex()};a.prototype.selectItem=function(a,b,e){void 0===b&&(b=!1);void 0===e&&(e=!0);var f=this.items,g=f.indexOf(a);a.isVisited(!0);this.setTabindex(a);
this.isTransitingSequence()||(null!=this.currentItem&&(this.currentItem.stop(),this.currentItem.isSelected(!1),this.animationIsReversed(this.currentItem.index>g)),uiManager.screenshotMode?this.renderedItems([a]):platformFeatures.getIsIE8()?this.renderedItems(f()):this.renderedItems(f.slice(Math.max(g-1,0),Math.min(g+2,f().length))),this.currentItem=a,this.currentItem.isSelected(!0),this.transitionType()==CardPresenterEnum.transitionTypes.scroll?this.animateScrollTop(1E3):platformFeatures.getIsIE8()&&
this.currentItem.getDomCardOverview()&&this.currentItem.getDomCardOverview().hide().fadeIn(),e&&this.currentItem.start(b))};a.prototype.animateScrollTop=function(a){var b=this,e=0;this.currentItem&&0!=this.currentItem.index&&(e=platformFeatures.getIsIE8()?this.availableHeight()*this.currentItem.index:this.availableHeight());this.getDomSequencerSlider().length&&(0<a?(this.isTransitingSequence(!0),this.getDomSequencerSlider().animate({scrollTop:e},a,"easeOutCubic",function(){b.isTransitingSequence(!1)})):
this.getDomSequencerSlider().scrollTop(e))};a.prototype.checkExerciseCompleted=function(){if(this.currentItem.index==this.items().length-1){for(var a=!0,b=this.items(),e=0,f=b.length;e<f;e++)if(!b[e].isVisited()){a=!1;break}a&&this.parent.setExerciseCompleted()}else this.parent.showCallToAction(!1)};a.prototype.selectNext=function(a){a&&(this.transitionEnabled=!0);if(a||this.transitionEnabled)if(this.transitionDirection(CardPresenterEnum.transitionDirections.forward),a=null,null!=this.currentItem?
(this.currentItem.downwardsway(!0),this.currentItem.upwardsway(!1),this.currentItem.index<this.items().length-1&&(a=this.items()[this.currentItem.index+1])):this.items().length&&(a=this.items()[0]),null!=a)a.downwardsway(!0),a.upwardsway(!1),this.selectItem(a,!0),this.animationCanStart(!0)};a.prototype.selectPrevious=function(){this.transitionDirection(CardPresenterEnum.transitionDirections.backwards);var a=null;this.transitionEnabled=!1;null!=this.currentItem?(this.currentItem.downwardsway(!1),this.currentItem.upwardsway(!0),
0<this.currentItem.index&&(a=this.items()[this.currentItem.index-1])):this.items().length&&(a=this.items()[0]);null!=a&&(a.downwardsway(!1),a.upwardsway(!0),this.selectItem(a,!0))};a.prototype.sizeChanged=function(a){if(null!=this.parent){this.hideScrollbar();var b=this.getDomContent().outerHeight(!0)-this.getDomContent().height(),e=$(this.getDomViewport()[0]).outerHeight(!0)-this.getDomViewport().height(),b=this.getDomTitleWrapper().outerHeight(!0)+applicationViewModel.timelineViewModel.buttonMenu.outerHeight(!0)+
b+e;platformFeatures.getIsPhone()&&(b-=applicationViewModel.timelineViewModel.buttonMenu.outerHeight(!0));this.availableHeight(Math.round(this.parent.height-b));this.availableWidth(a-this.getDomDot1().width()-this.getDomDot2().width());this.initItems();this.transitionType()==CardPresenterEnum.transitionTypes.scroll&&this.animateScrollTop(0)}return $.Deferred().resolve().promise()};a.prototype.initItems=function(){for(var a=0,b=this.renderedItems(),e=b.length;a<e;a+=1)this.initItem(b[a])};a.prototype.initItem=
function(a){if(this.keepCallToActionSpace||this.keepNavigationButtonSpace)this.keepCallToActionSpace&&a.isLastItem?this.callToActionHeight(this.parent.getDomCallToAction().outerHeight(!0)):this.callToActionHeight(a.getDomNavButton().outerHeight(!0));this.resizeItem(a)};a.prototype.resizeItem=function(a){var b=this.callToActionHeight(),e=this.availableWidth(),f=this.availableHeight();a.callToActionHeight=b;a.sizeChanged(e,f)};a.prototype.updateScrollbar=function(){return $.Deferred().resolve().promise()};
a.prototype.createScrollbar=function(){return this};a.prototype.updateAvailableHeight=function(a){this.availableHeight(this.parent.height-a)};a.prototype.startThumbnail=function(){this.items().length&&this.selectItem(this.items()[0]);return this};a.prototype.listenKeystrikes=function(){$document.on("keydown.sequencer",$.proxy(this.onKeypress,this))};a.prototype.onKeypress=function(a){var b=null;40==a.keyCode?b=this.selectNext:38==a.keyCode&&(b=this.selectPrevious);b&&(uiManager.stopPropagation(a),
a.preventDefault(),b())};a.prototype.start=function(){b.prototype.start.call(this);if(this.items().length){var a=!1;if((!this.title()||""==this.title()||"SequencerFullscreenLayout"==this.layout())&&applicationViewModel.accessibilityViewModel.accessibilityFeaturesActivated())a=!0;this.currentItem.start(a)}return this};a.prototype.stop=function(){null!=this.currentItem&&this.currentItem.stop();$document.off("keydown.sequencer");return this};a.prototype.cleanup=function(){b.prototype.cleanup.call(this);
for(var a=this.items(),d=0,e=a.length;d<e;d++)a[d].cleanup();this.items([]);return this};return a}(BaseContentViewModel),SequencerItemViewModel=function(b){function a(a,d){var e=this;b.call(this,a,d);this.videoEnded=this.animationEnded=!1;this.sequencerTemplateName="SequencerTemplate";this.layoutTemplate=ko.observable("SequencerTemplatetopleft");this.graphicTitle=ko.observable("");this.introductionMedia=ko.observable(null);this.conclusionMedia=ko.observable(null);this.contentMedia=ko.observable(null);
this.graphicCaption=ko.observable("");this.media=ko.observable(new MediaBase);this.mediaIsLarge=ko.observable(!1);this.graphicVisible=ko.observable(!1);this.contentVisible=ko.observable(!1);this.conclusionVisible=ko.observable(!0);this.conclusionDisplayDuration=this.visualElementDisplayDuration=1E3;this.contentAvailableHeight=ko.observable(0);this.graphicId=ko.observable(GuidHelper.newGuid());this.graphicTitleId=ko.observable(GuidHelper.newGuid());this.graphicCaptionId=ko.observable(GuidHelper.newGuid());
this.contentId=ko.observable(GuidHelper.newGuid());this.ariaLabelIntro=ko.observable("");this.ariaLabelImage=ko.observable("");this.ariaLabelContent=ko.observable("");this.ariaLabelConclusion=ko.observable("");this.displayGraphics=function(){e.graphicVisible(!0)};this.displayContent=function(){var a=e.getDomContentElement();platformFeatures.getIsIE9()?(a.hide(),e.contentVisible(!0),a.removeClass("fade-out").hide().fadeIn()):e.contentVisible(!0)};this.displayConclusion=function(){e.conclusionVisible(!0)}}
__extends(a,b);a.prototype.loadData=function(a,d,e){var f=StringHelper.htmlTrim(a.layout);platformFeatures.getIsPhone()&&-1!=f.indexOf("left")&&(f="top");platformFeatures.getIsPhone()&&-1!=f.indexOf("right")&&(f="top");this.layout(f);b.prototype.loadData.call(this,a,d,e);this.mediaIsLarge(f==CardPresenterEnum.layouts.leftEmphasized||f==CardPresenterEnum.layouts.rightEmphasized?!0:!1);this.setLayout();this.contentVisible(!this.animateVisualElements());this.conclusionVisible(!this.animateVisualElements());
this.graphicVisible(!this.animateVisualElements());this.hasMedia()||(this.visualElementDisplayDuration=0);this.getMedia().displayMediaTexts(a.graphictitle,a.graphiccaption,this.graphicTitle,this.graphicCaption,!1,!1);this.media().type==MediaType.image&&this.ariaLabelImage(this.media().metadataDescription)};a.prototype.getDomTitle=function(){return $("#"+this.mainTitleId)};a.prototype.getDomContentElement=function(){return $("#"+this.contentId())};a.prototype.getDomGraphicElement=function(){return $("#"+
this.graphicId())};a.prototype.getDomGraphicTitle=function(){return $("#"+this.graphicTitleId())};a.prototype.getDomGraphicCaption=function(){return $("#"+this.graphicCaptionId())};a.prototype.setLayout=function(){(!this.hasContent()||!this.hasMedia())&&this.layout(CardPresenterEnum.layouts.top);switch(this.layout()){case CardPresenterEnum.layouts.left:case CardPresenterEnum.layouts.leftEmphasized:case CardPresenterEnum.layouts.top:this.layoutTemplate(this.sequencerTemplateName+CardPresenterEnum.layouts.top+
CardPresenterEnum.layouts.left);break;case CardPresenterEnum.layouts.rightEmphasized:case CardPresenterEnum.layouts.bottom:case CardPresenterEnum.layouts.right:this.layoutTemplate(this.sequencerTemplateName+CardPresenterEnum.layouts.bottom+CardPresenterEnum.layouts.right)}};a.prototype.sizeChanged=function(a,d){b.prototype.sizeChanged.call(this,a,d);var e=this.media();if(e.type==MediaType.image)e.resize();else{var f=e.getDom(),g=f.height(),h=f.width()||$("#"+e.id+"_flash_api").width(),g=e.getOriginalHeight()*
(h/e.getOriginalWidth());f.parent().height(g);e.fitToContent(h,g,null,null)}this.updateScrollBar()};a.prototype.toggleVideo=function(){this.media().type==MediaType.video&&this.parent.isActiveAndAccessibilityEnabled()&&this.media().playToggle()};a.prototype.initDom=function(){this.media().type==MediaType.video&&(this.media().initializePlayerSize(),this.media().loadUrl())};a.prototype.start=function(a){var b=this;void 0===a&&(a=!1);this.clearTimeouts();this.hasVideo()&&this.getVideo().initializePlayerSize();
applicationViewModel.accessibilityViewModel.accessibilityFeaturesActivated()?this.media().setTabindex(100):this.hasSound()?this.sound.play():this.hasVideo()&&this.getVideo().play();this.hasImage()&&this.getImage().play();this.animateVisualElements()&&this.startAnimation();this.transitionTrigger==CardPresenterEnum.transitionTriggers.delay&&this.startNextSlideTransitionTimer();this.navigationButtonMustBeShown()&&!this.animateVisualElements()&&!this.hasVideo()&&!this.hasSound()&&this.timers.setTimeout("start sequencer item",
function(){b.displayNavigationButton(!0)},1E3);a&&(applicationViewModel.accessibilityViewModel.accessibilityFeaturesActivated()&&this.sound.hasSource()?this.getDomAudioButtonAccessibility().focus():this.getDomIntro().focus());this.checkSlideCompleted()};a.prototype.stop=function(){var a=this;this.soundEnded=this.videoEnded=this.animationEnded=!1;this.sound.stop();this.hasVideo()&&this.getVideo().stop();this.parent.isActiveAndAccessibilityEnabled()&&this.media().setTabindex(-1);this.clearTimeouts();
this.parent.setTimeout("stop_sequenceritem"+this.cardId,function(){a.parent.isActiveAndAccessibilityEnabled()||a.displayNavigationButton(!1);a.scrollbarManager&&a.scrollbarManager.updateTo(ScrollbarManager.TOP);a.centerDots();a.animateVisualElements()&&(a.graphicVisible(!1),a.contentVisible(!1))},1500)};a.prototype.cleanup=function(){b.prototype.cleanup.call(this);this.getMedia().cleanup();null!=this.contentMedia()&&this.contentMedia().cleanup()};a.prototype.disposeVideoPlayer=function(){var a=this.getVideo();
null!=a&&null!=a.videoPlayer&&a.disposeVideoPlayer()};a.prototype.hasVideo=function(){return null!=this.getVideo()};a.prototype.hasImage=function(){return null!=this.getImage()};a.prototype.getVideo=function(){return this.getMedia().type==MediaType.video?this.media():null};a.prototype.getImage=function(){return this.getMedia().type==MediaType.image?this.media():null};a.prototype.getMedia=function(){return this.media()};a.prototype.loadTexts=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a),
b=0,e=a.length;b<e;b++){var f=a[b];void 0!=f["#text"]&&("content"==f["@name"]?(this.contentMedia((new MediaText).loadData(f,this.parent.parent.exerciseId)),this.contentMedia().addCssClass("block"),this.ariaLabelContent(this.contentMedia().transformStringForAriaLabel())):"introduction"==f["@name"]?(this.introductionMedia((new MediaText).loadData(f,this.parent.parent.exerciseId)),this.ariaLabelIntro(this.introductionMedia().transformStringForAriaLabel())):"conclusion"==f["@name"]&&(this.conclusionMedia((new MediaText).loadData(f,
this.parent.parent.exerciseId)),this.ariaLabelConclusion(this.conclusionMedia().transformStringForAriaLabel())))}if((a=this.contentMedia())&&a.effect==TextEffect.balloon)switch(this.layout()){case CardPresenterEnum.layouts.left:case CardPresenterEnum.layouts.leftEmphasized:a.setBalloonPosition(TextBalloonPosition.right);break;case CardPresenterEnum.layouts.right:case CardPresenterEnum.layouts.rightEmphasized:a.setBalloonPosition(TextBalloonPosition.left);break;case CardPresenterEnum.layouts.bottom:a.setBalloonPosition(TextBalloonPosition.top);
break;case CardPresenterEnum.layouts.top:a.setBalloonPosition(TextBalloonPosition.bottom)}};a.prototype.loadMedias=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a),b=0,e=a.length;b<e;b++){var f=MediaFactory.createMedia(a[b]);switch(f.type){case MediaType.sound:this.sound=f;this.sound.onEnded.subscribe(this,this.onSoundEnded);break;case MediaType.image:this.media(f);break;case MediaType.video:this.media(f),this.getVideo().onEnded.subscribe(this,this.onVideoEnded)}}};a.prototype.onSoundEnded=
function(){var a=this;this.soundEnded=!0;this.hasVideo()&&!this.parent.isActiveAndAccessibilityEnabled()?this.getVideo().play():(this.navigationButtonMustBeShown()&&this.timers.setTimeout("onSoundEnded",function(){a.displayNavigationButton(!0)},250),this.transitionTrigger==CardPresenterEnum.transitionTriggers.media&&this.selectNext(!1));this.checkSlideCompleted()};a.prototype.onVideoEnded=function(){var a=this;this.videoEnded=!0;this.navigationButtonMustBeShown()&&this.timers.setTimeout("onVideoEnded",
function(){a.displayNavigationButton(!0)},250);this.transitionTrigger==CardPresenterEnum.transitionTriggers.media&&this.selectNext(!1);this.checkSlideCompleted()};a.prototype.fitMediaToContent=function(a,b){var e=this.getDomGraphicElement(),f=this.getDomGraphicTitle(),g=this.getDomGraphicCaption();this.getDomTitle();var h=this.getMediaAvailableWidth(a,e.outerWidth(!0)),i=this.getMediaAvailableHeight(b,f.outerHeight(!0),g.outerHeight(!0));logger.debug("item "+this.index+", graphicTitleElt.outerHeight(true) : "+
f.outerHeight(!0));logger.debug("item "+this.index+", graphicCaptionElt.outerHeight(true) : "+g.outerHeight(!0));logger.debug("item "+this.index+", image max height  : "+i);this.media().fitToContent(h,i,null,null,this.getMedia().isCropped);logger.debug("item "+this.index+", image height  : "+e.find("img").outerHeight(!0));logger.debug("item "+this.index+", illustration height  : "+e.outerHeight(!0))};a.prototype.getMediaAvailableWidth=function(a,b){var e=b;switch(this.layout()){case CardPresenterEnum.layouts.left:case CardPresenterEnum.layouts.leftEmphasized:case CardPresenterEnum.layouts.right:case CardPresenterEnum.layouts.rightEmphasized:e=
b;break;default:e=b}return 0.8*e};a.prototype.getMediaAvailableHeight=function(a,b,e){switch(this.layout()){case CardPresenterEnum.layouts.bottom:case CardPresenterEnum.layouts.top:a=this.hasContent()?0.45*a:0.85*a}return a-(b+e)};a.prototype.getContentAvailableHeight=function(a){switch(this.layout()){case CardPresenterEnum.layouts.top:case CardPresenterEnum.layouts.bottom:return this.hasMedia()?0.43*a:a;default:return a}};a.prototype.hasContent=function(){var a=this.contentMedia();return a&&""!=
a.text()?!0:!1};a.prototype.hasConclusion=function(){var a=this.conclusionMedia();return a&&""!=a.text()?!0:!1};a.prototype.hasMedia=function(){return""!=this.graphicTitle()||""!=this.graphicCaption()||""!=this.getMedia().url()?!0:!1};a.prototype.startAnimation=function(){var a=this,b;this.contentVisible(!1);this.conclusionVisible(!1);this.layout()==CardPresenterEnum.layouts.bottom?(b=this.visualElementDisplayDuration,this.timers.setTimeout("displayContent",this.displayContent,b),b+=this.visualElementDisplayDuration,
this.timers.setTimeout("displayGraphic",this.displayGraphics,b)):(b=this.visualElementDisplayDuration,this.timers.setTimeout("displaygraphic",this.displayGraphics,b),b+=this.visualElementDisplayDuration,this.timers.setTimeout("displayContent",this.displayContent,b));b+=this.hasConclusion()?this.conclusionDisplayDuration:0;this.timers.setTimeout("showConclusion",this.displayConclusion,b);this.totalAnimationDuration=b;this.navigationButtonMustBeShown()&&this.timers.setTimeout("displayNavigationButton"+
this.cardId,function(){a.displayNavigationButton(true)},b+1E3);this.timers.setTimeout("animationEnded"+this.cardId,function(){a.animationEnded=true;a.checkSlideCompleted()},b)};a.prototype.checkSlideCompleted=function(){this.hasVideo()||(this.videoEnded=!0);this.hasSound()||(this.soundEnded=!0);this.animateVisualElements()||(this.animationEnded=!0);this.animationEnded&&this.soundEnded&&this.videoEnded&&this.notifySlideCompletedCallback&&this.notifySlideCompletedCallback()};return a}(CardViewModel),
SequencerViewModel=function(b){function a(a){b.call(this,a)}__extends(a,b);a.prototype.instantiateCard=function(a,b){return new SequencerItemViewModel(a,b)};return a}(AbstractCardPresenterViewModel),DiscussionCardViewModel=function(b){function a(a,d){b.call(this,a,d);this.mediaImage=ko.observable(null);this.mediaText=ko.observable(new MediaText);this.containerId=GuidHelper.newGuid();this.spikeId=GuidHelper.newGuid();this.bubbleId=GuidHelper.newGuid();this.ariaLabelContent=ko.observable("");this.bubblePercentagePosition=
{top:0,left:0};this.layoutTemplate=ko.observable("SequencerItemDiscussion");this.bubbleOrientation=ko.observable("");this.bubbleTop=ko.observable("auto");this.bubbleRight=ko.observable("auto");this.bubbleBottom=ko.observable("auto");this.bubbleLeft=ko.observable("auto");this.cardIsVisible=ko.observable(!1);this.spikeLeft=ko.observable("auto");this.bubbleType=ko.observable("normal");this.bubbleDiagonal=ko.observable("discussion-card__speech-UpperLeftAndBottomRight");this.limitedImageHeight=ko.observable("auto");
this.index=a}__extends(a,b);a.prototype.start=function(a){var d=this;void 0===a&&(a=!1);b.prototype.start.call(this,a);this.mediaImage().play();this.navigationButtonMustBeShown()&&!this.hasSound()&&this.timers.setTimeout("start sequencer item",function(){d.displayNavigationButton(!0)},1E3);this.computeBubblePosition()};a.prototype.loadData=function(a,d,e){b.prototype.loadData.call(this,a,d,e);this.loadPhylactery(a.bubble)};a.prototype.loadMedias=function(a){var b=this;if(void 0!=a)for(var e=ArrayHelper.getArrayFromJson(a),
f=0,a=a.length;f<a;f++){var g=MediaFactory.createMedia(e[f]);switch(g.type){case MediaType.sound:this.sound=g;this.sound.onEnded.subscribe(this,this.onSoundEnded);break;case MediaType.image:this.mediaImage(g),this.mediaImage().onLoaded.subscribe(this,function(){b.computeBubblePosition()})}}};a.prototype.loadPhylactery=function(a){var b=100*a["@xpos"];this.bubblePercentagePosition.top=100*a["@ypos"];this.bubblePercentagePosition.left=b;b=platformFeatures.getIsPhone()?"south":a["@position"];this.bubbleOrientation(b);
switch(b){case "north":case "south":case "northeast":case "east":case "southwest":this.bubbleDiagonal("discussion-card__speech-UpperLeftAndBottomRight");break;case "southeast":case "northwest":case "west":this.bubbleDiagonal("discussion-card__speech-UpperRightAndBottomLeft")}switch(parseInt(a["@type"])){case 0:this.bubbleType("normal");break;case 1:this.bubbleType("angry");break;case 2:this.bubbleType("thinking");break;case 3:this.bubbleType("voiceover")}this.mediaText().loadData(a.text,this.parent.parent.exerciseId);
this.ariaLabelContent(this.mediaText().transformStringForAriaLabel())};a.prototype.sizeChanged=function(a,d){b.prototype.sizeChanged.call(this,a,d);var e=this.mediaImage(),f=d-this.callToActionHeight-this.nextButtonHeight-2;platformFeatures.getIsPhonePortrait()?(this.cardContentHeight("auto"),this.limitedImageHeight("auto")):platformFeatures.getIsPhoneLandscape()?(this.cardContentHeight("auto"),this.limitedImageHeight(f+"px")):this.cardContentHeight(f+"px");e.resize();this.computeBubblePosition()};
a.prototype.computeBubblePosition=function(){var a=this;setTimeout(function(){a.cardIsVisible(!0);a.bubbleTop(a.computeBubbleTop());a.bubbleRight(a.computeBubbleRight());a.bubbleBottom(a.computeBubbleBottom());a.bubbleLeft(a.computeBubbleLeft());platformFeatures.getIsPhone()&&a.computeMobileBubblePosition()},1E3)};a.prototype.createScrollbar=function(){};a.prototype.updateScrollBar=function(){};a.prototype.computeMobileBubblePosition=function(){var a=$("#"+this.mediaImage().idImage).width(),b=($("#"+
this.containerId).width()-a)/2,e=this.bubblePercentagePosition.left*a/100+b,f=$("#"+this.bubbleId).outerWidth(!0),g=$("#"+this.spikeId).width(),h=e-g/2,e=e-g/2-f/2,e=0>e?0:e;e>a-f&&(e=0>a-f?0:a-f+b);this.bubbleLeft(e+"px");this.spikeLeft(h-e+"px")};a.prototype.computeBubbleBottom=function(){if(platformFeatures.getIsPhone())return"auto";var a=$("#"+this.spikeId).height(),b=$("#"+this.mediaImage().idImage).height(),e=$("#"+this.containerId).height(),f=$("#"+this.bubbleId).outerHeight(!0),g=e-b;switch(this.bubbleOrientation()){case "north":case "northeast":case "northwest":return a=
(100-this.bubblePercentagePosition.top)*b/100+a+g,e-=f,(a>e?e:a)+"px";default:return"auto"}};a.prototype.computeBubbleRight=function(){if(platformFeatures.getIsPhone())return"auto";var a=$("#"+this.spikeId).width(),b=$("#"+this.containerId).width(),e=$("#"+this.mediaImage().idImage).width(),b=(100-this.bubblePercentagePosition.left)*e/100+(b-e)/2;switch(this.bubbleOrientation()){case "west":return b+a+"px";case "northwest":case "southwest":return b+"px";default:return"auto"}};a.prototype.computeBubbleTop=
function(){var a=$("#"+this.bubbleId).outerHeight(!0);if(platformFeatures.getIsPhonePortrait())return this.getDomNavButton().css("transform","translateY(0)"),"auto";if(platformFeatures.getIsPhoneLandscape())return this.getDomNavButton().css("transform","translateY(-60px)"),60>a?"-"+a+"px":"-60px";var b=$("#"+this.spikeId).height(),e=$("#"+this.mediaImage().idImage).height();switch(this.bubbleOrientation()){case "south":case "southeast":case "southwest":return a=this.bubblePercentagePosition.top*e/
100+b,a+"px";case "east":case "west":return a=this.bubblePercentagePosition.top*e/100-a/2,0>a&&(a=parseInt($("#"+this.spikeId).css("top"))+a,$("#"+this.spikeId).css("top",a+"px"),a=0),a+"px";default:return"auto"}};a.prototype.computeBubbleLeft=function(){if(platformFeatures.getIsPhone())return"auto";var a=$("#"+this.spikeId).width(),b=$("#"+this.mediaImage().idImage).width(),e=($("#"+this.containerId).width()-b)/2,f=this.bubblePercentagePosition.left*b/100+e;switch(this.bubbleOrientation()){case "east":return f+
a+"px";case "northeast":case "southeast":return f+"px";case "north":case "south":var g=$("#"+this.bubbleId).outerWidth(!0),f=f-g/2,a=g/2-a;f<e?(f-=e,$("#"+this.spikeId).css("left",a+f+"px"),f=e):f+g>b+e&&(f=b+e-(f+g),$("#"+this.spikeId).css("left",a-f+"px"),f=b+e-g);return f+"px";default:return"auto"}};return a}(CardViewModel),DiscussionViewModel=function(b){function a(a){b.call(this,a)}__extends(a,b);a.prototype.instantiateCard=function(a,b){return new DiscussionCardViewModel(a,b)};a.prototype.loadData=
function(a){return b.prototype.loadData.call(this,a)};return a}(AbstractCardPresenterViewModel),DragToPlaceViewModel=function(b){function a(a){var d=this;b.call(this,a);this.image=ko.observable(new MediaImage);this.hotspots=ko.observableArray([]);this.alternatives=ko.observableArray([]);this.imageHeight=ko.observable("");this.displayLowImage=ko.observable(!1);this.displayHighImage=ko.observable(!1);this.isHighQualityLoaded=this.isLowQualityLoaded=!1;this.imageRatio=0;this.isDragging=ko.observable(!1);
this.allAnswersFound=ko.observable(!1);this.allAnswersFoundTabindex=ko.observable(-1);this.selectedItem=null;this._tabindex=ko.observable(100);this.tabindexImg=this.generateTabIndexComputed("_tabindex",this);this.getDomIexploreImagesContainer=function(){return d.parent.getExerciseDom().find(".dragtoplace__images")};this.getDomImage=function(){if(!d.getDomIexploreImagesContainer())return null;var a=d.getDomIexploreImagesContainer().find(".dragtoplace__image");return d.isHighQualityLoaded?a.last():
a.first()};this.isDragDropTemplate=!0}__extends(a,b);a.prototype.loadData=function(a){a.exercise&&(this.title(a.exercise.title),this.instruction(a.exercise.instruction),this.layout("DragToPlaceStandardLayout"),this.layoutTemplate("DragToPlaceStandardLayout"),this.loadMedias(a.exercise.media),this.loadHotspots(a.exercise.hotspots));return b.prototype.loadData.call(this,a)};a.prototype.loadHotspots=function(a){if(void 0!=a){for(var b="visible"==a["@displaytype"],a=ArrayHelper.getArrayFromJson(a.hotspot),
e=[],f=[],g=0;g<a.length;g++){var h;h=new DragToPlaceHotSpot(this,g);h.loadData(a[g]);h.visible(b);e.push(h);ko.utils.arrayPushAll(f,h.labelItems)}this.hotspots(e);this.alternatives(ArrayHelper.shuffle(f))}};a.prototype.sizeChanged=function(a,d){var e=this;b.prototype.sizeChanged.call(this,a,d);var f=$.Deferred();this.getDomImage().css({display:"none"});var g=this.getDomTitleWrapper()?this.getDomTitleWrapper().outerHeight(!0):0,g=d-g;this.getDomIexploreImagesContainer().css({width:this.getDomContent().width(),
height:g});this.imageHeight("");g=a/g;this.imageRatio=this.getDomImage().outerWidth(!0)/this.getDomImage().outerHeight(!1);g>this.imageRatio?this.getDomImage().css({height:"100%",width:"auto"}):this.getDomImage().css({height:"auto",width:"100%"});this.getDomImage().css({display:""});this.image().resize();this.requestAnimationFrame("dragtoplace_renderHotspots",function(){var a=e.getDomImage().height();e.getDomIexploreImagesContainer().css({height:a});e.imageHeight(a+"px");e.renderHotspots(e.getDomIexploreImagesContainer().width(),
a);f.resolve()});this.updateScrollbar();return f.promise()};a.prototype.renderHotspots=function(a){var b,e,f,a=a||this.parent.width;b=this.getDomImage().outerWidth(!0);e=this.getDomImage().outerHeight(!0);a=(a-b)/2;f=this.hotspots();for(var g=0,h=f.length;g<h;g++)f[g].sizeChanged(b,e,a)};a.prototype.start=function(){b.prototype.start.call(this);for(var a=0,d=this.hotspots();a<d.length;a++)d[a].initialize();this.updateStickyFooterHeight();this.initializeDragAndDrop();this.selectNextItem();return this};
a.prototype.initializeDragAndDrop=function(){webkit_DragManager.reset();for(var a=this.hotspots(),b=this,e=0,f=a.length;e<f;e++){var g=[],h=a[e];if(!h.isItemDropped()){for(var i=0,j=h.labelItems.length;i<j;i++){var k=h.labelItems[i],l=$body[0];if(!l)throw"no element received:"+this.parent.slideId;l={revert:!0,container:l,onStart:function(a){return function(){b.isDragging(!0);a.onDragStarted()}}(k),onEnd:function(){return function(){b.isDragging(!1)}}(k)};webkit_DragManager.addDraggable(k.draggableId,
l);g.push(k.draggableId)}g={accept:g,hoverClass:"hover",hoverAllDropZone:!0,onDrop:function(a){return function(){a.onZoneReceivedDroppedItem()}}(h)};webkit_DragManager.addDropZone(h.hotspotId,g)}}};a.prototype.selectNextItem=function(){for(var a=this.alternatives(),b=0,e=a.length;b<e;b++)a[b].isAlternativeVisible(0==b);this.isActiveAndAccessibilityEnabled()&&(this.allAnswersFound()?this.allAnswersFoundTabindex(100):a[0].enableKeyboardFocus())};a.prototype.stop=function(){this.allAnswersFoundTabindex(-1);
b.prototype.stop.call(this);return this};a.prototype.disableDropZonesKeyboardFocus=function(){for(var a=0,b=this.alternatives().length;a<b;a++)this.alternatives()[a].disableKeyboardFocus()};a.prototype.reset=function(){this.allAnswersFound(!1);this.isDragging(!1);for(var a=[],b=this.hotspots(),e=0,f=b.length;e<f;e++){var g=b[e];g.markNoneFound();a=a.concat(g.labelItems)}this.alternatives(ArrayHelper.shuffle(a));this.selectNextItem();return this};a.prototype.cleanup=function(){try{b.prototype.cleanup.call(this)}catch(a){logger.error("Drag To Place  cleanup error : "+
a)}return this};a.prototype.itemDropped=function(a){var b=this;this.alternatives.remove(a);a.hasFeedback()?this.showItemFeedback(a):(this.disableDropZonesKeyboardFocus(),0!=this.alternatives().length&&this.selectNextItem(),this.isActiveAndAccessibilityEnabled()&&(0!=this.alternatives().length?this.parent.setTimeout("dragAccessibilityFocus",function(){b.alternatives()[0].getDomDragItem().focus();b.selectedItem=null},500):(this.parent.setTimeout("dragAccessibilityFocus",function(){b.selectedItem=null;
b.getDom().find("#dropped_"+a.draggableId).focus()},500),this.allAnswersFoundTabindex(100))));0==this.alternatives().length?(this.allAnswersFound(!0),this.hideStickyFooter(),a.hasFeedback()||this.parent.setExerciseCompleted()):this.updateStickyFooterHeight();this.updateScrollbar()};a.prototype.showItemFeedback=function(a){var b=this;this.disableKeyboardFocus();this.openingSound.stop();if(a.hasFeedback()){var e=a.media;0==this.alternatives().length&&this.allAnswersFoundTabindex(-1);this.feedback.setFeedback(e,
a.sound,a.feedback);this.setTimeout("feedback-sizechanged",function(){b.feedback.sizeChanged(b.parent.width,b.parent.height)});0==this.alternatives().length&&(this.selectedItem=a);this.showFeedback()}};a.prototype.onFeedbackCloseClick=function(){var a=this;this.tabindexTitleComponent(BaseContentViewModel.TITLE_COMPONENT_TABINDEX_ORDER_VALUE);this.disableDropZonesKeyboardFocus();0==this.alternatives().length?(this.parent.setExerciseCompleted(),this.allAnswersFoundTabindex(100),this.getDom().find("#dropped_"+
this.selectedItem.draggableId).focus(),platformFeatures.getIsIE()&&BrowserHelper.refreshDom()):(this.selectNextItem(),this.isActiveAndAccessibilityEnabled()&&this.parent.setTimeout("dragAccessibilityFocus",function(){a.alternatives()[0].getDomDragItem().focus()},500));this.selectedItem=null;b.prototype.onFeedbackCloseClick.call(this);this.updateScrollbar()};a.prototype.disableKeyboardFocus=function(){this.tabindexTitleComponent(BaseContentViewModel.DISABLED_TABINDEX_ORDER_VALUE);this.disableDropZonesKeyboardFocus()};
a.prototype.loadMedias=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a),b=0,e=a.length;b<e;b++){var f=MediaFactory.createMedia(a[b],!0);f.type==MediaType.sound?this.openingSound=f:f.type==MediaType.image&&(f.addCssClass("background"),this.image(f))}};a.prototype.lowImageLoaded=function(){this.isHighQualityLoaded||(this.isLowQualityLoaded=!0,this.displayLowImage(!0),this.requestRendering())};a.prototype.highImageLoaded=function(){this.isHighQualityLoaded=!0;this.displayHighImage(!0);
this.displayLowImage(!1);this.requestRendering()};a.prototype.requestRendering=function(){this.sizeChanged(this.parent.width,this.parent.height)};a.prototype.resetTabindex=function(){this._tabindex(-1);for(var a=this.hotspots(),b=a.length-1;0<=b;b--)a[b].resetTabindex()};return a}(BaseContentViewModel),DragToPlaceHotSpot=function(){function b(a,c){var b=this;this.id=GuidHelper.newGuid();this.isStarted=ko.observable(0);this.sizeLoaded=ko.observable(!1);this.labelItems=[];this.labelItemsFound=ko.observableArray([]);
this.scrollHeight=ko.observable(0);this.mustScroll=!1;this.inlineFeedbackId=GuidHelper.newGuid();this.captionId=GuidHelper.newGuid();this.hotspotId=GuidHelper.newGuid();this.visible=ko.observable(!0);this.originalHeight=this.originalWidth=this.originalY=this.originalX=0;this.isRectangleHotspot=ko.observable(!1);this.width=ko.observable(0);this.height=ko.observable(0);this.x=ko.observable(0);this.y=ko.observable(0);this.labelNumberTop=ko.observable(0);this.labelNumberLeft=ko.observable(0);this.branchingDestinationType=
null;this.isBranching=!1;this.textLabel=ko.observable("");this.hotspotLabel=localizedText.Accessibility_IexploreZone();this.positionLabel=ko.observable("southwest");this.droppedZoneId=GuidHelper.newGuid();this.marginInlineFeedback=10;this.sound=null;this.feedbackText=new MediaText;this.visualMedia=new MediaBase;this._tabindexItem=ko.observable(100);this.animateValidationIcon=ko.observable(!1);this.showValidationIcon=ko.observable(!1);this.getDomHotspots=function(){return null==b.parent?null:b.parent.getDomIexploreImagesContainer()};
this.getDomHotspot=function(){return $("#"+b.hotspotId)};this.getDomCaption=function(){return $("#"+b.captionId)};this.getDomLabelNumber=function(){return $(".dragtoplace__label-number",b.getDomHotspot())};this.fallback=null!=uiManager.screenshotMode||platformFeatures.getIsIE8();this.parent=a;this.positionInItemsList=c+1;this.setTabindex()}b.prototype.initialize=function(){this.isStarted(1)};b.prototype.setTabindex=function(){this._tabindexItem(100*(this.positionInItemsList+1));this.tabindexItem=
this.parent.generateTabIndexComputed("_tabindexItem",this)};b.prototype.resetTabindex=function(){this._tabindexItem(-1)};b.prototype.cleanup=function(){};b.prototype.getOriginalX=function(){return this.originalX};b.prototype.getOriginalY=function(){return this.originalY};b.prototype.getOriginalWidth=function(){return this.originalWidth};b.prototype.getOriginalHeight=function(){return this.originalHeight};b.prototype.loadData=function(a){this.originalWidth=parseFloat(a["@radiusWidth"]);this.originalHeight=
parseFloat(a["@radiusHeight"]);this.isRectangleHotspot("true"==a["@isRectangle"]);this.originalX=parseFloat(a["@xpos"]);this.originalY=parseFloat(a["@ypos"]);this.altNum=+a["@altnum"];var a=a.alternatives,c=[];if(void 0!=a){for(var a=ArrayHelper.getArrayFromJson(a.alternative),b=0,e=a.length;b<e;b++)c.push(new LabelDragToPlaceItem(this,a[b]));ko.utils.arrayPushAll(this.labelItems,c)}};b.prototype.loadMedias=function(a){if(void 0!=a){for(var a=ArrayHelper.getArrayFromJson(a),c=a.length,b=0;b<c;b++){var e=
MediaFactory.createMedia(a[b],!0);e.type==MediaType.sound?""!=e.url()&&(this.sound=e):this.visualMedia=e}e.type==MediaType.video&&e.isVisible(!1)}};b.prototype.initDom=function(){};b.prototype.sizeChanged=function(a,c,b){var e=this;a&&c&&(this.x(Math.floor(b+a*this.getOriginalX())),this.y(Math.floor(c*this.getOriginalY())),this.width(Math.floor(a*this.getOriginalWidth())),this.height(Math.floor(c*this.getOriginalHeight())),platformFeatures.getIsPhone()&&this.width()<this.getDomLabelNumber().outerWidth()&&
this.width(this.getDomLabelNumber().outerWidth()),this.getDomHotspots()&&platformFeatures.getIsIE8()&&this.parent.requestAnimationFrame("iexploreItem_sizechanged"+this.captionId,function(){var a=e.getDomCaption().parent(),c=a.outerHeight(),c=e.height()/2-c/2;("center"==e.positionLabel()||"east"==e.positionLabel()||"west"==e.positionLabel())&&a.css({top:c+"px"})}))};b.prototype.setDraggingItem=function(a){this.draggingItem=a};b.prototype.isItemDropped=function(){return null==this.draggingItem?!1:this.draggingItem.dropped()};
b.prototype.onZoneReceivedDroppedItem=function(){var a=this,c=this.draggingItem.getDomDragItem();this.getDomHotspot().removeClass("hover");this.draggingItem.onItemDropped();platformFeatures.getIsIPad()?(c.fadeOut(500),webkit_DragManager&&webkit_DragManager.removeDraggable(this.draggingItem.draggableId),this.labelItemsFound(ArrayHelper.append(this.draggingItem,this.labelItemsFound())),setTimeout(function(){a.parent.itemDropped(a.draggingItem)},500)):(webkit_DragManager&&webkit_DragManager.removeDraggable(this.draggingItem.draggableId),
this.labelItemsFound(ArrayHelper.append(this.draggingItem,this.labelItemsFound())),c.fadeOut(500).promise().then(function(){a.parent.itemDropped(a.draggingItem)}))};b.prototype.onClick=function(a){this.parent.showItemFeedback(a)};b.prototype.markNoneFound=function(){for(var a=[],c=this.labelItemsFound(),b=0,e=c.length;b<e;b++)a.push(c[b]);this.labelItemsFound.removeAll();return a};return b}(),LabelDragToPlaceItem=function(){function b(a,c){var b=this;this.draggableId=GuidHelper.newGuid();this.labelItemScreenReaderDescription=
localizedText.Accessibility_SelectDestination();this.isAlternativeVisible=ko.observable(!1);this.media=new MediaBase;this.sound=null;this.feedback=new MediaText;this.dropped=ko.observable(!1);this.wasDropped=!1;this.hasFeedback=ko.observable(!1);this._tabindexDragItem=ko.observable(-1);this.getDomDragItem=function(){return $("#"+b.draggableId)};this.parent=a;this.dropZoneId=a.hotspotId;this.tabindexDragItem=this.parent.parent.generateTabIndexComputed("_tabindexDragItem",this);this.loadData(c)}b.prototype.loadData=
function(a){this.responseText="";a.text&&(this.responseText=a.text["#text"]);this.feedback.loadData(a.response.text,this.parent.parent.parent.exerciseId);a.response&&this.loadMedias(a.response.media);(null!=this.media&&""!=this.media.url()||null!=this.sound&&this.sound.hasSource()||""!=this.feedback.text())&&this.hasFeedback(!0)};b.prototype.loadMedias=function(a){for(var a=ArrayHelper.getArrayFromJson(a),c=0,b=a.length;c<b;c++){var e=MediaFactory.createMedia(a[c]);e.type==MediaType.sound?""!=e.url()&&
(this.sound=e):this.media=e}};b.prototype.allAnswersFound=function(){return!1};b.prototype.onItemDropped=function(){this.dropped(!0);this.isAlternativeVisible(!1)};b.prototype.onClick=function(){this.parent.onClick(this)};b.prototype.onSelectForAccessibility=function(){this.parent.parent.isActiveAndAccessibilityEnabled()&&(this.parent.parent.selectedItem=this,this.parent.setDraggingItem(this))};b.prototype.onDragStarted=function(){var a=this;this.parent.parent.getDom().addClass("bounceAll");setTimeout(function(){a.parent.parent.getDom().removeClass("bounceAll")},
700);this.parent.parent.selectedItem=this;this.parent.setDraggingItem(this)};b.prototype.enableKeyboardFocus=function(){this._tabindexDragItem(100)};b.prototype.disableKeyboardFocus=function(){this.tabindexDragItem(-1)};b.prototype.stop=function(){};b.prototype.cleanup=function(){};return b}(),ElaborateViewModel=function(b){function a(){b.apply(this,arguments);this.layoutTemplate=ko.observable("");this.image=ko.observable(new MediaImage);this.items=ko.observableArray([]);this.selectedItem=ko.observable(null);
this.isFirstImage=!0;this.layout=ko.observable("");this.templateCropHeight=this.templateCropWidth=1;this.titlesMaxHeight=ko.observable("");this.illustrationsMaxHeight=ko.observable("");this.tableId=GuidHelper.newGuid();this.alternativeColumnId=GuidHelper.newGuid();this._imageTabindex=null;this.imageTabindex=this.generateTabIndexComputed("_imageTabindex",this)}__extends(a,b);a.prototype.loadData=function(a){if(a.exercise){this.title(a.exercise.title);this.instruction(a.exercise.instruction);var d=
a.exercise["@layout"];"ElaborateMediumImagesLayout"==d||"ElaborateLargeLayout"==d?d="exercise--elaborate--large":"ElaborateLittleImagesLayout"==d&&(d="exercise--elaborate--small");this.layout(d);this.layoutTemplate("ElaborateStandardLayout");this.applyLargeSizeLayout();this.loadItems(a.exercise.alternatives);this.loadMedias(a.exercise.media);this._imageTabindex=this.isFirstImage?ko.observable(99):ko.observable(100*(this.items().length+1))}return b.prototype.loadData.call(this,a)};a.prototype.loadItems=
function(a){if(void 0!=a&&void 0!=a.alternative)for(var a=ArrayHelper.getArrayFromJson(a.alternative),b=0,e=a.length;b<e;b++){var f=new ElaborateItem(this,b,0==b);f.loadData(a[b]);this.items.push(f)}};a.prototype.loadMedias=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a),b=0,e=a.length;b<e;b++){var f=MediaFactory.createMedia(a[b]);f.type==MediaType.sound?this.openingSound=f:f.type==MediaType.image&&this.image(f)}};a.prototype.renderAfterSelection=function(){this.image().resize();
this.selectedItem().getDomIllustration()&&this.illustrationsMaxHeight(this.selectedItem().getDomIllustration().outerHeight(!0)+"px");this.updateScrollbar()};a.prototype.render=function(){b.prototype.render.call(this);this.image().resize();this.computeTitlesMaxHeight();this.selectedItem()&&this.illustrationsMaxHeight(this.selectedItem().getDomIllustration().outerHeight(!0)+"px");return this};a.prototype.computeTitlesMaxHeight=function(){for(var a=0,b=this.items(),e=0,f=b.length;e<f;e++)b[e].image().resize(),
a=Math.max(b[e].getDomGraphicTitle().innerHeight(),a);this.titlesMaxHeight(a+"px")};a.prototype.sizeChanged=function(a,d){b.prototype.sizeChanged.call(this,a,d);this.render();return $.Deferred().resolve().promise()};a.prototype.start=function(){b.prototype.start.call(this);this.image().play();return this};a.prototype.stop=function(){for(var a=this.items(),d=a.length-1;0<=d;d--)a[d].stop();b.prototype.stop.call(this);return this};a.prototype.reset=function(){return this};a.prototype.cleanup=function(){try{b.prototype.cleanup.call(this);
this.image().cleanup();for(var a=this.items(),d=a.length-1;0<=d;d--)a[d].cleanup()}catch(e){logger.error("Elaborate.cleanup error : "+e)}return this};a.prototype.selectItem=function(a){for(var b=this.items(),e=0,f=b.length;e<f;e++)b[e].stop().isSelected(!1);this.selectedItem(a);a.start();this.renderAfterSelection()};a.prototype.checkExerciseCompleted=function(){for(var a=!0,b=this.items(),e=b.length-1;0<=e;e--)if(!1==b[e].hasBeenSelected){a=!1;break}a&&this.parent.setExerciseCompleted()};return a}(BaseContentViewModel),
ElaborateItem=function(){function b(a,c,b){var e=this;this.isSelected=ko.observable(!1);this.hasBeenSelected=this.isFirstItem=!1;this.text=ko.observable("");this.responseText=new MediaText;this.graphicTitle=ko.observable("");this.graphicTitleId=GuidHelper.newGuid();this.illustrationId=GuidHelper.newGuid();this.graphicCaption=ko.observable("");this.isHover=ko.observable(!1);this.sound=new MediaSound;this.image=ko.observable(new MediaImage);this.itemsListPosition=0;this.contentTabindex=this._contentTabindex=
this.buttonTabindex=this._buttonTabindex=null;this.getDomGraphicTitle=function(){return $("#"+e.graphicTitleId)};this.getDomIllustration=function(){return $("#"+e.illustrationId)};this.parent=a;this.itemsListPosition=c;this._buttonTabindex=ko.observable(100*(c+1));this.buttonTabindex=this.parent.generateTabIndexComputed("_buttonTabindex",this);this._contentTabindex=ko.observable(100*(c+1)+1);this.contentTabindex=this.parent.generateTabIndexComputed("_contentTabindex",this);this.isFirstItem=b}b.prototype.loadData=
function(a){a.text&&a.text["#text"]&&(this.text(a.text["#text"]),this.sound.setTranscriptTitle(this.text()),this.sound.setTranscriptDisplayedAsList(!0));a.response&&a.response.text&&this.responseText.loadData(a.response.text,this.parent.parent.exerciseId);a.response&&a.response.media&&this.loadMedias(a.response.media);a.response&&(a.response.graphictitle||a.response.graphiccaption)&&this.image().displayMediaTexts(a.response.graphictitle,a.response.graphiccaption,this.graphicTitle,this.graphicCaption,
!1,!1)};b.prototype.cleanup=function(){this.sound.cleanup();this.image().cleanup();this.hasBeenSelected=!1};b.prototype.start=function(){var a=this;this.hasBeenSelected=!0;""==this.sound.url()?this.parent.checkExerciseCompleted():this.sound.onEnded.subscribe(this,function(){a.parent.checkExerciseCompleted()});this.isSelected(!0);this.image().resize();this.parent.isActiveAndAccessibilityEnabled()?(this.sound.toggle(),this.sound.hasSource()||$("[tabindex="+this.contentTabindex()+"]",this.parent.getDom()).first().focus()):
this.sound.play();this.image().play()};b.prototype.select=function(){this.parent.selectItem(this);this.parent.isFirstImage=!1};b.prototype.loadMedias=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a),c=0,b=a.length;c<b;c++){var e=MediaFactory.createMedia(a[c]);e.type==MediaType.sound?this.sound=e:e.type==MediaType.image&&this.image(e)}};b.prototype.itemMouseOver=function(){this.isHover(!0)};b.prototype.itemMouseOut=function(){this.isHover(!1)};b.prototype.stop=function(){this.sound.stop();
return this};return b}(),EmbeddedContentViewModel=function(b){function a(a){b.call(this,a);this.title=ko.observable("");this.instruction=ko.observable("");this.layout=ko.observable("");this.richtextContent=ko.observable(new MediaText);this.providerEmbeddedContent=this.urlEmbeddedContent="";this.mobileMaskVisible=ko.observable(!1);this._tabindex=ko.observable(100);this.tabindex=this.generateTabIndexComputed("_tabindex",this);this.ariaLabel=ko.observable("");this.ariaLabelText=ko.observable("");this.isEmbeddedContentPlaying=
!1;this.getDomProgressBar=function(){return $(".progressbar")}}__extends(a,b);a.prototype.loadData=function(a){if(a.exercise){this.title(a.exercise.title);this.instruction(a.exercise.instruction);var d=this.getLayoutTemplateName(a.exercise["@layout"]);this.layoutTemplate(d);"EmbeddedContentTitleTextLayout"==d?this.layout("exercise--embeddedContent-title-text"):"EmbeddedContentFullscreenLayout"==d?this.layout("exercise--embeddedContent-fullscreen"):"EmbeddedContentWithTitleFullscreenLayout"==d?this.layout("exercise--embeddedContent-title"):
"EmbeddedContentTextLayout"==d&&this.layout("exercise--embeddedContent-text");this.loadTexts(a.exercise.text);this.loadEmbedded(a.exercise.embedded)}return b.prototype.loadData.call(this,a)};a.prototype.getLayoutTemplateName=function(a){switch(a){case "EmbeddedContentTitleLayout":return"EmbeddedContentWithTitleFullscreenLayout";default:return a}};a.prototype.render=function(){b.prototype.render.call(this);this.getDom().addClass("exercise--embeddedContent");return this};a.prototype.sizeChanged=function(a,
d){var e=this;return b.prototype.sizeChanged.call(this,a,d).then(function(){e.doSizeChanged(a,d)})};a.prototype.doSizeChanged=function(a,b){var e=this.getDomContent().outerHeight(!0)-this.getDomContent().height(),e=b-this.getDomTitleWrapper().outerHeight(!0)-this.getDomProgressBar().outerHeight(!0)-e;null!=e&&this.getDom().find(".embeddedContent").height(e);this.updateScrollbar()};a.prototype.swipeStarted=function(){this.isEmbeddedContentPlaying&&this.stopEmbeddedContent();return this};a.prototype.swipeCancelled=
function(){this.startEmbeddedContent();return this};a.prototype.start=function(){platformFeatures.getIsMobileDevice()&&this.mobileMaskVisible(!0);b.prototype.start.call(this);this.startEmbeddedContent();this.parent.setExerciseCompleted();return this};a.prototype.startThumbnail=function(){this.sizeChanged(this.parent.width,this.parent.height);this.getDom().find(".embeddedContent").attr("src",this.urlEmbeddedContent);return this};a.prototype.stop=function(){platformFeatures.getIsMobileDevice()&&this.mobileMaskVisible(!0);
this.stopEmbeddedContent();return this};a.prototype.cleanup=function(){b.prototype.cleanup.call(this);return this};a.prototype.loadTexts=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a),b=0,e=a.length;b<e;b++){var f=a[b];void 0!=f["#text"]&&"content"==f["@name"]&&(this.richtextContent().loadData(f,this.parent.exerciseId),this.ariaLabelText(this.richtextContent().transformStringForAriaLabel()))}};a.prototype.loadEmbedded=function(a){var b=this;void 0!=a&&!platformFeatures.getIsIE8()&&
(this.urlEmbeddedContent=a["@src"],this.providerEmbeddedContent=a["@provider"],this.ariaLabel(a["@provider"]),setTimeout(function(){b.getDom().find(".embeddedContainer").append("<iframe class='embeddedContent' src='' width='100%' height='100%' frameborder='0' allowfullscreen></iframe>")},0))};a.prototype.startEmbeddedContent=function(a){void 0===a&&(a=!1);if(""!=this.urlEmbeddedContent&&!platformFeatures.getIsIE8()){var b=-1!=this.urlEmbeddedContent.indexOf("?")?"&":"?",e=b+"rel=0&autoplay=1&showinfo=0&playsinline=1&wmode=transparent&endscreen-enable=0&sharing-enable=0";
this.isEmbeddedContentPlaying=!0;this.isActiveAndAccessibilityEnabled()&&!a&&(e=b+"rel=0&autoplay=0&showinfo=0&playsinline=1&wmode=transparent&endscreen-enable=0&sharing-enable=0",this.isEmbeddedContentPlaying=!1);this.getDom().find(".embeddedContent").attr("src",this.urlEmbeddedContent+e)}};a.prototype.stopEmbeddedContent=function(){""!=this.urlEmbeddedContent&&!platformFeatures.getIsIE8()&&(this.getDom().find(".embeddedContent").attr("src",""),this.isEmbeddedContentPlaying=!1)};a.prototype.clickAccessibilityEmbeddedContent=
function(){this.isActiveAndAccessibilityEnabled()&&""!=this.urlEmbeddedContent&&(this.isEmbeddedContentPlaying?this.stopEmbeddedContent():this.startEmbeddedContent(!0))};a.prototype.toggleMaskMobileVisibility=function(){this.mobileMaskVisible()?(this.mobileMaskVisible(!1),this.startEmbeddedContent()):(this.mobileMaskVisible(!0),this.stopEmbeddedContent())};return a}(BaseContentViewModel),EndingViewModel=function(b){function a(a){var d=this;b.call(this,a);this.image=ko.observable(new MediaImage);this.richText=
"";this.respectRichTextAlignment=!1;this._endingTabindexes=ko.observable(100);this.endingTabindexes=this.generateTabIndexComputed("_endingTabindexes",this);this._endingTitleTabindexes=ko.observable(10);this.endingTitleTabindexes=this.generateTabIndexComputed("_endingTitleTabindexes",this);this.skinImageUrl=null;this.hasSkinImage=ko.observable(!1);this.getDomTitleEnding=function(){return d.parent.getExerciseDom().find(".ending__title")};this.getDomSubtitleEnding=function(){return d.parent.getExerciseDom().find(".ending__subtitle")}}
__extends(a,b);a.prototype.loadData=function(a){this.title(a.exercise.title);a.exercise.text&&!StringHelper.isNullOrEmpty(a.exercise.text)&&(this.richText=(new MediaText).loadData(a.exercise.text,this.parent.exerciseId).text());this.respectRichTextAlignment=a.exercise.respectRichTextAlignment;this.loadMedias(a.exercise.media);this.layout(a.exercise["@layout"]);this.layoutTemplate("EndingStandardLayout");this.loadSkinData();return b.prototype.loadData.call(this,a)};a.prototype.loadMedias=function(a){if(void 0!=
a)for(var a=ArrayHelper.getArrayFromJson(a),b=0,e=a.length;b<e;b++){var f=MediaFactory.createMedia(a[b]);f.type==MediaType.sound?(this.openingSound=f,this.openingSound.onEnded.subscribe(this,this.onSoundEnded)):f.type==MediaType.image&&this.image(f)}};a.prototype.loadSkinData=function(){var a=SkinManager.getInstance().getTemplateSetting("ending","centeredImageUrl",!0);null!=a&&(this.skinImageUrl=a,this.hasSkinImage(!0))};a.prototype.onSoundEnded=function(){this.parent.setExerciseCompleted()};a.prototype.initDom=
function(){b.prototype.initDom.call(this);this.respectRichTextAlignment||this.getDomSubtitleEnding().css("text-align","center");return this};a.prototype.sizeChanged=function(){this.render();return $.Deferred().resolve().promise()};a.prototype.render=function(){b.prototype.render.call(this);this.image&&this.image().resize();return this};a.prototype.resetSize=function(){this.getDomSubtitleEnding().width("auto");this.getDomTitleEnding().width("auto");return $.Deferred().resolve().promise()};a.prototype.start=
function(){b.prototype.start.call(this);this.image().play();this.hasOpeningSound()||this.parent.setExerciseCompleted();this.isActiveAndAccessibilityEnabled()&&this.getDomTitleEnding().focus();return this};a.prototype.stop=function(){b.prototype.stop.call(this);return this};a.prototype.cleanup=function(){try{b.prototype.cleanup.call(this),this.image().cleanup()}catch(a){logger.error("EndingViewModel.cleanup error : "+a)}return this};return a}(BaseContentViewModel),EvaluateMediaItem=function(){function b(a,
c,b){this.id=ko.observable(GuidHelper.newGuid());this.imageId=GuidHelper.newGuid();this.index=ko.observable(0);this.isSelected=ko.observable(!1);this.correctAnswerFound=ko.observable(!1);this.anwsers=ko.observableArray([]);this.parent=null;this.responseText=new MediaText;this.graphicTitle=ko.observable("");this.graphicCaption=ko.observable("");this.sound=new MediaSound;this.image=ko.observable(new MediaImage);this.feedbackType=MediaType.image;this.feedbackImage=ko.observable(new MediaImage);this.feedbackVideo=
ko.observable(new MediaVideo);this.feedbackLabel=new MediaText;this.responseTitle=ko.observable("");this.hasFeedback=ko.observable(!1);this.showFeedbackOverlay=ko.observable(!1);this.graphicTitleId=ko.observable(GuidHelper.newGuid());this.graphicTitleElement=null;this.graphicCaptionId=ko.observable(GuidHelper.newGuid());this.graphicCaptionElement=null;this.mouseEntered=!1;this._tabindexAnswerFound=ko.observable(-1);this._tabindex=ko.observable(100);this.parent=b;this.index(a);this.totalItems=c-1;
this.answersId=GuidHelper.newGuid();this._tabindex(100*(a+1));this.tabindex=this.parent.generateTabIndexComputed("_tabindex",this);this.tabindexAnswerFound=this.parent.generateTabIndexComputed("_tabindexAnswerFound",this)}b.prototype.loadData=function(a,c){a.text&&(this.feedbackLabel.loadData(a.text,this.parent.parent.exerciseId),this.hasFeedback(!0));this.correctAnwserIndex=parseInt(a.response.correctAlternative);null!=a.response.text&&this.responseText.loadData(a.response.text,this.parent.parent.exerciseId);
this.loadMedias(a);this.buildAnwsers(c);this.image().displayMediaTexts(a.graphictitle,a.graphiccaption,this.graphicTitle,this.graphicCaption,!1,!1)};b.prototype.initDom=function(){this.dom=$("#"+this.id());this.graphicTitleDom=$("#"+this.graphicTitleId());this.graphicCaptionDom=$("#"+this.graphicCaptionId());for(var a=this.anwsers(),c=0,b=a.length;c<b;c++)a[c].initDom()};b.prototype.select=function(){if(!this.mouseEntered||platformFeatures.getIsMobileDevice()||platformFeatures.getIsPhone())null!=
this.selectItemCallback&&this.selectItemCallback(this),this.showFeedbackOverlay(!0),this.mouseEntered=!0};b.prototype.reset=function(){this.isSelected(!1);this.correctAnswerFound(!1);for(var a=this.anwsers(),c=0,b=a.length;c<b;c++)a[c].reset();this.anwsers(a)};b.prototype.handleMouseout=function(){!platformFeatures.getIsMobileDevice()&&!this.parent.isActiveAndAccessibilityEnabled()&&this.hideFeedbackOverlay()};b.prototype.hideFeedbackOverlay=function(){var a=this;this.mouseEntered=!1;this.timerHideFeedback=
setTimeout(function(){!1==a.mouseEntered&&!a.correctAnswerFound()&&a.showFeedbackOverlay(!1)},1200)};b.prototype.unselect=function(){this.isSelected(!1);this.showFeedbackOverlay(!1)};b.prototype.resetTabindex=function(){this._tabindex(-1);this._tabindexAnswerFound(-1)};b.prototype.setTabindex=function(){this._tabindex(100*(this.index()+1));this._tabindexAnswerFound(100*(this.index()+1))};b.prototype.startFeedback=function(){this.hasFeedback()&&null!=this.showFeedbackSelectedItemCallback&&((this.parent.isActiveAndAccessibilityEnabled()||
platformFeatures.getIsPhone())&&this.select(),this.parent.resetTabindex(),this.showFeedbackSelectedItemCallback())};b.prototype.sizeChanged=function(){this.image().resize()};b.prototype.cleanup=function(){try{clearTimeout(this.timerHideFeedback);this.sound.cleanup();this.image().cleanup();this.feedbackImage().cleanup();this.feedbackVideo().cleanup();this.graphicCaptionDom=this.graphicTitleDom=null;for(var a=this.anwsers(),c=0,b=a.length;c<b;c++)a[c].cleanup();this.anwsers.removeAll()}catch(e){logger.error("EvaluateMediaItem.cleanup error : "+
e)}};b.prototype.selectAnwser=function(a){if(a.isCorrect()){this.correctAnswerFound(!0);this.parent.checkExerciseFinished();this.responseTitle(a.text());this.hideFeedbackOverlay();for(var a=this.anwsers(),c=0,b=a.length;c<b;c++){a[c].isAnswerFound(!0);var e=a[c].text();this.parent.setAlertContent(localizedText.Accessibility_CorrectAnswer());a[c].ariaLabel(localizedText.Accessibility_CorrectAnswer()+"\n"+e)}this.select();this.parent.updateScrollbar();this._tabindexAnswerFound(100*(this.index()+1))}else a.shake(),
this.parent.setAlertContent(localizedText.Accessibility_WrongAnswer())};b.prototype.buildAnwsers=function(a){for(var c=0,b=a.length;c<b;c++){var e=a[c];if(0<e.text.length){var f=new EvaluateMediaAnwserViewModel;f.parent=this;f.text(e.text);f.ariaLabel(e.text);e.index==this.correctAnwserIndex&&f.isCorrect(!0);this.anwsers.push(f)}}};b.prototype.loadMedias=function(a){a.media&&this.image(MediaFactory.createMedia(a.media));var c=this.image();c.width(200);c.height(200);for(var a=ArrayHelper.getArrayFromJson(a.response.media),
c=0,b=a.length;c<b;c++){var e=MediaFactory.createMedia(a[c]);""!=e.url()&&this.hasFeedback(!0);e.type==MediaType.sound?this.sound=e:""!=e.url()&&(e.type==MediaType.image?this.feedbackImage(e):this.feedbackVideo(e),this.feedbackType=e.type)}};return b}(),EvaluateMediaAnwser=function(){function b(){}b.prototype.loadData=function(a){this.text=a["#text"];this.index=parseInt(a["@altnum"])};return b}(),EvaluateMediaAnwserViewModel=function(){function b(){this.id=ko.observable(GuidHelper.newGuid());this.text=
ko.observable("");this.ariaLabel=ko.observable("");this.isAnswerFound=ko.observable(!1);this.isCorrect=ko.observable(!1);this.isChecked=ko.observable(!1);this.shaker=this.element=null}b.prototype.getShaker=function(){this.shaker||(this.shaker=new Shaker(this.element,500,"animated"));return this.shaker};b.prototype.initDom=function(){this.element=$("#"+this.id())};b.prototype.select=function(){this.isChecked(!0);this.parent.selectAnwser(this)};b.prototype.shake=function(){this.getShaker().shake()};
b.prototype.cleanup=function(){this.element=null;this.shaker&&this.shaker.cleanup()};b.prototype.reset=function(){this.isAnswerFound(!1);this.isChecked(!1)};return b}(),EvaluateMediaViewModel=function(b){function a(a){b.call(this,a);this.exerciseIntro=ko.observable("");this.items=ko.observableArray([]);this.selectedItem=ko.observable(null);this.boxesId=GuidHelper.newGuid();this.anwsers=[];this.hasPolaroidItems=ko.observable(!1)}__extends(a,b);a.prototype.loadData=function(a){if(a.exercise){this.title(a.exercise.title);
this.question(a.exercise.question);this.instruction(a.exercise.instruction);var d=a.exercise["@layout"];platformFeatures.getIsPhone()?d="FluidBoxLayout":"EvaluateMediaLittleImagesLayout"==d&&(d="EvaluateMediaStandardLayout");this.layoutTemplate(d);this.loadAnwsers(a.exercise.alternatives);this.loadItems(a.exercise.items);this.loadMedias(a.exercise.media);this.layout("exercise--evaluatemedia--"+this.items().length+"columns")}return b.prototype.loadData.call(this,a)};a.prototype.loadItems=function(a){var b=
this;if(void 0!=a&&void 0!=a.item)for(var a=ArrayHelper.getArrayFromJson(a.item),e=0,f=a.length;e<f;e++){var g=a[e],h=new EvaluateMediaItem(e,a.length,this);h.loadData(g,this.anwsers);h.image().isPolaroid()&&(this.hasPolaroidItems(!0),h.image().polaroidTitle(g.graphictitle));h.selectItemCallback=function(a){var c=b.selectedItem();c&&c.isSelected(false);b.selectedItem(a);a.isSelected(true)};h.showFeedbackSelectedItemCallback=this.showFeedbackSelectedItem.bind(this);this.items.push(h)}};a.prototype.render=
function(){b.prototype.render.call(this);return this};a.prototype.loadAnwsers=function(a){if(void 0!=a&&void 0!=a.alternative)for(var a=ArrayHelper.getArrayFromJson(a.alternative),b=0,e=a.length;b<e;b++){var f=new EvaluateMediaAnwser;f.loadData(a[b]);this.anwsers.push(f)}};a.prototype.loadMedias=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a),b=0,e=a.length;b<e;b++){var f=MediaFactory.createMedia(a[b]);f.type==MediaType.sound&&(this.openingSound=f)}};a.prototype.initDom=function(){b.prototype.initDom.call(this);
for(var a=this.items(),d=0,e=a.length;d<e;d++)a[d].initDom();return this};a.prototype.sizeChanged=function(a,d){b.prototype.sizeChanged.call(this,a,d);for(var e=this.items(),f=0,g=e.length;f<g;f++)e[f].sizeChanged();return $.Deferred().resolve().promise()};a.prototype.start=function(){b.prototype.start.call(this);(platformFeatures.getIsMobileDevice()||this.isActiveAndAccessibilityEnabled())&&this.showAllAnswers();for(var a=this.items(),d=0,e=a.length;d<e;d++)a[d].image().play();return this};a.prototype.showAllAnswers=
function(){for(var a=$(".evaluatemedia__cell--answers",this.getDom()),b=0,e=function(a){return function(){a.removeClass("evaluatemedia__item__answers--hidden");a.addClass("evaluatemedia__item__answers--visible")}},b=0;b<a.length-1;b++){var f=$(a[b+1]);$(a[b]).cssPromise().then(e(f))}$(a[0]).removeClass("evaluatemedia__item__answers--hidden");$(a[0]).addClass("evaluatemedia__item__answers--visible")};a.prototype.stop=function(){b.prototype.stop.call(this);this.hideFeedback();this.reset();return this};
a.prototype.reset=function(){this.selectedItem(null);for(var a=this.items(),b=0,e=a.length;b<e;b++)a[b].reset();this.items(a);return this};a.prototype.loadCompleted=function(){b.prototype.loadCompleted.call(this);return this};a.prototype.cleanup=function(){try{b.prototype.cleanup.call(this);for(var a=this.items(),d=0,e=a.length;d<e;d++)a[d].cleanup();this.items.removeAll()}catch(f){logger.error("EvaluateMediaViewModel.cleanup error : "+f)}return this};a.prototype.selectItem=function(a){for(var b=
this.items(),e=0;e<b.length;e++)b[e].unselect();this.selectedItem(a);a.isSelected(!0);this.showFeedbackSelectedItem();a=!0;for(e=this.items().length-1;0<=e;e--)if(!1==this.items()[e].correctAnswerFound()){a=!1;break}a&&this.parent.setExerciseCompleted()};a.prototype.checkExerciseFinished=function(){for(var a=!0,b=this.items().length-1;0<=b;b--)if(!1==this.items()[b].correctAnswerFound()){a=!1;break}a&&this.parent.setExerciseCompleted()};a.prototype.showFeedbackSelectedItem=function(){var a=this,b=
this.selectedItem();this.openingSound.stop();this.setTimeout("show-feedback",function(){a.feedback.setFeedback(b.feedbackType==MediaType.image?b.feedbackImage():b.feedbackVideo(),b.sound,b.feedbackLabel);a.showFeedback()},platformFeatures.getFeedbackDelay())};a.prototype.setTabindex=function(){for(var a=0,b=this.items().length;a<b;a++)this.items()[a].setTabindex(),this.items()[a].isSelected()&&$("#"+this.items()[a].imageId).focus()};a.prototype.resetTabindex=function(){for(var a=0,b=this.items().length;a<
b;a++)this.items()[a].resetTabindex()};a.prototype.onFeedbackCloseClick=function(){var a=this;b.prototype.onFeedbackCloseClick.call(this);this.isActiveAndAccessibilityEnabled()&&(platformFeatures.getIsIE()&&BrowserHelper.refreshDom(),setTimeout(function(){$("#"+a.selectedItem().imageId).focus()},500));this.setTabindex()};a.prototype.getItemsFluidBoxRenderer=function(){return"EvaluateMediaItemsFluidBoxRenderer"};a.prototype.hasExerciseIntro=function(){return!StringHelper.isNullOrEmpty(this.exerciseIntro())};
return a}(BaseContentViewModel),FillInBlanksBehavior=function(){function b(){this.revealValidateButton=!0}b.prototype.getTemplate=function(){return platformFeatures.getIsIE678()?"FillInBlanksItemBlankIE8Template":"FillInBlanksItemBlankTemplate"};b.prototype.itemsEnabled=function(){return!0};b.prototype.revealIconRight=function(a){return a};b.prototype.revealIconWrong=function(a,c,b,e){return!c&&!b&&e};b.prototype.revealInput=function(a){return!a};b.prototype.revealUserResponseWrong=function(){return!1};
b.prototype.revealUserResponseRight=function(a){return a};b.prototype.revealUserResponse=function(){return!1};b.prototype.revealSolution=function(){return!1};return b}(),FillInBlanksViewModel=function(b){function a(a){b.call(this,a);this.behavior=new FillInBlanksBehavior}__extends(a,b);return a}(FillInBlanksCommon),FlashTemplateViewModel=function(b){function a(a){var d=this;b.call(this,a);this.title=ko.observable("");this.instruction=ko.observable("");this.layout=ko.observable("");this.fallbackMediaTemplateName=
ko.observable("");this.richtextContent=ko.observable(new MediaText);this.layoutId=ko.observable(GuidHelper.newGuid());this.mediaToDisplay=ko.observable(new MediaBase);this.showFallback=ko.observable(!1);this.soundHasBeenPlayed=!1;this.thumbnailMediaUrl="";this.thumbnailHeight=0;this._tabindex=ko.observable(100);this.tabindex=this.generateTabIndexComputed("_tabindex",this);this.ariaLabel=ko.observable("");this.ariaLabelText=ko.observable("");this.isFlashAnimation=ko.observable(!1);this.isHtmlAnimation=
ko.observable(!1);this.showPreviousArrow=ko.observable(!1);this.showNextArrow=ko.observable(!1);this.hasSwipeMask=ko.observable(!1);this.htmlMediaSave=null;this.getDomTextContent=function(){return d.parent.getExerciseDom().find(".flash__text-wrapper")};this.getDomMedia=function(){return d.parent.getExerciseDom().find(".flash__media")};this.getDomMenu=function(){return $("#menu")};this.getDomProgressBar=function(){return $(".progressbar")};this.getDomMaskContainer=function(){return $(".flash__mask--global-container")};
this.showFallback(!platformFeatures.isFlashEnabled())}__extends(a,b);a.prototype.loadData=function(a){if(a.exercise){this.title(a.exercise.title);this.instruction(a.exercise.instruction);var d=this.getLayoutTemplateName(a.exercise["@layout"]);this.layoutTemplate(d);"FlashMediaTitleTextLayout"==d?this.layout("exercise--flash-title-text"):"FlashMediaFullscreenLayout"==d?this.layout("exercise--flash-fullscreen"):"FlashMediaWithTitleFullscreenLayout"==d?this.layout("exercise--flash-title"):"FlashMediaTextLayout"==
d&&this.layout("exercise--flash-text");this.loadTexts(a.exercise.text);this.loadMedias(a.exercise.media)}return b.prototype.loadData.call(this,a)};a.prototype.getLayoutTemplateName=function(a){switch(a){case "FlashMediaTitleLayout":return"FlashMediaWithTitleFullscreenLayout";default:return a}};a.prototype.render=function(){b.prototype.render.call(this);this.mediaToDisplay().type==MediaType.flash&&this.mediaToDisplay().initialize();this.isFlashAnimation()?this.getDom().addClass("exercise--flash--media-flash"):
this.isHtmlAnimation()&&this.getDom().addClass("exercise--flash--media-html");return this};a.prototype.sizeChanged=function(a,d){var e=this;return b.prototype.sizeChanged.call(this,a,d).then(function(){e.doSizeChanged(a,d)})};a.prototype.doSizeChanged=function(a,b){var e=this;(platformFeatures.getIsPhone()||applicationViewModel.accessibilityViewModel.accessibilityFeaturesActivated())&&this.htmlMediaSave&&this.hasSwipeMask(!0);var f=this.mediaToDisplay();f.type==MediaType.image?(f.sizeChanged(a,b),
this.updateScrollbar()):requestAnimationFrame(function(){var f=e.getDomContent().outerHeight(!0)-e.getDomContent().height(),f=b-e.getDomTitleWrapper().outerHeight(!0)-e.getDomProgressBar().outerHeight(!0)-f;null!=e.mediaToDisplay()&&e.mediaToDisplay().sizeChanged(1,1);var h=e.getDomMedia().width();null!=f&&null!=h&&null!=e.mediaToDisplay()&&e.mediaToDisplay().sizeChanged(h,f);null!=e.htmlMediaSave&&e.htmlMediaSave.sizeChanged(a,b);e.getDomMaskContainer().height(300);e.updateScrollbar()})};a.prototype.swipeStarted=
function(){var a=this.mediaToDisplay();a.type==MediaType.video&&null!=a.videoPlayer&&a.pause();return this};a.prototype.swipeCancelled=function(){var a=this.mediaToDisplay();a.type==MediaType.video&&null!=a.videoPlayer&&!platformFeatures.getIsPhone()&&a.play();return this};a.prototype.start=function(){b.prototype.start.call(this);this.mediaToDisplay().setTabindex(this.tabindex());this.mediaToDisplay().play();this.parent.setExerciseCompleted();return this};a.prototype.startThumbnail=function(){this.isHtmlAnimation()||
this.sizeChanged(this.parent.width,this.parent.height);return this};a.prototype.stop=function(){this.openingSound.onEnded.unSubscribe(this,this.onSoundEnded);this.mediaToDisplay().type!=MediaType.image&&(this.mediaToDisplay().tabindex(this.tabindex()),this.mediaToDisplay().stop());this.showPreviousArrow(!1);this.showNextArrow(!1);return this};a.prototype.cleanup=function(){b.prototype.cleanup.call(this);this.mediaToDisplay().cleanup();return this};a.prototype.loadTexts=function(a){if(void 0!=a)for(var a=
ArrayHelper.getArrayFromJson(a),b=0,e=a.length;b<e;b++){var f=a[b];void 0!=f["#text"]&&"content"==f["@name"]&&(this.richtextContent().loadData(f,this.parent.exerciseId),this.ariaLabelText(this.richtextContent().transformStringForAriaLabel()))}};a.prototype.onSoundEnded=function(){this.soundHasBeenPlayed=audioPlayer instanceof Html5AudioPlayer?this.openingSound.hasBeenPlayed():!0};a.prototype.loadMedias=function(a){if(void 0!=a){for(var b,e,f,a=ArrayHelper.getArrayFromJson(a),g=0,h=a.length;g<h;g++){var i=
MediaFactory.createMedia(a[g]);if(i.json&&(!i.json||i.json["@name"]))switch(i.type){case MediaType.sound:if("fallbackSound"==i.json["@name"]&&this.showFallback()||"flashSound"==i.json["@name"]&&!this.showFallback())this.openingSound=i,this.openingSound.onEnded.subscribe(this,this.onSoundEnded);break;case MediaType.image:case MediaType.video:"fallbackMedia"==i.json["@name"]?null==b&&(b=i):"flashMedia"==i.json["@name"]&&(b=i,this.showFallback(!0));break;case MediaType.flash:"flashMedia"==i.json["@name"]&&
(e=i,this.thumbnailMediaUrl=e.url(),this.thumbnailHeight=e.height(),this.ariaLabel(e.metadataScreenReaderDescription),this.markAnimationType(MediaType.flash));break;case MediaType.html:"flashMedia"==i.json["@name"]&&(f=i,this.thumbnailMediaUrl=f.url(),this.ariaLabel(f.metadataScreenReaderDescription),this.markAnimationType(MediaType.html),f.setTabindex(-1))}}b&&""!=b.url()&&this.showFallback()&&(b.type==MediaType.image&&this.mediaToDisplay(b),b.type==MediaType.video&&this.mediaToDisplay(b));e&&!this.showFallback()?
this.mediaToDisplay(e):f&&(!platformFeatures.getIsPhone()&&!applicationViewModel.accessibilityViewModel.accessibilityFeaturesActivated()?this.mediaToDisplay(f):(this.htmlMediaSave=f,this.mediaToDisplay(new MediaBase)))}};a.prototype.markAnimationType=function(a){a==MediaType.html?(this.isHtmlAnimation(!0),this.isFlashAnimation(!1)):(this.isHtmlAnimation(!1),this.isFlashAnimation(!0))};a.prototype.nextButtonClick=function(){applicationViewModel.navigationManager.followNextLink()};a.prototype.previousButtonClick=
function(){applicationViewModel.navigationManager.followPreviousLink()};a.prototype.displayHTMLAnimation=function(){this.htmlMediaSave&&(this.feedback.setFeedback(this.htmlMediaSave,null,null),this.showFeedback())};a.prototype.onFeedbackCloseClick=function(){this.hideFeedback();this.updateStickyFooterHeight();applicationViewModel.accessibilityViewModel.accessibilityFeaturesActivated()&&this.getDomMaskContainer().focus()};a.flashTemplateName="FlashTemplate";return a}(BaseContentViewModel),IExploreViewModel=
function(b){function a(a){var d=this;b.call(this,a);this.image=ko.observable(new MediaImage);this.items=ko.observableArray([]);this.selectedItem=ko.observable(null);this.inlineFeedbackLayout=!1;this.displayLowImage=ko.observable(!1);this.displayHighImage=ko.observable(!1);this.imageHeight=ko.observable("");this.labelListHeight=ko.observable("");this.showLabelsInList=ko.observable(!1);this.hasLabeledItem=!1;this.hotspotsTop=ko.observable("0px");this.mustSaveAnswers=this.isHighQualityLoaded=this.isLowQualityLoaded=
this.hotspotsVisible=!1;this.getDomIexploreImagesContainer=function(){return d.parent.getExerciseDom().find(".iexplore__images")};this.getDomImage=function(){if(!d.getDomIexploreImagesContainer())return null;var a=d.getDomIexploreImagesContainer().find(".iexplore__image");return d.isHighQualityLoaded?a.last():a.first()};this.imageRatio=0;this._tabindex=ko.observable(100);this.tabindexImg=this.generateTabIndexComputed("_tabindex",this);this.checkResponses=function(){for(var a=!0,c=0,b=d.items();c<
b.length;c++){var h=b[c];if(!h.hasBeenClicked()||h.state()==IExploreItemState.SelectedLast){a=!1;break}}return a};this.retrieveAnswers=function(){for(var a={type:"choice",correct:"",given:"",weighting:"0"},c=[],b=0,h=d.items().length;b<h;b++){var i=d.items()[b];i.hasBeenClicked()&&(i=i.state(),c.push(b.toString()+interactionLearnerResponseSeparator+i))}a.given=ScormHelper.arrayToString(c);return a};this.resumeAnswers=function(a){if(null!=a&&(a=ScormHelper.stringToArray(a),null!=a&&0<a.length&&""!=
a[0]))for(var c=0;c<a.length;c++)if(null!=a[c]){var b=a[c].split(interactionLearnerResponseSeparator);if(2==b.length){var h=+b[0],b=IExploreItemState[IExploreItemState[b[1]]];null!=d.items()[h]&&d.items()[h].state(b)}}};this.resetAllUserAnswers=function(){for(var a=0,c=d.items();a<c.length;a++)c[a].state(IExploreItemState.NotSelected)};if(this.mustSaveAnswers=applicationViewModel.navigationManager.existsAlternativeDestinationFrom(a.exerciseId))this.interactionApi=new InteractionApi,a.initInteractionApi(this.interactionApi),
this.assessmentManager=new AssessmentManager(a.exerciseId,this.interactionApi,this.isActiveAndAccessibilityEnabled,!0);this.selectedItem(new IExploreItemBase(this,0))}__extends(a,b);a.prototype.cleanup=function(){b.prototype.cleanup.call(this);this.feedback.cleanup();this.selectedItem()&&this.setSelectedItem(null);for(var a=this.items(),d=0,e=a.length;d<e;d++)a[d].cleanup();this.items.removeAll();return this};a.prototype.loadData=function(a){this.title(a.exercise.title);this.instruction(a.exercise.instruction);
var d=a.exercise["@layout"];"IexploreWithoutTitleLayout"==d&&(d="IExploreFullscreenLayout");"IexploreWithTitleLayout"==d&&(d="IExploreWithTitleFullscreenLayout");var e;switch(d){case "IExploreInlineFeedbackFullscreenLayout":this.inlineFeedbackLayout=!0;case "IExploreFullscreenLayout":d="iexplore--fullscreen";e="IExploreWithoutTitleFullscreenLayout";break;case "IExploreWithTitleInlineFeedbackFullscreenLayout":this.inlineFeedbackLayout=!0;case "IExploreWithTitleFullscreenLayout":d="iexplore--fullscreen";
e="IExploreWithTitleFullscreenLayout";break;default:d="iexplore--fullscreen",e="IExploreWithTitleFullscreenLayout"}this.layout(d);this.layoutTemplate(e);this.loadMedias(a.exercise.media);this.loadItems(a.exercise.alternatives);this.mustSaveAnswers&&(this.assessmentManager.initialize(null,this.checkResponses,this.parent.setExerciseCompleted,this.retrieveAnswers,this.resumeAnswers,this.resetAllUserAnswers),this.assessmentManager.resumeLearnerResponses());return b.prototype.loadData.call(this,a)};a.prototype.loadMedias=
function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a),b=0,e=a.length;b<e;b++){var f=MediaFactory.createMedia(a[b],!0);f.type==MediaType.sound?this.openingSound=f:f.type==MediaType.image&&(f.addCssClass("background"),this.image(f))}};a.prototype.loadItems=function(a){if(void 0!=a){var b;this.hotspotsVisible="visible"==a["@displaytype"]?!0:!1;a=ArrayHelper.getArrayFromJson(a.alternative);b=[];for(var e=0,f=a.length;e<f;e++){a[e].label&&(this.hasLabeledItem=!0);var g;g=new IExploreItemBase(this,
e);g.loadData(a[e]);g.visible(this.hotspotsVisible);b.push(g)}this.items(b)}};a.prototype.initDom=function(){b.prototype.initDom.call(this);for(var a=this.items(),d=0,e=a.length;d<e;d++)a[d].initDom();return this};a.prototype.lowImageLoaded=function(){this.isHighQualityLoaded||(this.isLowQualityLoaded=!0,this.displayLowImage(!0),this.requestRendering())};a.prototype.highImageLoaded=function(){this.isHighQualityLoaded=!0;this.displayHighImage(!0);this.requestRendering();this.displayLowImage(!1)};a.prototype.requestRendering=
function(){this.sizeChanged(this.parent.width,this.parent.height)};a.prototype.sizeChanged=function(a,d){var e=this;b.prototype.sizeChanged.call(this,a,d);platformFeatures.getIsPhone()&&uiManager.getIsPhonePortrait()&&this.hasLabeledItem?this.showLabelsInList(!0):this.showLabelsInList(!1);var f=$.Deferred();this.getDomImage().css({display:"none"});var g=this.getDomTitleWrapper()?this.getDomTitleWrapper().outerHeight(!0):0,h;h=this.showLabelsInList()?0.7*(d-g):d-g;this.getDomIexploreImagesContainer().css({width:a,
height:h});this.imageHeight("");h=a/h;this.imageRatio=this.getDomImage().outerWidth(!0)/this.getDomImage().outerHeight(!1);h>this.imageRatio?this.getDomImage().css({height:"100%",width:"auto"}):this.getDomImage().css({height:"auto",width:"100%"});this.getDomImage().css({display:""});this.image().resize();this.requestAnimationFrame("iexplore_renderHotspots",function(){var a=e.getDomImage().outerHeight();e.renderHotspots(e.getDomIexploreImagesContainer().width(),a);e.labelListHeight(d-g-a-applicationViewModel.timelineViewModel.buttonMenu.outerHeight(!0)+
"px");f.resolve()});this.updateScrollbar();return f.promise()};a.prototype.renderHotspots=function(a){var b,e,f,a=a||this.parent.width;b=this.getDomImage().outerWidth(!0);e=this.getDomImage().outerHeight(!0);a=(a-b)/2;f=this.items();for(var g=0,h=f.length;g<h;g++){var i=f[g];i.sizeChanged(b,e,a);i.hasVisualMedia()&&i.visualMedia.type==MediaType.image&&i.visualMedia.resize()}};a.prototype.start=function(){b.prototype.start.call(this);for(var a=0,d=this.items();a<d.length;a++)d[a].initialize();this.checkExerciceCompleted();
return this};a.prototype.stop=function(){var a=this.items();this.feedback&&this.feedback.stop();for(var d=0,e=a.length;d<e;d++)a[d].stop();b.prototype.stop.call(this);return this};a.prototype.reset=function(){for(var a=this.items(),b=0,e=a.length;b<e;b++)a[b].stop(),a[b].visible(!1);this.hideFeedback();return this};a.prototype.loadCompleted=function(){b.prototype.loadCompleted.call(this);this.image().resize();return this};a.prototype.setSelectedItem=function(a){var b=this;this.hasOpeningSound()&&
this.openingSound.stop();this.feedback&&this.feedback.stop();var e=this.selectedItem();e!=a&&(e&&e.stop(),this.selectedItem(a),a&&(this.displaysInline(a)||setTimeout(function(){b.feedback.setFeedback(a.visualMedia,a.sound,a.feedbackText);b.feedback.sizeChanged(b.parent.width,b.parent.height);b.image().resize();b.showFeedback();a.videoPlay()},0)))};a.prototype.displaysInline=function(a){var b=this.inlineFeedbackLayout;if(platformFeatures.getIsPhone()&&a.hasVisualMedia()||a.isBranching)b=!1;return b};
a.prototype.onFeedbackCloseClick=function(){b.prototype.onFeedbackCloseClick.call(this);var a=this.selectedItem();if(a&&a.visualMedia&&a.visualMedia.type==MediaType.video){var d=a.visualMedia;d.stop();d.isVisible(!1)}this.tabindexTitleComponent(BaseContentViewModel.TITLE_COMPONENT_TABINDEX_ORDER_VALUE);this.setTabindex();a&&$("#"+a.hotspotId).focus();this.isActiveAndAccessibilityEnabled()&&platformFeatures.getIsIE()&&BrowserHelper.refreshDom();this.mustSaveAnswers&&(a.showValidationIcon(this.hotspotsVisible),
a.animateValidationIcon(this.hotspotsVisible),a.state(IExploreItemState.Selected),this.assessmentManager.submitProcess());this.selectedItem(null);this.checkExerciceCompleted()};a.prototype.checkExerciceCompleted=function(){if(this.parent){var a=!0,b=this.items();if(null==this.selectedItem()&&0<b.length){for(var e=b.length-1;0<=e;e--)if(b[e].isClickable()&&!1==b[e].hasBeenClicked()){a=!1;break}a&&this.parent.setExerciseCompleted()}}};a.prototype.setTabindex=function(){this._tabindex(100);for(var a=
this.items(),b=a.length-1;0<=b;b--)a[b].setTabindex()};a.prototype.resetTabindex=function(){this._tabindex(-1);for(var a=this.items(),b=a.length-1;0<=b;b--)a[b].resetTabindex()};return a}(BaseContentViewModel),IExploreItemBase=function(){function b(a,b){var d=this;this.scrollHeight=ko.observable(0);this.mustScroll=!1;this.isStarted=ko.observable(0);this.sizeLoaded=ko.observable(!1);this.id=GuidHelper.newGuid();this.inlineFeedbackId=GuidHelper.newGuid();this.captionId=GuidHelper.newGuid();this.hotspotId=
GuidHelper.newGuid();this.visible=ko.observable(!1);this.originalHeight=this.originalWidth=this.originalY=this.originalX=0;this.isRectangleHotspot=ko.observable(!1);this.width=ko.observable(0);this.height=ko.observable(0);this.x=ko.observable(0);this.y=ko.observable(0);this.labelNumberTop=ko.observable(0);this.labelNumberLeft=ko.observable(0);this.branchingDestinationType=null;this.isBranching=!1;this.textLabel=ko.observable("");this.hotspotLabel=localizedText.Accessibility_IexploreZone();this.positionLabel=
ko.observable("southwest");this.marginInlineFeedback=10;this.sound=null;this.feedbackText=new MediaText;this.visualMedia=new MediaBase;this.isClickable=ko.observable(!1);this.inlineFeedbackIsVisible=ko.observable(!1);this.inlineFeedbackIsInLeft=ko.observable(!1);this.inlineFeedback=null;this.state=ko.observable(IExploreItemState.NotSelected);this.hasBeenClicked=ko.computed(function(){return d.state()!=IExploreItemState.NotSelected});this.getDomInlineFeedback=function(){return null==d.inlineFeedback?
null:$("#"+d.inlineFeedback.inlineFeedbackId)};this.getDomHotspots=function(){return null==d.parent?null:d.parent.getDomIexploreImagesContainer()};this.getDomTriangle=function(){return null==d.getDomInlineFeedback()?null:d.getDomInlineFeedback().find(".feedback__inline__triangle")};this.getDomHotspot=function(){return $("#"+d.hotspotId)};this.getDomCaption=function(){return $("#"+d.captionId)};this.getDomLabelNumber=function(){return $(".iexplore__label-number",d.getDomHotspot())};this._tabindexItem=
ko.observable(100);this.isNorth=ko.computed(function(){return"north"==d.positionLabel()});this.isSouth=ko.computed(function(){return"south"==d.positionLabel()});this.isEast=ko.computed(function(){return"east"==d.positionLabel()});this.isWest=ko.computed(function(){return"west"==d.positionLabel()});this.isNorthEast=ko.computed(function(){return"northeast"==d.positionLabel()});this.isNorthWest=ko.computed(function(){return"northwest"==d.positionLabel()});this.isSouthEast=ko.computed(function(){return"southeast"==
d.positionLabel()});this.isSouthWest=ko.computed(function(){return"southwest"==d.positionLabel()});this.isCenter=ko.computed(function(){return"center"==d.positionLabel()});this.animateValidationIcon=ko.observable(!1);this.showValidationIcon=ko.observable(!1);this.fallback=null!=uiManager.screenshotMode||platformFeatures.getIsIE8();this.parent=a;this.positionInItemsList=b+1;this.setTabindex()}b.prototype.initialize=function(){this.isStarted(1);this.state()==IExploreItemState.SelectedLast?(this.showValidationIcon(this.parent.hotspotsVisible&&
this.parent.mustSaveAnswers),this.animateValidationIcon(this.parent.hotspotsVisible&&this.parent.mustSaveAnswers),this.state(IExploreItemState.Selected),this.parent.mustSaveAnswers&&this.parent.assessmentManager.submitProcess()):this.state()==IExploreItemState.Selected&&this.showValidationIcon(this.parent.hotspotsVisible&&this.parent.mustSaveAnswers)};b.prototype.setTabindex=function(){this._tabindexItem(100*(this.positionInItemsList+1));this.tabindexItem=this.parent.generateTabIndexComputed("_tabindexItem",
this)};b.prototype.resetTabindex=function(){this._tabindexItem(-1)};b.prototype.cleanup=function(){this.stop();this.visualMedia&&this.visualMedia.cleanup();this.sound&&this.sound.cleanup();this.visible(!1)};b.prototype.getOriginalX=function(){return this.originalX};b.prototype.getOriginalY=function(){return this.originalY};b.prototype.getOriginalWidth=function(){return this.originalWidth};b.prototype.getOriginalHeight=function(){return this.originalHeight};b.prototype.loadData=function(a){var b=this;
null!=a["@radiusWidth"]?(this.originalWidth=parseFloat(a["@radiusWidth"]),this.originalHeight=parseFloat(a["@radiusHeight"]),this.isRectangleHotspot("true"==a["@isRectangle"]),this.isTwoDimensions=!0):(this.originalWidth=parseFloat(a["@radius"]),this.originalHeight=parseFloat(a["@radius"]),this.isRectangleHotspot(!1),this.isTwoDimensions=!1);this.originalX=parseFloat(a["@xpos"]);this.originalY=parseFloat(a["@ypos"]);this.altNum=+a["@altnum"];0.5<this.originalX&&this.inlineFeedbackIsInLeft(!0);a.label&&
(this.textLabel(a.label),this.hotspotLabel+=", "+this.textLabel());a["@positionCaption"]&&this.positionLabel(a["@positionCaption"]);a.response&&a.response["@destinationId"]?(this.branchingDestinationId=+a.response["@destinationId"],this.branchingDestinationType=EnumBranchingDestinationTypeHelper.parseEnumBranchingDestinationType(a.response["@destinationType"]),this.isClickable(!0),this.isBranching=!0):(a.response&&a.response.text&&this.feedbackText.loadData(a.response.text,this.parent.parent.exerciseId),
a.response&&this.loadMedias(a.response.media),this.parent.displaysInline(this)?(this.inlineFeedback=new FeedbackInlineViewModel(this.parent.updateScrollbar.bind(this.parent),this.inlineFeedbackIsInLeft()),this.inlineFeedback.setTitle(this.textLabel()),this.inlineFeedback.setContentText(this.feedbackText.text()),this.inlineFeedback.setContentTextAriaLabel(this.feedbackText.transformStringForAriaLabel()),this.sound&&this.inlineFeedback.setSound(this.sound),this.hasVisualMedia()&&this.inlineFeedback.setMedia(this.visualMedia),
this.inlineFeedback.setTabindex(100*(this.positionInItemsList+1),this.parent),this.isClickable(this.inlineFeedback.hasFeedbackMedia()||this.inlineFeedback.hasFeedbackContent()||this.inlineFeedback.hasFeedbackSound()),this.inlineFeedback.setCallbackOnHideFeedbackAfterUpdateScrollbar(function(){if(b.parent!=null){b.parent.selectedItem()&&$("#"+b.parent.selectedItem().hotspotId).focus();b===b.parent.selectedItem()&&b.parent.setSelectedItem(null);b.parent.checkExerciceCompleted();if(b.parent.mustSaveAnswers){b.showValidationIcon(b.parent.hotspotsVisible);
b.animateValidationIcon(b.parent.hotspotsVisible);b.state(IExploreItemState.Selected);b.parent.assessmentManager.submitProcess()}}})):this.isClickable(!StringHelper.isNullOrEmpty(this.visualMedia.url())||null!=this.sound||0!=StringHelper.getHtmlTextLength(this.feedbackText.text())))};b.prototype.loadMedias=function(a){if(void 0!=a){for(var a=ArrayHelper.getArrayFromJson(a),b=a.length,d=0;d<b;d++){var e=MediaFactory.createMedia(a[d],!0);e.type==MediaType.sound?""!=e.url()&&(this.sound=e):this.visualMedia=
e}e.type==MediaType.video&&e.isVisible(!1)}};b.prototype.initDom=function(){null!=this.parent&&this.inlineFeedback&&this.inlineFeedback.initDom(this.getDomHotspot,this.parent.getDomOverview,this.parent.getDom)};b.prototype.sizeChanged=function(a,b,d){var e=this;if(a&&b&&(this.x(Math.floor(d+a*this.getOriginalX())),this.y(Math.floor(b*this.getOriginalY())),this.isTwoDimensions?this.width(Math.floor(a*this.getOriginalWidth())):this.width(Math.floor(b*this.getOriginalHeight())),this.height(Math.floor(b*
this.getOriginalHeight())),platformFeatures.getIsPhone()&&this.width()<this.getDomLabelNumber().outerWidth()&&this.width(this.getDomLabelNumber().outerWidth()),this.getDomHotspots()&&(platformFeatures.getIsIE8()&&this.parent.requestAnimationFrame("iexploreItem_sizechanged"+this.captionId,function(){var a=e.getDomCaption().parent(),b=a.outerHeight(),b=e.height()/2-b/2;("center"==e.positionLabel()||"east"==e.positionLabel()||"west"==e.positionLabel())&&a.css({top:b+"px"})}),this.inlineFeedback&&this.inlineFeedback.inlineFeedbackIsVisible()&&
this.calculateInlineFeedbackPosition(),this.parent.showLabelsInList())))if("center"==this.positionLabel())this.labelNumberLeft(this.width()/2-this.getDomLabelNumber().outerWidth()/2),this.labelNumberTop(this.height()/2-this.getDomLabelNumber().outerHeight()/2);else{a=0;"east"==this.positionLabel()&&(a=0);"southeast"==this.positionLabel()&&(a=1);"south"==this.positionLabel()&&(a=2);"southwest"==this.positionLabel()&&(a=3);"west"==this.positionLabel()&&(a=4);"northwest"==this.positionLabel()&&(a=5);
"north"==this.positionLabel()&&(a=6);"northeast"==this.positionLabel()&&(a=7);for(var b=this.width()/2,d=0,f=2*Math.PI/8,g=0,h=0,i=0;8>i;i++)g=Math.round(this.width()/2+b*Math.cos(d)-this.getDomLabelNumber().outerWidth()/2),h=Math.round(this.height()/2+b*Math.sin(d)-this.getDomLabelNumber().outerHeight()/2),i==a&&(this.labelNumberLeft(g),this.labelNumberTop(h)),d+=f}};b.prototype.calculateInlineFeedbackPosition=function(){var a=this;if(platformFeatures.getIsIE8()){var b=this.parent.getDomViewport().width()/
3;this.getDomInlineFeedback().css("width",b)}else{var b=this.parent.getDomViewport().width()/(platformFeatures.getIsDesktopMode()?4:3),d=this.parent.getDomViewport().width()/2-this.width()/2;platformFeatures.getIsPhone()&&(d=this.inlineFeedback.inlineFeedbackIsInLeft?this.x():this.parent.getDomViewport().width()-this.x()-this.width());var e=b;this.getDomInlineFeedback().css("width",e)}requestAnimationFrame(function(){(new TextStretcher(function(){})).nodeMustBeStretched(a.getDomInlineFeedback(),3)&&
(e=d);a.getDomInlineFeedback().css("width",e);a.inlineFeedback.updatePosition();a.inlineFeedbackIsVisible()||(a.inlineFeedbackIsVisible(!0),a.inlineFeedback.showFeedback())})};b.prototype.onClick=function(){this.state()==IExploreItemState.NotSelected&&(this.state(IExploreItemState.SelectedLast),this.parent.mustSaveAnswers&&this.parent.assessmentManager.submitProcess());if(null!=this.branchingDestinationType)return this.branchingDestinationType==EnumBranchingDestinationType.None?(this.state()!=IExploreItemState.Selected&&
(this.showValidationIcon(this.parent.mustSaveAnswers),this.animateValidationIcon(this.parent.mustSaveAnswers)),this.state(IExploreItemState.Selected),this.parent.assessmentManager.submitProcess(),this.parent.checkExerciceCompleted()):applicationViewModel.navigationManager.followAlternativeLink(this.parent.parent.exerciseId,this.altNum),!0;this.isClickable()&&!this.parent.displaysInline(this)&&(this.parent.resetTabindex(),this.parent.tabindexTitleComponent(BaseContentViewModel.DISABLED_TABINDEX_ORDER_VALUE));
this.isClickable()&&(this.parent.setSelectedItem(this),this.inlineFeedback&&!this.inlineFeedbackIsVisible()?this.calculateInlineFeedbackPosition():this.stop());return!0};b.prototype.stop=function(){null!=this.sound&&this.sound.stop();this.inlineFeedbackIsVisible()&&(this.inlineFeedbackIsVisible(!1),this.visualMedia.stop(),this.inlineFeedback&&this.inlineFeedback.hideInlineFeedback())};b.prototype.videoPlay=function(){var a=this.visualMedia;a&&a.type==MediaType.video&&(a.isVisible(!0),a.play())};b.prototype.hasVisualMedia=
function(){return this.visualMedia&&this.visualMedia.hasUrlData()};return b}(),IExploreItemState;(function(b){b[b.NotSelected=0]="NotSelected";b[b.SelectedLast=1]="SelectedLast";b[b.Selected=2]="Selected"})(IExploreItemState||(IExploreItemState={}));
var ImageViewModel=function(b){function a(a){var d=this;b.call(this,a);this.image=ko.observable(new MediaImage);this.displayLowImage=ko.observable(!1);this.displayHighImage=ko.observable(!1);this.imageHeight=ko.observable("");this.isHighQualityLoaded=this.isLowQualityLoaded=this.soundEnded=!1;this.getDomTemplateImagesContainer=function(){return d.parent.getExerciseDom().find(".image__images")};this.getDomImage=function(){if(!d.getDomTemplateImagesContainer())return null;var a=d.getDomTemplateImagesContainer().find(".image__image");
return d.isHighQualityLoaded?a.last():a.first()};this.imageRatio=0;this._tabindex=ko.observable(100);this.tabindexImg=this.generateTabIndexComputed("_tabindex",this)}__extends(a,b);a.prototype.cleanup=function(){b.prototype.cleanup.call(this);return this};a.prototype.loadData=function(a){this.title(a.exercise.title);var d;switch(a.exercise["@layout"]){case "ImageFullscreenLayout":d="ImageWithoutTitleFullscreenLayout";break;default:d="ImageWithTitleFullscreenLayout"}this.layoutTemplate(d);this.loadMedias(a.exercise.media);
return b.prototype.loadData.call(this,a)};a.prototype.loadMedias=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a),b=0,e=a.length;b<e;b++){var f=MediaFactory.createMedia(a[b],!0);f.type==MediaType.sound?(this.openingSound=f,this.openingSound.onEnded.subscribe(this,this.onSoundEnded)):f.type==MediaType.image&&(f.addCssClass("background"),this.image(f))}};a.prototype.onSoundEnded=function(){this.soundEnded=!0;this.checkExerciceCompleted()};a.prototype.initDom=function(){b.prototype.initDom.call(this);
return this};a.prototype.lowImageLoaded=function(){this.isHighQualityLoaded||(this.isLowQualityLoaded=!0,this.displayLowImage(!0),this.requestRendering())};a.prototype.highImageLoaded=function(){this.isHighQualityLoaded=!0;this.displayHighImage(!0);this.displayLowImage(!1);this.requestRendering()};a.prototype.requestRendering=function(){this.sizeChanged(this.parent.width,this.parent.height)};a.prototype.sizeChanged=function(a,d){b.prototype.sizeChanged.call(this,a,d);var e=$.Deferred();this.getDomImage().css({display:"none"});
var f=this.getDomTitleWrapper()?this.getDomTitleWrapper().outerHeight(!0):0,g=this.parent.hasCallToAction()?this.getExerciseDom().find("#"+this.parent.callToActionId).height()+document.getElementById("menu").offsetHeight+5:0,f=d-f-g;this.getDomTemplateImagesContainer().css({width:this.getDomContent().width(),height:f});this.imageHeight("");f=a/f;this.imageRatio=this.getDomImage().outerWidth(!0)/this.getDomImage().outerHeight(!1);f>this.imageRatio?this.getDomImage().css({height:"100%",width:"auto"}):
this.getDomImage().css({height:"auto",width:"100%"});this.getDomImage().css({display:""});this.image().resize();this.updateScrollbar();return e.promise()};a.prototype.start=function(){b.prototype.start.call(this);this.isActiveAndAccessibilityEnabled()&&null!=this.image()&&this.image().setTabindex(100);this.checkExerciceCompleted();return this};a.prototype.stop=function(){b.prototype.stop.call(this);this.image()&&this.image().resetTabindex();return this};a.prototype.reset=function(){this.resetTabindex();
this.soundEnded=!1;return this};a.prototype.loadCompleted=function(){b.prototype.loadCompleted.call(this);this.image().resize();return this};a.prototype.checkExerciceCompleted=function(){this.parent&&(!this.hasOpeningSound()||this.hasOpeningSound()&&!0==this.soundEnded)&&this.parent.setExerciseCompleted()};a.prototype.setTabindex=function(){this._tabindex(100)};a.prototype.resetTabindex=function(){this._tabindex(-1)};return a}(BaseContentViewModel),InfoLayoutPosition;
(function(b){b[b.left=0]="left";b[b.right=1]="right";b[b.top=2]="top";b[b.bottom=3]="bottom"})(InfoLayoutPosition||(InfoLayoutPosition={}));var InfoLayoutSize;(function(b){b[b.small=0]="small";b[b.medium=1]="medium";b[b.large=2]="large"})(InfoLayoutSize||(InfoLayoutSize={}));
var InfoViewModel=function(b){function a(a){var d=this;b.call(this,a);this.contentMedia=ko.observable(null);this.ariaLabelContentMedia="";this.introductionMedia=ko.observable(null);this.ariaLabelIntroductionMedia="";this.conclusionMedia=ko.observable(null);this.ariaLabelConclusionMedia="";this.graphicTitle=ko.observable("");this.graphicCaption=ko.observable("");this.media=ko.observable(new MediaBase);this.animateVisualElements=ko.observable(!1);this.graphicVisible=ko.observable(!1);this.contentVisible=
ko.observable(!1);this.conclusionVisible=ko.observable(!1);this.colContentId=GuidHelper.newGuid();this.displayConclusionDuration=this.displayContentDuration=this.displayGraphicDuration=1E3;this.conclusionDisplayTimerLabel="conclusionTimer";this.contentDisplayTimerLabel="contentTimer";this.graphicDisplayTimerLabel="graphicTimer";this.soundEnded=this.videoEnded=this.animationEnded=!1;this._infoTabindex=ko.observable(100);this.infoTabindex=this.generateTabIndexComputed("_infoTabindex",this);this.displayGraphic=
function(){d.graphicVisible(!0)};this.displayContent=function(){d.contentVisible(!0)};this.displayConclusion=function(){d.conclusionVisible(!0)}}__extends(a,b);a.prototype.render=function(){this.applyLargeSizeLayout();b.prototype.render.call(this);this.getDom().addClass("info-layout-position-"+this.infoLayoutPosition+" info--"+this.infoLayoutSize);return this};a.prototype.loadData=function(c){c.exercise&&(this.title(c.exercise.title),this.layout(this.getBackwardCompatibleLayoutName(c.exercise["@layout"])),
this.infoLayoutPosition=InfoLayoutPosition[a.layoutPosition[this.layout()]],this.infoLayoutSize=InfoLayoutSize[a.layoutSize[this.layout()]],platformFeatures.getIsPhone()&&"medium"==this.infoLayoutSize&&(this.infoLayoutSize="large"),this.loadViewFromLayout(),"true"==c.exercise.animateVisualElements&&this.animateVisualElements(!0),uiManager&&uiManager.screenshotMode&&this.animateVisualElements(!1),this.loadTexts(c.exercise.text),this.loadMedias(c.exercise.media),this.setBalloonPositionForLayout(),this.reset(),
this.buildAnimationDurations(),this.getMedia().displayMediaTexts(c.exercise.graphictitle,c.exercise.graphiccaption,this.graphicTitle,this.graphicCaption,!1,!1));return b.prototype.loadData.call(this,c)};a.prototype.getBackwardCompatibleLayoutName=function(b){var d="";switch(b){case "InfoTextWithImageOnRightLayout":d=a.layouts.rightSmall;break;case "InfoTextWithBiggerImageOnRightLayout":d=a.layouts.rightLarge;break;case "InfoTextWithImageOnLeftLayout":d=a.layouts.leftSmall;break;case "InfoTextWithBiggerImageOnLeftLayout":d=
a.layouts.leftLarge;break;case "InfoTextWithImageOnTopLayout":d=a.layouts.topSmall;break;case "InfoTextWithBiggerImageOnTopLayout":d=a.layouts.topMedium;break;case "InfoTextWithLargeImageOnTopLayout":d=a.layouts.topLarge;break;case "InfoTextWithImageOnBottomLayout":d=a.layouts.bottomSmall;break;case "InfoTextWithBiggerImageOnBottomLayout":d=a.layouts.bottomMedium;break;case "InfoTextWithLargeImageOnBottomLayout":d=a.layouts.bottomLarge;break;default:d=b}return d};a.prototype.loadViewFromLayout=function(){var a;
this.infoLayoutPosition==InfoLayoutPosition[InfoLayoutPosition.bottom]?a="InfoTextWithImageOnBottomLayout":this.infoLayoutPosition==InfoLayoutPosition[InfoLayoutPosition.top]||platformFeatures.getIsPhone()&&this.infoLayoutPosition==InfoLayoutPosition[InfoLayoutPosition.left]||platformFeatures.getIsPhone()&&this.infoLayoutPosition==InfoLayoutPosition[InfoLayoutPosition.right]?a="InfoTextWithImageOnTopLayout":this.infoLayoutPosition==InfoLayoutPosition[InfoLayoutPosition.right]&&!platformFeatures.getIsPhone()?
a="InfoTextWithImageOnRightLayout":this.infoLayoutPosition==InfoLayoutPosition[InfoLayoutPosition.left]&&!platformFeatures.getIsPhone()&&(a="InfoTextWithImageOnLeftLayout");this.layoutTemplate(a)};a.prototype.initDom=function(){b.prototype.initDom.call(this);this.media().type==MediaType.video&&(this.media().initializePlayerSize(),this.media().loadUrl());return this};a.prototype.sizeChanged=function(a,d){b.prototype.sizeChanged.call(this,a,d);var e=this.media();e.type==MediaType.image?e.resize():e.sizeChanged(null,
null);return $.Deferred().resolve().promise()};a.prototype.swipeStarted=function(){var a=this.media();a.type==MediaType.video&&a.pause();return this};a.prototype.swipeCancelled=function(){var a=this.media();a.type==MediaType.video&&!platformFeatures.getIsPhone()&&a.play();return this};a.prototype.start=function(){var a=this;b.prototype.start.call(this);this.animateVisualElements()&&this.startAnimation();this.hasVideo()?(this.getVideo().play(),this.hasOpeningSound()&&(platformFeatures.getIsIE8()?this.getVideo().onCanPlay.subscribe(this,
function(){a.getVideo().pause()}):this.getVideo().pause())):this.hasImage()&&this.getImage().play();this.isActiveAndAccessibilityEnabled()&&(null!=this.getVideo()&&this.getVideo().pause(),this.media().setTabindex(100));this.checkExerciseCompleted();return this};a.prototype.stop=function(){b.prototype.stop.call(this);this.hasVideo()&&this.getVideo().stop();this.animateVisualElements()&&(this.contentVisible(!1),this.conclusionVisible(!1),this.graphicVisible(!1),this.clearTimeout(this.contentDisplayTimerLabel),
this.clearTimeout(this.conclusionDisplayTimerLabel),this.clearTimeout(this.graphicDisplayTimerLabel));this.media()&&this.media().resetTabindex();return this};a.prototype.reset=function(){var a=!this.animateVisualElements();this.soundEnded=this.videoEnded=this.animationEnded=!1;this.contentVisible(a);this.conclusionVisible(a);this.graphicVisible(a);return this};a.prototype.cleanup=function(){b.prototype.cleanup.call(this);clearTimeout(this.timeoutCheckExerciseCompleted);var a=this.getMedia();a&&a.cleanup();
(a=this.conclusionMedia())&&a.cleanup();(a=this.contentMedia())&&a.cleanup();return this};a.prototype.getMedia=function(){return this.media()};a.prototype.getVideo=function(){return this.getMedia().type==MediaType.video?this.media():null};a.prototype.getImage=function(){return this.getMedia().type==MediaType.image?this.media():null};a.prototype.loadTexts=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a),b=0,e=a.length;b<e;b++){var f=a[b];void 0!=f["#text"]&&("content"==f["@name"]?
(this.contentMedia(new MediaText),this.contentMedia().loadData(f,this.parent.exerciseId),this.contentMedia().addCssClass("block"),this.ariaLabelContentMedia=this.contentMedia().transformStringForAriaLabel()):"introduction"==f["@name"]?(this.introductionMedia(new MediaText),this.introductionMedia().loadData(f,this.parent.exerciseId),this.ariaLabelIntroductionMedia=this.introductionMedia().transformStringForAriaLabel()):"conclusion"==f["@name"]&&(this.conclusionMedia(new MediaText),this.conclusionMedia().loadData(f,
this.parent.exerciseId),this.conclusionMedia().addCssClass("block"),this.ariaLabelConclusionMedia=this.conclusionMedia().transformStringForAriaLabel()))}};a.prototype.setBalloonPositionForLayout=function(){if(this.contentMedia()&&this.contentMedia().effect==TextEffect.balloon)switch(this.layout()){case a.layouts.leftSmall:case a.layouts.leftLarge:platformFeatures.getIsPhone()?this.contentMedia().setBalloonPosition(TextBalloonPosition.bottom):this.contentMedia().setBalloonPosition(TextBalloonPosition.right);
break;case a.layouts.rightSmall:case a.layouts.rightLarge:platformFeatures.getIsPhone()?this.contentMedia().setBalloonPosition(TextBalloonPosition.bottom):this.contentMedia().setBalloonPosition(TextBalloonPosition.left);break;case a.layouts.topSmall:case a.layouts.topMedium:case a.layouts.topLarge:this.contentMedia().setBalloonPosition(TextBalloonPosition.bottom);break;case a.layouts.bottomSmall:case a.layouts.bottomMedium:case a.layouts.bottomLarge:this.contentMedia().setBalloonPosition(TextBalloonPosition.top)}};
a.prototype.hasContent=function(){return this.contentMedia()&&""!=this.contentMedia().text()?!0:!1};a.prototype.hasConclusion=function(){return this.conclusionMedia()&&""!=this.conclusionMedia().text()?!0:!1};a.prototype.hasText=function(){return this.hasContent()||this.hasConclusion()};a.prototype.hasMedia=function(){return""!=this.graphicTitle()||""!=this.graphicCaption()||""!=this.getMedia().url()?!0:!1};a.prototype.hasVideo=function(){return null!=this.getVideo()&&!StringHelper.isNullOrEmpty(this.getVideo().url())};
a.prototype.hasImage=function(){return null!=this.getImage()&&!StringHelper.isNullOrEmpty(this.getImage().url())};a.prototype.loadMedias=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a),b=0;b<a.length;b++){var e=MediaFactory.createMedia(a[b],!1);switch(e.type){case MediaType.sound:this.openingSound=e;this.openingSound.onEnded.subscribe(this,this.onSoundEnded);break;case MediaType.image:this.media(e);break;case MediaType.video:this.media(e),this.media().onCanPlay.subscribe(this,this.updateScrollbar),
this.media().onEnded.subscribe(this,this.onVideoEnded)}}};a.prototype.onVideoEnded=function(){this.videoEnded=!0;this.checkExerciseCompleted()};a.prototype.onSoundEnded=function(){this.soundEnded=!0;this.hasVideo()&&!this.isActiveAndAccessibilityEnabled()&&this.getVideo().play();this.checkExerciseCompleted()};a.prototype.startAnimation=function(){var b;b=!0;if(this.layout()==a.layouts.bottomSmall||this.layout()==a.layouts.bottomMedium||this.layout()==a.layouts.bottomLarge)b=!1;b?(b=this.displayGraphicDuration,
this.setTimeout(this.graphicDisplayTimerLabel,this.displayGraphic,b),b+=this.displayContentDuration,this.setTimeout(this.contentDisplayTimerLabel,this.displayContent,b)):(b=this.displayContentDuration,this.setTimeout(this.contentDisplayTimerLabel,this.displayContent,b),b+=this.displayGraphicDuration,this.setTimeout(this.graphicDisplayTimerLabel,this.displayGraphic,b));b+=this.displayConclusionDuration;this.setTimeout(this.conclusionDisplayTimerLabel,this.displayConclusion,b);b+=this.displayConclusionDuration;
this.timeoutCheckExerciseCompleted=setTimeout($.proxy(function(){this.animationEnded=true;this.checkExerciseCompleted()},this),b)};a.prototype.checkExerciseCompleted=function(){this.hasVideo()||(this.videoEnded=!0);this.hasOpeningSound()||(this.soundEnded=!0);this.animateVisualElements()||(this.animationEnded=!0);this.animationEnded&&this.soundEnded&&this.videoEnded&&this.parent&&this.parent.setExerciseCompleted()};a.prototype.buildAnimationDurations=function(){this.hasMedia()||(this.displayGraphicDuration=
0);this.hasContent()||(this.displayContentDuration=0)};a.layouts={leftSmall:"InfoLeftMediaSmallLayout",leftLarge:"InfoLeftMediaLargeLayout",topSmall:"InfoTopMediaSmallLayout",topMedium:"InfoTopMediaMediumLayout",topLarge:"InfoTopMediaLargeLayout",rightSmall:"InfoRightMediaSmallLayout",rightLarge:"InfoRightMediaLargeLayout",bottomSmall:"InfoBottomMediaSmallLayout",bottomMedium:"InfoBottomMediaMediumLayout",bottomLarge:"InfoBottomMediaLargeLayout"};a.layoutPosition={InfoLeftMediaSmallLayout:InfoLayoutPosition.left,
InfoLeftMediaLargeLayout:InfoLayoutPosition.left,InfoTopMediaSmallLayout:InfoLayoutPosition.top,InfoTopMediaMediumLayout:InfoLayoutPosition.top,InfoTopMediaLargeLayout:InfoLayoutPosition.top,InfoRightMediaSmallLayout:InfoLayoutPosition.right,InfoRightMediaLargeLayout:InfoLayoutPosition.right,InfoBottomMediaSmallLayout:InfoLayoutPosition.bottom,InfoBottomMediaMediumLayout:InfoLayoutPosition.bottom,InfoBottomMediaLargeLayout:InfoLayoutPosition.bottom};a.layoutSize={InfoLeftMediaSmallLayout:InfoLayoutSize.small,
InfoLeftMediaLargeLayout:InfoLayoutSize.large,InfoTopMediaSmallLayout:InfoLayoutSize.small,InfoTopMediaMediumLayout:InfoLayoutSize.medium,InfoTopMediaLargeLayout:InfoLayoutSize.large,InfoRightMediaSmallLayout:InfoLayoutSize.small,InfoRightMediaLargeLayout:InfoLayoutSize.large,InfoBottomMediaSmallLayout:InfoLayoutSize.small,InfoBottomMediaMediumLayout:InfoLayoutSize.medium,InfoBottomMediaLargeLayout:InfoLayoutSize.large};return a}(BaseContentViewModel),IntroViewModel=function(b){function a(a){var d=
this;b.call(this,a);this.isDesktopMode=ko.observable(!1);this.transitionCss=platformFeatures.getTransitionSupported()==Transition.css;this.titleId=GuidHelper.newGuid();this.titleIsVisible=ko.observable(!1);this.subtitle=ko.observable("");this.subtitleId=GuidHelper.newGuid();this.subtitleIsVisible=ko.observable(!1);this.dragToStartText=ko.observable("");this.image=ko.observable(new MediaImage);this.logoImage=ko.observable((new MediaImage).loadData({}));this.imageId=GuidHelper.newGuid();this.imageIsVisible=
ko.observable(!1);this.logoIsVisible=ko.observable(!1);this.logoTransitionFinished=ko.observable(!0);this.logoId=GuidHelper.newGuid();this.hasSubtitle=ko.observable(!1);this.hasImage=ko.observable(!1);this.hasTitle=ko.observable(!1);this.animationIsFinished=this.soundHasBeenPlayed=!1;this.animator=$.Deferred();this.animationPromise=this.animator.promise();this._titlesIntroTabindex=ko.observable(10);this.titlesIntroTabindex=this.generateTabIndexComputed("_titlesIntroTabindex",this);this._introTabindex=
ko.observable(100);this.introTabindex=this.generateTabIndexComputed("_introTabindex",this);this.animateVisualElements=ko.observable(!1);this.getDomImage=function(){return $("#"+d.imageId)};this.getDomTitleIntro=function(){return $("#"+d.titleId)};this.getDomSubtitle=function(){return $("#"+d.subtitleId)};this.getDomLogo=function(){return $("#"+d.logoId)};this.loadSkinData();switch(platformFeatures.getNavigationMode()){case NavigationMode.jquery:this.isDesktopMode(!0);break;case NavigationMode.swipe:this.isDesktopMode(!1)}}
__extends(a,b);a.prototype.loadSkinData=function(){this.logoUrl=SkinManager.getInstance().getTemplateSetting("intro","logourl",!0);null!=this.logoUrl&&(this.logoImage().setSourceForImageWithoutQuality(this.logoUrl,!1),this.hasImage(!0))};a.prototype.loadData=function(a){this.loadBehaviors(a);this.loadTexts(a);this.layout(a.exercise["@layout"]);this.layoutTemplate(a.exercise["@layout"]);this.applyMediumSizeLayout();this.loadMedias(a.exercise.media);return b.prototype.loadData.call(this,a)};a.prototype.start=
function(){this.buildAnimation();this.image().resize();this.animator.resolve();b.prototype.start.call(this);this.image().play();return this};a.prototype.triggerAnimationEndedCallbacka=function(){};a.prototype.startThumbnail=function(){this.imageIsVisible(!0);this.logoTransitionFinished(!0);this.showTitle(0);this.showSubtitle(0);this.parent.setExerciseCompleted();return this};a.prototype.stop=function(){b.prototype.stop.call(this);this.openingSound.onEnded.unSubscribe(this,this.onSoundEnded);this.hideLogo(0);
return this};a.prototype.reset=function(){this.hideImage(0);this.hideLogo(0);this.hideSubtitle(0);this.hideTitle(0);return this};a.prototype.cleanup=function(){try{b.prototype.cleanup.call(this),this.image().cleanup()}catch(a){logger.error("IntroViewModel.cleanup error : "+a)}return this};a.prototype.loadTexts=function(a){this.loadTitle(a);this.loadSubtitle(a)};a.prototype.loadBehaviors=function(a){a.exercise.behaviors&&"true"==a.exercise.behaviors.animateVisualElements&&this.animateVisualElements(!0)};
a.prototype.loadTitle=function(a){var b=!0;a.exercise.title&&a.exercise.title["@useModuleTitle"]&&(b="false"==a.exercise.title["@useModuleTitle"]?!1:!0);a=b?applicationViewModel.courseName():a.exercise.title["#text"];this.title(a);a&&this.hasTitle(!0)};a.prototype.loadSubtitle=function(a){for(var b,e=!0,a=ArrayHelper.getArrayFromJson(a.exercise.text),f=0,g=a.length;f<g;f++){var h=a[f];"subtitle"==h["@name"]&&(h["@useModuleDescription"]&&(e="false"==h["@useModuleDescription"]?!1:!0),b=e?applicationViewModel.courseDescription():
(new MediaText).loadData(h,this.parent.exerciseId).text())}this.subtitle(b);b&&this.hasSubtitle(!0)};a.prototype.loadMedias=function(a){if(void 0!=a){for(var a=ArrayHelper.getArrayFromJson(a),b=0,e=a.length;b<e;b++){var f=MediaFactory.createMedia(a[b]);f.type==MediaType.sound?(this.openingSound=f,this.openingSound.onEnded.subscribe(this,this.onSoundEnded)):f.type==MediaType.image&&(this.image(f),this.hasImage(!0))}this.hasOpeningSound()||(this.soundHasBeenPlayed=!0)}};a.prototype.render=function(){b.prototype.render.call(this);
this.logoTransitionFinished(!0);null==this.logoUrl&&!this.animateVisualElements()?(this.showImage(0),this.showTitle(0),this.showSubtitle(0),this.logoImage().resize()):null!=this.logoUrl&&this.logoTransitionFinished(!1);return this};a.prototype.sizeChanged=function(){this.logoImage().resize();this.image().resize();return $.Deferred().resolve().promise()};a.prototype.buildAnimation=function(){var b=this;this.animator=$.Deferred();var d=this.animationPromise=this.animator.promise();StringHelper.isNullOrEmpty(this.logoUrl)?
this.logoTransitionFinished(!0):d=d.then(function(){b.logoImage().resize();return b.showLogo(a.showImageDuration,a.imageVisibleDuration)}).then(function(){return b.hideLogo(a.hideImageDuration)}).then(function(){var a=$.Deferred();b.logoTransitionFinished(!0);a.resolve();return a.promise()});this.animateVisualElements()&&!this.isActiveAndAccessibilityEnabled()?(""!=this.image().url()&&(d=d.then(function(){b.image().resize();return b.showImage(a.showImageDuration)})),d=d.then(function(){return b.showTitle(a.showTitleDuration)}),
this.hasSubtitle()&&(d=d.then(function(){return b.showSubtitle(a.showSubtitleImageDuration)}))):d=d.then(function(){b.image().resize();b.showImage(0);b.showTitle(0);b.showSubtitle(0)});d=d.always(function(){b.updateScrollbar();b.animationIsFinished=true;if(b.onVisualAnimationEnded)b.onVisualAnimationEnded(1E3);b.checkExerciseIsCompleted()&&b.parent.setExerciseCompleted()})};a.prototype.checkExerciseIsCompleted=function(){return this.soundHasBeenPlayed&&this.animationIsFinished?!0:!1};a.prototype.onSoundEnded=
function(){this.soundHasBeenPlayed=audioPlayer instanceof Html5AudioPlayer?this.openingSound.hasBeenPlayed():!0;this.checkExerciseIsCompleted()&&this.parent.setExerciseCompleted()};a.prototype.showLogo=function(a,b){var e=this;this.log("info","showLogo");if(this.transitionCss){var f=this.getDomLogo().cssPromise().then(function(){var a=$.Deferred();e.setTimeout("waitDuringLogoOneSecond",function(){e.log("info","showLogo wait 1 second");a.resolve()},b);return a});this.setTimeout("logoIsVisible",function(){e.logoIsVisible(!0)},
b)}else f=this.getDomLogo().css({display:"block",opacity:0}).animate({opacity:1},a).promise().then(function(){var a=$.Deferred();e.setTimeout("waitDuringLogoOneSecond",function(){a.resolve()},b);return a});return f};a.prototype.hideLogo=function(a){var b=this;this.log("info","hideLogo");return this.transitionCss?(a=this.getDomLogo().cssPromise(),this.setTimeout("hideLogo",function(){b.logoIsVisible(!1)}),a):this.getDomLogo().fadeOut(a).promise()};a.prototype.showImage=function(a){var b=this;this.log("info",
"showImage");return this.transitionCss?(a=this.getDomImage().cssPromise(),this.setTimeout("showImage",function(){b.imageIsVisible(!0)}),a):this.getDomImage().css({visibility:"visible",opacity:0}).animate({opacity:1},a).promise()};a.prototype.hideImage=function(a){var b=this;this.log("info","hideImage");return this.transitionCss?(a=this.getDomImage().cssPromise(),this.setTimeout("hideImage",function(){b.imageIsVisible(!1)}),a):this.getDomImage().fadeOut(a).promise().then(function(){this.css("visibility",
"hidden")})};a.prototype.showTitle=function(a){var b=this;this.log("info","showTitle");return this.transitionCss?(a=this.getDomTitleIntro().cssPromise(),this.setTimeout("showTitle",function(){b.titleIsVisible(!0)}),a):this.getDomTitleIntro().css({visibility:"visible",opacity:0}).animate({opacity:1},a).promise()};a.prototype.hideTitle=function(a){var b=this;this.log("info","hideTitle");return this.transitionCss?(a=this.getDomTitleIntro().cssPromise(),this.setTimeout("hideTitle",function(){b.titleIsVisible(!1)}),
a):this.getDomTitleIntro().fadeOut(a).promise().then(function(){this.css("visibility","hidden")})};a.prototype.showSubtitle=function(a){var b=this;this.log("info","showSubtitle");return this.transitionCss?(a=this.getDomSubtitle().cssPromise(),this.setTimeout("showSubtitle",function(){b.subtitleIsVisible(!0)}),a):this.getDomSubtitle().css({visibility:"visible",opacity:0}).animate({opacity:1},a).promise()};a.prototype.hideSubtitle=function(a){var b=this;this.log("info","hideSubtitle");return this.transitionCss?
(a=this.getDomSubtitle().cssPromise(),this.setTimeout("hideSubtitle",function(){b.subtitleIsVisible(!1)}),a):this.getDomSubtitle().fadeOut(a).promise().then(function(){this.css("visibility","hidden")})};a.animationStartDelay=500;a.showImageDuration=1E3;a.imageVisibleDuration=1E3;a.hideImageDuration=500;a.showTitleDuration=1E3;a.showSubtitleImageDuration=500;return a}(BaseContentViewModel),MatrixAboutViewModel=function(b){function a(a){var d=this;b.call(this,a);this.introduction=new MediaText;this.conclusion=
new MediaText;this.areaItemsList=ko.observableArray([]);this.getDomWestCaption=function(){return d.parent.getExerciseDom().find(".matrix__axis-label-west__text")};this.getDomEastCaption=function(){return d.parent.getExerciseDom().find(".matrix__axis-label-east__text")};this._introTabindex=ko.observable(100);this._concluTabindex=ko.observable(600);this.introTabindex=this.generateTabIndexComputed("_introTabindex",this);this.concluTabindex=this.generateTabIndexComputed("_concluTabindex",this);this.introLabel=
ko.observable("");this.concluLabel=ko.observable("")}__extends(a,b);a.prototype.loadData=function(a){var d=a.exercise["@layout"];"MatrixAboutPicturesWithArrowsLayout"==d?d="matrix--arrows":"MatrixAboutPicturesWithoutArrowsLayout"==d&&(d="matrix--no-arrows");this.layout(d);this.layoutTemplate("MatrixAboutStandardLayout");this.title(a.exercise.title);this.instruction(a.exercise.instruction);this.introduction.loadData(a.exercise.intro.text,this.parent.exerciseId);this.conclusion.loadData(a.exercise.conclusion.text,
this.parent.exerciseId);this.loadAxis(a.exercise.axes.axe);this.loadAreas(a.exercise.areas.area);this.loadFeedbacks(a.exercise.feedbacks.feedback);this.areaItemsList().push(this.areaNorthEast,this.areaNorthWest,this.areaSouthEast,this.areaSouthWest);d=MediaFactory.createMedia(a.exercise.media);d.type==MediaType.sound&&""!=d.url()&&(this.openingSound=d);this.introLabel(this.introduction.transformStringForAriaLabel());this.concluLabel(this.conclusion.transformStringForAriaLabel());return b.prototype.loadData.call(this,
a)};a.prototype.start=function(){b.prototype.start.call(this);for(var a=this.areaItemsList(),d=0,e=a.length;d<e;d++)a[d].image.play();return this};a.prototype.stop=function(){b.prototype.stop.call(this);this.openingSound.isPlaying&&this.openingSound.stop();this.areaItemsList().forEach(function(a){a.feedback&&a.feedback.hideInlineFeedback()});return this};a.prototype.loadAreas=function(a){this.areaNorthEast=new MatrixAboutItemArea(this,a[0].graphiccaption,a[0].graphictitle,MediaFactory.createMedia(a[0].media),
"north-east",3);this.areaNorthWest=new MatrixAboutItemArea(this,a[1].graphiccaption,a[1].graphictitle,MediaFactory.createMedia(a[1].media),"north-west",2);this.areaSouthWest=new MatrixAboutItemArea(this,a[2].graphiccaption,a[2].graphictitle,MediaFactory.createMedia(a[2].media),"south-west",5);this.areaSouthEast=new MatrixAboutItemArea(this,a[3].graphiccaption,a[3].graphictitle,MediaFactory.createMedia(a[3].media),"south-east",4)};a.prototype.loadAxis=function(a){this.axisNorth=a[0]["#text"];this.axisEast=
a[1]["#text"];this.axisWest=a[2]["#text"];this.axisSouth=a[3]["#text"]};a.prototype.loadFeedbacks=function(a){this.areaNorthEast.loadFeedbacks((new MediaText).loadData(a[0].text,this.parent.exerciseId),MediaFactory.createMedia(a[0].media),this.feedbackClickCallback.bind(this));this.areaNorthWest.loadFeedbacks((new MediaText).loadData(a[1].text,this.parent.exerciseId),MediaFactory.createMedia(a[1].media),this.feedbackClickCallback.bind(this));this.areaSouthWest.loadFeedbacks((new MediaText).loadData(a[2].text,
this.parent.exerciseId),MediaFactory.createMedia(a[2].media),this.feedbackClickCallback.bind(this));this.areaSouthEast.loadFeedbacks((new MediaText).loadData(a[3].text,this.parent.exerciseId),MediaFactory.createMedia(a[3].media),this.feedbackClickCallback.bind(this))};a.prototype.hideAllItemsFeedback=function(){for(var a=this.areaItemsList(),b=0,e=a.length;b<e;b++)a[b].feedback.hideInlineFeedback()};a.prototype.feedbackClickCallback=function(){this.checkExerciseCompleted()};a.prototype.sizeChanged=
function(a,d){for(var e=this.areaItemsList(),f=0,g=e.length;f<g;f++)e[f].sizeChanged();f=0;for(g=e.length;f<g;f++)e[f].updateMasks();platformFeatures.getIsIE8()&&(this.getDomWestCaption().css("margin-top",this.getDomWestCaption().height()/-2),this.getDomEastCaption().css("margin-top",this.getDomEastCaption().height()/-2));b.prototype.sizeChanged.call(this,a,d);return $.Deferred().resolve().promise()};a.prototype.initDom=function(){b.prototype.initDom.call(this);for(var a=this.areaItemsList(),d=0,
e=a.length;d<e;d++)a[d].initDom();return this};a.prototype.checkExerciseCompleted=function(){for(var a=this.areaItemsList(),b=0,e=a.length;b<e;b++)if(!a[b].feedback.inlineFeedbackVisited)return;this.parent.setExerciseCompleted()};a.prototype.cleanup=function(){b.prototype.cleanup.call(this);return this};return a}(BaseContentViewModel),MatrixAboutItemArea=function(){function b(a,b,d,e,f,g){var h=this;this.id=GuidHelper.newGuid();this.maskId="mask"+this.id;this.caption=this.title="";this.shadowSize=
10;this.halfShadowSize=this.shadowSize/2;this.ariaLabelItem=ko.observable("");this._tabindexItem=ko.observable(100);this.tabindexItem=null;this.textPosition="";this.getDomMask=function(){return $("#"+h.maskId)};this.getDomTitle=function(){return $(".matrix__"+h.areaPosition+"-title",h.parent.getDomContent())};this.getDomCaption=function(){return $(".matrix__"+h.areaPosition+"-caption",h.parent.getDomContent())};this.getDomImage=function(){return $(".matrix__"+h.areaPosition+"-image",h.parent.getDomContent())};
this.parent=a;this.caption=b;this.title=d;this.image=e;this.areaPosition=f;this.feedback=new FeedbackInlineViewModel(function(){h.parent.updateScrollbar()},!("south-west"==f||"north-west"==f));this.image.onLoaded.subscribe(this,function(){h.updateMasks()});a=StringHelper.isNullOrEmpty(this.parent.axisNorth)?"":this.parent.axisNorth+", ";b=StringHelper.isNullOrEmpty(this.parent.axisSouth)?"":this.parent.axisSouth+", ";d=StringHelper.isNullOrEmpty(this.parent.axisEast)?"":this.parent.axisEast;e=StringHelper.isNullOrEmpty(this.parent.axisWest)?
"":this.parent.axisWest;switch(f){case "north-east":this.textPosition=a+d;break;case "south-east":this.textPosition=b+d;break;case "south-west":this.textPosition=b+e;break;case "north-west":this.textPosition=a+e}this.tabindexItem=this.parent.generateTabIndexComputed("_tabindexItem",this);this._tabindexItem(100*g);this.index=g;this.ariaLabelItem(this.textPosition+", "+this.title+", "+this.caption);this.image.metadataScreenReaderDescription&&this.ariaLabelItem(this.textPosition+", "+this.title+", "+
this.image.metadataScreenReaderDescription+", "+this.caption+", "+localizedText.Accessibility_IexploreZone());this.feedback.setTabindex(100*this.index,this.parent)}b.prototype.loadFeedbacks=function(a,b,d){this.feedback.setContentText(a.text());this.feedback.setContentTextAriaLabel(a.transformStringForAriaLabel());this.feedback.setSound(b);this.feedback.onClickCallback=d};b.prototype.sizeChanged=function(){this.image.resize();this.feedback&&this.feedback.inlineFeedbackIsVisible()&&this.feedback.updatePosition()};
b.prototype.initDom=function(){this.feedback.initDom(this.getDomMask,this.parent.getDomOverview,this.parent.getDom)};b.prototype.updateMasks=function(){var a=this.getDomTitle().outerWidth(!0)-this.shadowSize,b=this.getDomTitle().outerHeight(!0)+this.getDomImage().outerHeight(!0)+this.getDomCaption().outerHeight(!0)-this.shadowSize;this.getDomMask().width(a);this.getDomMask().height(b);void 0!==this.getDomTitle()[0]&&this.getDomMask().offset({top:this.getDomTitle().offset().top+this.halfShadowSize,
left:this.getDomTitle().offset().left+this.halfShadowSize})};b.prototype.feedbackManagment=function(a){var b=this;this.parent.selectedItem==a&&(a.feedback.inlineFeedbackIsVisible()||a.feedback.isSoundPlaying())?(a.feedback.hideInlineFeedback(),this.parent.selectedItem=null):(this.parent.hideAllItemsFeedback(),this.parent.selectedItem=a,this.feedback.showFeedback(),platformFeatures.getIsIE()&&BrowserHelper.refreshDom(),this.feedback.setCallbackOnHideFeedbackAfterUpdateScrollbar(function(){b.parent.isActiveAndAccessibilityEnabled()&&
b.parent.selectedItem&&b.parent.selectedItem.getDomMask().focus();b.parent.checkExerciseCompleted()}))};return b}(),MatrixPuzzleViewModel=function(b){function a(a){var d=this;b.call(this,a);this.introduction=new MediaText;this.conclusion=new MediaText;this.dragItemType=ko.observable("");this.areaItemsList=ko.observableArray([]);this.dragItemsList=ko.observableArray();this.areaDraggableContainerId=GuidHelper.newGuid();this.getDomWestCaption=function(){return $(".matrix__arrow-west",d.getDom())};this.getDomEastCaption=
function(){return $(".matrix__arrow-east",d.getDom())};this.maxHeightDropTitle=ko.observable(null);this.maxHeightDropImage=ko.observable(null);this.maxHeightDropCaption=ko.observable(null);this._introTabindex=ko.observable(100);this._concluTabindex=ko.observable(600);this.introTabindex=this.generateTabIndexComputed("_introTabindex",this);this.concluTabindex=this.generateTabIndexComputed("_concluTabindex",this);this.introLabel=ko.observable("");this.concluLabel=ko.observable("");this.stickyColumnNumberClass=
ko.observable("sticky-puzzle--matrix--4columns");this.numberOfColumns=4;this.isDragDropTemplate=!0}__extends(a,b);a.prototype.loadData=function(a){var d=a.exercise["@layout"];"MatrixPuzzlePicturesWithArrowsLayout"==d?d="matrix--arrows":"MatrixPuzzlePicturesWithoutArrowsLayout"==d&&(d="matrix--no-arrows");this.layout(d);this.layoutTemplate("MatrixPuzzleStandardLayout");this.title(a.exercise.title);this.instruction(a.exercise.instruction);this.introduction.loadData(a.exercise.intro.text,this.parent.exerciseId);
this.conclusion.loadData(a.exercise.conclusion.text,this.parent.exerciseId);this.dragItemType=ko.observable(EnumDragItemTypeHelper.toString(EnumDragItemTypeHelper.parseEnumDragItemType(a.exercise.dragItemType)));this.loadAxis(a.exercise.axes.axe);this.loadAreas(a.exercise.areas.area);this.loadFeedbacks(a.exercise.feedbacks.feedback);this.areaItemsList().push(this.areaNorthEast,this.areaNorthWest,this.areaSouthWest,this.areaSouthEast);this.loadDraggableItem(a.exercise.areas.area);d=MediaFactory.createMedia(a.exercise.media);
d.type==MediaType.sound&&""!=d.url()&&(this.openingSound=d);this.introLabel(this.introduction.transformStringForAriaLabel());this.concluLabel(this.conclusion.transformStringForAriaLabel());return b.prototype.loadData.call(this,a)};a.prototype.loadDraggableItem=function(a){for(var b=[],e=0,f=a.length;e<f;e++){var g=this.areaItemsList()[e];g.imageDraggable(MediaFactory.createMedia(a[e].media));b.push(g)}this.dragItemsList(ArrayHelper.shuffle(b))};a.prototype.loadAreas=function(a){this.areaNorthEast=
new MatrixPuzzleItemArea(this,a[0].graphiccaption,a[0].graphictitle,a[0].media,"NorthEast",3);this.areaNorthWest=new MatrixPuzzleItemArea(this,a[1].graphiccaption,a[1].graphictitle,a[1].media,"NorthWest",2);this.areaSouthWest=new MatrixPuzzleItemArea(this,a[2].graphiccaption,a[2].graphictitle,a[2].media,"SouthWest",4);this.areaSouthEast=new MatrixPuzzleItemArea(this,a[3].graphiccaption,a[3].graphictitle,a[3].media,"SouthEast",5)};a.prototype.loadAxis=function(a){this.axisNorthLabel=a[0]["#text"];
this.axisEastLabel=a[1]["#text"];this.axisWestLabel=a[2]["#text"];this.axisSouthLabel=a[3]["#text"]};a.prototype.loadFeedbacks=function(a){this.areaNorthEast.loadFeedbacks((new MediaText).loadData(a[0].text,this.parent.exerciseId),MediaFactory.createMedia(a[0].media),this.setTabindex.bind(this));this.areaNorthWest.loadFeedbacks((new MediaText).loadData(a[1].text,this.parent.exerciseId),MediaFactory.createMedia(a[1].media),this.setTabindex.bind(this));this.areaSouthWest.loadFeedbacks((new MediaText).loadData(a[2].text,
this.parent.exerciseId),MediaFactory.createMedia(a[2].media),this.setTabindex.bind(this));this.areaSouthEast.loadFeedbacks((new MediaText).loadData(a[3].text,this.parent.exerciseId),MediaFactory.createMedia(a[3].media),this.setTabindex.bind(this))};a.prototype.swipeStarted=function(){this.stickyOnSwipeStarted();return this};a.prototype.swipeCancelled=function(){this.stickyOnSwipeCancel();return this};a.prototype.swipeEnded=function(){this.stickyOnSwipeCancel();return this};a.prototype.start=function(){var a=
this;this.updateAllMasks();this.setTimeout("initdndMatrix"+this.parent.slideId,function(){a.initializeDragAndDrop();b.prototype.start.call(a)});for(var d=this.areaItemsList(),e=0,f=d.length;e<f;e++)d[e].imageArea.play();return this};a.prototype.startThumbnail=function(){var a=this;b.prototype.startThumbnail.call(this);this.updateAllMasks();this.setTimeout("initdndMatrix"+this.parent.slideId,function(){a.initializeDragAndDrop()});return this};a.prototype.initializeDragAndDrop=function(){webkit_DragManager.reset();
for(var a=this.dragItemsList(),b=0,e=a.length;b<e;b++)this.setDraggableElement(a[b]),this.setDropZone(a[b])};a.prototype.setDraggableElement=function(a){var b={revert:!0,container:$body[0],onStart:function(a){return function(){a.onSelect()}}(a)};webkit_DragManager.addDraggable(a.draggableId,b)};a.prototype.setDropZone=function(a){for(var b={accept:[a.draggableId],hoverClass:"dropzone--dragging-hover",hoverAllDropZone:!0,onDrop:function(a){return function(){a.onDrop()}}(a),onAllOver:function(a){return function(){a.onAllOver()}}(a),
onAllOut:function(a){return function(){a.onAllOut()}}(a)},e=0,f=a.dropZones.length;e<f;e++)webkit_DragManager.addDropZone(a.dropZones[e],b)};a.prototype.sizeChanged=function(a,d){this.log("info","Matrix Puzzle sizechanged","sizechanged matrix puzzle");for(var e=this.areaItemsList(),f=this.dragItemsList(),g=0,h=f.length;g<h;g++)e[g].sizeChanged(),f[g].sizeChanged();this.maxHeightDropTitle(Math.max(f[0].titleHeight,f[1].titleHeight,f[2].titleHeight,f[3].titleHeight)+"px");this.maxHeightDropImage(Math.max(f[0].imageHeight,
f[1].imageHeight,f[2].imageHeight,f[3].imageHeight)+"px");this.maxHeightDropCaption(Math.max(f[0].captionHeight,f[1].captionHeight,f[2].captionHeight,f[3].captionHeight)+"px");platformFeatures.getIsIE8()&&(this.getDomWestCaption().css("margin-top",this.getDomWestCaption().height()/-2),this.getDomEastCaption().css("margin-top",this.getDomEastCaption().height()/-2));b.prototype.sizeChanged.call(this,a,d);return $.Deferred().resolve().promise()};a.prototype.initDom=function(){b.prototype.initDom.call(this);
for(var a=this.areaItemsList(),d=0,e=a.length;d<e;d++)a[d].initDom();return this};a.prototype.checkExcerciseCompleted=function(){for(var a=!0,b=this.areaItemsList(),e=0,f=b.length;e<f;e++)if(!b[e].answerFound()){a=!1;break}a&&(this.parent.setExerciseCompleted(),this.removeStickyFooterContent())};a.prototype.updateAllMasks=function(){this.log("info","updateAllMasks","start upadting masks");for(var a=this.areaItemsList(),b=0,e=a.length;b<e;b++)a[b].updateMasks()};a.prototype.setTabindex=function(){var a=
this.areaItemsList();this._introTabindex(100);this._concluTabindex(600);for(var b=0,e=a.length;b<e;b++)a[b].setTabindex()};a.prototype.focusSelectedDropZone=function(){this.selectedDropZone&&this.selectedDropZone.getDomMask().focus()};a.prototype.resetTabindex=function(){var a=this.areaItemsList();this._introTabindex(-1);this._concluTabindex(-1);for(var b=0,e=a.length;b<e;b++)a[b].resetTabindex()};a.prototype.setDragTabindex=function(){for(var a=this.dragItemsList(),b=-1,e=0,f=a.length;e<f;e++)-1==
b&&!a[e].answerFound()&&(b=e),a[e].setDragTabindex();-1!=b&&$("#"+a[b].draggableId).focus()};a.prototype.resetDragTabindex=function(){for(var a=this.areaItemsList(),b=0,e=a.length;b<e;b++)a[b].resetDragTabindex()};a.prototype.checkValidDrop=function(a){0<this.selectedDropZone.imageDropZoneId.indexOf(a)?(this.resetDragTabindex(),this.setTabindex(),this.selectedDropZone.onDrop(),this.setAlertContent(localizedText.Accessibility_CorrectAnswer()),this.selectedDropZone.getDomMask().focus()):this.setAlertContent(localizedText.Accessibility_WrongAnswer())};
a.prototype.hideAllItemsFeedback=function(){for(var a=this.areaItemsList(),b=0,e=a.length;b<e;b++)a[b].feedback.inlineFeedbackIsVisible()&&a[b].feedback.hideInlineFeedback()};a.prototype.cleanup=function(){b.prototype.cleanup.call(this);return this};return a}(BaseContentViewModel),MatrixPuzzleItemArea=function(){function b(a,b,d,e,f,g){var h=this;this.id=GuidHelper.newGuid();this.draggableId="drag-"+this.id;this.imageDropZoneId="image-drop-"+this.id;this.titleDropZoneId="title-drop-"+this.id;this.captionDropZoneId=
"caption-drop-"+this.id;this.maskId="mask"+this.id;this.title="";this.imageDraggable=ko.observable(null);this.caption="";this.shadowSize=10;this.halfShadowSize=this.shadowSize/2;this.dropZones=[];this.answerFound=ko.observable(!1);this.titleHeight=this.captionHeight=this.imageHeight=this.maxHeight=0;this.getDomMask=function(){return $("#"+h.maskId)};this.getDomTitle=function(){return $("#"+h.titleDropZoneId)};this.getDomCaption=function(){return $("#"+h.captionDropZoneId)};this.getDomImage=function(){return $("#"+
h.imageDropZoneId)};this.getDomDraggable=function(){return $("#"+h.draggableId)};this.getDomDropZones=function(){return[$("#"+h.dropZones[0]).children().first(),$("#"+h.dropZones[1]).children().first(),$("#"+h.dropZones[2]).children().first()]};this.ariaLabelItem=ko.observable("");this.ariaDropZoneArea=this.ariaWhenFound="";this._tabindexItem=ko.observable(100);this._dragTabindex=ko.observable(-1);this.dragTabindex=this.tabindexItem=null;this.keepValueOfTabindex=-1;this.textPosition=this.dragAriaLabel=
"";this.parent=a;this.caption=b;this.title=d;this.isTitleDroppable="puzzle-title"==a.dragItemType()||"puzzle-fullstep"==a.dragItemType();this.isImageDroppable="puzzle-image"==a.dragItemType()||"puzzle-fullstep"==a.dragItemType();this.isCaptionDroppable="puzzle-caption"==a.dragItemType()||"puzzle-fullstep"==a.dragItemType();this.isAllDroppable="puzzle-fullstep"==a.dragItemType();this.imageArea=MediaFactory.createMedia(e);this.imageDraggable(MediaFactory.createMedia(e));this.areaPosition=f;this.feedback=
new FeedbackInlineViewModel(this.parent.updateScrollbar.bind(this.parent),!("SouthWest"==this.areaPosition||"NorthWest"==this.areaPosition));this.isAllDroppable?this.dropZones.push(this.titleDropZoneId,this.imageDropZoneId,this.captionDropZoneId):this.isTitleDroppable?this.dropZones.push(this.titleDropZoneId):this.isImageDroppable?this.dropZones.push(this.imageDropZoneId):this.isCaptionDroppable&&this.dropZones.push(this.captionDropZoneId);a=StringHelper.isNullOrEmpty(this.parent.axisNorthLabel)?
"":this.parent.axisNorthLabel+", ";b=StringHelper.isNullOrEmpty(this.parent.axisSouthLabel)?"":this.parent.axisSouthLabel+", ";d=StringHelper.isNullOrEmpty(this.parent.axisEastLabel)?"":this.parent.axisEastLabel;e=StringHelper.isNullOrEmpty(this.parent.axisWestLabel)?"":this.parent.axisWestLabel;switch(f){case "NorthEast":this.textPosition=a+d;break;case "SouthEast":this.textPosition=b+d;break;case "SouthWest":this.textPosition=b+e;break;case "NorthWest":this.textPosition=a+e}this.textPosition.replace(RegExp(" & undefined",
"g"),"");this.tabindexItem=this.parent.generateTabIndexComputed("_tabindexItem",this);this.dragTabindex=this.parent.generateTabIndexComputed("_dragTabindex",this);this._tabindexItem(100*g);this.keepValueOfTabindex=100*g;this.index=g;this.isTitleDroppable?(this.dragAriaLabel=this.title,this.ariaDropZoneArea=this.imageArea.metadataScreenReaderDescription+", "+this.caption):this.isImageDroppable?(this.dragAriaLabel=this.imageArea.metadataScreenReaderDescription,this.ariaDropZoneArea=this.title+", "+
this.caption):this.isCaptionDroppable&&(this.dragAriaLabel=this.caption,this.ariaDropZoneArea=this.title+", "+this.imageArea.metadataScreenReaderDescription);this.isAllDroppable&&(this.dragAriaLabel=this.title+", "+this.imageArea.metadataScreenReaderDescription+", "+this.caption,this.ariaDropZoneArea="");this.ariaLabelItem(this.textPosition+", "+this.ariaDropZoneArea+", "+localizedText.Accessibility_DropZone());this.ariaWhenFound=this.textPosition+", "+this.title+", "+this.imageArea.metadataScreenReaderDescription+
", "+this.caption;this.feedback.setTabindex(100*this.index,this.parent)}b.prototype.resetTabindex=function(){this._tabindexItem(-1)};b.prototype.setTabindex=function(){this._tabindexItem(this.keepValueOfTabindex)};b.prototype.setDragTabindex=function(){this._dragTabindex(100)};b.prototype.resetDragTabindex=function(){this._dragTabindex(-1)};b.prototype.selectDragItem=function(){this.parent.isActiveAndAccessibilityEnabled()&&(this.parent.selectedDragItem=this,this.parent.checkValidDrop(this.id))};
b.prototype.selectDropZone=function(){this.parent.isActiveAndAccessibilityEnabled()&&(this.parent.selectedDropZone=this,this.parent.resetTabindex(),this.parent.setDragTabindex())};b.prototype.loadFeedbacks=function(a,b,d){var e=this;this.feedback.setContentText(a.text());this.feedback.setContentTextAriaLabel(a.transformStringForAriaLabel());this.feedback.setSound(b);this.feedback.onClickCallback=d;this.feedback.setCallbackOnHideFeedbackAfterUpdateScrollbar(function(){e.parent.isActiveAndAccessibilityEnabled()&&
e.parent.focusSelectedDropZone()})};b.prototype.sizeChanged=function(){this.imageArea.resize();this.imageDraggable().resize();this.titleHeight=Math.floor(this.getDomDropZones()[0].height());this.imageHeight=Math.floor(this.getDomImage().height());this.captionHeight=Math.floor(this.getDomDropZones()[2].height());this.updateMasks();this.feedback&&this.feedback.inlineFeedbackIsVisible()&&this.feedback.updatePosition()};b.prototype.initDom=function(){this.feedback.initDom(this.getDomMask,this.parent.getDomOverview,
this.parent.getDom)};b.prototype.updateMasks=function(){if(this.getDomTitle().offset()){var a=this.getDomTitle().outerWidth(!0)-this.shadowSize,b=this.getDomTitle().outerHeight(!0)+this.getDomImage().outerHeight(!0)+this.getDomCaption().outerHeight(!0)-this.shadowSize;this.getDomMask().width(a);this.getDomMask().height(b);void 0!==this.getDomTitle()[0]&&this.getDomMask().offset({top:this.getDomTitle().offset().top+this.halfShadowSize,left:this.getDomTitle().offset().left+this.halfShadowSize}).css("position",
"absolute")}};b.prototype.feedbackManagment=function(){this.feedback.inlineFeedbackIsVisible()?this.feedback.hideInlineFeedback():(this.feedback.updatePosition(),this.parent.hideAllItemsFeedback(),this.feedback.showFeedback());this.parent.selectedDropZone=this};b.prototype.onDrop=function(){for(var a=0;a<this.dropZones.length;a++)$("#"+this.dropZones[a]).removeClass("dropzone--dragging-hover").removeClass("dropzone--dragging-hoverAll");this.answerFound(!0);this.ariaLabelItem(this.ariaWhenFound);this.parent.updateAllMasks();
this.parent.updateScrollbar();this.feedbackManagment();this.parent.checkExcerciseCompleted();this.onAllOut()};b.prototype.onSelect=function(){this.parent.hideAllItemsFeedback()};b.prototype.onAllOver=function(){this.parent.dragItemType()==EnumDragItemTypeHelper.toString(EnumDragItemType.fullStep)&&(this.getDomTitle().addClass("dropzone--dragging-hoverAll"),this.getDomImage().addClass("dropzone--dragging-hoverAll"),this.getDomCaption().addClass("dropzone--dragging-hoverAll"))};b.prototype.onAllOut=
function(){this.parent.dragItemType()==EnumDragItemTypeHelper.toString(EnumDragItemType.fullStep)&&(this.getDomTitle().removeClass("dropzone--dragging-hoverAll"),this.getDomImage().removeClass("dropzone--dragging-hoverAll"),this.getDomCaption().removeClass("dropzone--dragging-hoverAll"))};return b}(),LabeledImagesViewModel=function(b){function a(a){b.call(this,a);this.exerciseIntro=ko.observable("");this.items=ko.observableArray([]);this.alternatives=ko.observableArray([]);this.allAnswersFound=ko.observable(!1);
this.isDragging=ko.observable(!1);this.matchimagesContentId=GuidHelper.newGuid();this.draggablesContainerId=GuidHelper.newGuid();this.hasPolaroidItems=ko.observable(!1);this.selectedItem=null;this.allAnswersFoundTabindex=ko.observable(-1);this.oldWindowHeight=windowHeight;this.isDragDropTemplate=!0;a=GuidHelper.newGuid();this.labeledimagebottomId="labeledimagebottom-"+a;this.labeledimagequestionId="labeledimagequestion-"+a;this.labeledimageanswersId="labeledimageanswers-"+a}__extends(a,b);a.prototype.loadData=
function(a){this.title(a.exercise.title);this.question(a.exercise.question);this.instruction(a.exercise.instruction);this.loadMedias(a.exercise.media);this.loadItems(a.exercise.labeledImages);platformFeatures.getIsPhone()?this.layoutTemplate("FluidBoxDragAndDropLayout"):this.layoutTemplate("LabeledImagesStandardLayout");this.layout(this.getLayoutName(a.exercise["@layout"]));return b.prototype.loadData.call(this,a)};a.prototype.getLayoutName=function(a){var b=null;switch(a){case "LabeledImagesLargeLayout":b=
"exercise--labeledimages--large--"+this.items().length+"columns";break;case "LabeledImagesSmallLayout":b="exercise--labeledimages--medium--"+this.items().length+"columns"}return b};a.prototype.render=function(){b.prototype.render.call(this);this.updateScrollbar();return this};a.prototype.start=function(){var a=this;b.prototype.start.call(this);for(var d=this.items(),e=0,f=d.length;e<f;e++)d[e].image.play();this.waitForLabeledImageLoaded().then(function(){a.updateStickyFooterHeight()});this.initializeDragAndDrop();
this.selectNextItem();return this};a.prototype.startThumbnail=function(){var a=this;b.prototype.startThumbnail.call(this);this.waitForLabeledImageLoaded().then(function(){a.updateStickyFooterHeight();a.showStickyFooter()});this.initializeDragAndDrop();this.selectNextItem();return this};a.prototype.waitForLabeledImageLoaded=function(){for(var a=[],b=this.items(),e=0,f=b.length;e<f;e++)a.push(b[e].imageLoadedPromise);return $.when.apply($,a)};a.prototype.stop=function(){b.prototype.stop.call(this);
this.disableDropZonesKeyboardFocus();this.allAnswersFoundTabindex(-1);return this};a.prototype.swipeStarted=function(){this.stickyOnSwipeStarted();return this};a.prototype.swipeCancelled=function(){this.stickyOnSwipeCancel();return this};a.prototype.swipeEnded=function(){this.stickyOnSwipeCancel();return this};a.prototype.reset=function(){this.allAnswersFound(!1);this.isDragging(!1);for(var a=[],b=this.items(),e=0,f=b.length;e<f;e++){var g=b[e];g.markNoneFound();a=a.concat(g.labelItems)}this.alternatives(ArrayHelper.shuffle(a));
this.selectNextItem();return this};a.prototype.getAllLabelsItemsShuffled=function(a){return ArrayHelper.shuffle(this.getAllLabelsItems(a))};a.prototype.getAllLabelsItems=function(a){for(var b=[],e=0,f=a.length;e<f;e++)for(var g=a[e],h=0,i=g.labelItems.length;h<i;h++)b.push(g.labelItems[h]);return b};a.prototype.sizeChanged=function(a,d){b.prototype.sizeChanged.call(this,a,d);this.updateScrollbar();for(var e=this.items(),f=0,g=e.length;f<g;f++)e[f].image.resize();return $.Deferred().resolve().promise()};
a.prototype.loadItems=function(a){for(var b=[],e=0,f=a.labeledImage.length;e<f;e++){var g=new LabeledImageItem(this,a.labeledImage[e]);g.isValid()&&b.push(g);g.image.isPolaroid()&&this.hasPolaroidItems(!0)}this.items(b);uiManager.screenshotMode?this.alternatives(this.getAllLabelsItems(this.items())):this.alternatives(this.getAllLabelsItemsShuffled(this.items()))};a.prototype.loadMedias=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a),b=0,e=a.length;b<e;b++){var f=MediaFactory.createMedia(a[b]);
f.type==MediaType.sound&&(this.openingSound=f)}};a.prototype.initializeDragAndDrop=function(){webkit_DragManager.reset();for(var a=this.items(),b=this,e=0,f=a.length;e<f;e++){var g=[],h=a[e];if(!h.isItemDropped()){for(var i=0,j=h.labelItems.length;i<j;i++){var k=h.labelItems[i],l=$body[0];if(!l)throw"no element received:"+this.parent.slideId;l={revert:!0,container:l,onStart:function(a){return function(){b.isDragging(!0);a.onDragStarted()}}(k),onEnd:function(){return function(){b.isDragging(!1)}}(k)};
webkit_DragManager.addDraggable(k.draggableId,l);g.push(k.draggableId)}g={accept:g,hoverClass:"hover",hoverAllDropZone:!0,onDrop:function(a){return function(){a.onZoneReceivedDroppedItem()}}(h)};webkit_DragManager.addDropZone(h.droppingImageId,g);webkit_DragManager.addDropZone(h.droppedZoneId,g)}}};a.prototype.selectNextItem=function(){for(var a=this.alternatives(),b=0,e=a.length;b<e;b++)a[b].isAlternativeVisible(0==b);this.isActiveAndAccessibilityEnabled()&&(this.allAnswersFound()?this.allAnswersFoundTabindex(100):
a[0].enableKeyboardFocus())};a.prototype.cleanup=function(){try{b.prototype.cleanup.call(this);for(var a=this.items(),d=0,e=a.length;d<e;d++)a[d].cleanup();this.items.removeAll()}catch(f){logger.error("LabeledImagesViewModel.cleanup error : "+f)}return this};a.prototype.itemDropped=function(a){var b=this;this.alternatives.remove(a);a.hasFeedback()?this.showItemFeedback(a):(this.disableDropZonesKeyboardFocus(),0!=this.alternatives().length&&this.selectNextItem(),this.isActiveAndAccessibilityEnabled()&&
(0!=this.alternatives().length?this.parent.setTimeout("dragAccessibilityFocus",function(){b.alternatives()[0].getDomDragItem().focus();b.selectedItem=null},500):(this.parent.setTimeout("dragAccessibilityFocus",function(){b.selectedItem=null;b.getDom().find("#dropped_"+a.draggableId).focus()},500),this.allAnswersFoundTabindex(100))));0==this.alternatives().length?(this.allAnswersFound(!0),this.hideStickyFooter(),a.hasFeedback()||this.parent.setExerciseCompleted()):this.updateStickyFooterHeight();this.updateScrollbar()};
a.prototype.showItemFeedback=function(a){var b=this;this.disableKeyboardFocus();this.openingSound.stop();if(a.hasFeedback()){var e=a.media;0==this.alternatives().length&&this.allAnswersFoundTabindex(-1);this.feedback.setFeedback(e,a.sound,a.feedback);this.setTimeout("feedback-sizechanged",function(){b.feedback.sizeChanged(b.parent.width,b.parent.height)});0==this.alternatives().length&&(this.selectedItem=a);this.showFeedback()}};a.prototype.enableKeyboardNavigationOnDropZones=function(){var a=this;
if(this.isActiveAndAccessibilityEnabled()){for(var b=0,e=this.items().length;b<e;b++)this.items()[b].enableKeyboardFocus();this.setTimeout("dropAccessibilityFocus",function(){a.items()[0].getDomImage().focus()},500)}};a.prototype.disableDropZonesKeyboardFocus=function(){for(var a=0,b=this.items().length;a<b;a++)this.items()[a].disableKeyboardFocus()};a.prototype.disableKeyboardFocus=function(){this.tabindexTitleComponent(BaseContentViewModel.DISABLED_TABINDEX_ORDER_VALUE);this.disableDropZonesKeyboardFocus()};
a.prototype.onFeedbackCloseClick=function(){var a=this;this.tabindexTitleComponent(BaseContentViewModel.TITLE_COMPONENT_TABINDEX_ORDER_VALUE);this.disableDropZonesKeyboardFocus();0==this.alternatives().length?(this.parent.setExerciseCompleted(),this.allAnswersFoundTabindex(100),this.getDom().find("#dropped_"+this.selectedItem.draggableId).focus(),platformFeatures.getIsIE()&&BrowserHelper.refreshDom()):(this.selectNextItem(),this.isActiveAndAccessibilityEnabled()&&this.parent.setTimeout("dragAccessibilityFocus",
function(){a.alternatives()[0].getDomDragItem().focus()},500));this.selectedItem=null;b.prototype.onFeedbackCloseClick.call(this);this.updateScrollbar()};a.prototype.getItemsFluidBoxRenderer=function(){return"LabeledImagesItemsFluidBoxRenderer"};a.prototype.hasExerciseIntro=function(){return!StringHelper.isNullOrEmpty(this.exerciseIntro())};return a}(BaseContentViewModel),LabeledImageItem=function(){function b(a,b){var d=this;this.id=GuidHelper.newGuid();this.title=ko.observable("");this.titleDomId=
GuidHelper.newGuid();this.imageDomId=GuidHelper.newGuid();this.itemScreenReaderDescription=localizedText.Accessibility_DropZone();this.droppingImageId=this.imageDomId;this.droppedZoneId=GuidHelper.newGuid();this.labelItems=[];this.labelItemsFound=ko.observableArray([]);this.selected=ko.observable(!1);this.imageLoadedDeferrer=$.Deferred();this.tabindexDropItem=ko.observable(-1);this.getDomImage=function(){return $("#"+d.imageDomId)};this.domDropZone=function(){return $("#"+d.droppedZoneId)};this.parent=
a;this.loadData(b);this.imageLoadedPromise=this.imageLoadedDeferrer.promise();this.image.onLoaded.subscribe(this,function(){d.imageLoadedDeferrer.resolve()})}b.prototype.markNoneFound=function(){for(var a=[],b=this.labelItemsFound(),d=0,e=b.length;d<e;d++)a.push(b[d]);this.labelItemsFound.removeAll();return a};b.prototype.setDraggingItem=function(a){this.draggingItem=a};b.prototype.isItemDropped=function(){return null==this.draggingItem?!1:this.draggingItem.dropped()};b.prototype.isValid=function(){return 0<
this.image.url().length};b.prototype.loadData=function(a){this.image=MediaFactory.createMedia(a.media);a.title&&a.title["#text"]?this.title(a.title["#text"]):this.title(a.title);this.image&&(this.itemScreenReaderDescription=this.title()+", "+this.image.metadataScreenReaderDescription+", "+localizedText.Accessibility_DropZone());this.image.isPolaroid()&&this.image.polaroidTitle(this.title());var a=a.alternatives,b=[];if(void 0!=a){for(var a=ArrayHelper.getArrayFromJson(a.alternative),d=0,e=a.length;d<
e;d++)b.push(new LabelItem(this,a[d]));ko.utils.arrayPushAll(this.labelItems,b)}};b.prototype.onZoneReceivedDroppedItem=function(){var a=this,b=this.draggingItem.getDomDragItem();this.getDomImage().removeClass("hover");this.draggingItem.onItemDropped();platformFeatures.getIsIPad()?(b.fadeOut(500),webkit_DragManager&&webkit_DragManager.removeDraggable(this.draggingItem.draggableId),this.labelItemsFound(ArrayHelper.append(this.draggingItem,this.labelItemsFound())),setTimeout(function(){a.parent.itemDropped(a.draggingItem)},
500)):(webkit_DragManager&&webkit_DragManager.removeDraggable(this.draggingItem.draggableId),this.labelItemsFound(ArrayHelper.append(this.draggingItem,this.labelItemsFound())),b.fadeOut(500).promise().then(function(){a.parent.itemDropped(a.draggingItem)}))};b.prototype.onClick=function(a){this.parent.showItemFeedback(a)};b.prototype.cleanup=function(){try{this.image.cleanup();for(var a=0,b=this.labelItems.length;a<b;a++)this.labelItems[a].cleanup()}catch(d){logger.error("LabeledImageItem.cleanup error : "+
d)}};b.prototype.enableKeyboardFocus=function(){this.tabindexDropItem(100);for(var a=0,b=this.labelItems.length;a<b;a++)this.labelItems[a].disableKeyboardFocus()};b.prototype.disableKeyboardFocus=function(){this.tabindexDropItem(-1);for(var a=0,b=this.labelItems.length;a<b;a++)this.labelItems[a].disableKeyboardFocus()};b.prototype.selectDropBox=function(){this.parent.selectedItem&&-1!=this.labelItems.indexOf(this.parent.selectedItem)?(this.parent.setAlertContent(localizedText.Accessibility_CorrectAnswer()),
this.setDraggingItem(this.parent.selectedItem),this.onZoneReceivedDroppedItem()):this.parent.selectedItem&&this.parent.setAlertContent(localizedText.Accessibility_WrongAnswer())};return b}(),LabelItem=function(){function b(a,b){var d=this;this.labelItemScreenReaderDescription=localizedText.Accessibility_SelectDestination();this.draggableId=GuidHelper.newGuid();this.isAlternativeVisible=ko.observable(!1);this.media=new MediaBase;this.sound=null;this.feedback=new MediaText;this.dropped=ko.observable(!1);
this.wasDropped=!1;this.hasFeedback=ko.observable(!1);this._tabindexDragItem=ko.observable(-1);this.getDomDragItem=function(){return $("#"+d.draggableId)};this.parent=a;this.dropZoneId=a.droppedZoneId;this.tabindexDragItem=this.parent.parent.generateTabIndexComputed("_tabindexDragItem",this);this.loadData(b)}b.prototype.loadData=function(a){this.responseText="";a.text&&(this.responseText=a.text["#text"]);this.feedback.loadData(a.response.text,this.parent.parent.parent.exerciseId);a.response&&this.loadMedias(a.response.media);
(null!=this.media&&""!=this.media.url()||null!=this.sound&&this.sound.hasSource()||""!=this.feedback.text())&&this.hasFeedback(!0)};b.prototype.allAnswersFound=function(){return this.parent.parent.allAnswersFound()};b.prototype.onItemDropped=function(){this.dropped(!0);this.isAlternativeVisible(!1)};b.prototype.onClick=function(){this.parent.onClick(this)};b.prototype.onSelectForAccessibility=function(){this.parent.parent.isActiveAndAccessibilityEnabled()&&(this.parent.parent.selectedItem=this,this.parent.setDraggingItem(this),
this.parent.parent.enableKeyboardNavigationOnDropZones())};b.prototype.onDragStarted=function(){var a=this;this.parent.parent.getDom().addClass("bounceAll");setTimeout(function(){a.parent.parent.getDom().removeClass("bounceAll")},700);this.parent.parent.selectedItem=this;this.parent.setDraggingItem(this)};b.prototype.enableKeyboardFocus=function(){this._tabindexDragItem(100)};b.prototype.disableKeyboardFocus=function(){this.tabindexDragItem(-1)};b.prototype.loadMedias=function(a){for(var a=ArrayHelper.getArrayFromJson(a),
b=0,d=a.length;b<d;b++){var e=MediaFactory.createMedia(a[b]);e.type==MediaType.sound?""!=e.url()&&(this.sound=e):this.media=e}};b.prototype.stop=function(){null!=this.sound&&this.sound.stop()};b.prototype.cleanup=function(){null!=this.media&&this.media.cleanup();null!=this.sound&&this.sound.cleanup()};return b}(),MoreAboutViewModel=function(b){function a(a){var d=this;b.call(this,a);this.items=ko.observableArray([]);this.selectedItem=ko.observable(null);this.rows=ko.observableArray();this.mustSaveAnswers=
!1;this.checkResponses=function(){for(var a=!0,b=0,c=d.items();b<c.length;b++){var h=c[b];if(!h.hasBeenClicked()||h.state()==MoreAboutItemState.SelectedLast){a=!1;break}}return a};this.retrieveAnswers=function(){for(var a={type:"choice",correct:"",given:"",weighting:"0"},b=[],c=[],h=0,i=d.items().length;h<i;h++){var j=d.items()[h];j.hasBeenClicked()&&(j=j.state(),c.push(h.toString()+interactionLearnerResponseSeparator+j));b.push(h.toString())}a.correct=ScormHelper.arrayToString(b);a.given=ScormHelper.arrayToString(c);
return a};this.resumeAnswers=function(a){if(null!=a&&(a=ScormHelper.stringToArray(a),null!=a&&0<a.length&&""!=a[0]))for(var b=0;b<a.length;b++)if(null!=a[b]){var c=a[b].split(interactionLearnerResponseSeparator);if(2==c.length){var h=+c[0],c=MoreAboutItemState[MoreAboutItemState[c[1]]];null!=d.items()[h]&&d.items()[h].state(c)}}};this.resetAllUserAnswers=function(){for(var a=0,b=d.items();a<b.length;a++)b[a].state(MoreAboutItemState.NotSelected)};this.selectedItem(new MoreAboutItem(this,0));if(this.mustSaveAnswers=
applicationViewModel.navigationManager.existsAlternativeDestinationFrom(a.exerciseId))this.interactionApi=new InteractionApi,a.initInteractionApi(this.interactionApi),this.assessmentManager=new AssessmentManager(a.exerciseId,this.interactionApi,this.isActiveAndAccessibilityEnabled,!0)}__extends(a,b);a.prototype.getTitleElement=function(){return $(".title",this.getExerciseDom())};a.prototype.loadData=function(a){this.instruction(a.exercise.instruction);this.title(a.exercise.title);var d=a.exercise["@layout"];
"MoreAboutLargeImagesLayout"!=d&&(d="MoreAboutLittleImagesLayout");this.layout(d);this.applyLargeSizeLayout();platformFeatures.getIsPhone()?this.layoutTemplate("FluidBoxLayout"):this.layoutTemplate("MoreAboutStandardLayout");this.loadMoreAboutItems(a.exercise.alternatives);this.loadMedias(a.exercise.media);var d=this.items(),e=d.length,f=[];if(3>=e)f[0]=d;else if(4==e)f[0]=[d[0],d[1]],f[1]=[d[2],d[3]];else if(5==e)f[0]=[d[0],d[1],d[2]],f[1]=[d[3],d[4]];else for(var g="MoreAboutLittleImagesLayout"==
this.layout()?4:3,h=0,e=Math.ceil(e/g),i=0;h<e;h++)f[h]=d.slice(i,g+i),i+=g;this.rows(f);this.resizeItems();this.mustSaveAnswers&&(this.assessmentManager.initialize(null,this.checkResponses,this.parent.setExerciseCompleted,this.retrieveAnswers,this.resumeAnswers,this.resetAllUserAnswers),this.assessmentManager.resumeLearnerResponses());return b.prototype.loadData.call(this,a)};a.prototype.sizeChanged=function(a,d){b.prototype.sizeChanged.call(this,a,d);this.resizeItems();return $.Deferred().resolve().promise()};
a.prototype.resetSize=function(){this.getExerciseDom();this.titleDom.width("auto");this.instructionDom.width("auto");return $.Deferred().resolve().promise()};a.prototype.resizeItems=function(){for(var a=this.items(),b=0,e=a.length;b<e;b++)a[b].sizeChanged()};a.prototype.start=function(){var a=this;b.prototype.start.call(this);for(var d=this.items(),e=0,f=d.length;e<f;e++)d[e].init();setTimeout(function(){a.updateScrollbar()},125);this.checkExerciseCompleted();return this};a.prototype.render=function(){b.prototype.render.call(this);
var a=this.getExerciseDom();this.titleDom=a.find(".title");this.instructionDom=a.find(".instruction");return this};a.prototype.stop=function(){b.prototype.stop.call(this);this.feedback.stop();this.hideFeedback();this.mustSaveAnswers||this.unselectItems();return this};a.prototype.unselectItems=function(){for(var a=this.items(),b=0,e=a.length;b<e;b++)a[b].state(MoreAboutItemState.NotSelected)};a.prototype.reset=function(){for(var a=this.items(),b=0,e=a.length;b<e;b++)a[b].state(MoreAboutItemState.NotSelected);
return this};a.prototype.cleanup=function(){b.prototype.cleanup.call(this);this.feedback.cleanup();return this};a.prototype.onFeedbackCloseClick=function(){var a=this;b.prototype.onFeedbackCloseClick.call(this);this.tabindexTitleComponent(BaseContentViewModel.TITLE_COMPONENT_TABINDEX_ORDER_VALUE);for(var d=this.items(),e=0,f=d.length;e<f;e++)d[e].setTabindex();null!=this.selectedItem()&&(this.selectedItem().state()!=MoreAboutItemState.Selected&&(this.selectedItem().showValidationIcon(this.mustSaveAnswers),
this.selectedItem().animateValidationIcon(this.mustSaveAnswers)),this.selectedItem().stop());this.isActiveAndAccessibilityEnabled()&&(platformFeatures.getIsIE()&&BrowserHelper.refreshDom(),setTimeout(function(){a.selectedItem().getIllustrationElement().parents(".moreabout__item__media").focus()},500));this.checkExerciseCompleted()};a.prototype.checkExerciseCompleted=function(){for(var a=!0,b=this.items(),e=0,f=b.length;e<f;e++)if(!1==b[e].hasBeenClicked()){a=!1;break}a&&this.parent.setExerciseCompleted()};
a.prototype.setSelectedItem=function(a){this.openingSound.stop();for(var b=this.items(),e=0,f=b.length;e<f;e++)b[e].resetTabindex();this.selectedItem(a);this.feedback.setFeedback(a.mediaResponse,a.soundResponse,a.textResponse);this.feedback.sizeChanged(this.parent.width,this.parent.height);this.showFeedback()};a.prototype.loadMedias=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a),b=0,e=a.length;b<e;b++){var f=MediaFactory.createMedia(a[b],!0);f.type==MediaType.sound&&(this.openingSound=
f)}};a.prototype.loadMoreAboutItems=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a.alternative),b=0,e=a.length;b<e;b++){var f=new MoreAboutItem(this,b);f.loadData(b,a.length,a[b]);this.items.push(f)}};a.prototype.getItemsFluidBoxRenderer=function(){return"MoreAboutItemsFluidBoxRenderer"};a.prototype.hasExerciseIntro=function(){return!1};return a}(BaseContentViewModel),MoreAboutItem=function(){function b(a,b){var d=this;this.media=new MediaBase;this.itemText=ko.observable("");this.state=
ko.observable(MoreAboutItemState.NotSelected);this.hasBeenClicked=ko.computed(function(){return d.state()!=MoreAboutItemState.NotSelected});this.animateValidationIcon=ko.observable(!1);this.showValidationIcon=ko.observable(!1);this.imageStyle=ko.observable("");this.alternativeGuidId=GuidHelper.newGuid();this.id=ko.observable(GuidHelper.newGuid());this.iconId=ko.computed(function(){return d.id()+"_iconfont"});this.itemHasFeedback=!1;this.soundResponse=new MediaSound;this.mediaResponse=new MediaBase;
this.textResponse=new MediaText;this._tabindex=ko.observable(100);this.branchingDestinationType=null;this.parent=a;this.positionInItemsList=b;this.setTabindex()}b.prototype.setTabindex=function(){this._tabindex(100*(this.positionInItemsList+1));this.tabindex=this.parent.generateTabIndexComputed("_tabindex",this)};b.prototype.resetTabindex=function(){this._tabindex(-1)};b.prototype.loadData=function(a,b,d){var e=this;this.altNum=+d["@altnum"];this.media=MediaFactory.createMedia(d.media,!1);if(d.response)if(d.response["@destinationId"])this.branchingDestinationId=
+d.response["@destinationId"],this.branchingDestinationType=EnumBranchingDestinationTypeHelper.parseEnumBranchingDestinationType(d.response["@destinationType"]),this.itemHasFeedback=!0;else if(this.textResponse.loadData(d.response.text,this.parent.parent.exerciseId),this.loadMedias(d.response.media),""!=this.soundResponse.url()||""!=this.mediaResponse.url()||""!=this.textResponse.text())this.itemHasFeedback=!0;setTimeout(function(){var a="";switch(platformFeatures.getIsIPad1()?Transition.none:platformFeatures.getTransitionSupported()){case Transition.css:case Transition.jquery:a+=
" type"+Math.abs(RandomHelper.randomFromInterval(1,4))}e.getIllustrationElement().addClass(a)},0);this.media.displayMediaTexts(d.text["#text"],null,this.itemText,null,!1,!1)};b.prototype.getIllustrationElement=function(){return $("#"+this.media.id)};b.prototype.sizeChanged=function(){if(0!=this.getIllustrationElement().length)if(this.media.type==MediaType.image)this.media.resize();else{var a=$("#"+this.id()+" .image");this.media.fitToContent(a.width(),a.height())}};b.prototype.loadMedias=function(a){for(var a=
ArrayHelper.getArrayFromJson(a),b=0,d=a.length;b<d;b++){var e=MediaFactory.createMedia(a[b],!0);e.type==MediaType.sound?""!=e.url()&&(this.soundResponse=e):this.mediaResponse=e}};b.prototype.onClick=function(){var a=this;this.state()==MoreAboutItemState.NotSelected&&(this.state(MoreAboutItemState.SelectedLast),this.parent.mustSaveAnswers&&this.parent.assessmentManager.submitProcess());null!=this.branchingDestinationType?this.branchingDestinationType==EnumBranchingDestinationType.None?(this.state()!=
MoreAboutItemState.Selected&&(this.showValidationIcon(this.parent.mustSaveAnswers),this.animateValidationIcon(this.parent.mustSaveAnswers)),this.state(MoreAboutItemState.Selected),this.parent.assessmentManager.submitProcess(),this.parent.checkExerciseCompleted()):applicationViewModel.navigationManager.followAlternativeLink(this.parent.parent.exerciseId,this.altNum):this.itemHasFeedback&&this.parent.setTimeout("itemFeedbackTimer",function(){a.parent.tabindexTitleComponent(BaseContentViewModel.DISABLED_TABINDEX_ORDER_VALUE);
a.parent.setSelectedItem(a)},platformFeatures.getFeedbackDelay())};b.prototype.cleanup=function(){null!=this.media&&this.media.cleanup();null!=this.mediaResponse&&this.mediaResponse.cleanup();null!=this.soundResponse&&this.soundResponse.cleanup()};b.prototype.init=function(){var a=this;this.media.play();if(platformFeatures.getIsIE678()){var b=$("#"+this.alternativeGuidId);b.mouseover(function(){a.imageStyle("typeMouseOver")});b.mouseout(function(){a.imageStyle("")})}this.state()==MoreAboutItemState.SelectedLast?
(this.showValidationIcon(this.parent.mustSaveAnswers),this.animateValidationIcon(this.parent.mustSaveAnswers),this.state(MoreAboutItemState.Selected),this.parent.mustSaveAnswers&&this.parent.assessmentManager.submitProcess()):this.state()==MoreAboutItemState.Selected&&this.showValidationIcon(this.parent.mustSaveAnswers)};b.prototype.stop=function(){null!=this.soundResponse&&this.soundResponse.stop()};return b}(),MoreAboutItemState;
(function(b){b[b.NotSelected=0]="NotSelected";b[b.SelectedLast=1]="SelectedLast";b[b.Selected=2]="Selected"})(MoreAboutItemState||(MoreAboutItemState={}));
var MultiBoxesViewModel=function(b){function a(a){var d=this;b.call(this,a);this.exerciseIntro=ko.observable("");this.containers=ko.observableArray([]);this.alternatives=ko.observableArray([]);this.isDragging=ko.observable(!1);this.allAnswersFound=ko.observable(!1);this.selectedMultiBoxAlternative=ko.observable(null);this.getDomContainersBoxes=function(){return d.parent.getExerciseDom().find(".multiboxes__table")};this.isDragDropTemplate=!0}__extends(a,b);a.prototype.getSelectedAnswer=function(){return this.selectedMultiBoxAlternative()};
a.prototype.loadData=function(a){platformFeatures.getIsPhone()?(this.template("FluidBoxDragAndDropLayout"),this.layoutTemplate("FluidBoxDragAndDropLayout")):(this.template("MultiBoxesClassicLayout"),this.layoutTemplate("MultiBoxesClassicLayout"));this.question(a.exercise.question);this.instruction(a.exercise.instruction);this.loadMedias(a.exercise.media);this.loadThreeBoxContainers(a.exercise.containers);this.moveAlternativesFromContainersToGlobalList();this.alternatives(ArrayHelper.shuffle(this.alternatives()));
this.selectNextItem();var d=a.exercise["@layout"];switch(d){case "MultiboxesStandardLayout":d=1==this.alternatives().length?"multiboxes--small":"multiboxes--large"}this.layout(d);return b.prototype.loadData.call(this,a)};a.prototype.render=function(){b.prototype.render.call(this);1===this.containers().length?this.getDom().addClass("multiboxes--2columns"):this.getDom().addClass("multiboxes--"+this.containers().length+"columns");return this};a.prototype.sizeChanged=function(a,d){return b.prototype.sizeChanged.call(this,
a,d)};a.prototype.start=function(){b.prototype.start.call(this);this.initializeDragAndDrop();return this};a.prototype.startThumbnail=function(){var a=this;b.prototype.startThumbnail.call(this);this.setTimeout("sticky-footer-move-i-e",function(){a.updateStickyFooterHeight();a.setTimeout("sticky-footer-show",function(){a.showStickyFooter()},0)});this.initializeDragAndDrop();return this};a.prototype.stop=function(){b.prototype.stop.call(this);return this};a.prototype.reset=function(){this.isDragging(!1);
this.allAnswersFound(!1);for(var a=this.containers(),b=0,e=a.length;b<e;b++)ko.utils.arrayPushAll(this.alternatives(),a[b].foundAlternatives()),a[b].foundAlternatives.removeAll();this.alternatives(ArrayHelper.shuffle(this.alternatives()));this.selectNextItem();return this};a.prototype.swipeStarted=function(){this.stickyOnSwipeStarted();return this};a.prototype.swipeCancelled=function(){this.stickyOnSwipeCancel();return this};a.prototype.swipeEnded=function(){this.stickyOnSwipeCancel();return this};
a.prototype.cleanup=function(){try{b.prototype.cleanup.call(this);for(var a=this.containers(),d=0,e=a.length;d<e;d++)a[d].cleanup();this.containers.removeAll()}catch(f){logger.error("MultiBoxesViewModel.cleanup error : "+f)}return this};a.prototype.initializeDragAndDrop=function(){webkit_DragManager.reset();for(var a=this.containers(),b=0,e=a.length;b<e;b++)this.initializeContainerDragAndDrop(a[b])};a.prototype.initializeContainerDragAndDrop=function(a){logger.info("multibox.initializeContainerDragAndDrop");
for(var b=[],e=this.alternatives(),f=this,g=0,h=e.length;g<h;g++){var i=e[g];if(i.dropZoneId==a.containerId){var j={revert:!0,container:$body[0],onStart:function(a){return function(){f.isDragging(!0);a.onDragStarted()}}(i),onEnd:function(){return function(){f.isDragging(!1)}}(i)};try{webkit_DragManager.addDraggable(i.draggableId,j)}catch(k){logger.info("multibox.initializeDragAndDrop error : "+k)}b.push(i.draggableId)}}e={accept:b,hoverClass:"dropzone--dragging-hover",hoverAllDropZone:!0,onDrop:function(a){return function(){a.onDrop()}}(a)};
if(null!=b&&0<b.length)try{webkit_DragManager.addDropZone(a.containerId,e)}catch(l){logger.info("multibox.initializeDragAndDrop error : "+l)}};a.prototype.selectNextItem=function(){var a=this.alternatives();if(0!=a.length){for(var b=0,e=a.length;b<e;b++)a[b].isAlternativeVisible(0==b);this.isActiveAndAccessibilityEnabled()&&(this.setAlertContent(localizedText.Accessibility_CorrectAnswer()),this.parent.setTimeout("multiboxes_focus_draggable"+a[0].draggableId,function(){$("#"+a[0].draggableId).focus()},
100))}};a.prototype.resetSelectedAnswer=function(){this.selectedMultiBoxAlternative(null)};a.prototype.setSelectedAnswer=function(a){this.setContainerTabindex();this.selectedMultiBoxAlternative(a)};a.prototype.setContainerTabindex=function(){for(var a=this,b=0,e=this.containers().length;b<e;b++)this.containers()[b].setTabindex();this.isActiveAndAccessibilityEnabled()&&this.parent.setTimeout("multiboxes_focus_container"+this.containers()[0].containerId,function(){$("#"+a.containers()[0].containerId).focus()},
100)};a.prototype.resetContainerTabindex=function(){for(var a=0,b=this.containers().length;a<b;a++)this.containers()[a].resetTabindex()};a.prototype.loadThreeBoxContainers=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a.container),b=0,e=a.length;b<e;b++)if(null!=a[b].text&&null!=a[b].text["#text"]){var f=new MultiBoxContainer(this);f.loadData(a[b]);this.containers.push(f)}};a.prototype.moveAlternativesFromContainersToGlobalList=function(){for(var a=this.containers(),b=0,e=a.length;b<
e;b++)ko.utils.arrayPushAll(this.alternatives(),a[b].alternatives)};a.prototype.onDropAnswer=function(a){var b=this;if(null!=this.getSelectedAnswer()){var e=this.getSelectedAnswer();a.onAnswerFound(e);a=$("#"+e.draggableId);this.resetSelectedAnswer();a.fadeOut(300,function(){e.isAlternativeVisible(!1);b.hideSelectedAnswer(e);b.updateStickyFooterHeight()})}};a.prototype.hideSelectedAnswer=function(a){this.alternatives.remove(a);this.selectedMultiBoxAlternative(null);0==this.alternatives().length&&
this.parent.setExerciseCompleted();this.selectNextItem()};a.prototype.checkIfAllAnswersFound=function(){for(var a=0,b=0,e=this.containers().length;b<e;b++)if(this.containers()[b].allAnswersFound()&&a++,a==this.containers().length){this.allAnswersFound(!0);break}};a.prototype.loadMedias=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a),b=0,e=a.length;b<e;b++){var f=MediaFactory.createMedia(a[b]);f.type==MediaType.sound&&(this.openingSound=f)}};a.prototype.getItemsFluidBoxRenderer=
function(){return"MultiBoxesItemsFluidBoxRenderer"};a.prototype.hasExerciseIntro=function(){return!StringHelper.isNullOrEmpty(this.exerciseIntro())};return a}(BaseContentViewModel),MultiBoxContainer=function(){function b(a){this.title=ko.observable("");this.itemScreenReaderDescription=localizedText.Accessibility_DropZone();this.foundAlternatives=ko.observableArray([]);this.alternatives=[];this.containerId=GuidHelper.newGuid();this.allAnswersFound=ko.observable(!1);this._tabindex=ko.observable(-1);
this.parent=a;this.tabindex=this.parent.generateTabIndexComputed("_tabindex",this)}b.prototype.setTabindex=function(){this._tabindex(100)};b.prototype.resetTabindex=function(){this._tabindex(-1)};b.prototype.loadData=function(a){null!=a.text&&null!=a.text["#text"]&&(this.title(a.text["#text"]),this.itemScreenReaderDescription=a.text["#text"]+", "+localizedText.Accessibility_DropZone());a=a.alternatives;if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a.alternative),b=0,d=a.length;b<d;b++){var e=
new MultiBoxAlternative(this.parent),f="";null!=a[b].text&&null!=a[b].text["#text"]&&(f=a[b].text["#text"]);e.loadData(this.containerId,f);this.alternatives.push(e)}};b.prototype.onDrop=function(){var a=this.parent.getSelectedAnswer();null!=a&&a.dropZoneId==this.containerId?(this.parent.getDomContainersBoxes()&&this.parent.getDomContainersBoxes().removeClass("dropzone--dragging-hover"),this.parent.onDropAnswer(this),this.foundAlternatives().length==this.alternatives.length?(this.allAnswersFound(!0),
this.parent.checkIfAllAnswersFound()):this.parent.resetContainerTabindex()):this.parent.setAlertContent(localizedText.Accessibility_WrongAnswer())};b.prototype.onAnswerFound=function(a){null!=a&&a.dropZoneId==this.containerId&&!a.answerFound&&(a.answerFound=!0,this.foundAlternatives.push(a),a=$("#"+a.alternativeId),$(a).fadeIn(300,function(){}))};b.prototype.computeHeightWithAllAlternatives=function(){var a=0,b=ko.observableArray(this.foundAlternatives().slice(0));this.foundAlternatives.removeAll();
a=this.alternatives;ko.utils.arrayPushAll(this.foundAlternatives(),a);a=this.getContainerDom().height();this.foundAlternatives.removeAll();ko.utils.arrayPushAll(this.foundAlternatives(),b());return a};b.prototype.cleanup=function(){};b.prototype.getContainerDom=function(){return $("#"+this.containerId)};return b}(),MultiBoxAlternative=function(){function b(a){this.responseText="";this.labelItemScreenReaderDescription=localizedText.Accessibility_SelectDestination();this.isAlternativeVisible=ko.observable(!1);
this.draggableId=GuidHelper.newGuid();this.alternativeId=GuidHelper.newGuid();this.answerFound=!1;this._tabindex=ko.observable(100);this.tabIndexValue=100;this.parent=a;this.tabindexDragItem=this.parent.generateTabIndexComputed("_tabindex",this)}b.prototype.loadData=function(a,b){this.dropZoneId=a;this.responseText=b};b.prototype.onSelectForAccessibility=function(){this.parent.isActiveAndAccessibilityEnabled()&&(this.isAlternativeVisible(!0),this.parent.setSelectedAnswer(this),this._tabindex(-1))};
b.prototype.onDragStarted=function(){this.isAlternativeVisible(!0);this.parent.setSelectedAnswer(this)};b.prototype.cleanup=function(){};return b}(),ProcessAboutViewModel=function(b){function a(a){b.call(this,a);this.items=ko.observableArray([]);this.selectedItem=ko.observable(null);this.selectedIndex=ko.observable(-1);this.tableId=ko.observable(GuidHelper.newGuid());this.selectedItemResponseText=ko.observable("");this.selectedItemFeedbackCssClass=ko.observable("");this.stretchablefeedbackVisible=
ko.observable(!1);this.hasPolaroid=ko.observable(!1);this.arrowVisible=ko.observable(!1);this.helper=new ProcessCommon(this,this.title,this.instruction,this.items,this.hasPolaroid,this.selectedItem,this.selectedIndex,this.stretchablefeedbackVisible,this.selectedItemResponseText,this.selectedItemFeedbackCssClass,this.arrowVisible,!0,!0,null)}__extends(a,b);a.prototype.loadData=function(a){this.layoutTemplate("ProcessAboutStandardLayout");platformFeatures.getIsPhone()?this.layoutTemplate("FluidBoxLayout"):
this.layoutTemplate("ProcessAboutStandardLayout");this.helper.loadData(a);return b.prototype.loadData.call(this,a)};a.prototype.sizeChanged=function(a,b){this.helper.sizeChanged(a,b);return $.Deferred().resolve().promise()};a.prototype.updateScrollbar=function(){this.helper.applyHeighest();return b.prototype.updateScrollbar.call(this)};a.prototype.start=function(){b.prototype.start.call(this);this.helper.start();return this};a.prototype.startThumbnail=function(){return this};a.prototype.stop=function(){b.prototype.stop.call(this);
this.helper.stop();return this};a.prototype.reset=function(){this.helper.reset();return this};a.prototype.render=function(){b.prototype.render.call(this);this.helper.render();return this};a.prototype.cleanup=function(){try{b.prototype.cleanup.call(this),this.helper.cleanup()}catch(a){logger.error("ProcessAbout.cleanup error : "+a)}return this};a.prototype.getItemsFluidBoxRenderer=function(){return"ProcessAboutItemsFluidBoxRenderer"};a.prototype.hasExerciseIntro=function(){return!StringHelper.isNullOrEmpty(this.helper.exerciseIntro.text())};
return a}(BaseContentViewModel),Mark=function(){function b(a,b){this.id=GuidHelper.newGuid();this.text=new MediaText;this.isCurrentMark=ko.observable(!1);this.mediaContentHeight=ko.observable(0);this.availableMediaContent=ko.observable(0);this.tabIndex=ko.observable(-1);this.startTime=a["@starttime"];this.layout=a["@layout"];void 0!==a.media&&(this.image=MediaFactory.createMedia(a.media),this.image.verticalAlignMiddle(!0));void 0!==a.text&&this.text.loadData(a.text,b)}b.prototype.play=function(){this.image.play()};
b.prototype.resize=function(a){var b=this;a.find(".presenter-right-content__media-content")[0]&&(this.mediaContent=a.find(".presenter-right-content__media-content"),this.mediaContentHeight(this.mediaContent.innerHeight()));if(a.find(".presenter-right-content__top-media--text")[0]){this.textHeight=a.find(".presenter-right-content__top-media--text");var d=Math.max(this.mediaContent.height()-this.textHeight.outerHeight(!0),this.mediaContent.height()/2);this.availableMediaContent(d)}a.find(".presenter-right-content__bottom-media--text")[0]&&
(this.textHeight=a.find(".presenter-right-content__bottom-media--text"),d=Math.max(this.mediaContent.height()-this.textHeight.outerHeight(!0),this.mediaContent.height()/2),this.availableMediaContent(d));this.image&&setTimeout(function(){b.image.resize()},0);a.find(".presenter-right-content")[0]&&setTimeout(function(){a.find(".presenter-right-content").css("visibility","visible")},0)};b.prototype.setTabIndex=function(){this.image.setTabindex(101);this.tabIndex(101)};b.prototype.resetTabIndex=function(){this.image.setTabindex(-1);
this.tabIndex(-1)};return b}(),PresenterViewModel=function(b){function a(a){var d=this;b.call(this,a,!0);this.image=new MediaImage(!1);this.playableMedia=null;this.containerHeight=ko.observable(0);this.contentHeight=ko.observable(0);this.getDomMediaController=function(){return d.parent.getExerciseDom().find(".presenter-mediaControler-container")};this.getDomLeftContentMedia=function(){return d.parent.getExerciseDom().find(".presenter-left-content__media")};this.getDomRightContent=function(){return d.parent.getExerciseDom().find(".presenter-right-content")};
this.getDomMediaControllerPlayPause=function(){return d.parent.getExerciseDom().find(".presenter-mediaControler__playpause")};this.getDomProgressBarContainer=function(){return d.parent.getExerciseDom().find(".presenter-progressBarContainer")};this.getDomProgressBar=function(){return d.parent.getExerciseDom().find(".presenter-progressBar")};this.getDomTimeRemaining=function(){return d.parent.getExerciseDom().find(".presenter-timeRemaining")};this.getDomSoundWave=function(){return d.parent.getExerciseDom().find(".presenter-soundWaveContainer")};
this.getDomButtonsContainer=function(){return d.parent.getExerciseDom().find(".presenter-mediaControler-buttonsContainer")};this.getDomRightContentMediaContent=function(){return d.parent.getExerciseDom().find(".presenter-right-content__media-content")};this.isIE8=ko.observable(!1);this.hasPlayableMedia=ko.observable(!1);this.hasImage=ko.observable(!1);this.hasSound=ko.observable(!1);this.hasVideo=ko.observable(!1);this.ariaLabelPlay=ko.observable(null);this.ariaLabelPause=ko.observable(null);this.ariaLabelReplay=
ko.observable(null);this.fadeOutAnimationIsOver=!0;this.marks=ko.observableArray([]);this.hasCurrentMark=ko.observable(!1);this.currentMark=ko.observable(null);this.refCurrentMark=-1;this.cron=null;this.animationTimer=0;this.timeLineLoaded=!1;this.oldProgressionPourcentage=0;this._presenterAudioControlsPlayPauseTabindex=ko.observable(100);this.presenterAudioControlsPlayPauseTabindex=this.generateTabIndexComputed("_presenterAudioControlsPlayPauseTabindex",this);this._presenterMediaControlsReplayTabindex=
ko.observable(102);this.presenterMediaControlsReplayTabindex=this.generateTabIndexComputed("_presenterMediaControlsReplayTabindex",this);this.leftContentId=GuidHelper.newGuid();this.contentContainerId=GuidHelper.newGuid();this.mediaControlerId=GuidHelper.newGuid();this.mediaControlerButtonsId=GuidHelper.newGuid();this.mediaContentHeight=ko.computed(function(){return d.currentMark()?d.currentMark().mediaContentHeight():0});this.scaleToApply=ko.observable(1.6);this.animation="fade";this.backgroundCardActivated=
!0;this.contentMediaTransformStyle=ko.computed(function(){if(!d.hasCurrentMark()&&!platformFeatures.getIsIE8()){var a=d.scaleToApply(),b="";c==Orientation.Landscape&&(b=" scale("+a+")");var c=uiManager.getOrientation(),a=(c==Orientation.Landscape?" translateX(75%)":" translateY(50%)")+b+";";return"-moz-transform :"+a+("-ms-transform :"+a)+("-webkit-transform :"+a)+("transform :"+a)}return""})}__extends(a,b);a.prototype.startThumbnail=function(){return this};a.prototype.loadData=function(a){if(a.exercise){this.layoutTemplate("PresenterStandardLayout");
this.title(a.exercise.title);this.instruction(a.exercise.instruction);void 0!=a.exercise.body&&this.loadMedias(a.exercise.body.media);void 0!=a.exercise.marks&&this.loadMarks(a.exercise.marks.mark);"PresenterAudioLayout"==a.exercise["@layout"]&&platformFeatures.getIsDesktopMode()?this.applyLargeSizeLayout():this.applyFullScreenSizeLayout();this.ariaLabelPlay(localizedText.Accessibility_SoundPlayerPlay);this.ariaLabelPause(localizedText.Accessibility_SoundPlayerPause);this.ariaLabelReplay(localizedText.Accessibility_SoundPlayerReplay);
this.hasVideo()&&(this._presenterAudioControlsPlayPauseTabindex=ko.observable(-1),this._presenterMediaControlsReplayTabindex=ko.observable(-1));if(a.exercise["@transition"])switch(a.exercise["@transition"]){case "0":this.animation="none";break;case "1":this.animation="fade";break;case "2":this.animation="animated"}if(a.exercise["@background"])switch(a.exercise["@background"]){case "0":this.backgroundCardActivated=!1;break;case "1":this.backgroundCardActivated=!0}}return b.prototype.loadData.call(this,
a)};a.prototype.setTabindex=function(){this.hasImage()&&this.image.setTabindex(100);this.hasPlayableMedia()&&this.playableMedia.setTabindex(100);this.currentMark()&&this.currentMark().setTabIndex()};a.prototype.resetTabindex=function(){this.hasImage()&&this.image.setTabindex(-1);this.hasPlayableMedia()&&this.playableMedia.setTabindex(-1);this.currentMark()&&this.currentMark().resetTabIndex()};a.prototype.render=function(){b.prototype.render.call(this);this.hasVideo()&&this.playableMedia.initializePlayerSize();
this.isIE8(platformFeatures.getIsIE8());return this};a.prototype.sizeChanged=function(a,b){var e=0,f=0;if(platformFeatures.getIsIE89())this.getDomMediaController().css("padding",applicationViewModel.timelineViewModel.buttonMenu.outerHeight()),f=e=b-this.getDomTitleWrapper().outerHeight()-this.getDomMediaController().outerHeight();else{var e=document.getElementById(this.leftContentId),f=document.getElementById(this.mediaControlerId),g=document.getElementById(this.contentContainerId),h=document.getElementById(this.mediaControlerButtonsId);
uiManager.getOrientation()==Orientation.Portrait&&(this.hasImage()||this.hasVideo())?(g&&h&&e&&(e.appendChild(f),e.appendChild(h)),this.getDomMediaController().css("padding","")):(f&&g&&h&&(g.appendChild(f),f.appendChild(h)),this.getDomRightContentMediaContent().css("top",""),this.getDomMediaController().css("padding",applicationViewModel.timelineViewModel.buttonMenu.outerHeight()));f=e=b-this.getDomTitleWrapper().outerHeight(!0)-this.getDomMediaController().outerHeight(!0);if(uiManager.getOrientation()==
Orientation.Portrait&&(this.hasVideo()||this.hasImage()))e=b-this.getDomTitleWrapper().outerHeight(!0)-applicationViewModel.timelineViewModel.buttonMenu.outerHeight(!0),f=0.6*e-this.getDomMediaController().outerHeight(!0)}this.containerHeight(e);this.contentHeight(f);this.sizeUpdater();return $.Deferred().resolve().promise()};a.prototype.sizeUpdater=function(){var a=this,b=this.getDomLeftContentMedia().outerWidth(!0),e=this.getDomLeftContentMedia().outerHeight(!0),f=1.6;if(this.hasVideo()){var g=
this.playableMedia.getDom().find("video").height(),f=this.getDomContent().height()/g;this.scaleToApply(Math.min(1.6,f));this.playableMedia.sizeChanged(b,e)}else this.hasImage()&&(this.clearTimeout("updateImageSize"),this.setTimeout("updateImageSize",function(){a.image.resize();var b=a.image.getDimensions().image.height;f=a.getDomContent().height()/b;a.scaleToApply(Math.min(1.6,f))},0));if(!platformFeatures.getIsIE89()&&uiManager.getOrientation()==Orientation.Portrait&&(this.hasImage()||this.hasVideo())){this.getDomButtonsContainer().css("left",
this.getDomLeftContentMedia().position().left+this.getDomLeftContentMedia().width()/2-this.getDomButtonsContainer().width()/2);this.getDomButtonsContainer().css("top",this.getDomLeftContentMedia().position().top+this.getDomLeftContentMedia().height()/2-this.getDomButtonsContainer().height()/2);this.fadeOutAnimationIsOver=!1;var h=this;platformFeatures.getIsMobileDevice()&&this.getDomButtonsContainer().fadeOut(3E3,function(){h.fadeOutAnimationIsOver=!0})}this.getDomTimeRemaining().position()&&this.getDomSoundWave().css("left",
this.getDomTimeRemaining().position().left+this.getDomTimeRemaining().width()/2-this.getDomSoundWave().width()/2);this.hasPlayableMedia()&&!platformFeatures.getIsIE8()&&(this.initTimeLine(!0),this.progressBarManagement(100*(this.playableMedia.getCurrentTime()/this.playableMedia.getDuration())));this.updateMarkDom()};a.prototype.swipeStarted=function(){this.hasVideo()&&this.playableMedia.pause();return this};a.prototype.swipeCancelled=function(){this.hasVideo()&&this.playableMedia.play();return this};
a.prototype.mediaPlayPause=function(){this.playableMedia.playPause();this.fadeOutButtonsOnMobile();this.getDomMediaControllerPlayPause().focus()};a.prototype.start=function(){var a=this;this.setTabindex();b.prototype.start.call(this);this.fadeOutButtonsOnMobile();this.reinitialize();this.image.play();this.cron=setInterval(function(){a.marksManagement();a.playableMedia&&!platformFeatures.getIsIE8()&&(a.playableMedia.isPlaying()&&a.timeLineManagement(),!a.timeLineLoaded&&!isNaN(a.playableMedia.getDuration())&&
0!=a.playableMedia.getDuration()&&a.initTimeLine())},300);return this};a.prototype.displaySoundWave=function(){uiManager.getOrientation()==Orientation.Portrait&&(this.hasVideo()||this.hasImage()&&this.hasSound())?this.getDomSoundWave().hide():this.playableMedia&&this.playableMedia.isPlaying()&&(this.hasImage()||this.hasSound())?platformFeatures.getIsIE89()?this.getDomSoundWave().show():this.getDomSoundWave().children().css("animation-play-state","running"):platformFeatures.getIsIE89()?this.getDomSoundWave().hide():
this.getDomSoundWave().children().css("animation-play-state","paused")};a.prototype.initSoundWave=function(){if(this.getDomTimeRemaining().position()){this.getDomSoundWave().css("left",this.getDomTimeRemaining().position().left+this.getDomTimeRemaining().width()/2-this.getDomSoundWave().width()/2);for(var a=1,b=void 0,e=0;7>e;e++)this.getDomSoundWave().append('<div class="presenter-soundWaveBar"></div>'),this.getDomSoundWave().children().eq(e).css("left",a),b=Math.floor(100*Math.random())+400+"ms",
this.getDomSoundWave().children().eq(e).css("animation-duration",b),a+=4;this.displaySoundWave()}};a.prototype.secondsToHms=function(a){var a=Number(a),b=Math.floor(a/3600),e=Math.floor(a%3600/60),a=Math.floor(a%3600%60);return(0<b?b+":"+(10>e?"0":""):"")+e+":"+(10>a?"0":"")+a};a.prototype.stop=function(){b.prototype.stop.call(this);this.resetTabindex();this.hasPlayableMedia()&&(this.playableMedia.stop(),this.progressBarManagement(0));this.timeLineLoaded=!1;clearInterval(this.cron);return this};a.prototype.reinitialize=
function(a){var b=this;void 0===a&&(a=!1);this.marks().length&&0<this.marks()[0].startTime&&(this.refCurrentMark=-1,this.currentMark(null),this.hasCurrentMark(!1));this.hasVideo()&&!this.isActiveAndAccessibilityEnabled()&&this.playableMedia.play();a?this.playableMedia.replay():this.playableMedia.play();this.isActiveAndAccessibilityEnabled()&&(a?this.getDomMediaControllerPlayPause().focus():this.playableMedia.pause());this.playableMedia.onEnded.subscribe(this,function(){b.getDomMediaControllerPlayPause().focus();
b.progressBarManagement(100)})};a.prototype.resetSize=function(){return $.Deferred().resolve().promise()};a.prototype.cleanup=function(){try{b.prototype.cleanup.call(this)}catch(a){logger.error("EndingViewModel.cleanup error : "+a)}return this};a.prototype.slideToNextExercise=function(){applicationViewModel.navigationManager.followNextLink()};a.prototype.loadMedias=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a),b=0;b<a.length;b++){var e=a[b];if(void 0!=e){var f=MediaFactory.createMedia(e);
switch(f.type){case MediaType.sound:this.loadPlayableMedia(new MediaSound,e);break;case MediaType.image:this.image=f;this.image.verticalAlignMiddle(!0);this.hasImage(null!=this.image&&!StringHelper.isNullOrEmpty(this.image.url()));break;case MediaType.video:f=new MediaVideo,platformFeatures.getIsIE8()||(f.hasCustomControls=!0),this.loadPlayableMedia(f,e)}}}};a.prototype.loadPlayableMedia=function(a,b){var e=this;this.playableMedia=a.loadData(b);this.playableMedia.onEnded.subscribe(this,function(){e.parent.setExerciseCompleted()});
this.hasPlayableMedia(null!=this.playableMedia&&!StringHelper.isNullOrEmpty(this.playableMedia.url()));this.hasSound(this.hasPlayableMedia()&&this.playableMedia instanceof MediaSound);this.hasVideo(this.hasPlayableMedia()&&this.playableMedia instanceof MediaVideo);this.playableMedia.isPlaying.subscribe(this.displaySoundWave,this)};a.prototype.loadMarks=function(a){a=ArrayHelper.getArrayFromJson(a);if(void 0!=a){for(var b=0;b<a.length;b++)void 0!=a[b]&&this.marks.push(new Mark(a[b],this.parent.exerciseId));
this.sortMarksArray()}this.animationTimer="none"==this.animation?0:250};a.prototype.sortMarksArray=function(){this.marks().sort(function(a,b){return a.startTime-b.startTime})};a.prototype.marksManagement=function(){for(var a=this,b=null,e=-1,f=this.hasCurrentMark(),g=0;g<this.marks().length;g++)if(this.hasPlayableMedia()&&this.marks()[g].startTime<=this.playableMedia.getCurrentTime()&&(null==b||this.marks()[g].startTime>parseFloat(b.startTime)))b=this.marks()[g],e=g,this.hasCurrentMark(!0);this.hasCurrentMark()||
(this.refCurrentMark=-1,this.currentMark(null));(-1==e||"MediaOnly"==b.layout)&&this.hasCurrentMark(!1);e!=this.refCurrentMark&&(this.getDomRightContent().css("visibility","hidden"),-1!=this.refCurrentMark&&this.marks()[this.refCurrentMark].isCurrentMark(!1),this.currentMark()&&this.currentMark().resetTabIndex(),this.currentMark(b),null!=this.currentMark()&&setTimeout(function(){a.currentMark().isCurrentMark(true);a.currentMark().play();a.currentMark().setTabIndex();a.refCurrentMark=e;a.updateMarkDom()},
this.animationTimer));f!=this.hasCurrentMark()&&(this.getDomRightContent().css("visibility","hidden"),this.updateMarkDom());return!0};a.prototype.updateMarkDom=function(){var a=this;this.currentMark()&&setTimeout(function(){a.currentMark().resize(a.getDom());if(!platformFeatures.getIsIE89()&&uiManager.getOrientation()==Orientation.Portrait&&(a.hasImage()||a.hasVideo()))a.getDomRightContentMediaContent().css("top",a.getDomMediaController().outerHeight(!0)),a.getDomRightContentMediaContent().css("margin-top",
"0px")},0)};a.prototype.initTimeLine=function(a){void 0===a&&(a=!1);if(!a||this.timeLineLoaded){this.timeLineLoaded=!0;this.getDomTimeRemaining().html("-"+this.secondsToHms(this.playableMedia.getDuration()));for(a=0;a<this.marks().length;a++){var b=this.getDomProgressBarContainer().width()/this.playableMedia.getDuration()*this.marks()[a].startTime;$("#"+this.marks()[a].id).css({left:b})}(this.hasImage()||this.hasSound())&&this.initSoundWave()}};a.prototype.progressBarManagement=function(a,b){void 0===
b&&(b=!1);var e=this,f=250;b&&(f=150);if(a>this.oldProgressionPourcentage+0.2||a<this.oldProgressionPourcentage-0.2)this.oldProgressionPourcentage=a,this.getDomProgressBar().animate({width:a+"%"},{duration:f,complete:function(){for(var a=0;a<e.marks().length;a++)e.hasPlayableMedia()&&(e.marks()[a].startTime<=e.playableMedia.getCurrentTime()?$("#"+e.marks()[a].id).addClass("presenter-progressStep-active"):$("#"+e.marks()[a].id).removeClass("presenter-progressStep-active"))}})};a.prototype.timeLineClick=
function(a,b){var e=$(b.target);-1!=e[0].className.indexOf("presenter-progressStep")&&(e=$(b.target).parent());e=e.offset();e=100*((b.clientX-e.left)/this.getDomProgressBarContainer().width());this.hasPlayableMedia()&&(this.progressBarManagement(e,!0),this.playableMedia.setCurrentTime(e*this.playableMedia.getDuration()/100),this.getDomTimeRemaining().html("-"+this.secondsToHms(this.playableMedia.getDuration()-this.playableMedia.getCurrentTime())))};a.prototype.timeLineManagement=function(){this.hasPlayableMedia()&&
(this.getDomTimeRemaining().html("-"+this.secondsToHms(this.playableMedia.getDuration()-this.playableMedia.getCurrentTime())),this.progressBarManagement(100*(this.playableMedia.getCurrentTime()/this.playableMedia.getDuration())))};a.prototype.fadeOutButtonsOnMobile=function(){var a=this;platformFeatures.getIsMobileDevice()&&this.fadeOutAnimationIsOver&&uiManager.getOrientation()==Orientation.Portrait&&(this.hasImage()||this.hasVideo())&&this.getDomButtonsContainer().fadeIn("slow",function(){a.fadeOutAnimationIsOver=
!1;setTimeout(function(){a.playableMedia.isPlaying()?a.getDomButtonsContainer().fadeOut("slow",function(){a.fadeOutAnimationIsOver=!0}):a.fadeOutAnimationIsOver=!0},3E3)})};return a}(BaseContentViewModel),ProcessPuzzleItem=function(b){function a(){b.apply(this,arguments);this.answerFound=ko.observable(!1);this.isAllDraggable=this.isCaptionDroppable=this.isTitleDroppable=this.isImageDroppable=!1;this.imageDropZoneId="image-zone-"+this.id();this.titleDropZoneId="title-zone-"+this.id();this.captionDropZoneId=
"caption-zone-"+this.id();this.draggableId="draggable-"+this.id();this.dropZones=[];this.imageDraggable=ko.observable(new MediaImage);this.dragAriaLabel="";this.ariaDropzoneTitle=ko.observable("");this.ariaDropzoneImage=ko.observable("");this.ariaDropzoneCaption=ko.observable("")}__extends(a,b);a.prototype.draggableDisplayedElement=function(a){var b=this;switch(a){case EnumDragItemType.caption:this.isCaptionDroppable=!0;this.dragAriaLabel=this.caption;this.ariaDropzoneTitle(this.title);this.ariaDropzoneImage(this.image().metadataScreenReaderDescription);
this.ariaDropzoneCaption(localizedText.Accessibility_DropZone()+" "+(this.index()+1));this.dropZones.push("caption-zone-"+this.id());this.onDragOverContainer=function(){};this.onDragOutContainer=function(){};break;case EnumDragItemType.title:this.isTitleDroppable=!0;this.dragAriaLabel=this.title;this.ariaDropzoneTitle(localizedText.Accessibility_DropZone()+" "+(this.index()+1));this.ariaDropzoneImage(this.image().metadataScreenReaderDescription);this.ariaDropzoneCaption(this.caption);this.dropZones.push("title-zone-"+
this.id());this.onDragOverContainer=function(){};this.onDragOutContainer=function(){};break;case EnumDragItemType.image:this.isImageDroppable=!0;this.dragAriaLabel=this.imageDraggable().metadataScreenReaderDescription;this.ariaDropzoneTitle(this.title);this.ariaDropzoneImage(localizedText.Accessibility_DropZone()+" "+(this.index()+1));this.ariaDropzoneCaption(this.caption);this.dropZones.push("image-zone-"+this.id());this.onDragOverContainer=function(){};this.onDragOutContainer=function(){};break;
case EnumDragItemType.fullStep:this.isAllDraggable=this.isCaptionDroppable=this.isTitleDroppable=this.isImageDroppable=!0,this.dragAriaLabel=this.title+"\n"+this.imageDraggable().metadataScreenReaderDescription+"\n"+this.caption,this.ariaDropzoneTitle(localizedText.Accessibility_DropZone()+" "+(this.index()+1)),this.ariaDropzoneImage(localizedText.Accessibility_DropZone()+" "+(this.index()+1)),this.ariaDropzoneCaption(localizedText.Accessibility_DropZone()+" "+(this.index()+1)),this.dropZones.push(this.captionDropZoneId,
this.imageDropZoneId,this.titleDropZoneId),this.onDragOverContainer=function(){for(var a=0;a<b.dropZones.length;a++)$("#"+b.dropZones[a]).addClass("dropzone--dragging-hoverAll")},this.onDragOutContainer=function(){for(var a=0;a<b.dropZones.length;a++)$("#"+b.dropZones[a]).removeClass("dropzone--dragging-hoverAll")}}};a.prototype.sizeChanged=function(){b.prototype.sizeChanged.call(this);this.imageDraggable().resize()};a.prototype.initializeDraggable=function(a){this.imageDraggable(MediaFactory.createMedia(a.media))};
a.prototype.onClick=function(){this.answerFound()&&this.select()};a.prototype.setParent=function(a){this.puzzleParent=a};a.prototype.selectDropZone=function(){var a=this.puzzleParent.getFirstDragItem();this.getParent().selectedDropZone=this;this.getParent().domSelectedDropZone=$("#"+this.dropZones[0]);this.getParent().resetTabindex();this.getParent().setDragTabindex();a&&$("#"+a.draggableId).focus()};a.prototype.selectDragItem=function(){this.getParent().getOwnerViewModel().isActiveAndAccessibilityEnabled()&&
this.getParent().selectedDropZone&&(this.getParent().selectedDragItem=this,this.getParent().checkAnswers()?(this.getParent().getOwnerViewModel().setAlertContent(localizedText.Accessibility_CorrectAnswer()),this.getParent().selectedDropZone.onDrop(),this.getParent().resetDragTabindex(),this.getParent().setTabindex(),this.ariaDropzoneTitle(this.title),this.ariaDropzoneImage(this.image().metadataScreenReaderDescription),this.ariaDropzoneCaption(this.caption),this.getParent().domSelectedDropZone.focus()):
this.getParent().getOwnerViewModel().setAlertContent(localizedText.Accessibility_WrongAnswer()))};a.prototype.onDrop=function(){for(var a=0;a<this.dropZones.length;a++)$("#"+this.dropZones[a]).removeClass("dropzone--dragging-hover").removeClass("dropzone--dragging-hoverAll");this.answerFound(!0);this.select();this.onDragOutContainer();this.puzzleParent.allItemsDropped()&&this.puzzleParent.hideStickyFooter(!0)};return a}(ProcessCommonItem),ProcessPuzzleViewModel=function(b){function a(a){b.call(this,
a);this.items=ko.observableArray([]);this.dragItemsList=ko.observableArray([]);this.selectedItem=ko.observable(null);this.selectedIndex=ko.observable(-1);this.tableId=ko.observable(GuidHelper.newGuid());this.selectedItemResponseText=ko.observable("");this.selectedItemFeedbackCssClass=ko.observable("");this.stretchablefeedbackVisible=ko.observable(!1);this.hasPolaroid=ko.observable(!1);this.arrowVisible=ko.observable(!1);this.dragItemType=ko.observable(EnumDragItemTypeHelper.toString(EnumDragItemType.fullStep));
this.draggablesContainerId=GuidHelper.newGuid();this.columnNumberClass=ko.observable("");this.stickyColumnNumberClass=ko.observable("");this.isDragDropTemplate=!0;this.helper=new ProcessCommon(this,this.title,this.instruction,this.items,this.hasPolaroid,this.selectedItem,this.selectedIndex,this.stretchablefeedbackVisible,this.selectedItemResponseText,this.selectedItemFeedbackCssClass,this.arrowVisible,!0,!0,this.itemPuzzleFactory)}__extends(a,b);a.prototype.loadData=function(a){platformFeatures.getIsPhone()?
this.layoutTemplate("FluidBoxPuzzleDragAndDropLayout"):this.layoutTemplate("ProcessPuzzleStandardLayout");this.helper.loadData(a);this.loadDraggableItem(a.exercise.alternatives.alternative);this.dragItemType(EnumDragItemTypeHelper.toString(EnumDragItemTypeHelper.parseEnumDragItemType(a.exercise.dragItemType)));for(var d=0,e=this.items().length;d<e;d++)this.items()[d].draggableDisplayedElement(EnumDragItemTypeHelper.parseEnumDragItemType(a.exercise.dragItemType)),this.dragItemsList()[d].draggableDisplayedElement(EnumDragItemTypeHelper.parseEnumDragItemType(a.exercise.dragItemType));
this.stickyColumnNumberClass(this.helper.stickyColumnNumberClass);this.columnNumberClass(this.helper.columnNumberClass);return b.prototype.loadData.call(this,a)};a.prototype.loadDraggableItem=function(a){for(var b=[],e=this.items(),f=0,g=a.length;f<g;f++){var h=e[f];h.initializeDraggable(a[f]);b.push(h);b[f].setParent(this)}this.dragItemsList(ArrayHelper.shuffle(b))};a.prototype.itemPuzzleFactory=function(a,b,e,f,g){return new ProcessPuzzleItem(a,b,e,f,g)};a.prototype.initializeDragAndDrop=function(){webkit_DragManager.reset();
for(var a=this.dragItemsList(),b=0,e=a.length;b<e;b++)this.setDraggableElement(a[b]),this.setDropZone(a[b])};a.prototype.setDraggableElement=function(a){webkit_DragManager.addDraggable(a.draggableId,{revert:!0,container:$body[0],onStart:function(){}})};a.prototype.setDropZone=function(a){for(var b={accept:[a.draggableId],hoverClass:"dropzone--dragging-hover",hoverAllDropZone:!0,onAllOver:function(a){return function(){a.onDragOverContainer()}}(a),onAllOut:function(a){return function(){a.onDragOutContainer()}}(a),
onDrop:function(a){return function(){a.onDrop()}}(a)},e=0,f=a.dropZones.length;e<f;e++)webkit_DragManager.addDropZone(a.dropZones[e],b)};a.prototype.applyHeighest=function(){return this};a.prototype.sizeChanged=function(a,d){b.prototype.sizeChanged.call(this,a,d);this.helper.sizeChanged(a,d);for(var e=0,f=this.dragItemsList().length;e<f;e++)this.dragItemsList()[e].sizeChanged();return $.Deferred().resolve().promise()};a.prototype.swipeStarted=function(){this.stickyOnSwipeStarted();return this};a.prototype.swipeCancelled=
function(){this.stickyOnSwipeCancel();return this};a.prototype.swipeEnded=function(){this.stickyOnSwipeCancel();return this};a.prototype.start=function(){var a=this;b.prototype.start.call(this);this.helper.start();for(var d=0,e=this.dragItemsList().length;d<e;d++)this.dragItemsList()[d].sizeChanged();this.setTimeout("init-dnd",function(){a.initializeDragAndDrop()});return this};a.prototype.startThumbnail=function(){b.prototype.startThumbnail.call(this);this.initializeDragAndDrop();return this};a.prototype.stop=
function(){b.prototype.stop.call(this);this.helper.stop();return this};a.prototype.reset=function(){b.prototype.reset.call(this);this.helper.reset();return this};a.prototype.render=function(){b.prototype.render.call(this);this.helper.render();return this};a.prototype.cleanup=function(){try{b.prototype.cleanup.call(this),this.helper.cleanup()}catch(a){logger.error("ProcessPuzzle.cleanup error : "+a)}return this};a.prototype.getFirstDragItem=function(){for(var a=this.dragItemsList(),b=0,e=a.length;b<
e;b++)if(!a[b].answerFound())return a[b];return null};a.prototype.getItemsFluidBoxRenderer=function(){return"ProcessPuzzleItemsFluidBoxRenderer"};a.prototype.hasExerciseIntro=function(){return!StringHelper.isNullOrEmpty(this.helper.exerciseIntro.text())};a.prototype.allItemsDropped=function(){for(var a=!0,b=0;b<this.dragItemsList().length;b++)if(!this.dragItemsList()[b].answerFound()){a=!1;break}return a};return a}(BaseContentViewModel),SpacerViewModel=function(b){function a(a){b.call(this,a);this.subtitle=
"";this.titleId=GuidHelper.newGuid();this.subtitleId=GuidHelper.newGuid();this.positionBottom=this.positionMiddle=this.positionTop=!1;this._titlesSpacerTabindex=ko.observable(10);this.titlesSpacerTabindex=this.generateTabIndexComputed("_titlesSpacerTabindex",this)}__extends(a,b);a.prototype.loadData=function(a){this.title(a.exercise.title);this.subtitle=a.exercise.introduction;this.loadMedias(a.exercise.media);this.layoutTemplate("SpacerStandardLayout");var d=a.exercise["@layout"];"SpacerTitleOnTopLayout"==
d?(d="exercise--spacer-top",this.positionTop=!0):"SpacerTitleOnBottomLayout"==d?(d="exercise--spacer-bottom",this.positionBottom=!0):"SpacerTitleOnMiddleLayout"==d&&(d="exercise--spacer-middle",this.positionMiddle=!0);this.layout(d);return b.prototype.loadData.call(this,a)};a.prototype.loadMedias=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a),b=0,e=a.length;b<e;b++){var f=MediaFactory.createMedia(a[b]);f.type==MediaType.sound&&(this.openingSound=f,this.openingSound.onEnded.subscribe(this,
this.onSoundEnded))}};a.prototype.sizeChanged=function(){return $.Deferred().resolve().promise()};a.prototype.start=function(){var c=this;b.prototype.start.call(this);this.startUpTime=new Date;(!this.hasOpeningSound()||this.isActiveAndAccessibilityEnabled())&&this.parent.setExerciseCompleted();this.transitionTimeout=setTimeout(function(){c.onTransitionTimeout()},a.transitionMinDelay);this.isActiveAndAccessibilityEnabled()&&(StringHelper.isNullOrEmpty(this.title())?""!=this.subtitle&&$("#"+this.subtitleId).focus():
$("#"+this.titleId).focus());return this};a.prototype.stop=function(){b.prototype.stop.call(this);clearTimeout(this.transitionTimeout);return this};a.prototype.cleanup=function(){try{clearTimeout(this.transitionTimeout)}catch(a){logger.error("EndingViewModel.cleanup error : "+a)}b.prototype.cleanup.call(this);return this};a.prototype.onTransitionTimeout=function(){if(!this.openingSound.isPlaying())this.onSpacerEnded()};a.prototype.onSoundEnded=function(){var b=this;this.parent.setExerciseCompleted();
this.isActiveAndAccessibilityEnabled()||(new Date).getTime()-this.startUpTime.getTime()>a.transitionMinDelay&&setTimeout(function(){b.onSpacerEnded()},a.soundMinDelay)};a.prototype.onSpacerEnded=function(){this.parent.exerciseTransitionType==EnumTransitionType.Auto&&!this.isActiveAndAccessibilityEnabled()&&this.slideToNextExercise()};a.prototype.slideToNextExercise=function(){applicationViewModel.navigationManager.followNextLink()};a.transitionMinDelay=6E3;a.soundMinDelay=500;return a}(BaseContentViewModel),
WhatIfViewModel=function(b){function a(a){var d=this;b.call(this,a);this.isReadMode=ko.observable(!0);this.items=ko.observableArray([]);this.selectedItem=ko.observable(null);this.image=ko.observable(new MediaImage);this.imageContentHeight=ko.observable(0);this.slideHeight=ko.observable(0);this.slideWidth=ko.observable(0);this.isStarted=!1;this.viewportMaxHeight=ko.observable("");this.getDomAnswers=function(){return d.parent.getExerciseDom().find(".whatif__answers")};this.mustSaveAnswers=!1;this.readyToAnimateItem=
ko.observable(!1);this._tabindex=ko.observable(100);this.tabindex=this.generateTabIndexComputed("_tabindex",this);this.checkResponses=function(){for(var a=!0,b=!0,c=!0,h=!0,i=0,j=d.items().length;i<j;i++){var k=d.items()[i];k.isCorrect&&(h=!1);k.isSelected()||(a=!1);k.isCorrect&&!k.isSelected()&&(b=!1);if(k.state()==WhatIfItemState.SelectedLast){c=!1;break}}return h&&a&&c||!h&&b&&c};this.retrieveAnswers=function(){for(var a={type:"choice",correct:"",given:"",weighting:"0"},b=[],c=[],h=0,i=d.items().length;h<
i;h++){var j=d.items()[h];if(j.isSelected()){var k=j.state();c.push(h.toString()+interactionLearnerResponseSeparator+k)}!0===j.isCorrect&&b.push(h.toString())}a.correct=ScormHelper.arrayToString(b);a.given=ScormHelper.arrayToString(c);return a};this.resumeAnswers=function(a){if(null!=a&&(a=ScormHelper.stringToArray(a),null!=a&&0<a.length&&""!=a[0]))for(var b=0;b<a.length;b++)if(null!=a[b]){var c=a[b].split(interactionLearnerResponseSeparator);if(2==c.length){var h=+c[0],c=WhatIfItemState[WhatIfItemState[c[1]]];
null!=d.items()[h]&&d.items()[h].state(c)}}};this.resetAllUserAnswers=function(){for(var a=0,b=d.items().length;a<b;a++)d.items()[a].state(WhatIfItemState.NotSelected)};this.selectedItem(new WhatIfItem(this));if(this.mustSaveAnswers=applicationViewModel.navigationManager.existsAlternativeDestinationFrom(a.exerciseId))this.interactionApi=new InteractionApi,a.initInteractionApi(this.interactionApi),this.assessmentManager=new AssessmentManager(a.exerciseId,this.interactionApi,this.isActiveAndAccessibilityEnabled,
!0)}__extends(a,b);a.prototype.loadData=function(a){this.instruction(a.exercise.instruction);this.question(a.exercise.question);this.loadItems(a.exercise.alternatives);this.layout(a.exercise["@layout"]);this.loadViewFromLayout();this.loadMedias(a.exercise.media);this.mustSaveAnswers&&this.assessmentManager.initialize(null,this.checkResponses,this.parent.setExerciseCompleted,this.retrieveAnswers,this.resumeAnswers,this.resetAllUserAnswers);return b.prototype.loadData.call(this,a)};a.prototype.loadViewFromLayout=
function(){switch(this.layout()){case a.layouts.whatIfSmallImageStandardLayout:case a.layouts.whatIfMediumImageStandardLayout:this.layoutTemplate("WhatIfStandardLayout");this.applySmallSizeLayout();this.readyToAnimateItem(!0);break;default:this.layoutTemplate("WhatIfOpenUpLayout"),this.isLayoutOpenup(!0),this.applyFullScreenSizeLayout(),this.readyToAnimateItem(!1)}};a.prototype.loadMedias=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a),b=0,e=a.length;b<e;b++){var f=MediaFactory.createMedia(a[b]);
f.type==MediaType.sound?this.openingSound=f:f.type==MediaType.image&&this.image(f)}};a.prototype.resetTabindex=function(){this._tabindex(-1);for(var a=this.items(),b=0,e=a.length;b<e;b++)a[b].resetTabindex()};a.prototype.setTabindex=function(){this._tabindex(100);for(var a=this.items(),b=0,e=a.length;b<e;b++)a[b].setTabindex(100)};a.prototype.isLittleImage=function(){switch(this.layout()){case a.layouts.whatIfSmallImageOpenUpLayout:case a.layouts.whatIfSmallImageStandardLayout:return!0;default:return!1}};
a.prototype.isMediumImage=function(){switch(this.layout()){case a.layouts.whatIfMediumImageStandardLayout:return!0;default:return!1}};a.prototype.getAvailableHeightContentWrapper=function(){return this.slideHeight()-this.imageContentHeight()};a.prototype.getBottomContentWrapper=function(){var a=this.getDomContentWrapper().height(),b=this.getAvailableHeightContentWrapper(),e=-1*(a-b)+"px";a<=b&&(e="0px");return e};a.prototype.start=function(){this.isStarted=!0;b.prototype.start.call(this);this.image().play();
this.repositionBottomContent();for(var a=0,d=this.items();a<d.length;a++)d[a].initialize();this.checkExerciseCompleted();return this};a.prototype.resetBottomContentPosition=function(){"WhatIfOpenUpLayout"==this.layoutTemplate()&&(this.readyToAnimateItem(!1),this.mustSaveAnswers||this.unselectItems(),this.getDomContentWrapper().css("bottom",-1*this.getDomAnswers().height()+"px"))};a.prototype.repositionBottomContent=function(){var a=this;if("WhatIfOpenUpLayout"==this.layoutTemplate()){var b=!uiManager.screenshotMode&&
!this.isActiveAndAccessibilityEnabled(),e=this.baseContentBackgroundViewModel.hasBackground()?1E3:200,f=this.getBottomContentWrapper();b?this.setTimeout("repositionBottom"+(new Date).getMilliseconds,function(){a.getDomContentWrapper().animate({bottom:f},1E3,function(){a.updateScrollbar();a.readyToAnimateItem(!0)})},e):(this.getDomContentWrapper().css({bottom:f}),this.readyToAnimateItem(!0))}};a.prototype.startThumbnail=function(){this.start();return this};a.prototype.stop=function(){b.prototype.stop.call(this);
this.isStarted=!1;var a=this.selectedItem();null!=a&&a.stop();this.mustSaveAnswers||this.unselectItems();this.hideFeedback();this.resetBottomContentPosition();return this};a.prototype.unselectItems=function(){for(var a=this.items(),b=0,e=a.length;b<e;b++)a[b].state(WhatIfItemState.NotSelected)};a.prototype.onFeedbackCloseClick=function(){var a=this;b.prototype.onFeedbackCloseClick.call(this);this.tabindexTitleComponent(BaseContentViewModel.TITLE_COMPONENT_TABINDEX_ORDER_VALUE);this.setTabindex();
this.isActiveAndAccessibilityEnabled()&&(platformFeatures.getIsIE()&&BrowserHelper.refreshDom(),setTimeout(function(){$("#"+a.selectedItem().answerId()).focus()},500));this.checkExerciseCompleted();for(var d=0,e=this.items();d<e.length;d++)e[d].initialize();this.readyToAnimateItem(!0)};a.prototype.updateImageContentHeight=function(a){this.imageContentHeight(this.slideHeight()*a/100);var a=this.getDomContentWrapper().height(),b=this.getAvailableHeightContentWrapper();a<b&&this.imageContentHeight(this.slideHeight()-
a)};a.prototype.sizeChanged=function(a,d){b.prototype.sizeChanged.call(this,a,d);var e=100*(this.image().getDimensions().image.height/d);e&&(e+=2);this.slideHeight(d);this.slideWidth(a);this.updateImageContentHeight(e);this.image().switchImageQualityIfNecessary();this.isStarted?this.repositionBottomContent():this.resetBottomContentPosition();this.updateScrollbar();return $.Deferred().resolve().promise()};a.prototype.cleanup=function(){try{b.prototype.cleanup.call(this);null!=this.selectedItem()&&
this.selectedItem(null);for(var a=this.items(),d=0,e=a.length;d<e;d++)a[d].cleanup();this.items(null)}catch(f){logger.error("WhatIfViewModel.cleanup error : "+f)}return this};a.prototype.setSelectedItem=function(a){this.openingSound.stop();this.selectedItem(a);this.feedback.setFeedback(a.feedbackMedia,a.sound,a.feedbackText);this.feedback.sizeChanged(this.parent.width,this.parent.height);this.showFeedback();a.start()};a.prototype.checkExerciseCompleted=function(){for(var a=!0,b=!0,e=this.items(),
f=0,g=e.length;f<g;f++)b=b&&e[f].isSelected(),e[f].isCorrect&&(a=a&&e[f].isSelected());this.isReadMode()?b&&this.parent.setExerciseCompleted():a&&this.parent.setExerciseCompleted()};a.prototype.loadItems=function(a){if(void 0!=a)for(var a=ArrayHelper.getArrayFromJson(a.alternative),b=0,e=a.length;b<e;b++){var f;f=new WhatIfItem(this);f.loadData(a[b]);f.isLast=b==a.length-1;this.items.push(f);this.isReadMode(this.isReadMode()&&!f.isCorrect)}};a.layouts={whatIfSmallImageStandardLayout:"WhatIfSmallImageStandardLayout",
whatIfMediumImageStandardLayout:"WhatIfMediumImageStandardLayout",whatIfSmallImageOpenUpLayout:"WhatIfSmallImageOpenUpLayout"};return a}(BaseContentViewModel),WhatIfItem=function(){function b(a){var b=this;this.text="";this.feedbackText=new MediaText;this.isLast=this.isCorrect=!1;this.state=ko.observable(WhatIfItemState.NotSelected);this.isSelected=ko.computed(function(){return b.state()!=WhatIfItemState.NotSelected});this.cssClass=ko.observable("whatifanswers");this.feedbackMedia=new MediaBase;this.sound=
null;this.hasFeedback=!1;this.answerId=ko.observable(GuidHelper.newGuid());this.iconId=ko.computed(function(){return b.answerId()+"_iconfont"});this.getDomAnswerWrapper=function(){return $("#"+b.answerId())};this._tabindex=ko.observable(100);this.ariaLabel=ko.observable("");this.branchingDestinationType=null;this.look=ko.computed(function(){return b.getLook()});this.waitForAnimation=ko.observable(!1);this.animateIcon=ko.computed(function(){return b.waitForAnimation()&&b.parent.readyToAnimateItem()});
this.showIcon=ko.computed(function(){return b.isSelected()&&(!b.parent.isReadMode()||b.parent.mustSaveAnswers)});this.parent=a;this.tabindex=this.parent.generateTabIndexComputed("_tabindex",this)}b.prototype.initialize=function(){this.state()==WhatIfItemState.SelectedLast?(this.waitForAnimation(!0),this.state(WhatIfItemState.Selected),this.parent.mustSaveAnswers&&this.parent.assessmentManager.submitProcess()):this.waitForAnimation(!1)};b.prototype.cleanup=function(){null!=this.feedbackMedia&&this.feedbackMedia.cleanup();
null!=this.sound&&this.sound.cleanup()};b.prototype.setTabindex=function(a){this._tabindex(a)};b.prototype.resetTabindex=function(){this._tabindex(-1)};b.prototype.loadData=function(a){this.altNum=+a["@altnum"];this.text="";a.text&&(this.text=StringHelper.getHtmlFormat(a.text["#text"]));this.feedbackText.loadData(a.response.text,this.parent.parent.exerciseId);"true"==a["@correct"]&&(this.isCorrect=!0);a.response&&(a.response["@destinationId"]?(this.branchingDestinationId=+a.response["@destinationId"],
this.branchingDestinationType=EnumBranchingDestinationTypeHelper.parseEnumBranchingDestinationType(a.response["@destinationType"])):this.loadMedias(a.response.media));this.ariaLabel(this.text);this.hasFeedback=""!=this.feedbackText.text()||""!=this.feedbackMedia.url()||null!=this.sound};b.prototype.onClick=function(){var a=this;this.state()==WhatIfItemState.NotSelected&&(this.state(WhatIfItemState.SelectedLast),this.parent.mustSaveAnswers&&this.parent.assessmentManager.submitProcess());if(null!=this.branchingDestinationType)this.branchingDestinationType==
EnumBranchingDestinationType.None?(this.state()!=WhatIfItemState.Selected&&(this.parent.readyToAnimateItem(!0),this.waitForAnimation(!0)),this.state(WhatIfItemState.Selected),this.parent.assessmentManager.submitProcess(),this.parent.checkExerciseCompleted()):applicationViewModel.navigationManager.followAlternativeLink(this.parent.parent.exerciseId,this.altNum);else{var b=this.isCorrect?localizedText.Accessibility_CorrectAnswer():localizedText.Accessibility_WrongAnswer();this.parent.isReadMode()?b=
"":this.parent.isActiveAndAccessibilityEnabled()&&this.parent.setAlertContent(b);this.ariaLabel(this.text+"\n"+b);this.hasFeedback?(this.parent.tabindexTitleComponent(BaseContentViewModel.DISABLED_TABINDEX_ORDER_VALUE),this.parent.resetTabindex(),setTimeout(function(){a.parent.setSelectedItem(a)},platformFeatures.getFeedbackDelay())):(this.parent.checkExerciseCompleted(),this.parent.setAlertContent(b+this.text));this.parent.readyToAnimateItem(!1)}};b.prototype.start=function(){};b.prototype.stop=
function(){null!=this.sound&&this.sound.stop()};b.prototype.loadMedias=function(a){for(var a=ArrayHelper.getArrayFromJson(a),b=0,d=a.length;b<d;b++){var e=MediaFactory.createMedia(a[b]);e.type==MediaType.sound?""!=e.url()&&(this.sound=e):this.feedbackMedia=e}};b.prototype.setCssClass=function(){var a="whatifanswers";this.isSelected&&(a=this.isCorrect?a+" right":a+" wrong");this.cssClass(a)};b.prototype.getLook=function(){return this.state()==WhatIfItemState.NotSelected?WhatIfItemLook.NotSelected:
this.parent.mustSaveAnswers?this.parent.isReadMode()?WhatIfItemLook.SelectedLinkRead:this.isCorrect?WhatIfItemLook.SelectedLinkCorrect:WhatIfItemLook.SelectedLinkIncorrect:this.parent.isReadMode()?WhatIfItemLook.SelectedWithoutLinkRead:this.isCorrect?WhatIfItemLook.SelectedWithoutLinkCorrect:WhatIfItemLook.SelectedWithoutLinkIncorrect};return b}(),WhatIfItemState;
(function(b){b[b.NotSelected=0]="NotSelected";b[b.SelectedLast=1]="SelectedLast";b[b.Selected=2]="Selected"})(WhatIfItemState||(WhatIfItemState={}));var WhatIfItemLook;
(function(b){b[b.NotSelected=0]="NotSelected";b[b.SelectedWithoutLinkRead=1]="SelectedWithoutLinkRead";b[b.SelectedWithoutLinkCorrect=2]="SelectedWithoutLinkCorrect";b[b.SelectedWithoutLinkIncorrect=3]="SelectedWithoutLinkIncorrect";b[b.SelectedLinkRead=4]="SelectedLinkRead";b[b.SelectedLinkCorrect=5]="SelectedLinkCorrect";b[b.SelectedLinkIncorrect=6]="SelectedLinkIncorrect"})(WhatIfItemLook||(WhatIfItemLook={}));
var VideoViewModel=function(b){function a(a){b.call(this,a);this.video=new MediaVideo(!1);this.layout=ko.observable("");this.layoutId=ko.observable(GuidHelper.newGuid());this.defaultLayout="VideoFullscreenLayout";this.videolayouts=["VideoFullscreenLayout","VideoWithTitleLayout"];this.slideImageUrl=ko.observable("");this.loadSkinData();this.video.onEnded.subscribe(this,this.videoEnded)}__extends(a,b);a.prototype.loadSkinData=function(){this.slideImageUrl(SkinManager.getInstance().getTemplateSetting("video",
"slidepageimageurl",!0))};a.prototype.initDom=function(){b.prototype.initDom.call(this);this.video.initializePlayerSize();this.video.loadUrl();return this};a.prototype.loadData=function(a){this.video.loadData(a.exercise.media);this.title(a.exercise.title);var d=a.exercise["@layout"];d&&-1!=this.videolayouts.indexOf(d)?this.layoutTemplate(d):this.layoutTemplate(this.defaultLayout);"VideoFullscreenLayout"==this.layoutTemplate()?this.layout("video--fullscreen"):"VideoWithTitleLayout"==this.layoutTemplate()&&
this.layout("video--title");this.applyFullScreenSizeLayout();return b.prototype.loadData.call(this,a)};a.prototype.sizeChanged=function(a){var b=this.getDomOverview().height()-this.getDomTitleWrapper().height();this.getDomContent().height(b);this.video.sizeChanged(a,b);return $.Deferred().resolve().promise()};a.prototype.swipeStarted=function(){this.video.pause();return this};a.prototype.swipeCancelled=function(){platformFeatures.getIsPhone()||this.video.play();return this};a.prototype.start=function(){b.prototype.start.call(this);
this.log("info","(Template) Video.play");this.isActiveAndAccessibilityEnabled()?(this.video.setTabindex(100),this.layoutTemplate()==this.defaultLayout?$(".videoWrapper",this.getDom()).focus():this.getDomTitleH1().focus(),$("[tabindex=0]",this.getDom()).each(function(){$(this).attr("tabindex",-1)})):this.video.play();return this};a.prototype.startThumbnail=function(){this.video.sizeChanged(0,0);return this};a.prototype.stop=function(){b.prototype.stop.call(this);this.video.resetTabindex();this.video.stop();
return this};a.prototype.reset=function(){return this};a.prototype.cleanup=function(){b.prototype.cleanup.call(this);this.video.cleanup();return this};a.prototype.videoEnded=function(){var a=this;this.parent.exerciseTransitionType==EnumTransitionType.Auto&&!this.isActiveAndAccessibilityEnabled()&&setTimeout(function(){a.slideToNextExercise()},500);this.parent.setExerciseCompleted()};a.prototype.slideToNextExercise=function(){applicationViewModel.navigationManager.followNextLink()};a.videoTemplateName=
"VideoTemplate";return a}(BaseContentViewModel);
